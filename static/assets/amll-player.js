(function(){const T=document.createElement("link").relList;if(T&&T.supports&&T.supports("modulepreload"))return;for(const I of document.querySelectorAll('link[rel="modulepreload"]'))R(I);new MutationObserver(I=>{for(const F of I)if(F.type==="childList")for(const D of F.addedNodes)D.tagName==="LINK"&&D.rel==="modulepreload"&&R(D)}).observe(document,{childList:!0,subtree:!0});function L(I){const F={};return I.integrity&&(F.integrity=I.integrity),I.referrerPolicy&&(F.referrerPolicy=I.referrerPolicy),I.crossOrigin==="use-credentials"?F.credentials="include":I.crossOrigin==="anonymous"?F.credentials="omit":F.credentials="same-origin",F}function R(I){if(I.ep)return;I.ep=!0;const F=L(I);fetch(I.href,F)}})();const __vite__wasmUrl="/assets/amll_lyric_bg-Dy4VPaCX.wasm",__vite__initWasm=async(P={},T)=>{let L;if(T.startsWith("data:")){const R=T.replace(/^data:.*?base64,/,"");let I;if(typeof Buffer=="function"&&typeof Buffer.from=="function")I=Buffer.from(R,"base64");else if(typeof atob=="function"){const F=atob(R);I=new Uint8Array(F.length);for(let D=0;D<F.length;D++)I[D]=F.charCodeAt(D)}else throw new Error("Cannot decode base64-encoded data URL");L=await WebAssembly.instantiate(I,P)}else{const R=await fetch(T),I=R.headers.get("Content-Type")||"";if("instantiateStreaming"in WebAssembly&&I.startsWith("application/wasm"))L=await WebAssembly.instantiateStreaming(R,P);else{const F=await R.arrayBuffer();L=await WebAssembly.instantiate(F,P)}}return L.instance.exports};let wasm$1;function __wbg_set_wasm(P){wasm$1=P}const heap=new Array(128).fill(void 0);heap.push(void 0,null,!0,!1);function getObject(P){return heap[P]}let heap_next=heap.length;function dropObject(P){P<132||(heap[P]=heap_next,heap_next=P)}function takeObject(P){const T=getObject(P);return dropObject(P),T}function addHeapObject(P){heap_next===heap.length&&heap.push(heap.length+1);const T=heap_next;return heap_next=heap[T],heap[T]=P,T}const lTextDecoder=typeof TextDecoder>"u"?(0,module.require)("util").TextDecoder:TextDecoder;let cachedTextDecoder=new lTextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});cachedTextDecoder.decode();let cachedUint8ArrayMemory0=null;function getUint8ArrayMemory0(){return(cachedUint8ArrayMemory0===null||cachedUint8ArrayMemory0.byteLength===0)&&(cachedUint8ArrayMemory0=new Uint8Array(wasm$1.memory.buffer)),cachedUint8ArrayMemory0}function getStringFromWasm0(P,T){return P=P>>>0,cachedTextDecoder.decode(getUint8ArrayMemory0().subarray(P,P+T))}let WASM_VECTOR_LEN=0;const lTextEncoder=typeof TextEncoder>"u"?(0,module.require)("util").TextEncoder:TextEncoder;let cachedTextEncoder=new lTextEncoder("utf-8");const encodeString=typeof cachedTextEncoder.encodeInto=="function"?function(P,T){return cachedTextEncoder.encodeInto(P,T)}:function(P,T){const L=cachedTextEncoder.encode(P);return T.set(L),{read:P.length,written:L.length}};function passStringToWasm0(P,T,L){if(L===void 0){const V=cachedTextEncoder.encode(P),q=T(V.length,1)>>>0;return getUint8ArrayMemory0().subarray(q,q+V.length).set(V),WASM_VECTOR_LEN=V.length,q}let R=P.length,I=T(R,1)>>>0;const F=getUint8ArrayMemory0();let D=0;for(;D<R;D++){const V=P.charCodeAt(D);if(V>127)break;F[I+D]=V}if(D!==R){D!==0&&(P=P.slice(D)),I=L(I,R,R=D+P.length*3,1)>>>0;const V=getUint8ArrayMemory0().subarray(I+D,I+R),q=encodeString(P,V);D+=q.written,I=L(I,R,D,1)>>>0}return WASM_VECTOR_LEN=D,I}function isLikeNone(P){return P==null}let cachedDataViewMemory0=null;function getDataViewMemory0(){return(cachedDataViewMemory0===null||cachedDataViewMemory0.buffer.detached===!0||cachedDataViewMemory0.buffer.detached===void 0&&cachedDataViewMemory0.buffer!==wasm$1.memory.buffer)&&(cachedDataViewMemory0=new DataView(wasm$1.memory.buffer)),cachedDataViewMemory0}function debugString(P){const T=typeof P;if(T=="number"||T=="boolean"||P==null)return`${P}`;if(T=="string")return`"${P}"`;if(T=="symbol"){const I=P.description;return I==null?"Symbol":`Symbol(${I})`}if(T=="function"){const I=P.name;return typeof I=="string"&&I.length>0?`Function(${I})`:"Function"}if(Array.isArray(P)){const I=P.length;let F="[";I>0&&(F+=debugString(P[0]));for(let D=1;D<I;D++)F+=", "+debugString(P[D]);return F+="]",F}const L=/\[object ([^\]]+)\]/.exec(toString.call(P));let R;if(L.length>1)R=L[1];else return toString.call(P);if(R=="Object")try{return"Object("+JSON.stringify(P)+")"}catch{return"Object"}return P instanceof Error?`${P.name}: ${P.message}
${P.stack}`:R}function stringifyAss$1(P){let T,L;try{const F=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.stringifyAss(F,addHeapObject(P));var R=getDataViewMemory0().getInt32(F+0,!0),I=getDataViewMemory0().getInt32(F+4,!0);return T=R,L=I,getStringFromWasm0(R,I)}finally{wasm$1.__wbindgen_add_to_stack_pointer(16),wasm$1.__wbindgen_free(T,L,1)}}function decryptQrcHex$1(P){let T,L;try{const F=wasm$1.__wbindgen_add_to_stack_pointer(-16),D=passStringToWasm0(P,wasm$1.__wbindgen_malloc,wasm$1.__wbindgen_realloc),V=WASM_VECTOR_LEN;wasm$1.decryptQrcHex(F,D,V);var R=getDataViewMemory0().getInt32(F+0,!0),I=getDataViewMemory0().getInt32(F+4,!0);return T=R,L=I,getStringFromWasm0(R,I)}finally{wasm$1.__wbindgen_add_to_stack_pointer(16),wasm$1.__wbindgen_free(T,L,1)}}function parseEslrc$1(P){const T=passStringToWasm0(P,wasm$1.__wbindgen_malloc,wasm$1.__wbindgen_realloc),L=WASM_VECTOR_LEN,R=wasm$1.parseEslrc(T,L);return takeObject(R)}function stringifyEslrc$1(P){let T,L;try{const F=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.stringifyEslrc(F,addHeapObject(P));var R=getDataViewMemory0().getInt32(F+0,!0),I=getDataViewMemory0().getInt32(F+4,!0);return T=R,L=I,getStringFromWasm0(R,I)}finally{wasm$1.__wbindgen_add_to_stack_pointer(16),wasm$1.__wbindgen_free(T,L,1)}}function parseLrc$1(P){const T=passStringToWasm0(P,wasm$1.__wbindgen_malloc,wasm$1.__wbindgen_realloc),L=WASM_VECTOR_LEN,R=wasm$1.parseLrc(T,L);return takeObject(R)}function stringifyLrc$1(P){let T,L;try{const F=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.stringifyLrc(F,addHeapObject(P));var R=getDataViewMemory0().getInt32(F+0,!0),I=getDataViewMemory0().getInt32(F+4,!0);return T=R,L=I,getStringFromWasm0(R,I)}finally{wasm$1.__wbindgen_add_to_stack_pointer(16),wasm$1.__wbindgen_free(T,L,1)}}function parseLys$1(P){const T=passStringToWasm0(P,wasm$1.__wbindgen_malloc,wasm$1.__wbindgen_realloc),L=WASM_VECTOR_LEN,R=wasm$1.parseLys(T,L);return takeObject(R)}function stringifyLys$1(P){let T,L;try{const F=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.stringifyLys(F,addHeapObject(P));var R=getDataViewMemory0().getInt32(F+0,!0),I=getDataViewMemory0().getInt32(F+4,!0);return T=R,L=I,getStringFromWasm0(R,I)}finally{wasm$1.__wbindgen_add_to_stack_pointer(16),wasm$1.__wbindgen_free(T,L,1)}}function parseQrc$1(P){const T=passStringToWasm0(P,wasm$1.__wbindgen_malloc,wasm$1.__wbindgen_realloc),L=WASM_VECTOR_LEN,R=wasm$1.parseQrc(T,L);return takeObject(R)}function stringifyQrc$1(P){let T,L;try{const F=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.stringifyQrc(F,addHeapObject(P));var R=getDataViewMemory0().getInt32(F+0,!0),I=getDataViewMemory0().getInt32(F+4,!0);return T=R,L=I,getStringFromWasm0(R,I)}finally{wasm$1.__wbindgen_add_to_stack_pointer(16),wasm$1.__wbindgen_free(T,L,1)}}function parseTTML$1(P){const T=passStringToWasm0(P,wasm$1.__wbindgen_malloc,wasm$1.__wbindgen_realloc),L=WASM_VECTOR_LEN,R=wasm$1.parseTTML(T,L);return takeObject(R)}function stringifyTTML$1(P){let T,L;try{const F=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.stringifyTTML(F,addHeapObject(P));var R=getDataViewMemory0().getInt32(F+0,!0),I=getDataViewMemory0().getInt32(F+4,!0);return T=R,L=I,getStringFromWasm0(R,I)}finally{wasm$1.__wbindgen_add_to_stack_pointer(16),wasm$1.__wbindgen_free(T,L,1)}}function parseYrc$1(P){const T=passStringToWasm0(P,wasm$1.__wbindgen_malloc,wasm$1.__wbindgen_realloc),L=WASM_VECTOR_LEN,R=wasm$1.parseYrc(T,L);return takeObject(R)}function stringifyYrc$1(P){let T,L;try{const F=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.stringifyYrc(F,addHeapObject(P));var R=getDataViewMemory0().getInt32(F+0,!0),I=getDataViewMemory0().getInt32(F+4,!0);return T=R,L=I,getStringFromWasm0(R,I)}finally{wasm$1.__wbindgen_add_to_stack_pointer(16),wasm$1.__wbindgen_free(T,L,1)}}function wasm_start$1(){wasm$1.wasm_start()}function handleError(P,T){try{return P.apply(this,T)}catch(L){wasm$1.__wbindgen_exn_store(addHeapObject(L))}}function __wbindgen_object_drop_ref(P){takeObject(P)}function __wbindgen_is_bigint(P){return typeof getObject(P)=="bigint"}function __wbindgen_bigint_from_u64(P){const T=BigInt.asUintN(64,P);return addHeapObject(T)}function __wbindgen_jsval_eq(P,T){return getObject(P)===getObject(T)}function __wbindgen_error_new(P,T){const L=new Error(getStringFromWasm0(P,T));return addHeapObject(L)}function __wbindgen_is_object(P){const T=getObject(P);return typeof T=="object"&&T!==null}function __wbindgen_is_undefined(P){return getObject(P)===void 0}function __wbindgen_in(P,T){return getObject(P)in getObject(T)}function __wbindgen_string_get(P,T){const L=getObject(T),R=typeof L=="string"?L:void 0;var I=isLikeNone(R)?0:passStringToWasm0(R,wasm$1.__wbindgen_malloc,wasm$1.__wbindgen_realloc),F=WASM_VECTOR_LEN;getDataViewMemory0().setInt32(P+4,F,!0),getDataViewMemory0().setInt32(P+0,I,!0)}function __wbindgen_boolean_get(P){const T=getObject(P);return typeof T=="boolean"?T?1:0:2}function __wbindgen_jsval_loose_eq(P,T){return getObject(P)==getObject(T)}function __wbindgen_number_get(P,T){const L=getObject(T),R=typeof L=="number"?L:void 0;getDataViewMemory0().setFloat64(P+8,isLikeNone(R)?0:R,!0),getDataViewMemory0().setInt32(P+0,!isLikeNone(R),!0)}function __wbindgen_as_number(P){return+getObject(P)}function __wbindgen_number_new(P){return addHeapObject(P)}function __wbindgen_object_clone_ref(P){const T=getObject(P);return addHeapObject(T)}function __wbindgen_string_new(P,T){const L=getStringFromWasm0(P,T);return addHeapObject(L)}function __wbg_getwithrefkey_edc2c8960f0f1191(P,T){const L=getObject(P)[getObject(T)];return addHeapObject(L)}function __wbg_set_f975102236d3c502(P,T,L){getObject(P)[takeObject(T)]=takeObject(L)}function __wbg_call_1084a111329e68ce(){return handleError(function(P,T){const L=getObject(P).call(getObject(T));return addHeapObject(L)},arguments)}function __wbg_get_3baa728f9d58d3f6(P,T){const L=getObject(P)[T>>>0];return addHeapObject(L)}function __wbg_length_ae22078168b726f5(P){return getObject(P).length}function __wbg_new_a220cf903aa02ca2(){const P=new Array;return addHeapObject(P)}function __wbindgen_is_function(P){return typeof getObject(P)=="function"}function __wbg_next_de3e9db4440638b2(P){const T=getObject(P).next;return addHeapObject(T)}function __wbg_next_f9cb570345655b9a(){return handleError(function(P){const T=getObject(P).next();return addHeapObject(T)},arguments)}function __wbg_done_bfda7aa8f252b39f(P){return getObject(P).done}function __wbg_value_6d39332ab4788d86(P){const T=getObject(P).value;return addHeapObject(T)}function __wbg_iterator_888179a48810a9fe(){return addHeapObject(Symbol.iterator)}function __wbg_get_224d16597dbbfd96(){return handleError(function(P,T){const L=Reflect.get(getObject(P),getObject(T));return addHeapObject(L)},arguments)}function __wbg_new_525245e2b9901204(){const P=new Object;return addHeapObject(P)}function __wbg_set_673dda6c73d19609(P,T,L){getObject(P)[T>>>0]=takeObject(L)}function __wbg_isArray_8364a5371e9737d8(P){return Array.isArray(getObject(P))}function __wbg_instanceof_ArrayBuffer_61dfc3198373c902(P){let T;try{T=getObject(P)instanceof ArrayBuffer}catch{T=!1}return T}function __wbg_isSafeInteger_7f1ed56200d90674(P){return Number.isSafeInteger(getObject(P))}function __wbg_buffer_b7b08af79b0b0974(P){const T=getObject(P).buffer;return addHeapObject(T)}function __wbg_new_ea1883e1e5e86686(P){const T=new Uint8Array(getObject(P));return addHeapObject(T)}function __wbg_set_d1e79e2388520f18(P,T,L){getObject(P).set(getObject(T),L>>>0)}function __wbg_length_8339fcf5d8ecd12e(P){return getObject(P).length}function __wbg_instanceof_Uint8Array_247a91427532499e(P){let T;try{T=getObject(P)instanceof Uint8Array}catch{T=!1}return T}function __wbindgen_bigint_get_as_i64(P,T){const L=getObject(T),R=typeof L=="bigint"?L:void 0;getDataViewMemory0().setBigInt64(P+8,isLikeNone(R)?BigInt(0):R,!0),getDataViewMemory0().setInt32(P+0,!isLikeNone(R),!0)}function __wbindgen_debug_string(P,T){const L=debugString(getObject(T)),R=passStringToWasm0(L,wasm$1.__wbindgen_malloc,wasm$1.__wbindgen_realloc),I=WASM_VECTOR_LEN;getDataViewMemory0().setInt32(P+4,I,!0),getDataViewMemory0().setInt32(P+0,R,!0)}function __wbindgen_throw(P,T){throw new Error(getStringFromWasm0(P,T))}function __wbindgen_memory(){const P=wasm$1.memory;return addHeapObject(P)}URL=globalThis.URL;const __vite__wasmModule=await __vite__initWasm({"./amll_lyric_bg.js":{__wbindgen_object_drop_ref,__wbindgen_is_bigint,__wbindgen_bigint_from_u64,__wbindgen_jsval_eq,__wbindgen_error_new,__wbindgen_is_object,__wbindgen_is_undefined,__wbindgen_in,__wbindgen_string_get,__wbindgen_boolean_get,__wbindgen_jsval_loose_eq,__wbindgen_number_get,__wbindgen_as_number,__wbindgen_number_new,__wbindgen_object_clone_ref,__wbindgen_string_new,__wbg_getwithrefkey_edc2c8960f0f1191,__wbg_set_f975102236d3c502,__wbg_call_1084a111329e68ce,__wbg_get_3baa728f9d58d3f6,__wbg_length_ae22078168b726f5,__wbg_new_a220cf903aa02ca2,__wbindgen_is_function,__wbg_next_de3e9db4440638b2,__wbg_next_f9cb570345655b9a,__wbg_done_bfda7aa8f252b39f,__wbg_value_6d39332ab4788d86,__wbg_iterator_888179a48810a9fe,__wbg_get_224d16597dbbfd96,__wbg_new_525245e2b9901204,__wbg_set_673dda6c73d19609,__wbg_isArray_8364a5371e9737d8,__wbg_instanceof_ArrayBuffer_61dfc3198373c902,__wbg_isSafeInteger_7f1ed56200d90674,__wbg_buffer_b7b08af79b0b0974,__wbg_new_ea1883e1e5e86686,__wbg_set_d1e79e2388520f18,__wbg_length_8339fcf5d8ecd12e,__wbg_instanceof_Uint8Array_247a91427532499e,__wbindgen_bigint_get_as_i64,__wbindgen_debug_string,__wbindgen_throw,__wbindgen_memory}},__vite__wasmUrl),memory=__vite__wasmModule.memory,stringifyAss=__vite__wasmModule.stringifyAss,decryptQrcHex=__vite__wasmModule.decryptQrcHex,parseEslrc=__vite__wasmModule.parseEslrc,stringifyEslrc=__vite__wasmModule.stringifyEslrc,parseLrc=__vite__wasmModule.parseLrc,stringifyLrc=__vite__wasmModule.stringifyLrc,parseLys=__vite__wasmModule.parseLys,stringifyLys=__vite__wasmModule.stringifyLys,parseQrc=__vite__wasmModule.parseQrc,stringifyQrc=__vite__wasmModule.stringifyQrc,parseTTML=__vite__wasmModule.parseTTML,stringifyTTML=__vite__wasmModule.stringifyTTML,parseYrc=__vite__wasmModule.parseYrc,stringifyYrc=__vite__wasmModule.stringifyYrc,wasm_start=__vite__wasmModule.wasm_start,__wbindgen_malloc=__vite__wasmModule.__wbindgen_malloc,__wbindgen_realloc=__vite__wasmModule.__wbindgen_realloc,__wbindgen_add_to_stack_pointer=__vite__wasmModule.__wbindgen_add_to_stack_pointer,__wbindgen_free=__vite__wasmModule.__wbindgen_free,__wbindgen_exn_store=__vite__wasmModule.__wbindgen_exn_store,__wbindgen_start=__vite__wasmModule.__wbindgen_start,wasm=Object.freeze(Object.defineProperty({__proto__:null,__wbindgen_add_to_stack_pointer,__wbindgen_exn_store,__wbindgen_free,__wbindgen_malloc,__wbindgen_realloc,__wbindgen_start,decryptQrcHex,memory,parseEslrc,parseLrc,parseLys,parseQrc,parseTTML,parseYrc,stringifyAss,stringifyEslrc,stringifyLrc,stringifyLys,stringifyQrc,stringifyTTML,stringifyYrc,wasm_start},Symbol.toStringTag,{value:"Module"}));__wbg_set_wasm(wasm);__wbindgen_start();const lyrics=Object.freeze(Object.defineProperty({__proto__:null,__wbg_buffer_b7b08af79b0b0974,__wbg_call_1084a111329e68ce,__wbg_done_bfda7aa8f252b39f,__wbg_get_224d16597dbbfd96,__wbg_get_3baa728f9d58d3f6,__wbg_getwithrefkey_edc2c8960f0f1191,__wbg_instanceof_ArrayBuffer_61dfc3198373c902,__wbg_instanceof_Uint8Array_247a91427532499e,__wbg_isArray_8364a5371e9737d8,__wbg_isSafeInteger_7f1ed56200d90674,__wbg_iterator_888179a48810a9fe,__wbg_length_8339fcf5d8ecd12e,__wbg_length_ae22078168b726f5,__wbg_new_525245e2b9901204,__wbg_new_a220cf903aa02ca2,__wbg_new_ea1883e1e5e86686,__wbg_next_de3e9db4440638b2,__wbg_next_f9cb570345655b9a,__wbg_set_673dda6c73d19609,__wbg_set_d1e79e2388520f18,__wbg_set_f975102236d3c502,__wbg_set_wasm,__wbg_value_6d39332ab4788d86,__wbindgen_as_number,__wbindgen_bigint_from_u64,__wbindgen_bigint_get_as_i64,__wbindgen_boolean_get,__wbindgen_debug_string,__wbindgen_error_new,__wbindgen_in,__wbindgen_is_bigint,__wbindgen_is_function,__wbindgen_is_object,__wbindgen_is_undefined,__wbindgen_jsval_eq,__wbindgen_jsval_loose_eq,__wbindgen_memory,__wbindgen_number_get,__wbindgen_number_new,__wbindgen_object_clone_ref,__wbindgen_object_drop_ref,__wbindgen_string_get,__wbindgen_string_new,__wbindgen_throw,decryptQrcHex:decryptQrcHex$1,parseEslrc:parseEslrc$1,parseLrc:parseLrc$1,parseLys:parseLys$1,parseQrc:parseQrc$1,parseTTML:parseTTML$1,parseYrc:parseYrc$1,stringifyAss:stringifyAss$1,stringifyEslrc:stringifyEslrc$1,stringifyLrc:stringifyLrc$1,stringifyLys:stringifyLys$1,stringifyQrc:stringifyQrc$1,stringifyTTML:stringifyTTML$1,stringifyYrc:stringifyYrc$1,wasm_start:wasm_start$1},Symbol.toStringTag,{value:"Module"}));function parseTimestampMs(P){const T=P.split(/[:.]/);if(T.length<2||T.length>3)throw new Error(`Invalid timestamp format: ${P}`);let L,R,I;if(T.length===3){L=parseInt(T[0]),R=parseInt(T[1]);const F=T[2];switch(I=0,F.length){case 1:I=parseInt(F)*100;break;case 2:I=parseInt(F)*10;break;case 3:I=parseInt(F);break;default:I=parseInt(F.substring(0,3));break}}else L=parseInt(T[0]),R=parseInt(T[1]),I=0;return(L*60+R)*1e3+I}function isESLyRiCFormat(P){const T=P.split(`
`).filter(R=>R.trim().length>0);return T.length===0?!1:T.slice(0,Math.min(5,T.length)).some(R=>/^\[\d{2}:\d{2}\.\d{3}\][\u4e00-\u9fa5a-zA-Z0-9]\[\d{2}:\d{2}\.\d{3}\]/.test(R))}function isLyRiCA2Format(P){const T=P.split(`
`).filter(R=>R.trim().length>0);return T.length===0?!1:T.slice(0,Math.min(5,T.length)).some(R=>/^\[\d{2}:\d{2}\.\d{3}\]<\d{2}:\d{2}\.\d{3}>/.test(R))}function isSPLFormat(P){const T=P.split(`
`).filter(R=>R.trim().length>0);return T.length===0?!1:T.slice(0,Math.min(5,T.length)).some(R=>/^((\[\d{1,3}:\d{1,2}(?:\.\d{1,6})?\])+)(.*)$/.test(R.trim()))}function isWalaokeFormat(P){const T=P.split(`
`).filter(R=>R.trim().length>0);return T.length===0?!1:T.slice(0,Math.min(5,T.length)).some(R=>{const I=/^(W|F|D|v1|v2):\s*\[\d{2}:\d{2}\.\d{3}\]/,F=/^\[\d{2}:\d{2}\.\d{3}\]\s*(W|F|D|v1|v2):/;return I.test(R.trim())||F.test(R.trim())})}function parseESLyRiC(P){const T=P.split(`
`).filter(R=>R.trim().length>0),L=[];for(const R of T){const I=R.match(/^\[(\d{2}):(\d{2})\.(\d{3})\]/);if(!I)continue;const F=parseInt(I[1])*60*1e3+parseInt(I[2])*1e3+parseInt(I[3]);let D=R.substring(I[0].length);const V=[];let q=F;const G=D.match(/\[(\d{2}):(\d{2})\.(\d{3})\]/);if(G){const gt=parseInt(G[1])*60*1e3+parseInt(G[2])*1e3+parseInt(G[3]);F!==gt&&(q=gt)}const z=/([^\[]+)\[(\d{2}):(\d{2})\.(\d{3})\]/g;let Q;for(;(Q=z.exec(D))!==null;){const gt=Q[1],yt=parseInt(Q[2])*60*1e3+parseInt(Q[3])*1e3+parseInt(Q[4]);V.push({word:gt,startTime:q,endTime:yt}),q=yt}const tt=D.match(/([^\[]+)$/);if(tt){const gt=tt[1].replace(/\d{2}:\d{2}\.\d{3}\]$/,"");V.push({word:gt,startTime:q,endTime:q})}V.length>0&&(V[0].word=(V[0].word??V[0].text??"").replace(/^\s+/,""),V[V.length-1].word=(V[V.length-1].word??V[V.length-1].text??"").replace(/\s+$/,""),L.push({words:V,startTime:V[0].startTime,endTime:V[V.length-1].endTime,translatedLyric:"",romanLyric:"",isBG:!1,isDuet:!1}))}return L}function parseSPL(P){const T=P.split(`
`).filter(I=>I.trim().length>0),L=[],R=[];for(const I of T){const D=I.trim().match(/^\[(\d{1,3}):(\d{1,2})(?:\.(\d{1,6}))?\]/);if(!D)continue;const V=parseInt(D[1]),q=parseInt(D[2]),G=D[3]?parseInt(D[3].padEnd(3,"0").slice(0,3)):0,z=V*6e4+q*1e3+G;R.push(z)}for(let I=0;I<T.length;I++){const D=T[I].trim(),V=D.match(/^\[(\d{1,3}):(\d{1,2})(?:\.(\d{1,6}))?\]/);if(!V)continue;const q=parseInt(V[1]),G=parseInt(V[2]),z=V[3]?parseInt(V[3].padEnd(3,"0").slice(0,3)):0;let Q=q*6e4+G*1e3+z,tt;I===R.length-1?tt=Q+5e3:tt=R[I+1];let gt=D.substring(V[0].length);const yt=[];let Et=Q;if(gt.includes("<")||gt.includes("[")){const At=/([^<\[]+?)[<\[](\d{2}):(\d{2})\.(\d{2,3})[>\]]/g;let kt,ne=!1;const Te=[];for(;(kt=At.exec(gt))!==null;){ne=!0;const Ht=kt[1].trim(),Le=parseTimestampMs(`${kt[2]}:${kt[3]}.${kt[4]}`);Te.push({word:Ht,time:Le})}if(ne&&Te.length>0){for(let Le=0;Le<Te.length;Le++){const ee=Te[Le];Le<Te.length-1?Te[Le+1].time:ee.time+1e3,yt.push({word:ee.word,startTime:Et,endTime:ee.time}),Et=ee.time}const Ht=gt.match(/[<\[](\d{2}):(\d{2})\.(\d{2,3})[>\]]$/);if(Ht){const Le=parseTimestampMs(`${Ht[1]}:${Ht[2]}.${Ht[3]}`);yt.length>0&&(yt[yt.length-1].endTime=Le)}}else{const Ht=gt.match(/[<\[](\d{2}):(\d{2})\.(\d{2,3})[>\]]/);if(Ht&&Ht.index!==void 0){const ee=gt.substring(0,Ht.index).trim();ee&&(yt.push({word:ee,startTime:Et,endTime:parseTimestampMs(`${Ht[1]}:${Ht[2]}.${Ht[3]}`)}),Et=yt[yt.length-1].endTime),gt=gt.substring(Ht.index+Ht[0].length);let si;for(;(si=At.exec(gt))!==null;){const ci=si[1].trim(),ui=parseTimestampMs(`${si[2]}:${si[3]}.${si[4]}`);yt.push({word:ci,startTime:Et,endTime:ui}),Et=ui}}const Le=gt.match(/([^<]+)$/);if(Le){const ee=Le[1].trim();ee&&yt.push({word:ee,startTime:Et,endTime:tt})}}}else{const At=gt.trim();At&&yt.push({word:At,startTime:Q,endTime:tt})}yt.length>0&&(yt[0].word=(yt[0].word??"").replace(/^\s+/,""),yt[yt.length-1].word=(yt[yt.length-1].word??"").replace(/\s+$/,""),L.push({words:yt,startTime:yt[0].startTime,endTime:yt[yt.length-1].endTime,translatedLyric:"",romanLyric:"",isBG:!1,isDuet:!1}))}return L.sort((I,F)=>I.startTime-F.startTime),convertToTTML(L)}function parseWalaoke(P){const T=P.split(`
`).filter(R=>R.trim().length>0),L=[];for(const R of T){const I=R.trim(),F=I.match(/^(W|F|D|v1|v2):\s*[<\[](\d{2}):(\d{2})\.(\d{2,3})[>\]](.*)$/),D=I.match(/^[<\[](\d{2}):(\d{2})\.(\d{2,3})[>\]]\s*(W|F|D|v1|v2):(.*)$/);let V=F,q=!1;if(D&&(V=D,q=!0),V){let G,z,Q,tt,gt;q?[,z,Q,tt,G,gt]=V:[,G,z,Q,tt,gt]=V;const yt=parseInt(z)*6e4+parseInt(Q)*1e3+parseInt(tt);let Et=gt;const J=[];let At=yt;if(Et.includes("<")||Et.includes("[")){const Ht=Et.match(/^[<\[](\d{2}):(\d{2})\.(\d{2,3})[>\]]/);Ht&&(At=parseTimestampMs(`${Ht[1]}:${Ht[2]}.${Ht[3]}`),Et=Et.substring(Ht[0].length));const Le=/([^<\[]*?)[<\[](\d{2}):(\d{2})\.(\d{2,3})[>\]]/g;let ee,si=0;for(;(ee=Le.exec(Et))!==null;){const di=ee[1].trim(),ii=parseTimestampMs(`${ee[2]}:${ee[3]}.${ee[4]}`);di&&(J.push({word:di,startTime:At,endTime:ii}),At=ii),si=ee.index+ee[0].length}let ci=Et.substring(si).trim();const ui=ci.match(/^(.*)[<\[](\d{2}):(\d{2})\.(\d{2,3})[>\]]$/);if(ui){const di=ui[1].trim(),ii=parseTimestampMs(`${ui[2]}:${ui[3]}.${ui[4]}`);di?J.push({word:di,startTime:At,endTime:ii}):J.length>0&&(J[J.length-1].endTime=ii)}else ci&&J.push({word:ci,startTime:At,endTime:At+1e3})}else{const Ht=gt.trim();Ht&&J.push({word:Ht,startTime:yt,endTime:yt+1e3})}let ne=!1,Te="";switch(G){case"W":J.length>0&&(J[0].word=`[第一声部] ${J[0].word}`);break;case"F":J.length>0&&(J[0].word=`[第二声部] ${J[0].word}`);break;case"D":J.length>0&&(J[0].word=`[合唱] ${J[0].word}`);break;case"v1":ne=!0,Te="v1";break;case"v2":ne=!0,Te="v2";break}J.length>0&&(J[0].word=(J[0].word??"").replace(/^\s+/,""),J[J.length-1].word=(J[J.length-1].word??"").replace(/\s+$/,""),L.push({words:J,startTime:J[0].startTime,endTime:J[J.length-1].endTime,translatedLyric:"",romanLyric:"",isBG:!1,isDuet:ne,agent:Te}))}}return L.sort((R,I)=>R.startTime-I.startTime),convertToTTML(L)}function parseLyRiCA2(P){const T=P.split(`
`).filter(R=>R.trim().length>0),L=[];for(const R of T){const I=R.match(/^\[(\d{2}):(\d{2})\.(\d{3})\]<(\d{2}):(\d{2})\.(\d{3})>/);if(!I)continue;const F=parseInt(I[4])*60*1e3+parseInt(I[5])*1e3+parseInt(I[6]);let D=R.substring(I[0].length);const V=[];let q=F;const G=D.match(/<(\d{2}):(\d{2})\.(\d{3})>/);if(G){const gt=parseInt(G[1])*60*1e3+parseInt(G[2])*1e3+parseInt(G[3]);F!==gt&&(q=gt)}const z=/([^<]+)<(\d{2}):(\d{2})\.(\d{3})>/g;let Q;for(;(Q=z.exec(D))!==null;){const gt=Q[1],yt=parseInt(Q[2])*60*1e3+parseInt(Q[3])*1e3+parseInt(Q[4]);V.push({word:gt,startTime:q,endTime:yt}),q=yt}const tt=D.match(/([^<]+)$/);if(tt){const gt=tt[1].replace(/\d{2}:\d{2}\.\d{3}>$/,"");V.push({word:gt,startTime:q,endTime:q})}V.length>0&&(V[0].word=(V[0].word??V[0].text??"").replace(/^\s+/,""),V[V.length-1].word=(V[V.length-1].word??V[V.length-1].text??"").replace(/\s+$/,""),L.push({words:V,startTime:V[0].startTime,endTime:V[V.length-1].endTime,translatedLyric:"",romanLyric:"",isBG:!1,isDuet:!1}))}return L}function convertToTTML(P){let T=`<?xml version="1.0" encoding="utf-8"?>
<tt xmlns="http://www.w3.org/ns/ttml" xmlns:ttm="http://www.w3.org/ns/ttml#metadata" xmlns:tts="http://www.w3.org/ns/ttml#styling" xml:lang="en">
  <head>
    <metadata>
      <ttm:title>Converted Lyrics</ttm:title>
    </metadata>
    <styling>
      <style xml:id="normal" tts:fontFamily="Arial" tts:fontSize="100%" tts:textAlign="center"/>
    </styling>
    <layout>
      <region xml:id="bottom" tts:origin="0% 0%" tts:extent="100% 100%" tts:textAlign="center" tts:displayAlign="after"/>
    </layout>
  </head>
  <body>
    <div>
`;for(const L of P){const R=formatTime$3(L.startTime);if(!L.words||L.words.length===0)throw new Error(`Empty line: ${JSON.stringify(L)}`);const I=L.words[L.words.length-1];I.endTime||(I.endTime=I.startTime);const F=formatTime$3(I.endTime),D=L.agent?` ttm:agent="${L.agent}"`:"";T+=`      <p begin="${R}" end="${F}" region="bottom"${D}>`;const V=[];for(let q=0;q<L.words.length;q++){const G=L.words[q],z=formatTime$3(G.startTime),Q=formatTime$3(G.endTime);let tt=G.word??G.text??"";q===0&&(tt=tt.replace(/^\s+/,"")),q===L.words.length-1&&(tt=tt.replace(/\s+$/,"")),V.push(`<span begin="${z}" end="${Q}">${escapeXml$4(tt)}</span>`)}T+=V.join(""),T+=`</p>
`}return T+=`    </div>
  </body>
</tt>`,T}function formatTime$3(P){const T=Math.floor(P/1e3),L=Math.floor(T/3600),R=Math.floor(T%3600/60),I=T%60,F=P%1e3;return`${L.toString().padStart(2,"0")}:${R.toString().padStart(2,"0")}:${I.toString().padStart(2,"0")}.${F.toString().padStart(3,"0")}`}function escapeXml$4(P){return P.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}const ASS_TIME_REGEX=/(\d+):(\d{2}):(\d{2})\.(\d{2})/,KARAOKE_TAG_REGEX=/\{\\k(?:[fo])?(\d+)}/g,ASS_LINE_REGEX=/^(?<Type>Comment|Dialogue):\s*(?<Layer>\d+)\s*,\s*(?<Start>\d+:\d{2}:\d{2}\.\d{2})\s*,\s*(?<End>\d+:\d{2}:\d{2}\.\d{2})\s*,\s*(?<Style>[^,]*?)\s*,\s*(?<Actor>[^,]*?)\s*,\s*[^,]*\s*,\s*[^,]*\s*,\s*[^,]*\s*,\s*(?<Effect>[^,]*?)\s*,\s*(?<Text>.*?)\s*$/;function stripOverrideTags(P,T={}){const{collapseSpaces:L=!1,trim:R=!1}=T;let I=P.replace(/\{[^}]*\}/g,"").replace(/\\[Nn]/g," ").replace(/\\h/g," ");return L&&(I=I.replace(/[ \t]+/g," ")),R&&(I=I.trim()),I}function parseAssTime(P){const T=P.match(ASS_TIME_REGEX);if(!T)throw new Error(`无效的时间格式: ${P}`);const L=parseInt(T[1],10),R=parseInt(T[2],10),I=parseInt(T[3],10),F=parseInt(T[4],10);return L*36e5+R*6e4+I*1e3+F*10}function isAssFormat(P){if(!P)return!1;const T=P.slice(0,2048);return/\[Script Info\]/i.test(T)&&/\[Events\]/i.test(P)||/Aegisub/i.test(T)?!0:T.split(/\r?\n/).filter(Boolean).slice(0,30).some(R=>/^(Comment|Dialogue):/.test(R))}function parseAss(P){const T=[],L=P.split(/\r?\n/);for(const R of L){const I=R.match(ASS_LINE_REGEX);if(!I||!I.groups||I.groups.Type==="Comment")continue;const D=parseAssTime(I.groups.Start),V=parseAssTime(I.groups.End),q=I.groups.Text??"",G=[];let z=D;const Q=[...q.matchAll(KARAOKE_TAG_REGEX)];if(Q.length===0){const tt=stripOverrideTags(q,{collapseSpaces:!1,trim:!1});tt&&G.push({word:tt,startTime:D,endTime:V})}else{for(let tt=0;tt<Q.length;tt++){const gt=Q[tt],yt=Q[tt+1],Et=parseInt(gt[1]||"0",10),J=gt.index+gt[0].length,At=yt?yt.index:q.length,kt=q.slice(J,At),ne=stripOverrideTags(kt,{collapseSpaces:!1,trim:!1}),Te=Math.max(0,Et*10),Ht=z+Te;ne&&G.push({word:ne,startTime:z,endTime:Ht}),z=Ht}G.length>0&&G[G.length-1].endTime<V&&(G[G.length-1].endTime=V)}G.length>0&&T.push({words:G,startTime:G[0].startTime,endTime:G[G.length-1].endTime,translatedLyric:"",romanLyric:"",isBG:!1,isDuet:!1})}return T}function formatTime$2(P){const T=Math.floor(P/1e3),L=Math.floor(T/3600),R=Math.floor(T%3600/60),I=T%60,F=P%1e3;return`${L.toString().padStart(2,"0")}:${R.toString().padStart(2,"0")}:${I.toString().padStart(2,"0")}.${F.toString().padStart(3,"0")}`}function assToTTML(P){const T=parseAss(P);let L=`<?xml version="1.0" encoding="utf-8"?>
<tt xmlns="http://www.w3.org/ns/ttml" xmlns:ttm="http://www.w3.org/ns/ttml#metadata" xmlns:tts="http://www.w3.org/ns/ttml#styling" xml:lang="en">
  <head>
    <metadata>
      <ttm:title>Converted Lyrics</ttm:title>
    </metadata>
    <styling>
      <style xml:id="normal" tts:fontFamily="Arial" tts:fontSize="100%" tts:textAlign="center"/>
    </styling>
    <layout>
      <region xml:id="bottom" tts:origin="0% 0%" tts:extent="100% 100%" tts:textAlign="center" tts:displayAlign="after"/>
    </layout>
  </head>
  <body>
    <div>
`;for(const R of T){const I=formatTime$2(R.startTime),F=formatTime$2(R.endTime);L+=`      <p begin="${I}" end="${F}" region="bottom">`;const D=[];for(const V of R.words)D.push(`<span begin="${formatTime$2(V.startTime)}" end="${formatTime$2(V.endTime)}">${escapeXml$3(V.word)}</span>`);L+=`${D.join("")}`,L+=`</p>
`}return L+=`    </div>
  </body>
</tt>`,L}function escapeXml$3(P){return P.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function parseLqe(P){if(!P.trim().startsWith("[Lyricify Quick Export]"))throw new Error("文件缺少 [Lyricify Quick Export] 头部标记");let T=[],L=[],R=[];const I={};let F=0,D="",V=0;const q=P.split(/\r?\n/);if(!q.some(z=>z.startsWith("[lyrics:")))try{const z=parseLrc$1(P);if(z.length>0)return z}catch{}for(let z=0;z<q.length;z++){const Q=q[z];if(Q.startsWith("[")&&Q.endsWith("]")){const tt=Q.match(/^\[(.*?):(.*)\]$/);if(tt){const gt=tt[1].trim(),yt=tt[2].trim();["lyrics","translation","pronunciation","Lyricify Quick Export","version"].includes(gt)||(I[gt]||(I[gt]=[]),I[gt].push(yt))}}if(Q.startsWith("[lyrics:")||Q.startsWith("[translation:")||Q.startsWith("[pronunciation:")){if(D.trim()){const gt=processBlock(D,V);switch(F){case 1:T=gt;break;case 2:L=gt;break;case 3:R=gt;break}}D="";const{format:tt}=parseSectionHeader(Q);V=tt,Q.startsWith("[lyrics:")?F=1:Q.startsWith("[translation:")?F=2:F=3}else!Q.startsWith("[Lyricify Quick Export]")&&!Q.startsWith("[version:")&&(D+=Q+`
`)}if(D.trim()){const z=processBlock(D,V);switch(F){case 1:T=z;break;case 2:L=z;break;case 3:R=z;break}}return T.length===0&&(L.length>0?(T=L,L=[]):R.length>0&&(T=R,R=[])),(L.length>0||R.length>0)&&(T=mergeTracks(T,L,R)),T}function parseSectionHeader(P){let T=0,L=null;const R=P.match(/^\[(.*?):(.*)\]$/);if(R){const I=R[2].split(",").map(F=>F.trim());for(const F of I){const[D,V]=F.split("@").map(q=>q.trim());if(D==="format")switch(V.toLowerCase()){case"lrc":T=0;break;case"ass":T=2;break;case"yrc":T=3;break;case"lys":T=1;break;case"qrc":T=4;break;default:T=0}else D==="language"&&(L=V)}}return{format:T,lang:L}}function processBlock(P,T){if(!P.trim())return[];try{const L=P.endsWith(`
`)?P:P+`
`;switch(T){case 0:const R=parseLrc$1(L);if(R.length!==0){const I=R[0]}return R;default:return parseLrc$1(L)}}catch{return[]}}function mergeTracks(P,T,L){if(P.length===0)return T.length>0?T:L.length>0?L:[];const R=JSON.parse(JSON.stringify(P));for(let I=0;I<R.length;I++){const F=R[I],D=F.startTime,V=F.endTime;if((!F.words||!Array.isArray(F.words)||F.words.length===0)&&(F.words=[{word:`[行 ${I+1}]`,startTime:D,endTime:V||D+1e3}]),T.length>0){let q=T.find(G=>Math.abs(G.startTime-D)<100&&(Math.abs(G.endTime-V)<100||!V||!G.endTime));if(q)F.translatedLyric=q.words.map(G=>G.word).join("");else{let G=T[0],z=Math.abs(G.startTime-D);for(const Q of T){const tt=Math.abs(Q.startTime-D);tt<z&&(z=tt,G=Q)}z<2e3&&(F.translatedLyric=G.words.map(Q=>Q.word).join(""))}}if(L.length>0){let q=L.find(G=>Math.abs(G.startTime-D)<100&&(Math.abs(G.endTime-V)<100||!V||!G.endTime));if(q)F.romanLyric=q.words.map(G=>G.word).join("");else{let G=L[0],z=Math.abs(G.startTime-D);for(const Q of L){const tt=Math.abs(Q.startTime-D);tt<z&&(z=tt,G=Q)}z<2e3&&(F.romanLyric=G.words.map(Q=>Q.word).join(""))}}for(const q of F.words)(isNaN(q.startTime)||q.startTime<0)&&(q.startTime=D),(isNaN(q.endTime)||q.endTime<=q.startTime)&&(q.endTime=q.startTime+500)}return R}function isLqeFormat(P){return P?P.slice(0,2048).includes("[Lyricify Quick Export]"):!1}function lqeToTTML(P){try{const T=parseLqe(P);if(T.length===0)try{const L=parseLrc$1(P);if(L.length>0)return generateTTML(L)}catch{}return generateTTML(T)}catch{try{const L=parseLrc$1(P);if(L.length>0)return generateTTML(L)}catch{}return`<?xml version="1.0" encoding="utf-8"?>
<tt xmlns="http://www.w3.org/ns/ttml" xmlns:ttm="http://www.w3.org/ns/ttml#metadata" xmlns:tts="http://www.w3.org/ns/ttml#styling" xml:lang="en">
  <head>
    <metadata>
      <ttm:title>Converted Lyrics</ttm:title>
    </metadata>
    <styling>
      <style xml:id="normal" tts:fontFamily="Arial" tts:fontSize="100%" tts:textAlign="center"/>
    </styling>
    <layout>
      <region xml:id="bottom" tts:origin="0% 0%" tts:extent="100% 100%" tts:textAlign="center" tts:displayAlign="after"/>
    </layout>
  </head>
  <body>
    <div>
      <p begin="00:00:00.000" end="00:00:01.000" region="bottom">
        <span begin="00:00:00.000" end="00:00:01.000">解析歌词失败</span>
      </p>
    </div>
  </body>
</tt>`}}function generateTTML(P){let T=`<?xml version="1.0" encoding="utf-8"?>
<tt xmlns="http://www.w3.org/ns/ttml" xmlns:ttm="http://www.w3.org/ns/ttml#metadata" xmlns:tts="http://www.w3.org/ns/ttml#styling" xml:lang="en">
  <head>
    <metadata>
      <ttm:title>Converted Lyrics</ttm:title>
    </metadata>
    <styling>
      <style xml:id="normal" tts:fontFamily="Arial" tts:fontSize="100%" tts:textAlign="center"/>
    </styling>
    <layout>
      <region xml:id="bottom" tts:origin="0% 0%" tts:extent="100% 100%" tts:textAlign="center" tts:displayAlign="after"/>
    </layout>
  </head>
  <body>
    <div>
`;for(const L of P){(isNaN(L.startTime)||L.startTime<0)&&(L.startTime=0),(isNaN(L.endTime)||L.endTime<=L.startTime)&&(L.endTime=L.startTime+1e3);const R=formatTime$1(L.startTime),I=formatTime$1(L.endTime);T+=`      <p begin="${R}" end="${I}" region="bottom">`;const F=[];if(!L.words||L.words.length===0)F.push(`<span begin="${R}" end="${I}">[无歌词]</span>`);else for(const D of L.words){const V=isNaN(D.startTime)?L.startTime:D.startTime,q=isNaN(D.endTime)||D.endTime<=V?V+500:D.endTime,G=D.word?D.word:"[空]";F.push(`<span begin="${formatTime$1(V)}" end="${formatTime$1(q)}">${escapeXml$2(G)}</span>`)}T+=`${F.join("")}`,T+=`</p>
`}return T+=`    </div>
  </body>
</tt>`,T}function formatTime$1(P){const T=Math.floor(P/1e3),L=Math.floor(T/3600),R=Math.floor(T%3600/60),I=T%60,F=P%1e3;return`${L.toString().padStart(2,"0")}:${R.toString().padStart(2,"0")}:${I.toString().padStart(2,"0")}.${F.toString().padStart(3,"0")}`}function escapeXml$2(P){return P.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function isLylFormat(P){const T=P.split(`
`).filter(R=>R.trim().length>0);return T.length===0||!T[0].includes("[type:LyricifyLines]")?!1:T.slice(1,Math.min(5,T.length)).some(R=>/^\[(\d+),(\d+)\]/.test(R.trim()))}function parseLyl(P){const T=P.split(`
`).filter(I=>I.trim().length>0),L=[],R=/^\[(\d+),(\d+)\](.*)$/;for(const[I,F]of T.entries()){const D=F.trim();if(D.length===0||D.includes("[type:LyricifyLines]"))continue;const V=R.exec(D);if(V){const q=parseInt(V[1]),G=parseInt(V[2]),z=V[3].trim();if(z.length===0)continue;const Q=[{word:z,startTime:q,endTime:G}];L.push({words:Q,startTime:q,endTime:G,translatedLyric:"",romanLyric:"",isBG:!1,isDuet:!1})}}return L}function lylToTTML(P){const T=parseLyl(P);let L=`<?xml version="1.0" encoding="utf-8"?>
<tt xmlns="http://www.w3.org/ns/ttml" xmlns:ttm="http://www.w3.org/ns/ttml#metadata" xmlns:tts="http://www.w3.org/ns/ttml#styling" xml:lang="en">
  <head>
    <metadata>
      <ttm:title>Converted LYL Lyrics</ttm:title>
    </metadata>
    <styling>
      <style xml:id="normal" tts:fontFamily="Arial" tts:fontSize="100%" tts:textAlign="center"/>
    </styling>
    <layout>
      <region xml:id="bottom" tts:origin="0% 0%" tts:extent="100% 100%" tts:textAlign="center" tts:displayAlign="after"/>
    </layout>
  </head>
  <body>
    <div>
`;for(const R of T){const I=formatTime(R.startTime),F=formatTime(R.endTime);L+=`      <p begin="${I}" end="${F}" region="bottom">`;const D=[];for(const V of R.words)D.push(`<span>${escapeXml$1(V.word)}</span>`);L+=`${D.join("")}`,L+=`</p>
`}return L+=`    </div>
  </body>
</tt>`,L}function formatTime(P){const T=Math.floor(P/1e3),L=Math.floor(T/3600),R=Math.floor(T%3600/60),I=T%60,F=P%1e3;return`${L.toString().padStart(2,"0")}:${R.toString().padStart(2,"0")}:${I.toString().padStart(2,"0")}.${F.toString().padStart(3,"0")}`}function escapeXml$1(P){return P.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function isSrtFormat(P){const T=P.split(/\r?\n/).map(R=>R.trim()),L=/\d{2}:\d{2}:\d{2},\d{3}\s+-->\s+\d{2}:\d{2}:\d{2},\d{3}/;return T.some(R=>L.test(R))}function srtToTTML(P){const T=splitSrtBlocks(P);let L=`<?xml version="1.0" encoding="utf-8"?>
<tt xmlns="http://www.w3.org/ns/ttml" xmlns:ttm="http://www.w3.org/ns/ttml#metadata" xmlns:tts="http://www.w3.org/ns/ttml#styling" xml:lang="en">
  <head>
    <metadata>
      <ttm:title>SRT Converted</ttm:title>
    </metadata>
    <styling>
      <style xml:id="normal" tts:fontFamily="Arial" tts:fontSize="100%" tts:textAlign="center"/>
    </styling>
    <layout>
      <region xml:id="bottom" tts:origin="0% 0%" tts:extent="100% 100%" tts:textAlign="center" tts:displayAlign="after"/>
    </layout>
  </head>
  <body>
    <div>
`;for(const R of T){if(!R)continue;const{beginMs:I,endMs:F,text:D}=R;if(I==null||F==null)continue;const V=formatTtmlTime(I),q=formatTtmlTime(F),G=escapeXml(D).replace(/\n/g,"<br/>");L+=`      <p begin="${V}" end="${q}" region="bottom">`,L+=`<span begin="${V}" end="${q}">${G}</span>`,L+=`</p>
`}return L+=`    </div>
  </body>
</tt>`,L}function splitSrtBlocks(P){const L=P.replace(/\r\n/g,`
`).split(/\n\s*\n/),R=/(\d{2}):(\d{2}):(\d{2}),(\d{3})\s*-->\s*(\d{2}):(\d{2}):(\d{2}),(\d{3})/,I=[];for(const F of L){const D=F.split(/\n/).map(yt=>yt.trim());if(D.length===0)continue;let V=0;/^\d+$/.test(D[0])&&(V=1);const q=D[V]||"",G=R.exec(q);if(!G)continue;const z=hmsToMs(G[1],G[2],G[3],G[4]),Q=hmsToMs(G[5],G[6],G[7],G[8]),gt=D.slice(V+1).filter(yt=>yt.length>0).join(`
`);I.push({beginMs:z,endMs:Q,text:gt})}return I}function hmsToMs(P,T,L,R){const I=parseInt(P,10)||0,F=parseInt(T,10)||0,D=parseInt(L,10)||0,V=parseInt(R,10)||0;return((I*60+F)*60+D)*1e3+V}function formatTtmlTime(P){const T=Math.floor(P/1e3),L=Math.floor(T/3600),R=Math.floor(T%3600/60),I=T%60,F=P%1e3;return`${L.toString().padStart(2,"0")}:${R.toString().padStart(2,"0")}:${I.toString().padStart(2,"0")}.${F.toString().padStart(3,"0")}`}function escapeXml(P){return P.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}const translations={en:{artist:"Artist",songInfo:"Metadata",title:"Title",loopPlay:"Loop Playback",loadFromUrl:"Load from URL",loadFiles:"Load Files",resetPlayer:"Reset Player",sourceFile:"Source",musicUrl:"Enter music URL",lyricsUrl:"Enter lyrics or lyrics URL",coverUrl:"Enter cover image URL",extractedFromFilename:"Extracted song info from filename",extractedSongInfo:"Extracted song info successfully",usedFilenameAsTitle:"Used filename as song title",showControlPanel:"Show Control Panel",hideControlPanel:"Hide Control Panel",clickToAddLyrics:"Click or drag & drop here to add lyrics",supportedLyricFormats:"Supports LyRiC / LyRiC A2 / LyRiC Walaoke / ESLyRiC / Salt Player ESLyRiC (*.lrc, *.spl), Apple Music (*.ttml, *.json), Netease Music (*.yrc), Lyricify (*.lys, *.lyl, *.lqe), QQMusic (*.qrc), KuGou (*.krc), ALRC (*.alrc, *.json), SubRip (*.srt), Aegisub (*.ass), Musixmatch (*.json) formats",musicLoadSuccess:"Music file loaded successfully",musicLoadFailed:"Failed to load music file",globalSettings:"Global",coverSettings:"Cover",lyricSettings:"Lyrics",backgroundSettings:"Background",visualizationSettings:"Visualization",lyricsLoadSuccess:"Lyrics file loaded successfully",lyricsLoadFailed:"Failed to load lyrics file",coverLoadSuccess:"Cover image loaded successfully",coverLoadFailed:"Failed to load cover image",lyricsUrlLoadFailed:"Failed to load lyrics from URL",loadFromUrlComplete:"Loading from URL completed",lyricsParseSuccess:"Lyrics loaded successfully, total lines: ",lyricsParseFailed:"Failed to parse lyrics",playerReset:"Player has been reset",metadataParseSuccess:"Audio metadata parsed successfully",metadataParseFailed:"Failed to parse audio metadata, using fallback",metadataLibNotLoaded:"Audio metadata library not loaded, using fallback",metadataParseError:"Error parsing audio metadata, using fallback",cannotParseAudioInfo:"Cannot parse audio file information",backgroundControl:"Background Control",flowSpeed:"Flow Speed",toggleBackgroundMode:"Toggle Background Mode",playbackRate:"Playback Speed",volume:"Volume",playbackControl:"Playback Control",amllBackground:"AMLL Background",coverBackground:"Cover Background",solidBackground:"Solid Background",coverBlurLevel:"Blur Level",colorMask:"Color Mask",invertColors:"Invert",showFPS:"Show Performance Monitor",enableMarquee:"Title Marquee Effect",roundedCover:"Cover Rounded Corners",coverRotation:"Cover Rotation Speed",renderScale:"Render Scale",backgroundFPS:"Background FPS",lyricAlignPosition:"Vertical Align",hidePassedLyrics:"Hide Passed Lyrics",lyricDelay:"Lyrics Delay",enableLyricBlur:"Lyrics Blur Effect",enableLyricScale:"Lyrics Scaling Effect",enableLyricSpring:"Lyrics Spring Effect",wordFadeWidth:"Word Fade Width",alignTop:"Top",alignCenter:"Center",alignBottom:"Bottom",lyricAlignFocus:"Lyrics Align Focus",backgroundStyle:"Background Style",showTranslatedLyric:"Show Translated",showRomanLyric:"Show Romanized",swapLyricPositions:"Swap Translated & Romanized",showbgLyric:"Show Background Lyrics",swapDuetsPositions:"Swap Left & Right",advanceLyricTiming:"Compact Gap (±400ms)",lowFreqVolume:"Low Frequency Volume",singleLyrics:"Single Lyrics",coverStyle:"Cover Style",normalShadow:"Shadow",innerShadow:"Inner Shadow",threeDShadow:"3D Shadow",longShadow:"Long Shadow",neumorphismA:"Neumorphism A",neumorphismB:"Neumorphism B",horizontalReflection:"Horizontal Reflection",cdRecord:"CD Record",vinylRecord:"Vinyl Record",coloredRecord:"Colored Record",fftDataRangeMin:"Minimum Frequency",fftDataRangeMax:"Maximum Frequency",posYSpringMass:"Vertical Spring Mass",posYSpringDamping:"Vertical Spring Damping",posYSpringStiffness:"Vertical Spring Stiffness",posYSpringSoft:"Soft Vertical Spring",scaleSpringMass:"Scale Spring Mass",controlPointCode:"Control Point Code",scaleSpringDamping:"Scale Spring Damping",scaleSpringStiffness:"Scale Spring Stiffness",scaleSpringSoft:"Soft Scale Spring",dominantColor:"Dominant Colors"},zh:{artist:"艺术家",songInfo:"元数据",title:"标题",loopPlay:"循环播放",loadFromUrl:"从URL加载",loadFiles:"加载文件",resetPlayer:"重置播放器",sourceFile:"播放源",musicUrl:"输入音乐文件URL",lyricsUrl:"输入歌词或歌词文件URL",coverUrl:"输入封面图片URL",extractedFromFilename:"从文件名解析歌曲信息",extractedSongInfo:"从文件名解析歌曲信息成功",usedFilenameAsTitle:"使用文件名作为歌曲标题",showControlPanel:"显示控制面板",hideControlPanel:"隐藏控制面板",clickToAddLyrics:"点击或拖拽至此区域添加歌词",supportedLyricFormats:"支持 LyRiC / LyRiC A2 / LyRiC Walaoke / ESLyRiC / Salt Player ESLyRiC (*.lrc, *.spl), Apple Music (*.ttml, *.json), Netease Music (*.yrc), Lyricify (*.lys, *.lyl, *.lqe), QQMusic (*.qrc), KuGou (*.krc), ALRC (*.alrc, *.json), SubRip (*.srt), Aegisub (*.ass), Musixmatch (*.json) 格式",musicLoadSuccess:"音乐文件加载成功",musicLoadFailed:"音乐文件加载失败",globalSettings:"全局",coverSettings:"封面",lyricSettings:"歌词",backgroundSettings:"背景",visualizationSettings:"可视化",lyricsLoadSuccess:"歌词文件加载成功",lyricsLoadFailed:"歌词文件加载失败",coverLoadSuccess:"封面图片加载成功",coverLoadFailed:"封面图片加载失败",lyricsUrlLoadFailed:"歌词URL加载失败",loadFromUrlComplete:"从URL加载完成",lyricsParseSuccess:"歌词加载成功，共 ",lyricsParseFailed:"歌词解析失败",playerReset:"播放器已重置",metadataParseSuccess:"音频元数据解析成功",metadataParseFailed:"音频元数据解析失败，使用备用方案",metadataLibNotLoaded:"音频元数据解析库未加载，使用备用方案",metadataParseError:"音频元数据解析出错，使用备用方案",cannotParseAudioInfo:"无法解析音频文件信息",backgroundControl:"背景控制",flowSpeed:"流动速度",toggleBackgroundMode:"切换背景模式",playbackRate:"播放速度",volume:"音量",playbackControl:"播放控制",amllBackground:"AMLL 背景",coverBackground:"封面背景",solidBackground:"纯色背景",coverBlurLevel:"模糊程度",colorMask:"颜色蒙版",invertColors:"反转",showFPS:"显示性能监控",enableMarquee:"标题跑马灯效果",roundedCover:"封面圆角",coverRotation:"封面旋转速度",renderScale:"渲染比例",backgroundFPS:"背景帧率",lyricAlignPosition:"垂直位置",hidePassedLyrics:"隐藏已播歌词",lyricDelay:"歌词延迟",enableLyricBlur:"歌词模糊效果",enableLyricScale:"歌词缩放效果",enableLyricSpring:"歌词弹簧效果",wordFadeWidth:"歌词渐变宽度",alignTop:"顶部",alignCenter:"居中",alignBottom:"底部",lyricAlignFocus:"歌词对齐焦点",backgroundStyle:"背景样式",showTranslatedLyric:"显示翻译",showRomanLyric:"显示音译",swapLyricPositions:"交换译文位置",showbgLyric:"显示背景词",swapDuetsPositions:"交换左右对齐",advanceLyricTiming:"紧凑间隙 (±400ms)",lowFreqVolume:"低音频率",singleLyrics:"单行歌词",coverStyle:"封面样式",normalShadow:"阴影",innerShadow:"内阴影",threeDShadow:"立体投影",longShadow:"长投影",neumorphismA:"新拟态A",neumorphismB:"新拟态B",horizontalReflection:"水平倒影",cdRecord:"CD唱片",vinylRecord:"黑胶唱片",coloredRecord:"彩胶唱片",fftDataRangeMin:"最小频率",fftDataRangeMax:"最大频率",posYSpringMass:"垂直弹簧质量",posYSpringDamping:"垂直弹簧阻尼",posYSpringStiffness:"垂直弹簧刚度",posYSpringSoft:"柔软垂直弹簧",controlPointCode:"控制点代码",scaleSpringMass:"缩放弹簧质量",scaleSpringDamping:"缩放弹簧阻尼",scaleSpringStiffness:"缩放弹簧刚度",scaleSpringSoft:"柔软缩放弹簧",dominantColor:"主色调"}};function getCurrentLanguage(){return navigator.language.toLowerCase().startsWith("zh")?"zh":"en"}function t$3(P){const T=getCurrentLanguage();return translations[T][P]}/**
 * lil-gui
 * https://lil-gui.georgealways.com
 * @version 0.20.0
 * @author George Michael Brower
 * @license MIT
 */class Controller{constructor(T,L,R,I,F="div"){this.parent=T,this.object=L,this.property=R,this._disabled=!1,this._hidden=!1,this.initialValue=this.getValue(),this.domElement=document.createElement(F),this.domElement.classList.add("controller"),this.domElement.classList.add(I),this.$name=document.createElement("div"),this.$name.classList.add("name"),Controller.nextNameID=Controller.nextNameID||0,this.$name.id=`lil-gui-name-${++Controller.nextNameID}`,this.$widget=document.createElement("div"),this.$widget.classList.add("widget"),this.$disable=this.$widget,this.domElement.appendChild(this.$name),this.domElement.appendChild(this.$widget),this.domElement.addEventListener("keydown",D=>D.stopPropagation()),this.domElement.addEventListener("keyup",D=>D.stopPropagation()),this.parent.children.push(this),this.parent.controllers.push(this),this.parent.$children.appendChild(this.domElement),this._listenCallback=this._listenCallback.bind(this),this.name(R)}name(T){return this._name=T,this.$name.textContent=T,this}onChange(T){return this._onChange=T,this}_callOnChange(){this.parent._callOnChange(this),this._onChange!==void 0&&this._onChange.call(this,this.getValue()),this._changed=!0}onFinishChange(T){return this._onFinishChange=T,this}_callOnFinishChange(){this._changed&&(this.parent._callOnFinishChange(this),this._onFinishChange!==void 0&&this._onFinishChange.call(this,this.getValue())),this._changed=!1}reset(){return this.setValue(this.initialValue),this._callOnFinishChange(),this}enable(T=!0){return this.disable(!T)}disable(T=!0){return T===this._disabled?this:(this._disabled=T,this.domElement.classList.toggle("disabled",T),this.$disable.toggleAttribute("disabled",T),this)}show(T=!0){return this._hidden=!T,this.domElement.style.display=this._hidden?"none":"",this}hide(){return this.show(!1)}options(T){const L=this.parent.add(this.object,this.property,T);return L.name(this._name),this.destroy(),L}min(T){return this}max(T){return this}step(T){return this}decimals(T){return this}listen(T=!0){return this._listening=T,this._listenCallbackID!==void 0&&(cancelAnimationFrame(this._listenCallbackID),this._listenCallbackID=void 0),this._listening&&this._listenCallback(),this}_listenCallback(){this._listenCallbackID=requestAnimationFrame(this._listenCallback);const T=this.save();T!==this._listenPrevValue&&this.updateDisplay(),this._listenPrevValue=T}getValue(){return this.object[this.property]}setValue(T){return this.getValue()!==T&&(this.object[this.property]=T,this._callOnChange(),this.updateDisplay()),this}updateDisplay(){return this}load(T){return this.setValue(T),this._callOnFinishChange(),this}save(){return this.getValue()}destroy(){this.listen(!1),this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.controllers.splice(this.parent.controllers.indexOf(this),1),this.parent.$children.removeChild(this.domElement)}}class BooleanController extends Controller{constructor(T,L,R){super(T,L,R,"boolean","label"),this.$input=document.createElement("input"),this.$input.setAttribute("type","checkbox"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$widget.appendChild(this.$input),this.$input.addEventListener("change",()=>{this.setValue(this.$input.checked),this._callOnFinishChange()}),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.checked=this.getValue(),this}}function normalizeColorString(P){let T,L;return(T=P.match(/(#|0x)?([a-f0-9]{6})/i))?L=T[2]:(T=P.match(/rgb\(\s*(\d*)\s*,\s*(\d*)\s*,\s*(\d*)\s*\)/))?L=parseInt(T[1]).toString(16).padStart(2,0)+parseInt(T[2]).toString(16).padStart(2,0)+parseInt(T[3]).toString(16).padStart(2,0):(T=P.match(/^#?([a-f0-9])([a-f0-9])([a-f0-9])$/i))&&(L=T[1]+T[1]+T[2]+T[2]+T[3]+T[3]),L?"#"+L:!1}const STRING={isPrimitive:!0,match:P=>typeof P=="string",fromHexString:normalizeColorString,toHexString:normalizeColorString},INT={isPrimitive:!0,match:P=>typeof P=="number",fromHexString:P=>parseInt(P.substring(1),16),toHexString:P=>"#"+P.toString(16).padStart(6,0)},ARRAY={isPrimitive:!1,match:P=>Array.isArray(P),fromHexString(P,T,L=1){const R=INT.fromHexString(P);T[0]=(R>>16&255)/255*L,T[1]=(R>>8&255)/255*L,T[2]=(R&255)/255*L},toHexString([P,T,L],R=1){R=255/R;const I=P*R<<16^T*R<<8^L*R<<0;return INT.toHexString(I)}},OBJECT={isPrimitive:!1,match:P=>Object(P)===P,fromHexString(P,T,L=1){const R=INT.fromHexString(P);T.r=(R>>16&255)/255*L,T.g=(R>>8&255)/255*L,T.b=(R&255)/255*L},toHexString({r:P,g:T,b:L},R=1){R=255/R;const I=P*R<<16^T*R<<8^L*R<<0;return INT.toHexString(I)}},FORMATS$1=[STRING,INT,ARRAY,OBJECT];function getColorFormat(P){return FORMATS$1.find(T=>T.match(P))}class ColorController extends Controller{constructor(T,L,R,I){super(T,L,R,"color"),this.$input=document.createElement("input"),this.$input.setAttribute("type","color"),this.$input.setAttribute("tabindex",-1),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$text=document.createElement("input"),this.$text.setAttribute("type","text"),this.$text.setAttribute("spellcheck","false"),this.$text.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this.$display.appendChild(this.$input),this.$widget.appendChild(this.$display),this.$widget.appendChild(this.$text),this._format=getColorFormat(this.initialValue),this._rgbScale=I,this._initialValueHexString=this.save(),this._textFocused=!1,this.$input.addEventListener("input",()=>{this._setValueFromHexString(this.$input.value)}),this.$input.addEventListener("blur",()=>{this._callOnFinishChange()}),this.$text.addEventListener("input",()=>{const F=normalizeColorString(this.$text.value);F&&this._setValueFromHexString(F)}),this.$text.addEventListener("focus",()=>{this._textFocused=!0,this.$text.select()}),this.$text.addEventListener("blur",()=>{this._textFocused=!1,this.updateDisplay(),this._callOnFinishChange()}),this.$disable=this.$text,this.updateDisplay()}reset(){return this._setValueFromHexString(this._initialValueHexString),this}_setValueFromHexString(T){if(this._format.isPrimitive){const L=this._format.fromHexString(T);this.setValue(L)}else this._format.fromHexString(T,this.getValue(),this._rgbScale),this._callOnChange(),this.updateDisplay()}save(){return this._format.toHexString(this.getValue(),this._rgbScale)}load(T){return this._setValueFromHexString(T),this._callOnFinishChange(),this}updateDisplay(){return this.$input.value=this._format.toHexString(this.getValue(),this._rgbScale),this._textFocused||(this.$text.value=this.$input.value.substring(1)),this.$display.style.backgroundColor=this.$input.value,this}}class FunctionController extends Controller{constructor(T,L,R){super(T,L,R,"function"),this.$button=document.createElement("button"),this.$button.appendChild(this.$name),this.$widget.appendChild(this.$button),this.$button.addEventListener("click",I=>{I.preventDefault(),this.getValue().call(this.object),this._callOnChange()}),this.$button.addEventListener("touchstart",()=>{},{passive:!0}),this.$disable=this.$button}}class NumberController extends Controller{constructor(T,L,R,I,F,D){super(T,L,R,"number"),this._initInput(),this.min(I),this.max(F);const V=D!==void 0;this.step(V?D:this._getImplicitStep(),V),this.updateDisplay()}decimals(T){return this._decimals=T,this.updateDisplay(),this}min(T){return this._min=T,this._onUpdateMinMax(),this}max(T){return this._max=T,this._onUpdateMinMax(),this}step(T,L=!0){return this._step=T,this._stepExplicit=L,this}updateDisplay(){const T=this.getValue();if(this._hasSlider){let L=(T-this._min)/(this._max-this._min);L=Math.max(0,Math.min(L,1)),this.$fill.style.width=L*100+"%"}return this._inputFocused||(this.$input.value=this._decimals===void 0?T:T.toFixed(this._decimals)),this}_initInput(){this.$input=document.createElement("input"),this.$input.setAttribute("type","text"),this.$input.setAttribute("aria-labelledby",this.$name.id),window.matchMedia("(pointer: coarse)").matches&&(this.$input.setAttribute("type","number"),this.$input.setAttribute("step","any")),this.$widget.appendChild(this.$input),this.$disable=this.$input;const L=()=>{let kt=parseFloat(this.$input.value);isNaN(kt)||(this._stepExplicit&&(kt=this._snap(kt)),this.setValue(this._clamp(kt)))},R=kt=>{const ne=parseFloat(this.$input.value);isNaN(ne)||(this._snapClampSetValue(ne+kt),this.$input.value=this.getValue())},I=kt=>{kt.key==="Enter"&&this.$input.blur(),kt.code==="ArrowUp"&&(kt.preventDefault(),R(this._step*this._arrowKeyMultiplier(kt))),kt.code==="ArrowDown"&&(kt.preventDefault(),R(this._step*this._arrowKeyMultiplier(kt)*-1))},F=kt=>{this._inputFocused&&(kt.preventDefault(),R(this._step*this._normalizeMouseWheel(kt)))};let D=!1,V,q,G,z,Q;const tt=5,gt=kt=>{V=kt.clientX,q=G=kt.clientY,D=!0,z=this.getValue(),Q=0,window.addEventListener("mousemove",yt),window.addEventListener("mouseup",Et)},yt=kt=>{if(D){const ne=kt.clientX-V,Te=kt.clientY-q;Math.abs(Te)>tt?(kt.preventDefault(),this.$input.blur(),D=!1,this._setDraggingStyle(!0,"vertical")):Math.abs(ne)>tt&&Et()}if(!D){const ne=kt.clientY-G;Q-=ne*this._step*this._arrowKeyMultiplier(kt),z+Q>this._max?Q=this._max-z:z+Q<this._min&&(Q=this._min-z),this._snapClampSetValue(z+Q)}G=kt.clientY},Et=()=>{this._setDraggingStyle(!1,"vertical"),this._callOnFinishChange(),window.removeEventListener("mousemove",yt),window.removeEventListener("mouseup",Et)},J=()=>{this._inputFocused=!0},At=()=>{this._inputFocused=!1,this.updateDisplay(),this._callOnFinishChange()};this.$input.addEventListener("input",L),this.$input.addEventListener("keydown",I),this.$input.addEventListener("wheel",F,{passive:!1}),this.$input.addEventListener("mousedown",gt),this.$input.addEventListener("focus",J),this.$input.addEventListener("blur",At)}_initSlider(){this._hasSlider=!0,this.$slider=document.createElement("div"),this.$slider.classList.add("slider"),this.$fill=document.createElement("div"),this.$fill.classList.add("fill"),this.$slider.appendChild(this.$fill),this.$widget.insertBefore(this.$slider,this.$input),this.domElement.classList.add("hasSlider");const T=(At,kt,ne,Te,Ht)=>(At-kt)/(ne-kt)*(Ht-Te)+Te,L=At=>{const kt=this.$slider.getBoundingClientRect();let ne=T(At,kt.left,kt.right,this._min,this._max);this._snapClampSetValue(ne)},R=At=>{this._setDraggingStyle(!0),L(At.clientX),window.addEventListener("mousemove",I),window.addEventListener("mouseup",F)},I=At=>{L(At.clientX)},F=()=>{this._callOnFinishChange(),this._setDraggingStyle(!1),window.removeEventListener("mousemove",I),window.removeEventListener("mouseup",F)};let D=!1,V,q;const G=At=>{At.preventDefault(),this._setDraggingStyle(!0),L(At.touches[0].clientX),D=!1},z=At=>{At.touches.length>1||(this._hasScrollBar?(V=At.touches[0].clientX,q=At.touches[0].clientY,D=!0):G(At),window.addEventListener("touchmove",Q,{passive:!1}),window.addEventListener("touchend",tt))},Q=At=>{if(D){const kt=At.touches[0].clientX-V,ne=At.touches[0].clientY-q;Math.abs(kt)>Math.abs(ne)?G(At):(window.removeEventListener("touchmove",Q),window.removeEventListener("touchend",tt))}else At.preventDefault(),L(At.touches[0].clientX)},tt=()=>{this._callOnFinishChange(),this._setDraggingStyle(!1),window.removeEventListener("touchmove",Q),window.removeEventListener("touchend",tt)},gt=this._callOnFinishChange.bind(this),yt=400;let Et;const J=At=>{if(Math.abs(At.deltaX)<Math.abs(At.deltaY)&&this._hasScrollBar)return;At.preventDefault();const ne=this._normalizeMouseWheel(At)*this._step;this._snapClampSetValue(this.getValue()+ne),this.$input.value=this.getValue(),clearTimeout(Et),Et=setTimeout(gt,yt)};this.$slider.addEventListener("mousedown",R),this.$slider.addEventListener("touchstart",z,{passive:!1}),this.$slider.addEventListener("wheel",J,{passive:!1})}_setDraggingStyle(T,L="horizontal"){this.$slider&&this.$slider.classList.toggle("active",T),document.body.classList.toggle("lil-gui-dragging",T),document.body.classList.toggle(`lil-gui-${L}`,T)}_getImplicitStep(){return this._hasMin&&this._hasMax?(this._max-this._min)/1e3:.1}_onUpdateMinMax(){!this._hasSlider&&this._hasMin&&this._hasMax&&(this._stepExplicit||this.step(this._getImplicitStep(),!1),this._initSlider(),this.updateDisplay())}_normalizeMouseWheel(T){let{deltaX:L,deltaY:R}=T;return Math.floor(T.deltaY)!==T.deltaY&&T.wheelDelta&&(L=0,R=-T.wheelDelta/120,R*=this._stepExplicit?1:10),L+-R}_arrowKeyMultiplier(T){let L=this._stepExplicit?1:10;return T.shiftKey?L*=10:T.altKey&&(L/=10),L}_snap(T){let L=0;return this._hasMin?L=this._min:this._hasMax&&(L=this._max),T-=L,T=Math.round(T/this._step)*this._step,T+=L,T=parseFloat(T.toPrecision(15)),T}_clamp(T){return T<this._min&&(T=this._min),T>this._max&&(T=this._max),T}_snapClampSetValue(T){this.setValue(this._clamp(this._snap(T)))}get _hasScrollBar(){const T=this.parent.root.$children;return T.scrollHeight>T.clientHeight}get _hasMin(){return this._min!==void 0}get _hasMax(){return this._max!==void 0}}class OptionController extends Controller{constructor(T,L,R,I){super(T,L,R,"option"),this.$select=document.createElement("select"),this.$select.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this.$select.addEventListener("change",()=>{this.setValue(this._values[this.$select.selectedIndex]),this._callOnFinishChange()}),this.$select.addEventListener("focus",()=>{this.$display.classList.add("focus")}),this.$select.addEventListener("blur",()=>{this.$display.classList.remove("focus")}),this.$widget.appendChild(this.$select),this.$widget.appendChild(this.$display),this.$disable=this.$select,this.options(I)}options(T){return this._values=Array.isArray(T)?T:Object.values(T),this._names=Array.isArray(T)?T:Object.keys(T),this.$select.replaceChildren(),this._names.forEach(L=>{const R=document.createElement("option");R.textContent=L,this.$select.appendChild(R)}),this.updateDisplay(),this}updateDisplay(){const T=this.getValue(),L=this._values.indexOf(T);return this.$select.selectedIndex=L,this.$display.textContent=L===-1?T:this._names[L],this}}class StringController extends Controller{constructor(T,L,R){super(T,L,R,"string"),this.$input=document.createElement("input"),this.$input.setAttribute("type","text"),this.$input.setAttribute("spellcheck","false"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$input.addEventListener("input",()=>{this.setValue(this.$input.value)}),this.$input.addEventListener("keydown",I=>{I.code==="Enter"&&this.$input.blur()}),this.$input.addEventListener("blur",()=>{this._callOnFinishChange()}),this.$widget.appendChild(this.$input),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.value=this.getValue(),this}}var stylesheet=`.lil-gui {
  font-family: var(--font-family);
  font-size: var(--font-size);
  line-height: 1;
  font-weight: normal;
  font-style: normal;
  text-align: left;
  color: var(--text-color);
  user-select: none;
  -webkit-user-select: none;
  touch-action: manipulation;
  --background-color: #1f1f1f;
  --text-color: #ebebeb;
  --title-background-color: #111111;
  --title-text-color: #ebebeb;
  --widget-color: #424242;
  --hover-color: #4f4f4f;
  --focus-color: #595959;
  --number-color: #2cc9ff;
  --string-color: #a2db3c;
  --font-size: 11px;
  --input-font-size: 11px;
  --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
  --font-family-mono: Menlo, Monaco, Consolas, "Droid Sans Mono", monospace;
  --padding: 4px;
  --spacing: 4px;
  --widget-height: 20px;
  --title-height: calc(var(--widget-height) + var(--spacing) * 1.25);
  --name-width: 45%;
  --slider-knob-width: 2px;
  --slider-input-width: 27%;
  --color-input-width: 27%;
  --slider-input-min-width: 45px;
  --color-input-min-width: 45px;
  --folder-indent: 7px;
  --widget-padding: 0 0 0 3px;
  --widget-border-radius: 2px;
  --checkbox-size: calc(0.75 * var(--widget-height));
  --scrollbar-width: 5px;
}
.lil-gui, .lil-gui * {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}
.lil-gui.root {
  width: var(--width, 245px);
  display: flex;
  flex-direction: column;
  background: var(--background-color);
}
.lil-gui.root > .title {
  background: var(--title-background-color);
  color: var(--title-text-color);
}
.lil-gui.root > .children {
  overflow-x: hidden;
  overflow-y: auto;
}
.lil-gui.root > .children::-webkit-scrollbar {
  width: var(--scrollbar-width);
  height: var(--scrollbar-width);
  background: var(--background-color);
}
.lil-gui.root > .children::-webkit-scrollbar-thumb {
  border-radius: var(--scrollbar-width);
  background: var(--focus-color);
}
@media (pointer: coarse) {
  .lil-gui.allow-touch-styles, .lil-gui.allow-touch-styles .lil-gui {
    --widget-height: 28px;
    --padding: 6px;
    --spacing: 6px;
    --font-size: 13px;
    --input-font-size: 16px;
    --folder-indent: 10px;
    --scrollbar-width: 7px;
    --slider-input-min-width: 50px;
    --color-input-min-width: 65px;
  }
}
.lil-gui.force-touch-styles, .lil-gui.force-touch-styles .lil-gui {
  --widget-height: 28px;
  --padding: 6px;
  --spacing: 6px;
  --font-size: 13px;
  --input-font-size: 16px;
  --folder-indent: 10px;
  --scrollbar-width: 7px;
  --slider-input-min-width: 50px;
  --color-input-min-width: 65px;
}
.lil-gui.autoPlace {
  max-height: 100%;
  position: fixed;
  top: 0;
  right: 15px;
  z-index: 1001;
}

.lil-gui .controller {
  display: flex;
  align-items: center;
  padding: 0 var(--padding);
  margin: var(--spacing) 0;
}
.lil-gui .controller.disabled {
  opacity: 0.5;
}
.lil-gui .controller.disabled, .lil-gui .controller.disabled * {
  pointer-events: none !important;
}
.lil-gui .controller > .name {
  min-width: var(--name-width);
  flex-shrink: 0;
  white-space: pre;
  padding-right: var(--spacing);
  line-height: var(--widget-height);
}
.lil-gui .controller .widget {
  position: relative;
  display: flex;
  align-items: center;
  width: 100%;
  min-height: var(--widget-height);
}
.lil-gui .controller.string input {
  color: var(--string-color);
}
.lil-gui .controller.boolean {
  cursor: pointer;
}
.lil-gui .controller.color .display {
  width: 100%;
  height: var(--widget-height);
  border-radius: var(--widget-border-radius);
  position: relative;
}
@media (hover: hover) {
  .lil-gui .controller.color .display:hover:before {
    content: " ";
    display: block;
    position: absolute;
    border-radius: var(--widget-border-radius);
    border: 1px solid #fff9;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
  }
}
.lil-gui .controller.color input[type=color] {
  opacity: 0;
  width: 100%;
  height: 100%;
  cursor: pointer;
}
.lil-gui .controller.color input[type=text] {
  margin-left: var(--spacing);
  font-family: var(--font-family-mono);
  min-width: var(--color-input-min-width);
  width: var(--color-input-width);
  flex-shrink: 0;
}
.lil-gui .controller.option select {
  opacity: 0;
  position: absolute;
  width: 100%;
  max-width: 100%;
}
.lil-gui .controller.option .display {
  position: relative;
  pointer-events: none;
  border-radius: var(--widget-border-radius);
  height: var(--widget-height);
  line-height: var(--widget-height);
  max-width: 100%;
  overflow: hidden;
  word-break: break-all;
  padding-left: 0.55em;
  padding-right: 1.75em;
  background: var(--widget-color);
}
@media (hover: hover) {
  .lil-gui .controller.option .display.focus {
    background: var(--focus-color);
  }
}
.lil-gui .controller.option .display.active {
  background: var(--focus-color);
}
.lil-gui .controller.option .display:after {
  font-family: "lil-gui";
  content: "↕";
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  padding-right: 0.375em;
}
.lil-gui .controller.option .widget,
.lil-gui .controller.option select {
  cursor: pointer;
}
@media (hover: hover) {
  .lil-gui .controller.option .widget:hover .display {
    background: var(--hover-color);
  }
}
.lil-gui .controller.number input {
  color: var(--number-color);
}
.lil-gui .controller.number.hasSlider input {
  margin-left: var(--spacing);
  width: var(--slider-input-width);
  min-width: var(--slider-input-min-width);
  flex-shrink: 0;
}
.lil-gui .controller.number .slider {
  width: 100%;
  height: var(--widget-height);
  background: var(--widget-color);
  border-radius: var(--widget-border-radius);
  padding-right: var(--slider-knob-width);
  overflow: hidden;
  cursor: ew-resize;
  touch-action: pan-y;
}
@media (hover: hover) {
  .lil-gui .controller.number .slider:hover {
    background: var(--hover-color);
  }
}
.lil-gui .controller.number .slider.active {
  background: var(--focus-color);
}
.lil-gui .controller.number .slider.active .fill {
  opacity: 0.95;
}
.lil-gui .controller.number .fill {
  height: 100%;
  border-right: var(--slider-knob-width) solid var(--number-color);
  box-sizing: content-box;
}

.lil-gui-dragging .lil-gui {
  --hover-color: var(--widget-color);
}
.lil-gui-dragging * {
  cursor: ew-resize !important;
}

.lil-gui-dragging.lil-gui-vertical * {
  cursor: ns-resize !important;
}

.lil-gui .title {
  height: var(--title-height);
  font-weight: 600;
  padding: 0 var(--padding);
  width: 100%;
  text-align: left;
  background: none;
  text-decoration-skip: objects;
}
.lil-gui .title:before {
  font-family: "lil-gui";
  content: "▾";
  padding-right: 2px;
  display: inline-block;
}
.lil-gui .title:active {
  background: var(--title-background-color);
  opacity: 0.75;
}
@media (hover: hover) {
  body:not(.lil-gui-dragging) .lil-gui .title:hover {
    background: var(--title-background-color);
    opacity: 0.85;
  }
  .lil-gui .title:focus {
    text-decoration: underline var(--focus-color);
  }
}
.lil-gui.root > .title:focus {
  text-decoration: none !important;
}
.lil-gui.closed > .title:before {
  content: "▸";
}
.lil-gui.closed > .children {
  transform: translateY(-7px);
  opacity: 0;
}
.lil-gui.closed:not(.transition) > .children {
  display: none;
}
.lil-gui.transition > .children {
  transition-duration: 300ms;
  transition-property: height, opacity, transform;
  transition-timing-function: cubic-bezier(0.2, 0.6, 0.35, 1);
  overflow: hidden;
  pointer-events: none;
}
.lil-gui .children:empty:before {
  content: "Empty";
  padding: 0 var(--padding);
  margin: var(--spacing) 0;
  display: block;
  height: var(--widget-height);
  font-style: italic;
  line-height: var(--widget-height);
  opacity: 0.5;
}
.lil-gui.root > .children > .lil-gui > .title {
  border: 0 solid var(--widget-color);
  border-width: 1px 0;
  transition: border-color 300ms;
}
.lil-gui.root > .children > .lil-gui.closed > .title {
  border-bottom-color: transparent;
}
.lil-gui + .controller {
  border-top: 1px solid var(--widget-color);
  margin-top: 0;
  padding-top: var(--spacing);
}
.lil-gui .lil-gui .lil-gui > .title {
  border: none;
}
.lil-gui .lil-gui .lil-gui > .children {
  border: none;
  margin-left: var(--folder-indent);
  border-left: 2px solid var(--widget-color);
}
.lil-gui .lil-gui .controller {
  border: none;
}

.lil-gui label, .lil-gui input, .lil-gui button {
  -webkit-tap-highlight-color: transparent;
}
.lil-gui input {
  border: 0;
  outline: none;
  font-family: var(--font-family);
  font-size: var(--input-font-size);
  border-radius: var(--widget-border-radius);
  height: var(--widget-height);
  background: var(--widget-color);
  color: var(--text-color);
  width: 100%;
}
@media (hover: hover) {
  .lil-gui input:hover {
    background: var(--hover-color);
  }
  .lil-gui input:active {
    background: var(--focus-color);
  }
}
.lil-gui input:disabled {
  opacity: 1;
}
.lil-gui input[type=text],
.lil-gui input[type=number] {
  padding: var(--widget-padding);
  -moz-appearance: textfield;
}
.lil-gui input[type=text]:focus,
.lil-gui input[type=number]:focus {
  background: var(--focus-color);
}
.lil-gui input[type=checkbox] {
  appearance: none;
  width: var(--checkbox-size);
  height: var(--checkbox-size);
  border-radius: var(--widget-border-radius);
  text-align: center;
  cursor: pointer;
}
.lil-gui input[type=checkbox]:checked:before {
  font-family: "lil-gui";
  content: "✓";
  font-size: var(--checkbox-size);
  line-height: var(--checkbox-size);
}
@media (hover: hover) {
  .lil-gui input[type=checkbox]:focus {
    box-shadow: inset 0 0 0 1px var(--focus-color);
  }
}
.lil-gui button {
  outline: none;
  cursor: pointer;
  font-family: var(--font-family);
  font-size: var(--font-size);
  color: var(--text-color);
  width: 100%;
  border: none;
}
.lil-gui .controller button {
  height: var(--widget-height);
  text-transform: none;
  background: var(--widget-color);
  border-radius: var(--widget-border-radius);
}
@media (hover: hover) {
  .lil-gui .controller button:hover {
    background: var(--hover-color);
  }
  .lil-gui .controller button:focus {
    box-shadow: inset 0 0 0 1px var(--focus-color);
  }
}
.lil-gui .controller button:active {
  background: var(--focus-color);
}

@font-face {
  font-family: "lil-gui";
  src: url("data:application/font-woff;charset=utf-8;base64,d09GRgABAAAAAAUsAAsAAAAACJwAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABCAAAAH4AAADAImwmYE9TLzIAAAGIAAAAPwAAAGBKqH5SY21hcAAAAcgAAAD0AAACrukyyJBnbHlmAAACvAAAAF8AAACEIZpWH2hlYWQAAAMcAAAAJwAAADZfcj2zaGhlYQAAA0QAAAAYAAAAJAC5AHhobXR4AAADXAAAABAAAABMAZAAAGxvY2EAAANsAAAAFAAAACgCEgIybWF4cAAAA4AAAAAeAAAAIAEfABJuYW1lAAADoAAAASIAAAIK9SUU/XBvc3QAAATEAAAAZgAAAJCTcMc2eJxVjbEOgjAURU+hFRBK1dGRL+ALnAiToyMLEzFpnPz/eAshwSa97517c/MwwJmeB9kwPl+0cf5+uGPZXsqPu4nvZabcSZldZ6kfyWnomFY/eScKqZNWupKJO6kXN3K9uCVoL7iInPr1X5baXs3tjuMqCtzEuagm/AAlzQgPAAB4nGNgYRBlnMDAysDAYM/gBiT5oLQBAwuDJAMDEwMrMwNWEJDmmsJwgCFeXZghBcjlZMgFCzOiKOIFAB71Bb8AeJy1kjFuwkAQRZ+DwRAwBtNQRUGKQ8OdKCAWUhAgKLhIuAsVSpWz5Bbkj3dEgYiUIszqWdpZe+Z7/wB1oCYmIoboiwiLT2WjKl/jscrHfGg/pKdMkyklC5Zs2LEfHYpjcRoPzme9MWWmk3dWbK9ObkWkikOetJ554fWyoEsmdSlt+uR0pCJR34b6t/TVg1SY3sYvdf8vuiKrpyaDXDISiegp17p7579Gp3p++y7HPAiY9pmTibljrr85qSidtlg4+l25GLCaS8e6rRxNBmsnERunKbaOObRz7N72ju5vdAjYpBXHgJylOAVsMseDAPEP8LYoUHicY2BiAAEfhiAGJgZWBgZ7RnFRdnVJELCQlBSRlATJMoLV2DK4glSYs6ubq5vbKrJLSbGrgEmovDuDJVhe3VzcXFwNLCOILB/C4IuQ1xTn5FPilBTj5FPmBAB4WwoqAHicY2BkYGAA4sk1sR/j+W2+MnAzpDBgAyEMQUCSg4EJxAEAwUgFHgB4nGNgZGBgSGFggJMhDIwMqEAYAByHATJ4nGNgAIIUNEwmAABl3AGReJxjYAACIQYlBiMGJ3wQAEcQBEV4nGNgZGBgEGZgY2BiAAEQyQWEDAz/wXwGAAsPATIAAHicXdBNSsNAHAXwl35iA0UQXYnMShfS9GPZA7T7LgIu03SSpkwzYTIt1BN4Ak/gKTyAeCxfw39jZkjymzcvAwmAW/wgwHUEGDb36+jQQ3GXGot79L24jxCP4gHzF/EIr4jEIe7wxhOC3g2TMYy4Q7+Lu/SHuEd/ivt4wJd4wPxbPEKMX3GI5+DJFGaSn4qNzk8mcbKSR6xdXdhSzaOZJGtdapd4vVPbi6rP+cL7TGXOHtXKll4bY1Xl7EGnPtp7Xy2n00zyKLVHfkHBa4IcJ2oD3cgggWvt/V/FbDrUlEUJhTn/0azVWbNTNr0Ens8de1tceK9xZmfB1CPjOmPH4kitmvOubcNpmVTN3oFJyjzCvnmrwhJTzqzVj9jiSX911FjeAAB4nG3HMRKCMBBA0f0giiKi4DU8k0V2GWbIZDOh4PoWWvq6J5V8If9NVNQcaDhyouXMhY4rPTcG7jwYmXhKq8Wz+p762aNaeYXom2n3m2dLTVgsrCgFJ7OTmIkYbwIbC6vIB7WmFfAAAA==") format("woff");
}`;function _injectStyles(P){const T=document.createElement("style");T.innerHTML=P;const L=document.querySelector("head link[rel=stylesheet], head style");L?document.head.insertBefore(T,L):document.head.appendChild(T)}let stylesInjected=!1;class GUI{constructor({parent:T,autoPlace:L=T===void 0,container:R,width:I,title:F="Controls",closeFolders:D=!1,injectStyles:V=!0,touchStyles:q=!0}={}){if(this.parent=T,this.root=T?T.root:this,this.children=[],this.controllers=[],this.folders=[],this._closed=!1,this._hidden=!1,this.domElement=document.createElement("div"),this.domElement.classList.add("lil-gui"),this.$title=document.createElement("button"),this.$title.classList.add("title"),this.$title.setAttribute("aria-expanded",!0),this.$title.addEventListener("click",()=>this.openAnimated(this._closed)),this.$title.addEventListener("touchstart",()=>{},{passive:!0}),this.$children=document.createElement("div"),this.$children.classList.add("children"),this.domElement.appendChild(this.$title),this.domElement.appendChild(this.$children),this.title(F),this.parent){this.parent.children.push(this),this.parent.folders.push(this),this.parent.$children.appendChild(this.domElement);return}this.domElement.classList.add("root"),q&&this.domElement.classList.add("allow-touch-styles"),!stylesInjected&&V&&(_injectStyles(stylesheet),stylesInjected=!0),R?R.appendChild(this.domElement):L&&(this.domElement.classList.add("autoPlace"),document.body.appendChild(this.domElement)),I&&this.domElement.style.setProperty("--width",I+"px"),this._closeFolders=D}add(T,L,R,I,F){if(Object(R)===R)return new OptionController(this,T,L,R);const D=T[L];switch(typeof D){case"number":return new NumberController(this,T,L,R,I,F);case"boolean":return new BooleanController(this,T,L);case"string":return new StringController(this,T,L);case"function":return new FunctionController(this,T,L)}console.error(`gui.add failed
	property:`,L,`
	object:`,T,`
	value:`,D)}addColor(T,L,R=1){return new ColorController(this,T,L,R)}addFolder(T){const L=new GUI({parent:this,title:T});return this.root._closeFolders&&L.close(),L}load(T,L=!0){return T.controllers&&this.controllers.forEach(R=>{R instanceof FunctionController||R._name in T.controllers&&R.load(T.controllers[R._name])}),L&&T.folders&&this.folders.forEach(R=>{R._title in T.folders&&R.load(T.folders[R._title])}),this}save(T=!0){const L={controllers:{},folders:{}};return this.controllers.forEach(R=>{if(!(R instanceof FunctionController)){if(R._name in L.controllers)throw new Error(`Cannot save GUI with duplicate property "${R._name}"`);L.controllers[R._name]=R.save()}}),T&&this.folders.forEach(R=>{if(R._title in L.folders)throw new Error(`Cannot save GUI with duplicate folder "${R._title}"`);L.folders[R._title]=R.save()}),L}open(T=!0){return this._setClosed(!T),this.$title.setAttribute("aria-expanded",!this._closed),this.domElement.classList.toggle("closed",this._closed),this}close(){return this.open(!1)}_setClosed(T){this._closed!==T&&(this._closed=T,this._callOnOpenClose(this))}show(T=!0){return this._hidden=!T,this.domElement.style.display=this._hidden?"none":"",this}hide(){return this.show(!1)}openAnimated(T=!0){return this._setClosed(!T),this.$title.setAttribute("aria-expanded",!this._closed),requestAnimationFrame(()=>{const L=this.$children.clientHeight;this.$children.style.height=L+"px",this.domElement.classList.add("transition");const R=F=>{F.target===this.$children&&(this.$children.style.height="",this.domElement.classList.remove("transition"),this.$children.removeEventListener("transitionend",R))};this.$children.addEventListener("transitionend",R);const I=T?this.$children.scrollHeight:0;this.domElement.classList.toggle("closed",!T),requestAnimationFrame(()=>{this.$children.style.height=I+"px"})}),this}title(T){return this._title=T,this.$title.textContent=T,this}reset(T=!0){return(T?this.controllersRecursive():this.controllers).forEach(R=>R.reset()),this}onChange(T){return this._onChange=T,this}_callOnChange(T){this.parent&&this.parent._callOnChange(T),this._onChange!==void 0&&this._onChange.call(this,{object:T.object,property:T.property,value:T.getValue(),controller:T})}onFinishChange(T){return this._onFinishChange=T,this}_callOnFinishChange(T){this.parent&&this.parent._callOnFinishChange(T),this._onFinishChange!==void 0&&this._onFinishChange.call(this,{object:T.object,property:T.property,value:T.getValue(),controller:T})}onOpenClose(T){return this._onOpenClose=T,this}_callOnOpenClose(T){this.parent&&this.parent._callOnOpenClose(T),this._onOpenClose!==void 0&&this._onOpenClose.call(this,T)}destroy(){this.parent&&(this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.folders.splice(this.parent.folders.indexOf(this),1)),this.domElement.parentElement&&this.domElement.parentElement.removeChild(this.domElement),Array.from(this.children).forEach(T=>T.destroy())}controllersRecursive(){let T=Array.from(this.controllers);return this.folders.forEach(L=>{T=T.concat(L.controllersRecursive())}),T}foldersRecursive(){let T=Array.from(this.folders);return this.folders.forEach(L=>{T=T.concat(L.foldersRecursive())}),T}}var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(P){return P&&P.__esModule&&Object.prototype.hasOwnProperty.call(P,"default")?P.default:P}function getAugmentedNamespace(P){if(Object.prototype.hasOwnProperty.call(P,"__esModule"))return P;var T=P.default;if(typeof T=="function"){var L=function R(){var I=!1;try{I=this instanceof R}catch{}return I?Reflect.construct(T,arguments,this.constructor):T.apply(this,arguments)};L.prototype=T.prototype}else L={};return Object.defineProperty(L,"__esModule",{value:!0}),Object.keys(P).forEach(function(R){var I=Object.getOwnPropertyDescriptor(P,R);Object.defineProperty(L,R,I.get?I:{enumerable:!0,get:function(){return P[R]}})}),L}var stats_min$1={exports:{}},stats_min=stats_min$1.exports,hasRequiredStats_min;function requireStats_min(){return hasRequiredStats_min||(hasRequiredStats_min=1,(function(P,T){(function(L,R){P.exports=R()})(stats_min,function(){var L=function(){function R(gt){return D.appendChild(gt.dom),gt}function I(gt){for(var yt=0;yt<D.children.length;yt++)D.children[yt].style.display=yt===gt?"block":"none";F=gt}var F=0,D=document.createElement("div");D.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",D.addEventListener("click",function(gt){gt.preventDefault(),I(++F%D.children.length)},!1);var V=(performance||Date).now(),q=V,G=0,z=R(new L.Panel("FPS","#0ff","#002")),Q=R(new L.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var tt=R(new L.Panel("MB","#f08","#201"));return I(0),{REVISION:16,dom:D,addPanel:R,showPanel:I,begin:function(){V=(performance||Date).now()},end:function(){G++;var gt=(performance||Date).now();if(Q.update(gt-V,200),gt>q+1e3&&(z.update(1e3*G/(gt-q),100),q=gt,G=0,tt)){var yt=performance.memory;tt.update(yt.usedJSHeapSize/1048576,yt.jsHeapSizeLimit/1048576)}return gt},update:function(){V=this.end()},domElement:D,setMode:I}};return L.Panel=function(R,I,F){var D=1/0,V=0,q=Math.round,G=q(window.devicePixelRatio||1),z=80*G,Q=48*G,tt=3*G,gt=2*G,yt=3*G,Et=15*G,J=74*G,At=30*G,kt=document.createElement("canvas");kt.width=z,kt.height=Q,kt.style.cssText="width:80px;height:48px";var ne=kt.getContext("2d");return ne.font="bold "+9*G+"px Helvetica,Arial,sans-serif",ne.textBaseline="top",ne.fillStyle=F,ne.fillRect(0,0,z,Q),ne.fillStyle=I,ne.fillText(R,tt,gt),ne.fillRect(yt,Et,J,At),ne.fillStyle=F,ne.globalAlpha=.9,ne.fillRect(yt,Et,J,At),{dom:kt,update:function(Te,Ht){D=Math.min(D,Te),V=Math.max(V,Te),ne.fillStyle=F,ne.globalAlpha=1,ne.fillRect(0,0,z,Et),ne.fillStyle=I,ne.fillText(q(Te)+" "+R+" ("+q(D)+"-"+q(V)+")",tt,gt),ne.drawImage(kt,yt+G,Et,J-G,At,yt,Et,J-G,At),ne.fillRect(yt+J-G,Et,G,At),ne.fillStyle=F,ne.globalAlpha=.9,ne.fillRect(yt+J-G,Et,G,q((1-Te/Ht)*At))}}},L})})(stats_min$1)),stats_min$1.exports}var stats_minExports=requireStats_min();const Stats=getDefaultExportFromCjs(stats_minExports);var t$2=function(P,T){return P<T?-1:P>T?1:0},r$1=function(P){return P.reduce(function(T,L){return T+L},0)},n$2=(function(){function P(L){this.colors=L}var T=P.prototype;return T.palette=function(){return this.colors},T.map=function(L){return L},P})(),o$1=(function(){function P(F,D,V){return(F<<10)+(D<<5)+V}function T(F){var D=[],V=!1;function q(){D.sort(F),V=!0}return{push:function(G){D.push(G),V=!1},peek:function(G){return V||q(),G===void 0&&(G=D.length-1),D[G]},pop:function(){return V||q(),D.pop()},size:function(){return D.length},map:function(G){return D.map(G)},debug:function(){return V||q(),D}}}function L(F,D,V,q,G,z,Q){var tt=this;tt.r1=F,tt.r2=D,tt.g1=V,tt.g2=q,tt.b1=G,tt.b2=z,tt.histo=Q}function R(){this.vboxes=new T(function(F,D){return t$2(F.vbox.count()*F.vbox.volume(),D.vbox.count()*D.vbox.volume())})}function I(F,D){if(D.count()){var V=D.r2-D.r1+1,q=D.g2-D.g1+1,G=Math.max.apply(null,[V,q,D.b2-D.b1+1]);if(D.count()==1)return[D.copy()];var z,Q,tt,gt,yt=0,Et=[],J=[];if(G==V)for(z=D.r1;z<=D.r2;z++){for(gt=0,Q=D.g1;Q<=D.g2;Q++)for(tt=D.b1;tt<=D.b2;tt++)gt+=F[P(z,Q,tt)]||0;Et[z]=yt+=gt}else if(G==q)for(z=D.g1;z<=D.g2;z++){for(gt=0,Q=D.r1;Q<=D.r2;Q++)for(tt=D.b1;tt<=D.b2;tt++)gt+=F[P(Q,z,tt)]||0;Et[z]=yt+=gt}else for(z=D.b1;z<=D.b2;z++){for(gt=0,Q=D.r1;Q<=D.r2;Q++)for(tt=D.g1;tt<=D.g2;tt++)gt+=F[P(Q,tt,z)]||0;Et[z]=yt+=gt}return Et.forEach(function(At,kt){J[kt]=yt-At}),(function(At){var kt,ne,Te,Ht,Le,ee=At+"1",si=At+"2",ci=0;for(z=D[ee];z<=D[si];z++)if(Et[z]>yt/2){for(Te=D.copy(),Ht=D.copy(),Le=(kt=z-D[ee])<=(ne=D[si]-z)?Math.min(D[si]-1,~~(z+ne/2)):Math.max(D[ee],~~(z-1-kt/2));!Et[Le];)Le++;for(ci=J[Le];!ci&&Et[Le-1];)ci=J[--Le];return Te[si]=Le,Ht[ee]=Te[si]+1,[Te,Ht]}})(G==V?"r":G==q?"g":"b")}}return L.prototype={volume:function(F){var D=this;return D._volume&&!F||(D._volume=(D.r2-D.r1+1)*(D.g2-D.g1+1)*(D.b2-D.b1+1)),D._volume},count:function(F){var D=this,V=D.histo;if(!D._count_set||F){var q,G,z,Q=0;for(q=D.r1;q<=D.r2;q++)for(G=D.g1;G<=D.g2;G++)for(z=D.b1;z<=D.b2;z++)Q+=V[P(q,G,z)]||0;D._count=Q,D._count_set=!0}return D._count},copy:function(){var F=this;return new L(F.r1,F.r2,F.g1,F.g2,F.b1,F.b2,F.histo)},avg:function(F){var D=this,V=D.histo;if(!D._avg||F){var q,G,z,Q,tt=0,gt=0,yt=0,Et=0;if(D.r1===D.r2&&D.g1===D.g2&&D.b1===D.b2)D._avg=[D.r1<<3,D.g1<<3,D.b1<<3];else{for(G=D.r1;G<=D.r2;G++)for(z=D.g1;z<=D.g2;z++)for(Q=D.b1;Q<=D.b2;Q++)tt+=q=V[P(G,z,Q)]||0,gt+=q*(G+.5)*8,yt+=q*(z+.5)*8,Et+=q*(Q+.5)*8;D._avg=tt?[~~(gt/tt),~~(yt/tt),~~(Et/tt)]:[~~(8*(D.r1+D.r2+1)/2),~~(8*(D.g1+D.g2+1)/2),~~(8*(D.b1+D.b2+1)/2)]}}return D._avg},contains:function(F){var D=this,V=F[0]>>3;return gval=F[1]>>3,bval=F[2]>>3,V>=D.r1&&V<=D.r2&&gval>=D.g1&&gval<=D.g2&&bval>=D.b1&&bval<=D.b2}},R.prototype={push:function(F){this.vboxes.push({vbox:F,color:F.avg()})},palette:function(){return this.vboxes.map(function(F){return F.color})},size:function(){return this.vboxes.size()},map:function(F){for(var D=this.vboxes,V=0;V<D.size();V++)if(D.peek(V).vbox.contains(F))return D.peek(V).color;return this.nearest(F)},nearest:function(F){for(var D,V,q,G=this.vboxes,z=0;z<G.size();z++)((V=Math.sqrt(Math.pow(F[0]-G.peek(z).color[0],2)+Math.pow(F[1]-G.peek(z).color[1],2)+Math.pow(F[2]-G.peek(z).color[2],2)))<D||D===void 0)&&(D=V,q=G.peek(z).color);return q},forcebw:function(){var F=this.vboxes;F.sort(function(G,z){return t$2(r$1(G.color),r$1(z.color))});var D=F[0].color;D[0]<5&&D[1]<5&&D[2]<5&&(F[0].color=[0,0,0]);var V=F.length-1,q=F[V].color;q[0]>251&&q[1]>251&&q[2]>251&&(F[V].color=[255,255,255])}},{quantize:function(F,D){if(!Number.isInteger(D)||D<1||D>256)throw new Error("Invalid maximum color count. It must be an integer between 1 and 256.");if(!F.length||D<2||D>256||!F.length||D<2||D>256)return!1;for(var V=[],q=new Set,G=0;G<F.length;G++){var z=F[G],Q=z.join(",");q.has(Q)||(q.add(Q),V.push(z))}if(V.length<=D)return new n$2(V);var tt=(function(kt){var ne,Te=new Array(32768);return kt.forEach(function(Ht){ne=P(Ht[0]>>3,Ht[1]>>3,Ht[2]>>3),Te[ne]=(Te[ne]||0)+1}),Te})(F);tt.forEach(function(){});var gt=(function(kt,ne){var Te,Ht,Le,ee=1e6,si=0,ci=1e6,ui=0,di=1e6,ii=0;return kt.forEach(function(bi){(Te=bi[0]>>3)<ee?ee=Te:Te>si&&(si=Te),(Ht=bi[1]>>3)<ci?ci=Ht:Ht>ui&&(ui=Ht),(Le=bi[2]>>3)<di?di=Le:Le>ii&&(ii=Le)}),new L(ee,si,ci,ui,di,ii,ne)})(F,tt),yt=new T(function(kt,ne){return t$2(kt.count(),ne.count())});function Et(kt,ne){for(var Te,Ht=kt.size(),Le=0;Le<1e3;){if(Ht>=ne||Le++>1e3)return;if((Te=kt.pop()).count()){var ee=I(tt,Te),si=ee[0],ci=ee[1];if(!si)return;kt.push(si),ci&&(kt.push(ci),Ht++)}else kt.push(Te),Le++}}yt.push(gt),Et(yt,.75*D);for(var J=new T(function(kt,ne){return t$2(kt.count()*kt.volume(),ne.count()*ne.volume())});yt.size();)J.push(yt.pop());Et(J,D);for(var At=new R;J.size();)At.push(J.pop());return At}}})().quantize,e$1=function(P){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.width=this.canvas.width=P.naturalWidth,this.height=this.canvas.height=P.naturalHeight,this.context.drawImage(P,0,0,this.width,this.height)};e$1.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)};var u$2=function(){};u$2.prototype.getColor=function(P,T){return T===void 0&&(T=10),this.getPalette(P,5,T)[0]},u$2.prototype.getPalette=function(P,T,L){var R=(function(V){var q=V.colorCount,G=V.quality;if(q!==void 0&&Number.isInteger(q)){if(q===1)throw new Error("colorCount should be between 2 and 20. To get one color, call getColor() instead of getPalette()");q=Math.max(q,2),q=Math.min(q,20)}else q=10;return(G===void 0||!Number.isInteger(G)||G<1)&&(G=10),{colorCount:q,quality:G}})({colorCount:T,quality:L}),I=new e$1(P),F=(function(V,q,G){for(var z,Q,tt,gt,yt,Et=V,J=[],At=0;At<q;At+=G)Q=Et[0+(z=4*At)],tt=Et[z+1],gt=Et[z+2],((yt=Et[z+3])===void 0||yt>=125)&&(Q>250&&tt>250&&gt>250||J.push([Q,tt,gt]));return J})(I.getImageData().data,I.width*I.height,R.quality),D=o$1(F,R.colorCount);return D?D.palette():null},u$2.prototype.getColorFromUrl=function(P,T,L){var R=this,I=document.createElement("img");I.addEventListener("load",function(){var F=R.getPalette(I,5,L);T(F[0],P)}),I.src=P},u$2.prototype.getImageData=function(P,T){var L=new XMLHttpRequest;L.open("GET",P,!0),L.responseType="arraybuffer",L.onload=function(){if(this.status==200){var R=new Uint8Array(this.response);i=R.length;for(var I=new Array(i),F=0;F<R.length;F++)I[F]=String.fromCharCode(R[F]);var D=I.join(""),V=window.btoa(D);T("data:image/png;base64,"+V)}},L.send()},u$2.prototype.getColorAsync=function(P,T,L){var R=this;this.getImageData(P,function(I){var F=document.createElement("img");F.addEventListener("load",function(){var D=R.getPalette(F,5,L);T(D[0],this)}),F.src=I})};var ENV=(P=>(P[P.WEBGL_LEGACY=0]="WEBGL_LEGACY",P[P.WEBGL=1]="WEBGL",P[P.WEBGL2=2]="WEBGL2",P))(ENV||{}),RENDERER_TYPE=(P=>(P[P.UNKNOWN=0]="UNKNOWN",P[P.WEBGL=1]="WEBGL",P[P.CANVAS=2]="CANVAS",P))(RENDERER_TYPE||{}),BUFFER_BITS=(P=>(P[P.COLOR=16384]="COLOR",P[P.DEPTH=256]="DEPTH",P[P.STENCIL=1024]="STENCIL",P))(BUFFER_BITS||{}),BLEND_MODES=(P=>(P[P.NORMAL=0]="NORMAL",P[P.ADD=1]="ADD",P[P.MULTIPLY=2]="MULTIPLY",P[P.SCREEN=3]="SCREEN",P[P.OVERLAY=4]="OVERLAY",P[P.DARKEN=5]="DARKEN",P[P.LIGHTEN=6]="LIGHTEN",P[P.COLOR_DODGE=7]="COLOR_DODGE",P[P.COLOR_BURN=8]="COLOR_BURN",P[P.HARD_LIGHT=9]="HARD_LIGHT",P[P.SOFT_LIGHT=10]="SOFT_LIGHT",P[P.DIFFERENCE=11]="DIFFERENCE",P[P.EXCLUSION=12]="EXCLUSION",P[P.HUE=13]="HUE",P[P.SATURATION=14]="SATURATION",P[P.COLOR=15]="COLOR",P[P.LUMINOSITY=16]="LUMINOSITY",P[P.NORMAL_NPM=17]="NORMAL_NPM",P[P.ADD_NPM=18]="ADD_NPM",P[P.SCREEN_NPM=19]="SCREEN_NPM",P[P.NONE=20]="NONE",P[P.SRC_OVER=0]="SRC_OVER",P[P.SRC_IN=21]="SRC_IN",P[P.SRC_OUT=22]="SRC_OUT",P[P.SRC_ATOP=23]="SRC_ATOP",P[P.DST_OVER=24]="DST_OVER",P[P.DST_IN=25]="DST_IN",P[P.DST_OUT=26]="DST_OUT",P[P.DST_ATOP=27]="DST_ATOP",P[P.ERASE=26]="ERASE",P[P.SUBTRACT=28]="SUBTRACT",P[P.XOR=29]="XOR",P))(BLEND_MODES||{}),DRAW_MODES=(P=>(P[P.POINTS=0]="POINTS",P[P.LINES=1]="LINES",P[P.LINE_LOOP=2]="LINE_LOOP",P[P.LINE_STRIP=3]="LINE_STRIP",P[P.TRIANGLES=4]="TRIANGLES",P[P.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",P[P.TRIANGLE_FAN=6]="TRIANGLE_FAN",P))(DRAW_MODES||{}),FORMATS=(P=>(P[P.RGBA=6408]="RGBA",P[P.RGB=6407]="RGB",P[P.RG=33319]="RG",P[P.RED=6403]="RED",P[P.RGBA_INTEGER=36249]="RGBA_INTEGER",P[P.RGB_INTEGER=36248]="RGB_INTEGER",P[P.RG_INTEGER=33320]="RG_INTEGER",P[P.RED_INTEGER=36244]="RED_INTEGER",P[P.ALPHA=6406]="ALPHA",P[P.LUMINANCE=6409]="LUMINANCE",P[P.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",P[P.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",P[P.DEPTH_STENCIL=34041]="DEPTH_STENCIL",P))(FORMATS||{}),TARGETS=(P=>(P[P.TEXTURE_2D=3553]="TEXTURE_2D",P[P.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",P[P.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",P[P.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",P[P.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",P[P.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",P[P.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",P[P.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",P[P.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",P))(TARGETS||{}),TYPES=(P=>(P[P.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",P[P.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",P[P.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",P[P.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",P[P.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",P[P.UNSIGNED_INT=5125]="UNSIGNED_INT",P[P.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",P[P.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",P[P.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",P[P.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",P[P.BYTE=5120]="BYTE",P[P.SHORT=5122]="SHORT",P[P.INT=5124]="INT",P[P.FLOAT=5126]="FLOAT",P[P.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",P[P.HALF_FLOAT=36193]="HALF_FLOAT",P))(TYPES||{}),SAMPLER_TYPES=(P=>(P[P.FLOAT=0]="FLOAT",P[P.INT=1]="INT",P[P.UINT=2]="UINT",P))(SAMPLER_TYPES||{}),SCALE_MODES=(P=>(P[P.NEAREST=0]="NEAREST",P[P.LINEAR=1]="LINEAR",P))(SCALE_MODES||{}),WRAP_MODES=(P=>(P[P.CLAMP=33071]="CLAMP",P[P.REPEAT=10497]="REPEAT",P[P.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",P))(WRAP_MODES||{}),MIPMAP_MODES=(P=>(P[P.OFF=0]="OFF",P[P.POW2=1]="POW2",P[P.ON=2]="ON",P[P.ON_MANUAL=3]="ON_MANUAL",P))(MIPMAP_MODES||{}),ALPHA_MODES=(P=>(P[P.NPM=0]="NPM",P[P.UNPACK=1]="UNPACK",P[P.PMA=2]="PMA",P[P.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",P[P.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",P[P.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",P))(ALPHA_MODES||{}),CLEAR_MODES=(P=>(P[P.NO=0]="NO",P[P.YES=1]="YES",P[P.AUTO=2]="AUTO",P[P.BLEND=0]="BLEND",P[P.CLEAR=1]="CLEAR",P[P.BLIT=2]="BLIT",P))(CLEAR_MODES||{}),GC_MODES=(P=>(P[P.AUTO=0]="AUTO",P[P.MANUAL=1]="MANUAL",P))(GC_MODES||{}),PRECISION=(P=>(P.LOW="lowp",P.MEDIUM="mediump",P.HIGH="highp",P))(PRECISION||{}),MASK_TYPES=(P=>(P[P.NONE=0]="NONE",P[P.SCISSOR=1]="SCISSOR",P[P.STENCIL=2]="STENCIL",P[P.SPRITE=3]="SPRITE",P[P.COLOR=4]="COLOR",P))(MASK_TYPES||{}),MSAA_QUALITY=(P=>(P[P.NONE=0]="NONE",P[P.LOW=2]="LOW",P[P.MEDIUM=4]="MEDIUM",P[P.HIGH=8]="HIGH",P))(MSAA_QUALITY||{}),BUFFER_TYPE=(P=>(P[P.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",P[P.ARRAY_BUFFER=34962]="ARRAY_BUFFER",P[P.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",P))(BUFFER_TYPE||{});const BrowserAdapter={createCanvas:(P,T)=>{const L=document.createElement("canvas");return L.width=P,L.height=T,L},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(P,T)=>fetch(P,T),parseXML:P=>new DOMParser().parseFromString(P,"text/xml")},settings={ADAPTER:BrowserAdapter,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var appleIphone=/iPhone/i,appleIpod=/iPod/i,appleTablet=/iPad/i,appleUniversal=/\biOS-universal(?:.+)Mac\b/i,androidPhone=/\bAndroid(?:.+)Mobile\b/i,androidTablet=/Android/i,amazonPhone=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,amazonTablet=/Silk/i,windowsPhone=/Windows Phone/i,windowsTablet=/\bWindows(?:.+)ARM\b/i,otherBlackBerry=/BlackBerry/i,otherBlackBerry10=/BB10/i,otherOpera=/Opera Mini/i,otherChrome=/\b(CriOS|Chrome)(?:.+)Mobile/i,otherFirefox=/Mobile(?:.+)Firefox\b/i,isAppleTabletOnIos13=function(P){return typeof P<"u"&&P.platform==="MacIntel"&&typeof P.maxTouchPoints=="number"&&P.maxTouchPoints>1&&typeof MSStream>"u"};function createMatch(P){return function(T){return T.test(P)}}function isMobile$1(P){var T={userAgent:"",platform:"",maxTouchPoints:0};!P&&typeof navigator<"u"?T={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof P=="string"?T.userAgent=P:P&&P.userAgent&&(T={userAgent:P.userAgent,platform:P.platform,maxTouchPoints:P.maxTouchPoints||0});var L=T.userAgent,R=L.split("[FBAN");typeof R[1]<"u"&&(L=R[0]),R=L.split("Twitter"),typeof R[1]<"u"&&(L=R[0]);var I=createMatch(L),F={apple:{phone:I(appleIphone)&&!I(windowsPhone),ipod:I(appleIpod),tablet:!I(appleIphone)&&(I(appleTablet)||isAppleTabletOnIos13(T))&&!I(windowsPhone),universal:I(appleUniversal),device:(I(appleIphone)||I(appleIpod)||I(appleTablet)||I(appleUniversal)||isAppleTabletOnIos13(T))&&!I(windowsPhone)},amazon:{phone:I(amazonPhone),tablet:!I(amazonPhone)&&I(amazonTablet),device:I(amazonPhone)||I(amazonTablet)},android:{phone:!I(windowsPhone)&&I(amazonPhone)||!I(windowsPhone)&&I(androidPhone),tablet:!I(windowsPhone)&&!I(amazonPhone)&&!I(androidPhone)&&(I(amazonTablet)||I(androidTablet)),device:!I(windowsPhone)&&(I(amazonPhone)||I(amazonTablet)||I(androidPhone)||I(androidTablet))||I(/\bokhttp\b/i)},windows:{phone:I(windowsPhone),tablet:I(windowsTablet),device:I(windowsPhone)||I(windowsTablet)},other:{blackberry:I(otherBlackBerry),blackberry10:I(otherBlackBerry10),opera:I(otherOpera),firefox:I(otherFirefox),chrome:I(otherChrome),device:I(otherBlackBerry)||I(otherBlackBerry10)||I(otherOpera)||I(otherFirefox)||I(otherChrome)},any:!1,phone:!1,tablet:!1};return F.any=F.apple.device||F.android.device||F.windows.device||F.other.device,F.phone=F.apple.phone||F.android.phone||F.windows.phone,F.tablet=F.apple.tablet||F.android.tablet||F.windows.tablet,F}const isMobileCall=isMobile$1.default??isMobile$1,isMobile=isMobileCall(globalThis.navigator);settings.RETINA_PREFIX=/@([0-9\.]+)x/;settings.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var eventemitter3={exports:{}},hasRequiredEventemitter3;function requireEventemitter3(){return hasRequiredEventemitter3||(hasRequiredEventemitter3=1,(function(P){var T=Object.prototype.hasOwnProperty,L="~";function R(){}Object.create&&(R.prototype=Object.create(null),new R().__proto__||(L=!1));function I(q,G,z){this.fn=q,this.context=G,this.once=z||!1}function F(q,G,z,Q,tt){if(typeof z!="function")throw new TypeError("The listener must be a function");var gt=new I(z,Q||q,tt),yt=L?L+G:G;return q._events[yt]?q._events[yt].fn?q._events[yt]=[q._events[yt],gt]:q._events[yt].push(gt):(q._events[yt]=gt,q._eventsCount++),q}function D(q,G){--q._eventsCount===0?q._events=new R:delete q._events[G]}function V(){this._events=new R,this._eventsCount=0}V.prototype.eventNames=function(){var G=[],z,Q;if(this._eventsCount===0)return G;for(Q in z=this._events)T.call(z,Q)&&G.push(L?Q.slice(1):Q);return Object.getOwnPropertySymbols?G.concat(Object.getOwnPropertySymbols(z)):G},V.prototype.listeners=function(G){var z=L?L+G:G,Q=this._events[z];if(!Q)return[];if(Q.fn)return[Q.fn];for(var tt=0,gt=Q.length,yt=new Array(gt);tt<gt;tt++)yt[tt]=Q[tt].fn;return yt},V.prototype.listenerCount=function(G){var z=L?L+G:G,Q=this._events[z];return Q?Q.fn?1:Q.length:0},V.prototype.emit=function(G,z,Q,tt,gt,yt){var Et=L?L+G:G;if(!this._events[Et])return!1;var J=this._events[Et],At=arguments.length,kt,ne;if(J.fn){switch(J.once&&this.removeListener(G,J.fn,void 0,!0),At){case 1:return J.fn.call(J.context),!0;case 2:return J.fn.call(J.context,z),!0;case 3:return J.fn.call(J.context,z,Q),!0;case 4:return J.fn.call(J.context,z,Q,tt),!0;case 5:return J.fn.call(J.context,z,Q,tt,gt),!0;case 6:return J.fn.call(J.context,z,Q,tt,gt,yt),!0}for(ne=1,kt=new Array(At-1);ne<At;ne++)kt[ne-1]=arguments[ne];J.fn.apply(J.context,kt)}else{var Te=J.length,Ht;for(ne=0;ne<Te;ne++)switch(J[ne].once&&this.removeListener(G,J[ne].fn,void 0,!0),At){case 1:J[ne].fn.call(J[ne].context);break;case 2:J[ne].fn.call(J[ne].context,z);break;case 3:J[ne].fn.call(J[ne].context,z,Q);break;case 4:J[ne].fn.call(J[ne].context,z,Q,tt);break;default:if(!kt)for(Ht=1,kt=new Array(At-1);Ht<At;Ht++)kt[Ht-1]=arguments[Ht];J[ne].fn.apply(J[ne].context,kt)}}return!0},V.prototype.on=function(G,z,Q){return F(this,G,z,Q,!1)},V.prototype.once=function(G,z,Q){return F(this,G,z,Q,!0)},V.prototype.removeListener=function(G,z,Q,tt){var gt=L?L+G:G;if(!this._events[gt])return this;if(!z)return D(this,gt),this;var yt=this._events[gt];if(yt.fn)yt.fn===z&&(!tt||yt.once)&&(!Q||yt.context===Q)&&D(this,gt);else{for(var Et=0,J=[],At=yt.length;Et<At;Et++)(yt[Et].fn!==z||tt&&!yt[Et].once||Q&&yt[Et].context!==Q)&&J.push(yt[Et]);J.length?this._events[gt]=J.length===1?J[0]:J:D(this,gt)}return this},V.prototype.removeAllListeners=function(G){var z;return G?(z=L?L+G:G,this._events[z]&&D(this,z)):(this._events=new R,this._eventsCount=0),this},V.prototype.off=V.prototype.removeListener,V.prototype.addListener=V.prototype.on,V.prefixed=L,V.EventEmitter=V,P.exports=V})(eventemitter3)),eventemitter3.exports}var eventemitter3Exports=requireEventemitter3();const EventEmitter=getDefaultExportFromCjs(eventemitter3Exports);var earcut={exports:{}},hasRequiredEarcut;function requireEarcut(){if(hasRequiredEarcut)return earcut.exports;hasRequiredEarcut=1,earcut.exports=P,earcut.exports.default=P;function P(we,Ge,Se){Se=Se||2;var ni=Ge&&Ge.length,ti=ni?Ge[0]*Se:we.length,ei=T(we,0,ti,Se,!0),oi=[];if(!ei||ei.next===ei.prev)return oi;var ai,fi,mi,_i,Si,Ti,Ei;if(ni&&(ei=q(we,Ge,ei,Se)),we.length>80*Se){ai=mi=we[0],fi=_i=we[1];for(var vi=Se;vi<ti;vi+=Se)Si=we[vi],Ti=we[vi+1],Si<ai&&(ai=Si),Ti<fi&&(fi=Ti),Si>mi&&(mi=Si),Ti>_i&&(_i=Ti);Ei=Math.max(mi-ai,_i-fi),Ei=Ei!==0?32767/Ei:0}return R(ei,oi,Se,ai,fi,Ei,0),oi}function T(we,Ge,Se,ni,ti){var ei,oi;if(ti===gi(we,Ge,Se,ni)>0)for(ei=Ge;ei<Se;ei+=ni)oi=ii(ei,we[ei],we[ei+1],oi);else for(ei=Se-ni;ei>=Ge;ei-=ni)oi=ii(ei,we[ei],we[ei+1],oi);return oi&&Te(oi,oi.next)&&(bi(oi),oi=oi.next),oi}function L(we,Ge){if(!we)return we;Ge||(Ge=we);var Se=we,ni;do if(ni=!1,!Se.steiner&&(Te(Se,Se.next)||ne(Se.prev,Se,Se.next)===0)){if(bi(Se),Se=Ge=Se.prev,Se===Se.next)break;ni=!0}else Se=Se.next;while(ni||Se!==Ge);return Ge}function R(we,Ge,Se,ni,ti,ei,oi){if(we){!oi&&ei&&gt(we,ni,ti,ei);for(var ai=we,fi,mi;we.prev!==we.next;){if(fi=we.prev,mi=we.next,ei?F(we,ni,ti,ei):I(we)){Ge.push(fi.i/Se|0),Ge.push(we.i/Se|0),Ge.push(mi.i/Se|0),bi(we),we=mi.next,ai=mi.next;continue}if(we=mi,we===ai){oi?oi===1?(we=D(L(we),Ge,Se),R(we,Ge,Se,ni,ti,ei,2)):oi===2&&V(we,Ge,Se,ni,ti,ei):R(L(we),Ge,Se,ni,ti,ei,1);break}}}}function I(we){var Ge=we.prev,Se=we,ni=we.next;if(ne(Ge,Se,ni)>=0)return!1;for(var ti=Ge.x,ei=Se.x,oi=ni.x,ai=Ge.y,fi=Se.y,mi=ni.y,_i=ti<ei?ti<oi?ti:oi:ei<oi?ei:oi,Si=ai<fi?ai<mi?ai:mi:fi<mi?fi:mi,Ti=ti>ei?ti>oi?ti:oi:ei>oi?ei:oi,Ei=ai>fi?ai>mi?ai:mi:fi>mi?fi:mi,vi=ni.next;vi!==Ge;){if(vi.x>=_i&&vi.x<=Ti&&vi.y>=Si&&vi.y<=Ei&&At(ti,ai,ei,fi,oi,mi,vi.x,vi.y)&&ne(vi.prev,vi,vi.next)>=0)return!1;vi=vi.next}return!0}function F(we,Ge,Se,ni){var ti=we.prev,ei=we,oi=we.next;if(ne(ti,ei,oi)>=0)return!1;for(var ai=ti.x,fi=ei.x,mi=oi.x,_i=ti.y,Si=ei.y,Ti=oi.y,Ei=ai<fi?ai<mi?ai:mi:fi<mi?fi:mi,vi=_i<Si?_i<Ti?_i:Ti:Si<Ti?Si:Ti,Ai=ai>fi?ai>mi?ai:mi:fi>mi?fi:mi,Li=_i>Si?_i>Ti?_i:Ti:Si>Ti?Si:Ti,Mi=Et(Ei,vi,Ge,Se,ni),Ri=Et(Ai,Li,Ge,Se,ni),xi=we.prevZ,wi=we.nextZ;xi&&xi.z>=Mi&&wi&&wi.z<=Ri;){if(xi.x>=Ei&&xi.x<=Ai&&xi.y>=vi&&xi.y<=Li&&xi!==ti&&xi!==oi&&At(ai,_i,fi,Si,mi,Ti,xi.x,xi.y)&&ne(xi.prev,xi,xi.next)>=0||(xi=xi.prevZ,wi.x>=Ei&&wi.x<=Ai&&wi.y>=vi&&wi.y<=Li&&wi!==ti&&wi!==oi&&At(ai,_i,fi,Si,mi,Ti,wi.x,wi.y)&&ne(wi.prev,wi,wi.next)>=0))return!1;wi=wi.nextZ}for(;xi&&xi.z>=Mi;){if(xi.x>=Ei&&xi.x<=Ai&&xi.y>=vi&&xi.y<=Li&&xi!==ti&&xi!==oi&&At(ai,_i,fi,Si,mi,Ti,xi.x,xi.y)&&ne(xi.prev,xi,xi.next)>=0)return!1;xi=xi.prevZ}for(;wi&&wi.z<=Ri;){if(wi.x>=Ei&&wi.x<=Ai&&wi.y>=vi&&wi.y<=Li&&wi!==ti&&wi!==oi&&At(ai,_i,fi,Si,mi,Ti,wi.x,wi.y)&&ne(wi.prev,wi,wi.next)>=0)return!1;wi=wi.nextZ}return!0}function D(we,Ge,Se){var ni=we;do{var ti=ni.prev,ei=ni.next.next;!Te(ti,ei)&&Ht(ti,ni,ni.next,ei)&&ci(ti,ei)&&ci(ei,ti)&&(Ge.push(ti.i/Se|0),Ge.push(ni.i/Se|0),Ge.push(ei.i/Se|0),bi(ni),bi(ni.next),ni=we=ei),ni=ni.next}while(ni!==we);return L(ni)}function V(we,Ge,Se,ni,ti,ei){var oi=we;do{for(var ai=oi.next.next;ai!==oi.prev;){if(oi.i!==ai.i&&kt(oi,ai)){var fi=di(oi,ai);oi=L(oi,oi.next),fi=L(fi,fi.next),R(oi,Ge,Se,ni,ti,ei,0),R(fi,Ge,Se,ni,ti,ei,0);return}ai=ai.next}oi=oi.next}while(oi!==we)}function q(we,Ge,Se,ni){var ti=[],ei,oi,ai,fi,mi;for(ei=0,oi=Ge.length;ei<oi;ei++)ai=Ge[ei]*ni,fi=ei<oi-1?Ge[ei+1]*ni:we.length,mi=T(we,ai,fi,ni,!1),mi===mi.next&&(mi.steiner=!0),ti.push(J(mi));for(ti.sort(G),ei=0;ei<ti.length;ei++)Se=z(ti[ei],Se);return Se}function G(we,Ge){return we.x-Ge.x}function z(we,Ge){var Se=Q(we,Ge);if(!Se)return Ge;var ni=di(Se,we);return L(ni,ni.next),L(Se,Se.next)}function Q(we,Ge){var Se=Ge,ni=we.x,ti=we.y,ei=-1/0,oi;do{if(ti<=Se.y&&ti>=Se.next.y&&Se.next.y!==Se.y){var ai=Se.x+(ti-Se.y)*(Se.next.x-Se.x)/(Se.next.y-Se.y);if(ai<=ni&&ai>ei&&(ei=ai,oi=Se.x<Se.next.x?Se:Se.next,ai===ni))return oi}Se=Se.next}while(Se!==Ge);if(!oi)return null;var fi=oi,mi=oi.x,_i=oi.y,Si=1/0,Ti;Se=oi;do ni>=Se.x&&Se.x>=mi&&ni!==Se.x&&At(ti<_i?ni:ei,ti,mi,_i,ti<_i?ei:ni,ti,Se.x,Se.y)&&(Ti=Math.abs(ti-Se.y)/(ni-Se.x),ci(Se,we)&&(Ti<Si||Ti===Si&&(Se.x>oi.x||Se.x===oi.x&&tt(oi,Se)))&&(oi=Se,Si=Ti)),Se=Se.next;while(Se!==fi);return oi}function tt(we,Ge){return ne(we.prev,we,Ge.prev)<0&&ne(Ge.next,we,we.next)<0}function gt(we,Ge,Se,ni){var ti=we;do ti.z===0&&(ti.z=Et(ti.x,ti.y,Ge,Se,ni)),ti.prevZ=ti.prev,ti.nextZ=ti.next,ti=ti.next;while(ti!==we);ti.prevZ.nextZ=null,ti.prevZ=null,yt(ti)}function yt(we){var Ge,Se,ni,ti,ei,oi,ai,fi,mi=1;do{for(Se=we,we=null,ei=null,oi=0;Se;){for(oi++,ni=Se,ai=0,Ge=0;Ge<mi&&(ai++,ni=ni.nextZ,!!ni);Ge++);for(fi=mi;ai>0||fi>0&&ni;)ai!==0&&(fi===0||!ni||Se.z<=ni.z)?(ti=Se,Se=Se.nextZ,ai--):(ti=ni,ni=ni.nextZ,fi--),ei?ei.nextZ=ti:we=ti,ti.prevZ=ei,ei=ti;Se=ni}ei.nextZ=null,mi*=2}while(oi>1);return we}function Et(we,Ge,Se,ni,ti){return we=(we-Se)*ti|0,Ge=(Ge-ni)*ti|0,we=(we|we<<8)&16711935,we=(we|we<<4)&252645135,we=(we|we<<2)&858993459,we=(we|we<<1)&1431655765,Ge=(Ge|Ge<<8)&16711935,Ge=(Ge|Ge<<4)&252645135,Ge=(Ge|Ge<<2)&858993459,Ge=(Ge|Ge<<1)&1431655765,we|Ge<<1}function J(we){var Ge=we,Se=we;do(Ge.x<Se.x||Ge.x===Se.x&&Ge.y<Se.y)&&(Se=Ge),Ge=Ge.next;while(Ge!==we);return Se}function At(we,Ge,Se,ni,ti,ei,oi,ai){return(ti-oi)*(Ge-ai)>=(we-oi)*(ei-ai)&&(we-oi)*(ni-ai)>=(Se-oi)*(Ge-ai)&&(Se-oi)*(ei-ai)>=(ti-oi)*(ni-ai)}function kt(we,Ge){return we.next.i!==Ge.i&&we.prev.i!==Ge.i&&!si(we,Ge)&&(ci(we,Ge)&&ci(Ge,we)&&ui(we,Ge)&&(ne(we.prev,we,Ge.prev)||ne(we,Ge.prev,Ge))||Te(we,Ge)&&ne(we.prev,we,we.next)>0&&ne(Ge.prev,Ge,Ge.next)>0)}function ne(we,Ge,Se){return(Ge.y-we.y)*(Se.x-Ge.x)-(Ge.x-we.x)*(Se.y-Ge.y)}function Te(we,Ge){return we.x===Ge.x&&we.y===Ge.y}function Ht(we,Ge,Se,ni){var ti=ee(ne(we,Ge,Se)),ei=ee(ne(we,Ge,ni)),oi=ee(ne(Se,ni,we)),ai=ee(ne(Se,ni,Ge));return!!(ti!==ei&&oi!==ai||ti===0&&Le(we,Se,Ge)||ei===0&&Le(we,ni,Ge)||oi===0&&Le(Se,we,ni)||ai===0&&Le(Se,Ge,ni))}function Le(we,Ge,Se){return Ge.x<=Math.max(we.x,Se.x)&&Ge.x>=Math.min(we.x,Se.x)&&Ge.y<=Math.max(we.y,Se.y)&&Ge.y>=Math.min(we.y,Se.y)}function ee(we){return we>0?1:we<0?-1:0}function si(we,Ge){var Se=we;do{if(Se.i!==we.i&&Se.next.i!==we.i&&Se.i!==Ge.i&&Se.next.i!==Ge.i&&Ht(Se,Se.next,we,Ge))return!0;Se=Se.next}while(Se!==we);return!1}function ci(we,Ge){return ne(we.prev,we,we.next)<0?ne(we,Ge,we.next)>=0&&ne(we,we.prev,Ge)>=0:ne(we,Ge,we.prev)<0||ne(we,we.next,Ge)<0}function ui(we,Ge){var Se=we,ni=!1,ti=(we.x+Ge.x)/2,ei=(we.y+Ge.y)/2;do Se.y>ei!=Se.next.y>ei&&Se.next.y!==Se.y&&ti<(Se.next.x-Se.x)*(ei-Se.y)/(Se.next.y-Se.y)+Se.x&&(ni=!ni),Se=Se.next;while(Se!==we);return ni}function di(we,Ge){var Se=new yi(we.i,we.x,we.y),ni=new yi(Ge.i,Ge.x,Ge.y),ti=we.next,ei=Ge.prev;return we.next=Ge,Ge.prev=we,Se.next=ti,ti.prev=Se,ni.next=Se,Se.prev=ni,ei.next=ni,ni.prev=ei,ni}function ii(we,Ge,Se,ni){var ti=new yi(we,Ge,Se);return ni?(ti.next=ni.next,ti.prev=ni,ni.next.prev=ti,ni.next=ti):(ti.prev=ti,ti.next=ti),ti}function bi(we){we.next.prev=we.prev,we.prev.next=we.next,we.prevZ&&(we.prevZ.nextZ=we.nextZ),we.nextZ&&(we.nextZ.prevZ=we.prevZ)}function yi(we,Ge,Se){this.i=we,this.x=Ge,this.y=Se,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}P.deviation=function(we,Ge,Se,ni){var ti=Ge&&Ge.length,ei=ti?Ge[0]*Se:we.length,oi=Math.abs(gi(we,0,ei,Se));if(ti)for(var ai=0,fi=Ge.length;ai<fi;ai++){var mi=Ge[ai]*Se,_i=ai<fi-1?Ge[ai+1]*Se:we.length;oi-=Math.abs(gi(we,mi,_i,Se))}var Si=0;for(ai=0;ai<ni.length;ai+=3){var Ti=ni[ai]*Se,Ei=ni[ai+1]*Se,vi=ni[ai+2]*Se;Si+=Math.abs((we[Ti]-we[vi])*(we[Ei+1]-we[Ti+1])-(we[Ti]-we[Ei])*(we[vi+1]-we[Ti+1]))}return oi===0&&Si===0?0:Math.abs((Si-oi)/oi)};function gi(we,Ge,Se,ni){for(var ti=0,ei=Ge,oi=Se-ni;ei<Se;ei+=ni)ti+=(we[oi]-we[ei])*(we[ei+1]+we[oi+1]),oi=ei;return ti}return P.flatten=function(we){for(var Ge=we[0][0].length,Se={vertices:[],holes:[],dimensions:Ge},ni=0,ti=0;ti<we.length;ti++){for(var ei=0;ei<we[ti].length;ei++)for(var oi=0;oi<Ge;oi++)Se.vertices.push(we[ti][ei][oi]);ti>0&&(ni+=we[ti-1].length,Se.holes.push(ni))}return Se},earcut.exports}requireEarcut();var url={},punycode$1={exports:{}};/*! https://mths.be/punycode v1.4.1 by @mathias */var punycode=punycode$1.exports,hasRequiredPunycode;function requirePunycode(){return hasRequiredPunycode||(hasRequiredPunycode=1,(function(P,T){(function(L){var R=T&&!T.nodeType&&T,I=P&&!P.nodeType&&P,F=typeof commonjsGlobal=="object"&&commonjsGlobal;(F.global===F||F.window===F||F.self===F)&&(L=F);var D,V=2147483647,q=36,G=1,z=26,Q=38,tt=700,gt=72,yt=128,Et="-",J=/^xn--/,At=/[^\x20-\x7E]/,kt=/[\x2E\u3002\uFF0E\uFF61]/g,ne={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},Te=q-G,Ht=Math.floor,Le=String.fromCharCode,ee;function si(ti){throw new RangeError(ne[ti])}function ci(ti,ei){for(var oi=ti.length,ai=[];oi--;)ai[oi]=ei(ti[oi]);return ai}function ui(ti,ei){var oi=ti.split("@"),ai="";oi.length>1&&(ai=oi[0]+"@",ti=oi[1]),ti=ti.replace(kt,".");var fi=ti.split("."),mi=ci(fi,ei).join(".");return ai+mi}function di(ti){for(var ei=[],oi=0,ai=ti.length,fi,mi;oi<ai;)fi=ti.charCodeAt(oi++),fi>=55296&&fi<=56319&&oi<ai?(mi=ti.charCodeAt(oi++),(mi&64512)==56320?ei.push(((fi&1023)<<10)+(mi&1023)+65536):(ei.push(fi),oi--)):ei.push(fi);return ei}function ii(ti){return ci(ti,function(ei){var oi="";return ei>65535&&(ei-=65536,oi+=Le(ei>>>10&1023|55296),ei=56320|ei&1023),oi+=Le(ei),oi}).join("")}function bi(ti){return ti-48<10?ti-22:ti-65<26?ti-65:ti-97<26?ti-97:q}function yi(ti,ei){return ti+22+75*(ti<26)-((ei!=0)<<5)}function gi(ti,ei,oi){var ai=0;for(ti=oi?Ht(ti/tt):ti>>1,ti+=Ht(ti/ei);ti>Te*z>>1;ai+=q)ti=Ht(ti/Te);return Ht(ai+(Te+1)*ti/(ti+Q))}function we(ti){var ei=[],oi=ti.length,ai,fi=0,mi=yt,_i=gt,Si,Ti,Ei,vi,Ai,Li,Mi,Ri,xi;for(Si=ti.lastIndexOf(Et),Si<0&&(Si=0),Ti=0;Ti<Si;++Ti)ti.charCodeAt(Ti)>=128&&si("not-basic"),ei.push(ti.charCodeAt(Ti));for(Ei=Si>0?Si+1:0;Ei<oi;){for(vi=fi,Ai=1,Li=q;Ei>=oi&&si("invalid-input"),Mi=bi(ti.charCodeAt(Ei++)),(Mi>=q||Mi>Ht((V-fi)/Ai))&&si("overflow"),fi+=Mi*Ai,Ri=Li<=_i?G:Li>=_i+z?z:Li-_i,!(Mi<Ri);Li+=q)xi=q-Ri,Ai>Ht(V/xi)&&si("overflow"),Ai*=xi;ai=ei.length+1,_i=gi(fi-vi,ai,vi==0),Ht(fi/ai)>V-mi&&si("overflow"),mi+=Ht(fi/ai),fi%=ai,ei.splice(fi++,0,mi)}return ii(ei)}function Ge(ti){var ei,oi,ai,fi,mi,_i,Si,Ti,Ei,vi,Ai,Li=[],Mi,Ri,xi,wi;for(ti=di(ti),Mi=ti.length,ei=yt,oi=0,mi=gt,_i=0;_i<Mi;++_i)Ai=ti[_i],Ai<128&&Li.push(Le(Ai));for(ai=fi=Li.length,fi&&Li.push(Et);ai<Mi;){for(Si=V,_i=0;_i<Mi;++_i)Ai=ti[_i],Ai>=ei&&Ai<Si&&(Si=Ai);for(Ri=ai+1,Si-ei>Ht((V-oi)/Ri)&&si("overflow"),oi+=(Si-ei)*Ri,ei=Si,_i=0;_i<Mi;++_i)if(Ai=ti[_i],Ai<ei&&++oi>V&&si("overflow"),Ai==ei){for(Ti=oi,Ei=q;vi=Ei<=mi?G:Ei>=mi+z?z:Ei-mi,!(Ti<vi);Ei+=q)wi=Ti-vi,xi=q-vi,Li.push(Le(yi(vi+wi%xi,0))),Ti=Ht(wi/xi);Li.push(Le(yi(Ti,0))),mi=gi(oi,Ri,ai==fi),oi=0,++ai}++oi,++ei}return Li.join("")}function Se(ti){return ui(ti,function(ei){return J.test(ei)?we(ei.slice(4).toLowerCase()):ei})}function ni(ti){return ui(ti,function(ei){return At.test(ei)?"xn--"+Ge(ei):ei})}if(D={version:"1.4.1",ucs2:{decode:di,encode:ii},decode:we,encode:Ge,toASCII:ni,toUnicode:Se},R&&I)if(P.exports==R)I.exports=D;else for(ee in D)D.hasOwnProperty(ee)&&(R[ee]=D[ee]);else L.punycode=D})(punycode)})(punycode$1,punycode$1.exports)),punycode$1.exports}var type,hasRequiredType;function requireType(){return hasRequiredType||(hasRequiredType=1,type=TypeError),type}const __viteBrowserExternal={},__viteBrowserExternal$1=Object.freeze(Object.defineProperty({__proto__:null,default:__viteBrowserExternal},Symbol.toStringTag,{value:"Module"})),require$$0=getAugmentedNamespace(__viteBrowserExternal$1);var objectInspect,hasRequiredObjectInspect;function requireObjectInspect(){if(hasRequiredObjectInspect)return objectInspect;hasRequiredObjectInspect=1;var P=typeof Map=="function"&&Map.prototype,T=Object.getOwnPropertyDescriptor&&P?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,L=P&&T&&typeof T.get=="function"?T.get:null,R=P&&Map.prototype.forEach,I=typeof Set=="function"&&Set.prototype,F=Object.getOwnPropertyDescriptor&&I?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,D=I&&F&&typeof F.get=="function"?F.get:null,V=I&&Set.prototype.forEach,q=typeof WeakMap=="function"&&WeakMap.prototype,G=q?WeakMap.prototype.has:null,z=typeof WeakSet=="function"&&WeakSet.prototype,Q=z?WeakSet.prototype.has:null,tt=typeof WeakRef=="function"&&WeakRef.prototype,gt=tt?WeakRef.prototype.deref:null,yt=Boolean.prototype.valueOf,Et=Object.prototype.toString,J=Function.prototype.toString,At=String.prototype.match,kt=String.prototype.slice,ne=String.prototype.replace,Te=String.prototype.toUpperCase,Ht=String.prototype.toLowerCase,Le=RegExp.prototype.test,ee=Array.prototype.concat,si=Array.prototype.join,ci=Array.prototype.slice,ui=Math.floor,di=typeof BigInt=="function"?BigInt.prototype.valueOf:null,ii=Object.getOwnPropertySymbols,bi=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,yi=typeof Symbol=="function"&&typeof Symbol.iterator=="object",gi=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===yi||!0)?Symbol.toStringTag:null,we=Object.prototype.propertyIsEnumerable,Ge=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(ri){return ri.__proto__}:null);function Se(ri,li){if(ri===1/0||ri===-1/0||ri!==ri||ri&&ri>-1e3&&ri<1e3||Le.call(/e/,li))return li;var Pi=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof ri=="number"){var Ii=ri<0?-ui(-ri):ui(ri);if(Ii!==ri){var Fi=String(Ii),Ci=kt.call(li,Fi.length+1);return ne.call(Fi,Pi,"$&_")+"."+ne.call(ne.call(Ci,/([0-9]{3})/g,"$&_"),/_$/,"")}}return ne.call(li,Pi,"$&_")}var ni=require$$0,ti=ni.custom,ei=Ri(ti)?ti:null,oi={__proto__:null,double:'"',single:"'"},ai={__proto__:null,double:/(["\\])/g,single:/(['\\])/g};objectInspect=function ri(li,Pi,Ii,Fi){var Ci=Pi||{};if(Di(Ci,"quoteStyle")&&!Di(oi,Ci.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Di(Ci,"maxStringLength")&&(typeof Ci.maxStringLength=="number"?Ci.maxStringLength<0&&Ci.maxStringLength!==1/0:Ci.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var Yi=Di(Ci,"customInspect")?Ci.customInspect:!0;if(typeof Yi!="boolean"&&Yi!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Di(Ci,"indent")&&Ci.indent!==null&&Ci.indent!=="	"&&!(parseInt(Ci.indent,10)===Ci.indent&&Ci.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Di(Ci,"numericSeparator")&&typeof Ci.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var ji=Ci.numericSeparator;if(typeof li>"u")return"undefined";if(li===null)return"null";if(typeof li=="boolean")return li?"true":"false";if(typeof li=="string")return or(li,Ci);if(typeof li=="number"){if(li===0)return 1/0/li>0?"0":"-0";var Oi=String(li);return ji?Se(li,Oi):Oi}if(typeof li=="bigint"){var Hi=String(li)+"n";return ji?Se(li,Hi):Hi}var Xs=typeof Ci.depth>"u"?5:Ci.depth;if(typeof Ii>"u"&&(Ii=0),Ii>=Xs&&Xs>0&&typeof li=="object")return Si(li)?"[Array]":"[Object]";var Ji=Tr(Ci,Ii);if(typeof Fi>"u")Fi=[];else if(Gi(Fi,li)>=0)return"[Circular]";function $i(_s,Vs,wr){if(Vs&&(Fi=ci.call(Fi),Fi.push(Vs)),wr){var gr={depth:Ci.depth};return Di(Ci,"quoteStyle")&&(gr.quoteStyle=Ci.quoteStyle),ri(_s,gr,Ii+1,Fi)}return ri(_s,Ci,Ii+1,Fi)}if(typeof li=="function"&&!Ei(li)){var hr=Xi(li),cr=Us(li,$i);return"[Function"+(hr?": "+hr:" (anonymous)")+"]"+(cr.length>0?" { "+si.call(cr,", ")+" }":"")}if(Ri(li)){var ur=yi?ne.call(String(li),/^(Symbol\(.*\))_[^)]*$/,"$1"):bi.call(li);return typeof li=="object"&&!yi?Rs(ur):ur}if(br(li)){for(var Bs="<"+Ht.call(String(li.nodeName)),Ks=li.attributes||[],$s=0;$s<Ks.length;$s++)Bs+=" "+Ks[$s].name+"="+fi(mi(Ks[$s].value),"double",Ci);return Bs+=">",li.childNodes&&li.childNodes.length&&(Bs+="..."),Bs+="</"+Ht.call(String(li.nodeName))+">",Bs}if(Si(li)){if(li.length===0)return"[]";var Zs=Us(li,$i);return Ji&&!Sr(Zs)?"["+js(Zs,Ji)+"]":"[ "+si.call(Zs,", ")+" ]"}if(vi(li)){var Qs=Us(li,$i);return!("cause"in Error.prototype)&&"cause"in li&&!we.call(li,"cause")?"{ ["+String(li)+"] "+si.call(ee.call("[cause]: "+$i(li.cause),Qs),", ")+" }":Qs.length===0?"["+String(li)+"]":"{ ["+String(li)+"] "+si.call(Qs,", ")+" }"}if(typeof li=="object"&&Yi){if(ei&&typeof li[ei]=="function"&&ni)return ni(li,{depth:Xs-Ii});if(Yi!=="symbol"&&typeof li.inspect=="function")return li.inspect()}if(Ui(li)){var dr=[];return R&&R.call(li,function(_s,Vs){dr.push($i(Vs,li,!0)+" => "+$i(_s,li))}),lr("Map",L.call(li),dr,Ji)}if(Qi(li)){var fr=[];return V&&V.call(li,function(_s){fr.push($i(_s,li))}),lr("Set",D.call(li),fr,Ji)}if(Ki(li))return Ws("WeakMap");if(vr(li))return Ws("WeakSet");if(Zi(li))return Ws("WeakRef");if(Li(li))return Rs($i(Number(li)));if(xi(li))return Rs($i(di.call(li)));if(Mi(li))return Rs(yt.call(li));if(Ai(li))return Rs($i(String(li)));if(typeof window<"u"&&li===window)return"{ [object Window] }";if(typeof globalThis<"u"&&li===globalThis||typeof commonjsGlobal<"u"&&li===commonjsGlobal)return"{ [object globalThis] }";if(!Ti(li)&&!Ei(li)){var Js=Us(li,$i),pr=Ge?Ge(li)===Object.prototype:li instanceof Object||li.constructor===Object,tr=li instanceof Object?"":"null prototype",mr=!pr&&gi&&Object(li)===li&&gi in li?kt.call(Bi(li),8,-1):tr?"Object":"",xr=pr||typeof li.constructor!="function"?"":li.constructor.name?li.constructor.name+" ":"",er=xr+(mr||tr?"["+si.call(ee.call([],mr||[],tr||[]),": ")+"] ":"");return Js.length===0?er+"{}":Ji?er+"{"+js(Js,Ji)+"}":er+"{ "+si.call(Js,", ")+" }"}return String(li)};function fi(ri,li,Pi){var Ii=Pi.quoteStyle||li,Fi=oi[Ii];return Fi+ri+Fi}function mi(ri){return ne.call(String(ri),/"/g,"&quot;")}function _i(ri){return!gi||!(typeof ri=="object"&&(gi in ri||typeof ri[gi]<"u"))}function Si(ri){return Bi(ri)==="[object Array]"&&_i(ri)}function Ti(ri){return Bi(ri)==="[object Date]"&&_i(ri)}function Ei(ri){return Bi(ri)==="[object RegExp]"&&_i(ri)}function vi(ri){return Bi(ri)==="[object Error]"&&_i(ri)}function Ai(ri){return Bi(ri)==="[object String]"&&_i(ri)}function Li(ri){return Bi(ri)==="[object Number]"&&_i(ri)}function Mi(ri){return Bi(ri)==="[object Boolean]"&&_i(ri)}function Ri(ri){if(yi)return ri&&typeof ri=="object"&&ri instanceof Symbol;if(typeof ri=="symbol")return!0;if(!ri||typeof ri!="object"||!bi)return!1;try{return bi.call(ri),!0}catch{}return!1}function xi(ri){if(!ri||typeof ri!="object"||!di)return!1;try{return di.call(ri),!0}catch{}return!1}var wi=Object.prototype.hasOwnProperty||function(ri){return ri in this};function Di(ri,li){return wi.call(ri,li)}function Bi(ri){return Et.call(ri)}function Xi(ri){if(ri.name)return ri.name;var li=At.call(J.call(ri),/^function\s*([\w$]+)/);return li?li[1]:null}function Gi(ri,li){if(ri.indexOf)return ri.indexOf(li);for(var Pi=0,Ii=ri.length;Pi<Ii;Pi++)if(ri[Pi]===li)return Pi;return-1}function Ui(ri){if(!L||!ri||typeof ri!="object")return!1;try{L.call(ri);try{D.call(ri)}catch{return!0}return ri instanceof Map}catch{}return!1}function Ki(ri){if(!G||!ri||typeof ri!="object")return!1;try{G.call(ri,G);try{Q.call(ri,Q)}catch{return!0}return ri instanceof WeakMap}catch{}return!1}function Zi(ri){if(!gt||!ri||typeof ri!="object")return!1;try{return gt.call(ri),!0}catch{}return!1}function Qi(ri){if(!D||!ri||typeof ri!="object")return!1;try{D.call(ri);try{L.call(ri)}catch{return!0}return ri instanceof Set}catch{}return!1}function vr(ri){if(!Q||!ri||typeof ri!="object")return!1;try{Q.call(ri,Q);try{G.call(ri,G)}catch{return!0}return ri instanceof WeakSet}catch{}return!1}function br(ri){return!ri||typeof ri!="object"?!1:typeof HTMLElement<"u"&&ri instanceof HTMLElement?!0:typeof ri.nodeName=="string"&&typeof ri.getAttribute=="function"}function or(ri,li){if(ri.length>li.maxStringLength){var Pi=ri.length-li.maxStringLength,Ii="... "+Pi+" more character"+(Pi>1?"s":"");return or(kt.call(ri,0,li.maxStringLength),li)+Ii}var Fi=ai[li.quoteStyle||"single"];Fi.lastIndex=0;var Ci=ne.call(ne.call(ri,Fi,"\\$1"),/[\x00-\x1f]/g,_r);return fi(Ci,"single",li)}function _r(ri){var li=ri.charCodeAt(0),Pi={8:"b",9:"t",10:"n",12:"f",13:"r"}[li];return Pi?"\\"+Pi:"\\x"+(li<16?"0":"")+Te.call(li.toString(16))}function Rs(ri){return"Object("+ri+")"}function Ws(ri){return ri+" { ? }"}function lr(ri,li,Pi,Ii){var Fi=Ii?js(Pi,Ii):si.call(Pi,", ");return ri+" ("+li+") {"+Fi+"}"}function Sr(ri){for(var li=0;li<ri.length;li++)if(Gi(ri[li],`
`)>=0)return!1;return!0}function Tr(ri,li){var Pi;if(ri.indent==="	")Pi="	";else if(typeof ri.indent=="number"&&ri.indent>0)Pi=si.call(Array(ri.indent+1)," ");else return null;return{base:Pi,prev:si.call(Array(li+1),Pi)}}function js(ri,li){if(ri.length===0)return"";var Pi=`
`+li.prev+li.base;return Pi+si.call(ri,","+Pi)+`
`+li.prev}function Us(ri,li){var Pi=Si(ri),Ii=[];if(Pi){Ii.length=ri.length;for(var Fi=0;Fi<ri.length;Fi++)Ii[Fi]=Di(ri,Fi)?li(ri[Fi],ri):""}var Ci=typeof ii=="function"?ii(ri):[],Yi;if(yi){Yi={};for(var ji=0;ji<Ci.length;ji++)Yi["$"+Ci[ji]]=Ci[ji]}for(var Oi in ri)Di(ri,Oi)&&(Pi&&String(Number(Oi))===Oi&&Oi<ri.length||yi&&Yi["$"+Oi]instanceof Symbol||(Le.call(/[^\w$]/,Oi)?Ii.push(li(Oi,ri)+": "+li(ri[Oi],ri)):Ii.push(Oi+": "+li(ri[Oi],ri))));if(typeof ii=="function")for(var Hi=0;Hi<Ci.length;Hi++)we.call(ri,Ci[Hi])&&Ii.push("["+li(Ci[Hi])+"]: "+li(ri[Ci[Hi]],ri));return Ii}return objectInspect}var sideChannelList,hasRequiredSideChannelList;function requireSideChannelList(){if(hasRequiredSideChannelList)return sideChannelList;hasRequiredSideChannelList=1;var P=requireObjectInspect(),T=requireType(),L=function(V,q,G){for(var z=V,Q;(Q=z.next)!=null;z=Q)if(Q.key===q)return z.next=Q.next,G||(Q.next=V.next,V.next=Q),Q},R=function(V,q){if(V){var G=L(V,q);return G&&G.value}},I=function(V,q,G){var z=L(V,q);z?z.value=G:V.next={key:q,next:V.next,value:G}},F=function(V,q){return V?!!L(V,q):!1},D=function(V,q){if(V)return L(V,q,!0)};return sideChannelList=function(){var q,G={assert:function(z){if(!G.has(z))throw new T("Side channel does not contain "+P(z))},delete:function(z){var Q=q&&q.next,tt=D(q,z);return tt&&Q&&Q===tt&&(q=void 0),!!tt},get:function(z){return R(q,z)},has:function(z){return F(q,z)},set:function(z,Q){q||(q={next:void 0}),I(q,z,Q)}};return G},sideChannelList}var esObjectAtoms,hasRequiredEsObjectAtoms;function requireEsObjectAtoms(){return hasRequiredEsObjectAtoms||(hasRequiredEsObjectAtoms=1,esObjectAtoms=Object),esObjectAtoms}var esErrors,hasRequiredEsErrors;function requireEsErrors(){return hasRequiredEsErrors||(hasRequiredEsErrors=1,esErrors=Error),esErrors}var _eval,hasRequired_eval;function require_eval(){return hasRequired_eval||(hasRequired_eval=1,_eval=EvalError),_eval}var range,hasRequiredRange;function requireRange(){return hasRequiredRange||(hasRequiredRange=1,range=RangeError),range}var ref,hasRequiredRef;function requireRef(){return hasRequiredRef||(hasRequiredRef=1,ref=ReferenceError),ref}var syntax,hasRequiredSyntax;function requireSyntax(){return hasRequiredSyntax||(hasRequiredSyntax=1,syntax=SyntaxError),syntax}var uri,hasRequiredUri;function requireUri(){return hasRequiredUri||(hasRequiredUri=1,uri=URIError),uri}var abs,hasRequiredAbs;function requireAbs(){return hasRequiredAbs||(hasRequiredAbs=1,abs=Math.abs),abs}var floor,hasRequiredFloor;function requireFloor(){return hasRequiredFloor||(hasRequiredFloor=1,floor=Math.floor),floor}var max,hasRequiredMax;function requireMax(){return hasRequiredMax||(hasRequiredMax=1,max=Math.max),max}var min,hasRequiredMin;function requireMin(){return hasRequiredMin||(hasRequiredMin=1,min=Math.min),min}var pow,hasRequiredPow;function requirePow(){return hasRequiredPow||(hasRequiredPow=1,pow=Math.pow),pow}var round,hasRequiredRound;function requireRound(){return hasRequiredRound||(hasRequiredRound=1,round=Math.round),round}var _isNaN,hasRequired_isNaN;function require_isNaN(){return hasRequired_isNaN||(hasRequired_isNaN=1,_isNaN=Number.isNaN||function(T){return T!==T}),_isNaN}var sign,hasRequiredSign;function requireSign(){if(hasRequiredSign)return sign;hasRequiredSign=1;var P=require_isNaN();return sign=function(L){return P(L)||L===0?L:L<0?-1:1},sign}var gOPD,hasRequiredGOPD;function requireGOPD(){return hasRequiredGOPD||(hasRequiredGOPD=1,gOPD=Object.getOwnPropertyDescriptor),gOPD}var gopd,hasRequiredGopd;function requireGopd(){if(hasRequiredGopd)return gopd;hasRequiredGopd=1;var P=requireGOPD();if(P)try{P([],"length")}catch{P=null}return gopd=P,gopd}var esDefineProperty,hasRequiredEsDefineProperty;function requireEsDefineProperty(){if(hasRequiredEsDefineProperty)return esDefineProperty;hasRequiredEsDefineProperty=1;var P=Object.defineProperty||!1;if(P)try{P({},"a",{value:1})}catch{P=!1}return esDefineProperty=P,esDefineProperty}var shams,hasRequiredShams;function requireShams(){return hasRequiredShams||(hasRequiredShams=1,shams=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var T={},L=Symbol("test"),R=Object(L);if(typeof L=="string"||Object.prototype.toString.call(L)!=="[object Symbol]"||Object.prototype.toString.call(R)!=="[object Symbol]")return!1;var I=42;T[L]=I;for(var F in T)return!1;if(typeof Object.keys=="function"&&Object.keys(T).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(T).length!==0)return!1;var D=Object.getOwnPropertySymbols(T);if(D.length!==1||D[0]!==L||!Object.prototype.propertyIsEnumerable.call(T,L))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var V=Object.getOwnPropertyDescriptor(T,L);if(V.value!==I||V.enumerable!==!0)return!1}return!0}),shams}var hasSymbols,hasRequiredHasSymbols;function requireHasSymbols(){if(hasRequiredHasSymbols)return hasSymbols;hasRequiredHasSymbols=1;var P=typeof Symbol<"u"&&Symbol,T=requireShams();return hasSymbols=function(){return typeof P!="function"||typeof Symbol!="function"||typeof P("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:T()},hasSymbols}var Reflect_getPrototypeOf,hasRequiredReflect_getPrototypeOf;function requireReflect_getPrototypeOf(){return hasRequiredReflect_getPrototypeOf||(hasRequiredReflect_getPrototypeOf=1,Reflect_getPrototypeOf=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),Reflect_getPrototypeOf}var Object_getPrototypeOf,hasRequiredObject_getPrototypeOf;function requireObject_getPrototypeOf(){if(hasRequiredObject_getPrototypeOf)return Object_getPrototypeOf;hasRequiredObject_getPrototypeOf=1;var P=requireEsObjectAtoms();return Object_getPrototypeOf=P.getPrototypeOf||null,Object_getPrototypeOf}var implementation,hasRequiredImplementation;function requireImplementation(){if(hasRequiredImplementation)return implementation;hasRequiredImplementation=1;var P="Function.prototype.bind called on incompatible ",T=Object.prototype.toString,L=Math.max,R="[object Function]",I=function(q,G){for(var z=[],Q=0;Q<q.length;Q+=1)z[Q]=q[Q];for(var tt=0;tt<G.length;tt+=1)z[tt+q.length]=G[tt];return z},F=function(q,G){for(var z=[],Q=G,tt=0;Q<q.length;Q+=1,tt+=1)z[tt]=q[Q];return z},D=function(V,q){for(var G="",z=0;z<V.length;z+=1)G+=V[z],z+1<V.length&&(G+=q);return G};return implementation=function(q){var G=this;if(typeof G!="function"||T.apply(G)!==R)throw new TypeError(P+G);for(var z=F(arguments,1),Q,tt=function(){if(this instanceof Q){var At=G.apply(this,I(z,arguments));return Object(At)===At?At:this}return G.apply(q,I(z,arguments))},gt=L(0,G.length-z.length),yt=[],Et=0;Et<gt;Et++)yt[Et]="$"+Et;if(Q=Function("binder","return function ("+D(yt,",")+"){ return binder.apply(this,arguments); }")(tt),G.prototype){var J=function(){};J.prototype=G.prototype,Q.prototype=new J,J.prototype=null}return Q},implementation}var functionBind,hasRequiredFunctionBind;function requireFunctionBind(){if(hasRequiredFunctionBind)return functionBind;hasRequiredFunctionBind=1;var P=requireImplementation();return functionBind=Function.prototype.bind||P,functionBind}var functionCall,hasRequiredFunctionCall;function requireFunctionCall(){return hasRequiredFunctionCall||(hasRequiredFunctionCall=1,functionCall=Function.prototype.call),functionCall}var functionApply,hasRequiredFunctionApply;function requireFunctionApply(){return hasRequiredFunctionApply||(hasRequiredFunctionApply=1,functionApply=Function.prototype.apply),functionApply}var reflectApply,hasRequiredReflectApply;function requireReflectApply(){return hasRequiredReflectApply||(hasRequiredReflectApply=1,reflectApply=typeof Reflect<"u"&&Reflect&&Reflect.apply),reflectApply}var actualApply,hasRequiredActualApply;function requireActualApply(){if(hasRequiredActualApply)return actualApply;hasRequiredActualApply=1;var P=requireFunctionBind(),T=requireFunctionApply(),L=requireFunctionCall(),R=requireReflectApply();return actualApply=R||P.call(L,T),actualApply}var callBindApplyHelpers,hasRequiredCallBindApplyHelpers;function requireCallBindApplyHelpers(){if(hasRequiredCallBindApplyHelpers)return callBindApplyHelpers;hasRequiredCallBindApplyHelpers=1;var P=requireFunctionBind(),T=requireType(),L=requireFunctionCall(),R=requireActualApply();return callBindApplyHelpers=function(F){if(F.length<1||typeof F[0]!="function")throw new T("a function is required");return R(P,L,F)},callBindApplyHelpers}var get,hasRequiredGet;function requireGet(){if(hasRequiredGet)return get;hasRequiredGet=1;var P=requireCallBindApplyHelpers(),T=requireGopd(),L;try{L=[].__proto__===Array.prototype}catch(D){if(!D||typeof D!="object"||!("code"in D)||D.code!=="ERR_PROTO_ACCESS")throw D}var R=!!L&&T&&T(Object.prototype,"__proto__"),I=Object,F=I.getPrototypeOf;return get=R&&typeof R.get=="function"?P([R.get]):typeof F=="function"?function(V){return F(V==null?V:I(V))}:!1,get}var getProto,hasRequiredGetProto;function requireGetProto(){if(hasRequiredGetProto)return getProto;hasRequiredGetProto=1;var P=requireReflect_getPrototypeOf(),T=requireObject_getPrototypeOf(),L=requireGet();return getProto=P?function(I){return P(I)}:T?function(I){if(!I||typeof I!="object"&&typeof I!="function")throw new TypeError("getProto: not an object");return T(I)}:L?function(I){return L(I)}:null,getProto}var hasown,hasRequiredHasown;function requireHasown(){if(hasRequiredHasown)return hasown;hasRequiredHasown=1;var P=Function.prototype.call,T=Object.prototype.hasOwnProperty,L=requireFunctionBind();return hasown=L.call(P,T),hasown}var getIntrinsic,hasRequiredGetIntrinsic;function requireGetIntrinsic(){if(hasRequiredGetIntrinsic)return getIntrinsic;hasRequiredGetIntrinsic=1;var P,T=requireEsObjectAtoms(),L=requireEsErrors(),R=require_eval(),I=requireRange(),F=requireRef(),D=requireSyntax(),V=requireType(),q=requireUri(),G=requireAbs(),z=requireFloor(),Q=requireMax(),tt=requireMin(),gt=requirePow(),yt=requireRound(),Et=requireSign(),J=Function,At=function(Ei){try{return J('"use strict"; return ('+Ei+").constructor;")()}catch{}},kt=requireGopd(),ne=requireEsDefineProperty(),Te=function(){throw new V},Ht=kt?(function(){try{return arguments.callee,Te}catch{try{return kt(arguments,"callee").get}catch{return Te}}})():Te,Le=requireHasSymbols()(),ee=requireGetProto(),si=requireObject_getPrototypeOf(),ci=requireReflect_getPrototypeOf(),ui=requireFunctionApply(),di=requireFunctionCall(),ii={},bi=typeof Uint8Array>"u"||!ee?P:ee(Uint8Array),yi={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?P:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?P:ArrayBuffer,"%ArrayIteratorPrototype%":Le&&ee?ee([][Symbol.iterator]()):P,"%AsyncFromSyncIteratorPrototype%":P,"%AsyncFunction%":ii,"%AsyncGenerator%":ii,"%AsyncGeneratorFunction%":ii,"%AsyncIteratorPrototype%":ii,"%Atomics%":typeof Atomics>"u"?P:Atomics,"%BigInt%":typeof BigInt>"u"?P:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?P:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?P:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?P:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":L,"%eval%":eval,"%EvalError%":R,"%Float16Array%":typeof Float16Array>"u"?P:Float16Array,"%Float32Array%":typeof Float32Array>"u"?P:Float32Array,"%Float64Array%":typeof Float64Array>"u"?P:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?P:FinalizationRegistry,"%Function%":J,"%GeneratorFunction%":ii,"%Int8Array%":typeof Int8Array>"u"?P:Int8Array,"%Int16Array%":typeof Int16Array>"u"?P:Int16Array,"%Int32Array%":typeof Int32Array>"u"?P:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":Le&&ee?ee(ee([][Symbol.iterator]())):P,"%JSON%":typeof JSON=="object"?JSON:P,"%Map%":typeof Map>"u"?P:Map,"%MapIteratorPrototype%":typeof Map>"u"||!Le||!ee?P:ee(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":T,"%Object.getOwnPropertyDescriptor%":kt,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?P:Promise,"%Proxy%":typeof Proxy>"u"?P:Proxy,"%RangeError%":I,"%ReferenceError%":F,"%Reflect%":typeof Reflect>"u"?P:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?P:Set,"%SetIteratorPrototype%":typeof Set>"u"||!Le||!ee?P:ee(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?P:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":Le&&ee?ee(""[Symbol.iterator]()):P,"%Symbol%":Le?Symbol:P,"%SyntaxError%":D,"%ThrowTypeError%":Ht,"%TypedArray%":bi,"%TypeError%":V,"%Uint8Array%":typeof Uint8Array>"u"?P:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?P:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?P:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?P:Uint32Array,"%URIError%":q,"%WeakMap%":typeof WeakMap>"u"?P:WeakMap,"%WeakRef%":typeof WeakRef>"u"?P:WeakRef,"%WeakSet%":typeof WeakSet>"u"?P:WeakSet,"%Function.prototype.call%":di,"%Function.prototype.apply%":ui,"%Object.defineProperty%":ne,"%Object.getPrototypeOf%":si,"%Math.abs%":G,"%Math.floor%":z,"%Math.max%":Q,"%Math.min%":tt,"%Math.pow%":gt,"%Math.round%":yt,"%Math.sign%":Et,"%Reflect.getPrototypeOf%":ci};if(ee)try{null.error}catch(Ei){var gi=ee(ee(Ei));yi["%Error.prototype%"]=gi}var we=function Ei(vi){var Ai;if(vi==="%AsyncFunction%")Ai=At("async function () {}");else if(vi==="%GeneratorFunction%")Ai=At("function* () {}");else if(vi==="%AsyncGeneratorFunction%")Ai=At("async function* () {}");else if(vi==="%AsyncGenerator%"){var Li=Ei("%AsyncGeneratorFunction%");Li&&(Ai=Li.prototype)}else if(vi==="%AsyncIteratorPrototype%"){var Mi=Ei("%AsyncGenerator%");Mi&&ee&&(Ai=ee(Mi.prototype))}return yi[vi]=Ai,Ai},Ge={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Se=requireFunctionBind(),ni=requireHasown(),ti=Se.call(di,Array.prototype.concat),ei=Se.call(ui,Array.prototype.splice),oi=Se.call(di,String.prototype.replace),ai=Se.call(di,String.prototype.slice),fi=Se.call(di,RegExp.prototype.exec),mi=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,_i=/\\(\\)?/g,Si=function(vi){var Ai=ai(vi,0,1),Li=ai(vi,-1);if(Ai==="%"&&Li!=="%")throw new D("invalid intrinsic syntax, expected closing `%`");if(Li==="%"&&Ai!=="%")throw new D("invalid intrinsic syntax, expected opening `%`");var Mi=[];return oi(vi,mi,function(Ri,xi,wi,Di){Mi[Mi.length]=wi?oi(Di,_i,"$1"):xi||Ri}),Mi},Ti=function(vi,Ai){var Li=vi,Mi;if(ni(Ge,Li)&&(Mi=Ge[Li],Li="%"+Mi[0]+"%"),ni(yi,Li)){var Ri=yi[Li];if(Ri===ii&&(Ri=we(Li)),typeof Ri>"u"&&!Ai)throw new V("intrinsic "+vi+" exists, but is not available. Please file an issue!");return{alias:Mi,name:Li,value:Ri}}throw new D("intrinsic "+vi+" does not exist!")};return getIntrinsic=function(vi,Ai){if(typeof vi!="string"||vi.length===0)throw new V("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof Ai!="boolean")throw new V('"allowMissing" argument must be a boolean');if(fi(/^%?[^%]*%?$/,vi)===null)throw new D("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var Li=Si(vi),Mi=Li.length>0?Li[0]:"",Ri=Ti("%"+Mi+"%",Ai),xi=Ri.name,wi=Ri.value,Di=!1,Bi=Ri.alias;Bi&&(Mi=Bi[0],ei(Li,ti([0,1],Bi)));for(var Xi=1,Gi=!0;Xi<Li.length;Xi+=1){var Ui=Li[Xi],Ki=ai(Ui,0,1),Zi=ai(Ui,-1);if((Ki==='"'||Ki==="'"||Ki==="`"||Zi==='"'||Zi==="'"||Zi==="`")&&Ki!==Zi)throw new D("property names with quotes must have matching quotes");if((Ui==="constructor"||!Gi)&&(Di=!0),Mi+="."+Ui,xi="%"+Mi+"%",ni(yi,xi))wi=yi[xi];else if(wi!=null){if(!(Ui in wi)){if(!Ai)throw new V("base intrinsic for "+vi+" exists, but the property is not available.");return}if(kt&&Xi+1>=Li.length){var Qi=kt(wi,Ui);Gi=!!Qi,Gi&&"get"in Qi&&!("originalValue"in Qi.get)?wi=Qi.get:wi=wi[Ui]}else Gi=ni(wi,Ui),wi=wi[Ui];Gi&&!Di&&(yi[xi]=wi)}}return wi},getIntrinsic}var callBound,hasRequiredCallBound;function requireCallBound(){if(hasRequiredCallBound)return callBound;hasRequiredCallBound=1;var P=requireGetIntrinsic(),T=requireCallBindApplyHelpers(),L=T([P("%String.prototype.indexOf%")]);return callBound=function(I,F){var D=P(I,!!F);return typeof D=="function"&&L(I,".prototype.")>-1?T([D]):D},callBound}var sideChannelMap,hasRequiredSideChannelMap;function requireSideChannelMap(){if(hasRequiredSideChannelMap)return sideChannelMap;hasRequiredSideChannelMap=1;var P=requireGetIntrinsic(),T=requireCallBound(),L=requireObjectInspect(),R=requireType(),I=P("%Map%",!0),F=T("Map.prototype.get",!0),D=T("Map.prototype.set",!0),V=T("Map.prototype.has",!0),q=T("Map.prototype.delete",!0),G=T("Map.prototype.size",!0);return sideChannelMap=!!I&&function(){var Q,tt={assert:function(gt){if(!tt.has(gt))throw new R("Side channel does not contain "+L(gt))},delete:function(gt){if(Q){var yt=q(Q,gt);return G(Q)===0&&(Q=void 0),yt}return!1},get:function(gt){if(Q)return F(Q,gt)},has:function(gt){return Q?V(Q,gt):!1},set:function(gt,yt){Q||(Q=new I),D(Q,gt,yt)}};return tt},sideChannelMap}var sideChannelWeakmap,hasRequiredSideChannelWeakmap;function requireSideChannelWeakmap(){if(hasRequiredSideChannelWeakmap)return sideChannelWeakmap;hasRequiredSideChannelWeakmap=1;var P=requireGetIntrinsic(),T=requireCallBound(),L=requireObjectInspect(),R=requireSideChannelMap(),I=requireType(),F=P("%WeakMap%",!0),D=T("WeakMap.prototype.get",!0),V=T("WeakMap.prototype.set",!0),q=T("WeakMap.prototype.has",!0),G=T("WeakMap.prototype.delete",!0);return sideChannelWeakmap=F?function(){var Q,tt,gt={assert:function(yt){if(!gt.has(yt))throw new I("Side channel does not contain "+L(yt))},delete:function(yt){if(F&&yt&&(typeof yt=="object"||typeof yt=="function")){if(Q)return G(Q,yt)}else if(R&&tt)return tt.delete(yt);return!1},get:function(yt){return F&&yt&&(typeof yt=="object"||typeof yt=="function")&&Q?D(Q,yt):tt&&tt.get(yt)},has:function(yt){return F&&yt&&(typeof yt=="object"||typeof yt=="function")&&Q?q(Q,yt):!!tt&&tt.has(yt)},set:function(yt,Et){F&&yt&&(typeof yt=="object"||typeof yt=="function")?(Q||(Q=new F),V(Q,yt,Et)):R&&(tt||(tt=R()),tt.set(yt,Et))}};return gt}:R,sideChannelWeakmap}var sideChannel,hasRequiredSideChannel;function requireSideChannel(){if(hasRequiredSideChannel)return sideChannel;hasRequiredSideChannel=1;var P=requireType(),T=requireObjectInspect(),L=requireSideChannelList(),R=requireSideChannelMap(),I=requireSideChannelWeakmap(),F=I||R||L;return sideChannel=function(){var V,q={assert:function(G){if(!q.has(G))throw new P("Side channel does not contain "+T(G))},delete:function(G){return!!V&&V.delete(G)},get:function(G){return V&&V.get(G)},has:function(G){return!!V&&V.has(G)},set:function(G,z){V||(V=F()),V.set(G,z)}};return q},sideChannel}var formats,hasRequiredFormats;function requireFormats(){if(hasRequiredFormats)return formats;hasRequiredFormats=1;var P=String.prototype.replace,T=/%20/g,L={RFC1738:"RFC1738",RFC3986:"RFC3986"};return formats={default:L.RFC3986,formatters:{RFC1738:function(R){return P.call(R,T,"+")},RFC3986:function(R){return String(R)}},RFC1738:L.RFC1738,RFC3986:L.RFC3986},formats}var utils,hasRequiredUtils;function requireUtils(){if(hasRequiredUtils)return utils;hasRequiredUtils=1;var P=requireFormats(),T=Object.prototype.hasOwnProperty,L=Array.isArray,R=(function(){for(var J=[],At=0;At<256;++At)J.push("%"+((At<16?"0":"")+At.toString(16)).toUpperCase());return J})(),I=function(At){for(;At.length>1;){var kt=At.pop(),ne=kt.obj[kt.prop];if(L(ne)){for(var Te=[],Ht=0;Ht<ne.length;++Ht)typeof ne[Ht]<"u"&&Te.push(ne[Ht]);kt.obj[kt.prop]=Te}}},F=function(At,kt){for(var ne=kt&&kt.plainObjects?{__proto__:null}:{},Te=0;Te<At.length;++Te)typeof At[Te]<"u"&&(ne[Te]=At[Te]);return ne},D=function J(At,kt,ne){if(!kt)return At;if(typeof kt!="object"&&typeof kt!="function"){if(L(At))At.push(kt);else if(At&&typeof At=="object")(ne&&(ne.plainObjects||ne.allowPrototypes)||!T.call(Object.prototype,kt))&&(At[kt]=!0);else return[At,kt];return At}if(!At||typeof At!="object")return[At].concat(kt);var Te=At;return L(At)&&!L(kt)&&(Te=F(At,ne)),L(At)&&L(kt)?(kt.forEach(function(Ht,Le){if(T.call(At,Le)){var ee=At[Le];ee&&typeof ee=="object"&&Ht&&typeof Ht=="object"?At[Le]=J(ee,Ht,ne):At.push(Ht)}else At[Le]=Ht}),At):Object.keys(kt).reduce(function(Ht,Le){var ee=kt[Le];return T.call(Ht,Le)?Ht[Le]=J(Ht[Le],ee,ne):Ht[Le]=ee,Ht},Te)},V=function(At,kt){return Object.keys(kt).reduce(function(ne,Te){return ne[Te]=kt[Te],ne},At)},q=function(J,At,kt){var ne=J.replace(/\+/g," ");if(kt==="iso-8859-1")return ne.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(ne)}catch{return ne}},G=1024,z=function(At,kt,ne,Te,Ht){if(At.length===0)return At;var Le=At;if(typeof At=="symbol"?Le=Symbol.prototype.toString.call(At):typeof At!="string"&&(Le=String(At)),ne==="iso-8859-1")return escape(Le).replace(/%u[0-9a-f]{4}/gi,function(bi){return"%26%23"+parseInt(bi.slice(2),16)+"%3B"});for(var ee="",si=0;si<Le.length;si+=G){for(var ci=Le.length>=G?Le.slice(si,si+G):Le,ui=[],di=0;di<ci.length;++di){var ii=ci.charCodeAt(di);if(ii===45||ii===46||ii===95||ii===126||ii>=48&&ii<=57||ii>=65&&ii<=90||ii>=97&&ii<=122||Ht===P.RFC1738&&(ii===40||ii===41)){ui[ui.length]=ci.charAt(di);continue}if(ii<128){ui[ui.length]=R[ii];continue}if(ii<2048){ui[ui.length]=R[192|ii>>6]+R[128|ii&63];continue}if(ii<55296||ii>=57344){ui[ui.length]=R[224|ii>>12]+R[128|ii>>6&63]+R[128|ii&63];continue}di+=1,ii=65536+((ii&1023)<<10|ci.charCodeAt(di)&1023),ui[ui.length]=R[240|ii>>18]+R[128|ii>>12&63]+R[128|ii>>6&63]+R[128|ii&63]}ee+=ui.join("")}return ee},Q=function(At){for(var kt=[{obj:{o:At},prop:"o"}],ne=[],Te=0;Te<kt.length;++Te)for(var Ht=kt[Te],Le=Ht.obj[Ht.prop],ee=Object.keys(Le),si=0;si<ee.length;++si){var ci=ee[si],ui=Le[ci];typeof ui=="object"&&ui!==null&&ne.indexOf(ui)===-1&&(kt.push({obj:Le,prop:ci}),ne.push(ui))}return I(kt),At},tt=function(At){return Object.prototype.toString.call(At)==="[object RegExp]"},gt=function(At){return!At||typeof At!="object"?!1:!!(At.constructor&&At.constructor.isBuffer&&At.constructor.isBuffer(At))},yt=function(At,kt){return[].concat(At,kt)},Et=function(At,kt){if(L(At)){for(var ne=[],Te=0;Te<At.length;Te+=1)ne.push(kt(At[Te]));return ne}return kt(At)};return utils={arrayToObject:F,assign:V,combine:yt,compact:Q,decode:q,encode:z,isBuffer:gt,isRegExp:tt,maybeMap:Et,merge:D},utils}var stringify_1,hasRequiredStringify;function requireStringify(){if(hasRequiredStringify)return stringify_1;hasRequiredStringify=1;var P=requireSideChannel(),T=requireUtils(),L=requireFormats(),R=Object.prototype.hasOwnProperty,I={brackets:function(J){return J+"[]"},comma:"comma",indices:function(J,At){return J+"["+At+"]"},repeat:function(J){return J}},F=Array.isArray,D=Array.prototype.push,V=function(Et,J){D.apply(Et,F(J)?J:[J])},q=Date.prototype.toISOString,G=L.default,z={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,commaRoundTrip:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:T.encode,encodeValuesOnly:!1,filter:void 0,format:G,formatter:L.formatters[G],indices:!1,serializeDate:function(J){return q.call(J)},skipNulls:!1,strictNullHandling:!1},Q=function(J){return typeof J=="string"||typeof J=="number"||typeof J=="boolean"||typeof J=="symbol"||typeof J=="bigint"},tt={},gt=function Et(J,At,kt,ne,Te,Ht,Le,ee,si,ci,ui,di,ii,bi,yi,gi,we,Ge){for(var Se=J,ni=Ge,ti=0,ei=!1;(ni=ni.get(tt))!==void 0&&!ei;){var oi=ni.get(J);if(ti+=1,typeof oi<"u"){if(oi===ti)throw new RangeError("Cyclic object value");ei=!0}typeof ni.get(tt)>"u"&&(ti=0)}if(typeof ci=="function"?Se=ci(At,Se):Se instanceof Date?Se=ii(Se):kt==="comma"&&F(Se)&&(Se=T.maybeMap(Se,function(xi){return xi instanceof Date?ii(xi):xi})),Se===null){if(Ht)return si&&!gi?si(At,z.encoder,we,"key",bi):At;Se=""}if(Q(Se)||T.isBuffer(Se)){if(si){var ai=gi?At:si(At,z.encoder,we,"key",bi);return[yi(ai)+"="+yi(si(Se,z.encoder,we,"value",bi))]}return[yi(At)+"="+yi(String(Se))]}var fi=[];if(typeof Se>"u")return fi;var mi;if(kt==="comma"&&F(Se))gi&&si&&(Se=T.maybeMap(Se,si)),mi=[{value:Se.length>0?Se.join(",")||null:void 0}];else if(F(ci))mi=ci;else{var _i=Object.keys(Se);mi=ui?_i.sort(ui):_i}var Si=ee?String(At).replace(/\./g,"%2E"):String(At),Ti=ne&&F(Se)&&Se.length===1?Si+"[]":Si;if(Te&&F(Se)&&Se.length===0)return Ti+"[]";for(var Ei=0;Ei<mi.length;++Ei){var vi=mi[Ei],Ai=typeof vi=="object"&&vi&&typeof vi.value<"u"?vi.value:Se[vi];if(!(Le&&Ai===null)){var Li=di&&ee?String(vi).replace(/\./g,"%2E"):String(vi),Mi=F(Se)?typeof kt=="function"?kt(Ti,Li):Ti:Ti+(di?"."+Li:"["+Li+"]");Ge.set(J,ti);var Ri=P();Ri.set(tt,Ge),V(fi,Et(Ai,Mi,kt,ne,Te,Ht,Le,ee,kt==="comma"&&gi&&F(Se)?null:si,ci,ui,di,ii,bi,yi,gi,we,Ri))}}return fi},yt=function(J){if(!J)return z;if(typeof J.allowEmptyArrays<"u"&&typeof J.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof J.encodeDotInKeys<"u"&&typeof J.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(J.encoder!==null&&typeof J.encoder<"u"&&typeof J.encoder!="function")throw new TypeError("Encoder has to be a function.");var At=J.charset||z.charset;if(typeof J.charset<"u"&&J.charset!=="utf-8"&&J.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var kt=L.default;if(typeof J.format<"u"){if(!R.call(L.formatters,J.format))throw new TypeError("Unknown format option provided.");kt=J.format}var ne=L.formatters[kt],Te=z.filter;(typeof J.filter=="function"||F(J.filter))&&(Te=J.filter);var Ht;if(J.arrayFormat in I?Ht=J.arrayFormat:"indices"in J?Ht=J.indices?"indices":"repeat":Ht=z.arrayFormat,"commaRoundTrip"in J&&typeof J.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var Le=typeof J.allowDots>"u"?J.encodeDotInKeys===!0?!0:z.allowDots:!!J.allowDots;return{addQueryPrefix:typeof J.addQueryPrefix=="boolean"?J.addQueryPrefix:z.addQueryPrefix,allowDots:Le,allowEmptyArrays:typeof J.allowEmptyArrays=="boolean"?!!J.allowEmptyArrays:z.allowEmptyArrays,arrayFormat:Ht,charset:At,charsetSentinel:typeof J.charsetSentinel=="boolean"?J.charsetSentinel:z.charsetSentinel,commaRoundTrip:!!J.commaRoundTrip,delimiter:typeof J.delimiter>"u"?z.delimiter:J.delimiter,encode:typeof J.encode=="boolean"?J.encode:z.encode,encodeDotInKeys:typeof J.encodeDotInKeys=="boolean"?J.encodeDotInKeys:z.encodeDotInKeys,encoder:typeof J.encoder=="function"?J.encoder:z.encoder,encodeValuesOnly:typeof J.encodeValuesOnly=="boolean"?J.encodeValuesOnly:z.encodeValuesOnly,filter:Te,format:kt,formatter:ne,serializeDate:typeof J.serializeDate=="function"?J.serializeDate:z.serializeDate,skipNulls:typeof J.skipNulls=="boolean"?J.skipNulls:z.skipNulls,sort:typeof J.sort=="function"?J.sort:null,strictNullHandling:typeof J.strictNullHandling=="boolean"?J.strictNullHandling:z.strictNullHandling}};return stringify_1=function(Et,J){var At=Et,kt=yt(J),ne,Te;typeof kt.filter=="function"?(Te=kt.filter,At=Te("",At)):F(kt.filter)&&(Te=kt.filter,ne=Te);var Ht=[];if(typeof At!="object"||At===null)return"";var Le=I[kt.arrayFormat],ee=Le==="comma"&&kt.commaRoundTrip;ne||(ne=Object.keys(At)),kt.sort&&ne.sort(kt.sort);for(var si=P(),ci=0;ci<ne.length;++ci){var ui=ne[ci],di=At[ui];kt.skipNulls&&di===null||V(Ht,gt(di,ui,Le,ee,kt.allowEmptyArrays,kt.strictNullHandling,kt.skipNulls,kt.encodeDotInKeys,kt.encode?kt.encoder:null,kt.filter,kt.sort,kt.allowDots,kt.serializeDate,kt.format,kt.formatter,kt.encodeValuesOnly,kt.charset,si))}var ii=Ht.join(kt.delimiter),bi=kt.addQueryPrefix===!0?"?":"";return kt.charsetSentinel&&(kt.charset==="iso-8859-1"?bi+="utf8=%26%2310003%3B&":bi+="utf8=%E2%9C%93&"),ii.length>0?bi+ii:""},stringify_1}var parse,hasRequiredParse;function requireParse(){if(hasRequiredParse)return parse;hasRequiredParse=1;var P=requireUtils(),T=Object.prototype.hasOwnProperty,L=Array.isArray,R={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:P.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1,throwOnLimitExceeded:!1},I=function(tt){return tt.replace(/&#(\d+);/g,function(gt,yt){return String.fromCharCode(parseInt(yt,10))})},F=function(tt,gt,yt){if(tt&&typeof tt=="string"&&gt.comma&&tt.indexOf(",")>-1)return tt.split(",");if(gt.throwOnLimitExceeded&&yt>=gt.arrayLimit)throw new RangeError("Array limit exceeded. Only "+gt.arrayLimit+" element"+(gt.arrayLimit===1?"":"s")+" allowed in an array.");return tt},D="utf8=%26%2310003%3B",V="utf8=%E2%9C%93",q=function(gt,yt){var Et={__proto__:null},J=yt.ignoreQueryPrefix?gt.replace(/^\?/,""):gt;J=J.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var At=yt.parameterLimit===1/0?void 0:yt.parameterLimit,kt=J.split(yt.delimiter,yt.throwOnLimitExceeded?At+1:At);if(yt.throwOnLimitExceeded&&kt.length>At)throw new RangeError("Parameter limit exceeded. Only "+At+" parameter"+(At===1?"":"s")+" allowed.");var ne=-1,Te,Ht=yt.charset;if(yt.charsetSentinel)for(Te=0;Te<kt.length;++Te)kt[Te].indexOf("utf8=")===0&&(kt[Te]===V?Ht="utf-8":kt[Te]===D&&(Ht="iso-8859-1"),ne=Te,Te=kt.length);for(Te=0;Te<kt.length;++Te)if(Te!==ne){var Le=kt[Te],ee=Le.indexOf("]="),si=ee===-1?Le.indexOf("="):ee+1,ci,ui;si===-1?(ci=yt.decoder(Le,R.decoder,Ht,"key"),ui=yt.strictNullHandling?null:""):(ci=yt.decoder(Le.slice(0,si),R.decoder,Ht,"key"),ui=P.maybeMap(F(Le.slice(si+1),yt,L(Et[ci])?Et[ci].length:0),function(ii){return yt.decoder(ii,R.decoder,Ht,"value")})),ui&&yt.interpretNumericEntities&&Ht==="iso-8859-1"&&(ui=I(String(ui))),Le.indexOf("[]=")>-1&&(ui=L(ui)?[ui]:ui);var di=T.call(Et,ci);di&&yt.duplicates==="combine"?Et[ci]=P.combine(Et[ci],ui):(!di||yt.duplicates==="last")&&(Et[ci]=ui)}return Et},G=function(tt,gt,yt,Et){var J=0;if(tt.length>0&&tt[tt.length-1]==="[]"){var At=tt.slice(0,-1).join("");J=Array.isArray(gt)&&gt[At]?gt[At].length:0}for(var kt=Et?gt:F(gt,yt,J),ne=tt.length-1;ne>=0;--ne){var Te,Ht=tt[ne];if(Ht==="[]"&&yt.parseArrays)Te=yt.allowEmptyArrays&&(kt===""||yt.strictNullHandling&&kt===null)?[]:P.combine([],kt);else{Te=yt.plainObjects?{__proto__:null}:{};var Le=Ht.charAt(0)==="["&&Ht.charAt(Ht.length-1)==="]"?Ht.slice(1,-1):Ht,ee=yt.decodeDotInKeys?Le.replace(/%2E/g,"."):Le,si=parseInt(ee,10);!yt.parseArrays&&ee===""?Te={0:kt}:!isNaN(si)&&Ht!==ee&&String(si)===ee&&si>=0&&yt.parseArrays&&si<=yt.arrayLimit?(Te=[],Te[si]=kt):ee!=="__proto__"&&(Te[ee]=kt)}kt=Te}return kt},z=function(gt,yt,Et,J){if(gt){var At=Et.allowDots?gt.replace(/\.([^.[]+)/g,"[$1]"):gt,kt=/(\[[^[\]]*])/,ne=/(\[[^[\]]*])/g,Te=Et.depth>0&&kt.exec(At),Ht=Te?At.slice(0,Te.index):At,Le=[];if(Ht){if(!Et.plainObjects&&T.call(Object.prototype,Ht)&&!Et.allowPrototypes)return;Le.push(Ht)}for(var ee=0;Et.depth>0&&(Te=ne.exec(At))!==null&&ee<Et.depth;){if(ee+=1,!Et.plainObjects&&T.call(Object.prototype,Te[1].slice(1,-1))&&!Et.allowPrototypes)return;Le.push(Te[1])}if(Te){if(Et.strictDepth===!0)throw new RangeError("Input depth exceeded depth option of "+Et.depth+" and strictDepth is true");Le.push("["+At.slice(Te.index)+"]")}return G(Le,yt,Et,J)}},Q=function(gt){if(!gt)return R;if(typeof gt.allowEmptyArrays<"u"&&typeof gt.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof gt.decodeDotInKeys<"u"&&typeof gt.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(gt.decoder!==null&&typeof gt.decoder<"u"&&typeof gt.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof gt.charset<"u"&&gt.charset!=="utf-8"&&gt.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");if(typeof gt.throwOnLimitExceeded<"u"&&typeof gt.throwOnLimitExceeded!="boolean")throw new TypeError("`throwOnLimitExceeded` option must be a boolean");var yt=typeof gt.charset>"u"?R.charset:gt.charset,Et=typeof gt.duplicates>"u"?R.duplicates:gt.duplicates;if(Et!=="combine"&&Et!=="first"&&Et!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var J=typeof gt.allowDots>"u"?gt.decodeDotInKeys===!0?!0:R.allowDots:!!gt.allowDots;return{allowDots:J,allowEmptyArrays:typeof gt.allowEmptyArrays=="boolean"?!!gt.allowEmptyArrays:R.allowEmptyArrays,allowPrototypes:typeof gt.allowPrototypes=="boolean"?gt.allowPrototypes:R.allowPrototypes,allowSparse:typeof gt.allowSparse=="boolean"?gt.allowSparse:R.allowSparse,arrayLimit:typeof gt.arrayLimit=="number"?gt.arrayLimit:R.arrayLimit,charset:yt,charsetSentinel:typeof gt.charsetSentinel=="boolean"?gt.charsetSentinel:R.charsetSentinel,comma:typeof gt.comma=="boolean"?gt.comma:R.comma,decodeDotInKeys:typeof gt.decodeDotInKeys=="boolean"?gt.decodeDotInKeys:R.decodeDotInKeys,decoder:typeof gt.decoder=="function"?gt.decoder:R.decoder,delimiter:typeof gt.delimiter=="string"||P.isRegExp(gt.delimiter)?gt.delimiter:R.delimiter,depth:typeof gt.depth=="number"||gt.depth===!1?+gt.depth:R.depth,duplicates:Et,ignoreQueryPrefix:gt.ignoreQueryPrefix===!0,interpretNumericEntities:typeof gt.interpretNumericEntities=="boolean"?gt.interpretNumericEntities:R.interpretNumericEntities,parameterLimit:typeof gt.parameterLimit=="number"?gt.parameterLimit:R.parameterLimit,parseArrays:gt.parseArrays!==!1,plainObjects:typeof gt.plainObjects=="boolean"?gt.plainObjects:R.plainObjects,strictDepth:typeof gt.strictDepth=="boolean"?!!gt.strictDepth:R.strictDepth,strictNullHandling:typeof gt.strictNullHandling=="boolean"?gt.strictNullHandling:R.strictNullHandling,throwOnLimitExceeded:typeof gt.throwOnLimitExceeded=="boolean"?gt.throwOnLimitExceeded:!1}};return parse=function(tt,gt){var yt=Q(gt);if(tt===""||tt===null||typeof tt>"u")return yt.plainObjects?{__proto__:null}:{};for(var Et=typeof tt=="string"?q(tt,yt):tt,J=yt.plainObjects?{__proto__:null}:{},At=Object.keys(Et),kt=0;kt<At.length;++kt){var ne=At[kt],Te=z(ne,Et[ne],yt,typeof tt=="string");J=P.merge(J,Te,yt)}return yt.allowSparse===!0?J:P.compact(J)},parse}var lib,hasRequiredLib;function requireLib(){if(hasRequiredLib)return lib;hasRequiredLib=1;var P=requireStringify(),T=requireParse(),L=requireFormats();return lib={formats:L,parse:T,stringify:P},lib}var hasRequiredUrl;function requireUrl(){if(hasRequiredUrl)return url;hasRequiredUrl=1;var P=requirePunycode();function T(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var L=/^([a-z0-9.+-]+:)/i,R=/:[0-9]*$/,I=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,F=["<",">",'"',"`"," ","\r",`
`,"	"],D=["{","}","|","\\","^","`"].concat(F),V=["'"].concat(D),q=["%","/","?",";","#"].concat(V),G=["/","?","#"],z=255,Q=/^[+a-z0-9A-Z_-]{0,63}$/,tt=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,gt={javascript:!0,"javascript:":!0},yt={javascript:!0,"javascript:":!0},Et={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},J=requireLib();function At(Ht,Le,ee){if(Ht&&typeof Ht=="object"&&Ht instanceof T)return Ht;var si=new T;return si.parse(Ht,Le,ee),si}T.prototype.parse=function(Ht,Le,ee){if(typeof Ht!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof Ht);var si=Ht.indexOf("?"),ci=si!==-1&&si<Ht.indexOf("#")?"?":"#",ui=Ht.split(ci),di=/\\/g;ui[0]=ui[0].replace(di,"/"),Ht=ui.join(ci);var ii=Ht;if(ii=ii.trim(),!ee&&Ht.split("#").length===1){var bi=I.exec(ii);if(bi)return this.path=ii,this.href=ii,this.pathname=bi[1],bi[2]?(this.search=bi[2],Le?this.query=J.parse(this.search.substr(1)):this.query=this.search.substr(1)):Le&&(this.search="",this.query={}),this}var yi=L.exec(ii);if(yi){yi=yi[0];var gi=yi.toLowerCase();this.protocol=gi,ii=ii.substr(yi.length)}if(ee||yi||ii.match(/^\/\/[^@/]+@[^@/]+/)){var we=ii.substr(0,2)==="//";we&&!(yi&&yt[yi])&&(ii=ii.substr(2),this.slashes=!0)}if(!yt[yi]&&(we||yi&&!Et[yi])){for(var Ge=-1,Se=0;Se<G.length;Se++){var ni=ii.indexOf(G[Se]);ni!==-1&&(Ge===-1||ni<Ge)&&(Ge=ni)}var ti,ei;Ge===-1?ei=ii.lastIndexOf("@"):ei=ii.lastIndexOf("@",Ge),ei!==-1&&(ti=ii.slice(0,ei),ii=ii.slice(ei+1),this.auth=decodeURIComponent(ti)),Ge=-1;for(var Se=0;Se<q.length;Se++){var ni=ii.indexOf(q[Se]);ni!==-1&&(Ge===-1||ni<Ge)&&(Ge=ni)}Ge===-1&&(Ge=ii.length),this.host=ii.slice(0,Ge),ii=ii.slice(Ge),this.parseHost(),this.hostname=this.hostname||"";var oi=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!oi)for(var ai=this.hostname.split(/\./),Se=0,fi=ai.length;Se<fi;Se++){var mi=ai[Se];if(mi&&!mi.match(Q)){for(var _i="",Si=0,Ti=mi.length;Si<Ti;Si++)mi.charCodeAt(Si)>127?_i+="x":_i+=mi[Si];if(!_i.match(Q)){var Ei=ai.slice(0,Se),vi=ai.slice(Se+1),Ai=mi.match(tt);Ai&&(Ei.push(Ai[1]),vi.unshift(Ai[2])),vi.length&&(ii="/"+vi.join(".")+ii),this.hostname=Ei.join(".");break}}}this.hostname.length>z?this.hostname="":this.hostname=this.hostname.toLowerCase(),oi||(this.hostname=P.toASCII(this.hostname));var Li=this.port?":"+this.port:"",Mi=this.hostname||"";this.host=Mi+Li,this.href+=this.host,oi&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),ii[0]!=="/"&&(ii="/"+ii))}if(!gt[gi])for(var Se=0,fi=V.length;Se<fi;Se++){var Ri=V[Se];if(ii.indexOf(Ri)!==-1){var xi=encodeURIComponent(Ri);xi===Ri&&(xi=escape(Ri)),ii=ii.split(Ri).join(xi)}}var wi=ii.indexOf("#");wi!==-1&&(this.hash=ii.substr(wi),ii=ii.slice(0,wi));var Di=ii.indexOf("?");if(Di!==-1?(this.search=ii.substr(Di),this.query=ii.substr(Di+1),Le&&(this.query=J.parse(this.query)),ii=ii.slice(0,Di)):Le&&(this.search="",this.query={}),ii&&(this.pathname=ii),Et[gi]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var Li=this.pathname||"",Bi=this.search||"";this.path=Li+Bi}return this.href=this.format(),this};function kt(Ht){return typeof Ht=="string"&&(Ht=At(Ht)),Ht instanceof T?Ht.format():T.prototype.format.call(Ht)}T.prototype.format=function(){var Ht=this.auth||"";Ht&&(Ht=encodeURIComponent(Ht),Ht=Ht.replace(/%3A/i,":"),Ht+="@");var Le=this.protocol||"",ee=this.pathname||"",si=this.hash||"",ci=!1,ui="";this.host?ci=Ht+this.host:this.hostname&&(ci=Ht+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(ci+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(ui=J.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var di=this.search||ui&&"?"+ui||"";return Le&&Le.substr(-1)!==":"&&(Le+=":"),this.slashes||(!Le||Et[Le])&&ci!==!1?(ci="//"+(ci||""),ee&&ee.charAt(0)!=="/"&&(ee="/"+ee)):ci||(ci=""),si&&si.charAt(0)!=="#"&&(si="#"+si),di&&di.charAt(0)!=="?"&&(di="?"+di),ee=ee.replace(/[?#]/g,function(ii){return encodeURIComponent(ii)}),di=di.replace("#","%23"),Le+ci+ee+di+si};function ne(Ht,Le){return At(Ht,!1,!0).resolve(Le)}T.prototype.resolve=function(Ht){return this.resolveObject(At(Ht,!1,!0)).format()};function Te(Ht,Le){return Ht?At(Ht,!1,!0).resolveObject(Le):Le}return T.prototype.resolveObject=function(Ht){if(typeof Ht=="string"){var Le=new T;Le.parse(Ht,!1,!0),Ht=Le}for(var ee=new T,si=Object.keys(this),ci=0;ci<si.length;ci++){var ui=si[ci];ee[ui]=this[ui]}if(ee.hash=Ht.hash,Ht.href==="")return ee.href=ee.format(),ee;if(Ht.slashes&&!Ht.protocol){for(var di=Object.keys(Ht),ii=0;ii<di.length;ii++){var bi=di[ii];bi!=="protocol"&&(ee[bi]=Ht[bi])}return Et[ee.protocol]&&ee.hostname&&!ee.pathname&&(ee.pathname="/",ee.path=ee.pathname),ee.href=ee.format(),ee}if(Ht.protocol&&Ht.protocol!==ee.protocol){if(!Et[Ht.protocol]){for(var yi=Object.keys(Ht),gi=0;gi<yi.length;gi++){var we=yi[gi];ee[we]=Ht[we]}return ee.href=ee.format(),ee}if(ee.protocol=Ht.protocol,!Ht.host&&!yt[Ht.protocol]){for(var fi=(Ht.pathname||"").split("/");fi.length&&!(Ht.host=fi.shift()););Ht.host||(Ht.host=""),Ht.hostname||(Ht.hostname=""),fi[0]!==""&&fi.unshift(""),fi.length<2&&fi.unshift(""),ee.pathname=fi.join("/")}else ee.pathname=Ht.pathname;if(ee.search=Ht.search,ee.query=Ht.query,ee.host=Ht.host||"",ee.auth=Ht.auth,ee.hostname=Ht.hostname||Ht.host,ee.port=Ht.port,ee.pathname||ee.search){var Ge=ee.pathname||"",Se=ee.search||"";ee.path=Ge+Se}return ee.slashes=ee.slashes||Ht.slashes,ee.href=ee.format(),ee}var ni=ee.pathname&&ee.pathname.charAt(0)==="/",ti=Ht.host||Ht.pathname&&Ht.pathname.charAt(0)==="/",ei=ti||ni||ee.host&&Ht.pathname,oi=ei,ai=ee.pathname&&ee.pathname.split("/")||[],fi=Ht.pathname&&Ht.pathname.split("/")||[],mi=ee.protocol&&!Et[ee.protocol];if(mi&&(ee.hostname="",ee.port=null,ee.host&&(ai[0]===""?ai[0]=ee.host:ai.unshift(ee.host)),ee.host="",Ht.protocol&&(Ht.hostname=null,Ht.port=null,Ht.host&&(fi[0]===""?fi[0]=Ht.host:fi.unshift(Ht.host)),Ht.host=null),ei=ei&&(fi[0]===""||ai[0]==="")),ti)ee.host=Ht.host||Ht.host===""?Ht.host:ee.host,ee.hostname=Ht.hostname||Ht.hostname===""?Ht.hostname:ee.hostname,ee.search=Ht.search,ee.query=Ht.query,ai=fi;else if(fi.length)ai||(ai=[]),ai.pop(),ai=ai.concat(fi),ee.search=Ht.search,ee.query=Ht.query;else if(Ht.search!=null){if(mi){ee.host=ai.shift(),ee.hostname=ee.host;var _i=ee.host&&ee.host.indexOf("@")>0?ee.host.split("@"):!1;_i&&(ee.auth=_i.shift(),ee.hostname=_i.shift(),ee.host=ee.hostname)}return ee.search=Ht.search,ee.query=Ht.query,(ee.pathname!==null||ee.search!==null)&&(ee.path=(ee.pathname?ee.pathname:"")+(ee.search?ee.search:"")),ee.href=ee.format(),ee}if(!ai.length)return ee.pathname=null,ee.search?ee.path="/"+ee.search:ee.path=null,ee.href=ee.format(),ee;for(var Si=ai.slice(-1)[0],Ti=(ee.host||Ht.host||ai.length>1)&&(Si==="."||Si==="..")||Si==="",Ei=0,vi=ai.length;vi>=0;vi--)Si=ai[vi],Si==="."?ai.splice(vi,1):Si===".."?(ai.splice(vi,1),Ei++):Ei&&(ai.splice(vi,1),Ei--);if(!ei&&!oi)for(;Ei--;Ei)ai.unshift("..");ei&&ai[0]!==""&&(!ai[0]||ai[0].charAt(0)!=="/")&&ai.unshift(""),Ti&&ai.join("/").substr(-1)!=="/"&&ai.push("");var Ai=ai[0]===""||ai[0]&&ai[0].charAt(0)==="/";if(mi){ee.hostname=Ai?"":ai.length?ai.shift():"",ee.host=ee.hostname;var _i=ee.host&&ee.host.indexOf("@")>0?ee.host.split("@"):!1;_i&&(ee.auth=_i.shift(),ee.hostname=_i.shift(),ee.host=ee.hostname)}return ei=ei||ee.host&&ai.length,ei&&!Ai&&ai.unshift(""),ai.length>0?ee.pathname=ai.join("/"):(ee.pathname=null,ee.path=null),(ee.pathname!==null||ee.search!==null)&&(ee.path=(ee.pathname?ee.pathname:"")+(ee.search?ee.search:"")),ee.auth=Ht.auth||ee.auth,ee.slashes=ee.slashes||Ht.slashes,ee.href=ee.format(),ee},T.prototype.parseHost=function(){var Ht=this.host,Le=R.exec(Ht);Le&&(Le=Le[0],Le!==":"&&(this.port=Le.substr(1)),Ht=Ht.substr(0,Ht.length-Le.length)),Ht&&(this.hostname=Ht)},url.parse=At,url.resolve=ne,url.resolveObject=Te,url.format=kt,url.Url=T,url}requireUrl();const warnings={};function deprecation(P,T,L=3){if(warnings[T])return;let R=new Error().stack;typeof R>"u"?console.warn("PixiJS Deprecation Warning: ",`${T}
Deprecated since v${P}`):(R=R.split(`
`).splice(L).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${T}
Deprecated since v${P}`),console.warn(R),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${T}
Deprecated since v${P}`),console.warn(R))),warnings[T]=!0}let supported;function isWebGLSupported(){return typeof supported>"u"&&(supported=(function(){const P={stencil:!0,failIfMajorPerformanceCaveat:settings.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!settings.ADAPTER.getWebGLRenderingContext())return!1;const T=settings.ADAPTER.createCanvas();let L=T.getContext("webgl",P)||T.getContext("experimental-webgl",P);const R=!!L?.getContextAttributes()?.stencil;if(L){const I=L.getExtension("WEBGL_lose_context");I&&I.loseContext()}return L=null,R}catch{return!1}})()),supported}var r={grad:.9,turn:360,rad:360/(2*Math.PI)},t$1=function(P){return typeof P=="string"?P.length>0:typeof P=="number"},n$1=function(P,T,L){return T===void 0&&(T=0),L===void 0&&(L=Math.pow(10,T)),Math.round(L*P)/L+0},e=function(P,T,L){return T===void 0&&(T=0),L===void 0&&(L=1),P>L?L:P>T?P:T},u$1=function(P){return(P=isFinite(P)?P%360:0)>0?P:P+360},a=function(P){return{r:e(P.r,0,255),g:e(P.g,0,255),b:e(P.b,0,255),a:e(P.a)}},o=function(P){return{r:n$1(P.r),g:n$1(P.g),b:n$1(P.b),a:n$1(P.a,3)}},i$1=/^#([0-9a-f]{3,8})$/i,s=function(P){var T=P.toString(16);return T.length<2?"0"+T:T},h=function(P){var T=P.r,L=P.g,R=P.b,I=P.a,F=Math.max(T,L,R),D=F-Math.min(T,L,R),V=D?F===T?(L-R)/D:F===L?2+(R-T)/D:4+(T-L)/D:0;return{h:60*(V<0?V+6:V),s:F?D/F*100:0,v:F/255*100,a:I}},b=function(P){var T=P.h,L=P.s,R=P.v,I=P.a;T=T/360*6,L/=100,R/=100;var F=Math.floor(T),D=R*(1-L),V=R*(1-(T-F)*L),q=R*(1-(1-T+F)*L),G=F%6;return{r:255*[R,V,D,D,q,R][G],g:255*[q,R,R,V,D,D][G],b:255*[D,D,q,R,R,V][G],a:I}},g=function(P){return{h:u$1(P.h),s:e(P.s,0,100),l:e(P.l,0,100),a:e(P.a)}},d$1=function(P){return{h:n$1(P.h),s:n$1(P.s),l:n$1(P.l),a:n$1(P.a,3)}},f$1=function(P){return b((L=(T=P).s,{h:T.h,s:(L*=((R=T.l)<50?R:100-R)/100)>0?2*L/(R+L)*100:0,v:R+L,a:T.a}));var T,L,R},c=function(P){return{h:(T=h(P)).h,s:(I=(200-(L=T.s))*(R=T.v)/100)>0&&I<200?L*R/100/(I<=100?I:200-I)*100:0,l:I/2,a:T.a};var T,L,R,I},l=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,p=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,v=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,m=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,y={string:[[function(P){var T=i$1.exec(P);return T?(P=T[1]).length<=4?{r:parseInt(P[0]+P[0],16),g:parseInt(P[1]+P[1],16),b:parseInt(P[2]+P[2],16),a:P.length===4?n$1(parseInt(P[3]+P[3],16)/255,2):1}:P.length===6||P.length===8?{r:parseInt(P.substr(0,2),16),g:parseInt(P.substr(2,2),16),b:parseInt(P.substr(4,2),16),a:P.length===8?n$1(parseInt(P.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(P){var T=v.exec(P)||m.exec(P);return T?T[2]!==T[4]||T[4]!==T[6]?null:a({r:Number(T[1])/(T[2]?100/255:1),g:Number(T[3])/(T[4]?100/255:1),b:Number(T[5])/(T[6]?100/255:1),a:T[7]===void 0?1:Number(T[7])/(T[8]?100:1)}):null},"rgb"],[function(P){var T=l.exec(P)||p.exec(P);if(!T)return null;var L,R,I=g({h:(L=T[1],R=T[2],R===void 0&&(R="deg"),Number(L)*(r[R]||1)),s:Number(T[3]),l:Number(T[4]),a:T[5]===void 0?1:Number(T[5])/(T[6]?100:1)});return f$1(I)},"hsl"]],object:[[function(P){var T=P.r,L=P.g,R=P.b,I=P.a,F=I===void 0?1:I;return t$1(T)&&t$1(L)&&t$1(R)?a({r:Number(T),g:Number(L),b:Number(R),a:Number(F)}):null},"rgb"],[function(P){var T=P.h,L=P.s,R=P.l,I=P.a,F=I===void 0?1:I;if(!t$1(T)||!t$1(L)||!t$1(R))return null;var D=g({h:Number(T),s:Number(L),l:Number(R),a:Number(F)});return f$1(D)},"hsl"],[function(P){var T=P.h,L=P.s,R=P.v,I=P.a,F=I===void 0?1:I;if(!t$1(T)||!t$1(L)||!t$1(R))return null;var D=(function(V){return{h:u$1(V.h),s:e(V.s,0,100),v:e(V.v,0,100),a:e(V.a)}})({h:Number(T),s:Number(L),v:Number(R),a:Number(F)});return b(D)},"hsv"]]},N$1=function(P,T){for(var L=0;L<T.length;L++){var R=T[L][0](P);if(R)return[R,T[L][1]]}return[null,void 0]},x=function(P){return typeof P=="string"?N$1(P.trim(),y.string):typeof P=="object"&&P!==null?N$1(P,y.object):[null,void 0]},M=function(P,T){var L=c(P);return{h:L.h,s:e(L.s+100*T,0,100),l:L.l,a:L.a}},H$1=function(P){return(299*P.r+587*P.g+114*P.b)/1e3/255},$=function(P,T){var L=c(P);return{h:L.h,s:L.s,l:e(L.l+100*T,0,100),a:L.a}},j$1=(function(){function P(T){this.parsed=x(T)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return P.prototype.isValid=function(){return this.parsed!==null},P.prototype.brightness=function(){return n$1(H$1(this.rgba),2)},P.prototype.isDark=function(){return H$1(this.rgba)<.5},P.prototype.isLight=function(){return H$1(this.rgba)>=.5},P.prototype.toHex=function(){return T=o(this.rgba),L=T.r,R=T.g,I=T.b,D=(F=T.a)<1?s(n$1(255*F)):"","#"+s(L)+s(R)+s(I)+D;var T,L,R,I,F,D},P.prototype.toRgb=function(){return o(this.rgba)},P.prototype.toRgbString=function(){return T=o(this.rgba),L=T.r,R=T.g,I=T.b,(F=T.a)<1?"rgba("+L+", "+R+", "+I+", "+F+")":"rgb("+L+", "+R+", "+I+")";var T,L,R,I,F},P.prototype.toHsl=function(){return d$1(c(this.rgba))},P.prototype.toHslString=function(){return T=d$1(c(this.rgba)),L=T.h,R=T.s,I=T.l,(F=T.a)<1?"hsla("+L+", "+R+"%, "+I+"%, "+F+")":"hsl("+L+", "+R+"%, "+I+"%)";var T,L,R,I,F},P.prototype.toHsv=function(){return T=h(this.rgba),{h:n$1(T.h),s:n$1(T.s),v:n$1(T.v),a:n$1(T.a,3)};var T},P.prototype.invert=function(){return w({r:255-(T=this.rgba).r,g:255-T.g,b:255-T.b,a:T.a});var T},P.prototype.saturate=function(T){return T===void 0&&(T=.1),w(M(this.rgba,T))},P.prototype.desaturate=function(T){return T===void 0&&(T=.1),w(M(this.rgba,-T))},P.prototype.grayscale=function(){return w(M(this.rgba,-1))},P.prototype.lighten=function(T){return T===void 0&&(T=.1),w($(this.rgba,T))},P.prototype.darken=function(T){return T===void 0&&(T=.1),w($(this.rgba,-T))},P.prototype.rotate=function(T){return T===void 0&&(T=15),this.hue(this.hue()+T)},P.prototype.alpha=function(T){return typeof T=="number"?w({r:(L=this.rgba).r,g:L.g,b:L.b,a:T}):n$1(this.rgba.a,3);var L},P.prototype.hue=function(T){var L=c(this.rgba);return typeof T=="number"?w({h:T,s:L.s,l:L.l,a:L.a}):n$1(L.h)},P.prototype.isEqual=function(T){return this.toHex()===w(T).toHex()},P})(),w=function(P){return P instanceof j$1?P:new j$1(P)},S=[],k=function(P){P.forEach(function(T){S.indexOf(T)<0&&(T(j$1,y),S.push(T))})};function namesPlugin(P,T){var L={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},R={};for(var I in L)R[L[I]]=I;var F={};P.prototype.toName=function(D){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var V,q,G=R[this.toHex()];if(G)return G;if(D?.closest){var z=this.toRgb(),Q=1/0,tt="black";if(!F.length)for(var gt in L)F[gt]=new P(L[gt]).toRgb();for(var yt in L){var Et=(V=z,q=F[yt],Math.pow(V.r-q.r,2)+Math.pow(V.g-q.g,2)+Math.pow(V.b-q.b,2));Et<Q&&(Q=Et,tt=yt)}return tt}},T.string.push([function(D){var V=D.toLowerCase(),q=V==="transparent"?"#0000":L[V];return q?new P(q).toRgb():null},"name"])}k([namesPlugin]);const _Color=class qs{constructor(T=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=T}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(T){return this.value=T,this}set value(T){if(T instanceof qs)this._value=this.cloneSource(T._value),this._int=T._int,this._components.set(T._components);else{if(T===null)throw new Error("Cannot set PIXI.Color#value to null");(this._value===null||!this.isSourceEqual(this._value,T))&&(this.normalize(T),this._value=this.cloneSource(T))}}get value(){return this._value}cloneSource(T){return typeof T=="string"||typeof T=="number"||T instanceof Number||T===null?T:Array.isArray(T)||ArrayBuffer.isView(T)?T.slice(0):typeof T=="object"&&T!==null?{...T}:T}isSourceEqual(T,L){const R=typeof T;if(R!==typeof L)return!1;if(R==="number"||R==="string"||T instanceof Number)return T===L;if(Array.isArray(T)&&Array.isArray(L)||ArrayBuffer.isView(T)&&ArrayBuffer.isView(L))return T.length!==L.length?!1:T.every((I,F)=>I===L[F]);if(T!==null&&L!==null){const I=Object.keys(T),F=Object.keys(L);return I.length!==F.length?!1:I.every(D=>T[D]===L[D])}return T===L}toRgba(){const[T,L,R,I]=this._components;return{r:T,g:L,b:R,a:I}}toRgb(){const[T,L,R]=this._components;return{r:T,g:L,b:R}}toRgbaString(){const[T,L,R]=this.toUint8RgbArray();return`rgba(${T},${L},${R},${this.alpha})`}toUint8RgbArray(T){const[L,R,I]=this._components;return T=T??[],T[0]=Math.round(L*255),T[1]=Math.round(R*255),T[2]=Math.round(I*255),T}toRgbArray(T){T=T??[];const[L,R,I]=this._components;return T[0]=L,T[1]=R,T[2]=I,T}toNumber(){return this._int}toLittleEndianNumber(){const T=this._int;return(T>>16)+(T&65280)+((T&255)<<16)}multiply(T){const[L,R,I,F]=qs.temp.setValue(T)._components;return this._components[0]*=L,this._components[1]*=R,this._components[2]*=I,this._components[3]*=F,this.refreshInt(),this._value=null,this}premultiply(T,L=!0){return L&&(this._components[0]*=T,this._components[1]*=T,this._components[2]*=T),this._components[3]=T,this.refreshInt(),this._value=null,this}toPremultiplied(T,L=!0){if(T===1)return(255<<24)+this._int;if(T===0)return L?0:this._int;let R=this._int>>16&255,I=this._int>>8&255,F=this._int&255;return L&&(R=R*T+.5|0,I=I*T+.5|0,F=F*T+.5|0),(T*255<<24)+(R<<16)+(I<<8)+F}toHex(){const T=this._int.toString(16);return`#${"000000".substring(0,6-T.length)+T}`}toHexa(){const T=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-T.length)+T}setAlpha(T){return this._components[3]=this._clamp(T),this}round(T){const[L,R,I]=this._components;return this._components[0]=Math.round(L*T)/T,this._components[1]=Math.round(R*T)/T,this._components[2]=Math.round(I*T)/T,this.refreshInt(),this._value=null,this}toArray(T){T=T??[];const[L,R,I,F]=this._components;return T[0]=L,T[1]=R,T[2]=I,T[3]=F,T}normalize(T){let L,R,I,F;if((typeof T=="number"||T instanceof Number)&&T>=0&&T<=16777215){const D=T;L=(D>>16&255)/255,R=(D>>8&255)/255,I=(D&255)/255,F=1}else if((Array.isArray(T)||T instanceof Float32Array)&&T.length>=3&&T.length<=4)T=this._clamp(T),[L,R,I,F=1]=T;else if((T instanceof Uint8Array||T instanceof Uint8ClampedArray)&&T.length>=3&&T.length<=4)T=this._clamp(T,0,255),[L,R,I,F=255]=T,L/=255,R/=255,I/=255,F/=255;else if(typeof T=="string"||typeof T=="object"){if(typeof T=="string"){const V=qs.HEX_PATTERN.exec(T);V&&(T=`#${V[2]}`)}const D=w(T);D.isValid()&&({r:L,g:R,b:I,a:F}=D.rgba,L/=255,R/=255,I/=255)}if(L!==void 0)this._components[0]=L,this._components[1]=R,this._components[2]=I,this._components[3]=F,this.refreshInt();else throw new Error(`Unable to convert color ${T}`)}refreshInt(){this._clamp(this._components);const[T,L,R]=this._components;this._int=(T*255<<16)+(L*255<<8)+(R*255|0)}_clamp(T,L=0,R=1){return typeof T=="number"?Math.min(Math.max(T,L),R):(T.forEach((I,F)=>{T[F]=Math.min(Math.max(I,L),R)}),T)}};_Color.shared=new _Color,_Color.temp=new _Color,_Color.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let Color=_Color;function mapPremultipliedBlendModes(){const P=[],T=[];for(let R=0;R<32;R++)P[R]=R,T[R]=R;P[BLEND_MODES.NORMAL_NPM]=BLEND_MODES.NORMAL,P[BLEND_MODES.ADD_NPM]=BLEND_MODES.ADD,P[BLEND_MODES.SCREEN_NPM]=BLEND_MODES.SCREEN,T[BLEND_MODES.NORMAL]=BLEND_MODES.NORMAL_NPM,T[BLEND_MODES.ADD]=BLEND_MODES.ADD_NPM,T[BLEND_MODES.SCREEN]=BLEND_MODES.SCREEN_NPM;const L=[];return L.push(T),L.push(P),L}const premultiplyBlendMode=mapPremultipliedBlendModes();function getBufferType(P){if(P.BYTES_PER_ELEMENT===4)return P instanceof Float32Array?"Float32Array":P instanceof Uint32Array?"Uint32Array":"Int32Array";if(P.BYTES_PER_ELEMENT===2){if(P instanceof Uint16Array)return"Uint16Array"}else if(P.BYTES_PER_ELEMENT===1&&P instanceof Uint8Array)return"Uint8Array";return null}function nextPow2(P){return P+=P===0?1:0,--P,P|=P>>>1,P|=P>>>2,P|=P>>>4,P|=P>>>8,P|=P>>>16,P+1}function isPow2(P){return!(P&P-1)&&!!P}function log2(P){let T=(P>65535?1:0)<<4;P>>>=T;let L=(P>255?1:0)<<3;return P>>>=L,T|=L,L=(P>15?1:0)<<2,P>>>=L,T|=L,L=(P>3?1:0)<<1,P>>>=L,T|=L,T|P>>1}function removeItems(P,T,L){const R=P.length;let I;if(T>=R||L===0)return;L=T+L>R?R-T:L;const F=R-L;for(I=T;I<F;++I)P[I]=P[I+L];P.length=F}let nextUid=0;function uid(){return++nextUid}const ProgramCache={},TextureCache=Object.create(null),BaseTextureCache=Object.create(null);function determineCrossOrigin(P,T=globalThis.location){if(P.startsWith("data:"))return"";T=T||globalThis.location;const L=new URL(P,document.baseURI);return L.hostname!==T.hostname||L.port!==T.port||L.protocol!==T.protocol?"anonymous":""}function getResolutionOfUrl(P,T=1){const L=settings.RETINA_PREFIX?.exec(P);return L?parseFloat(L[1]):T}var ExtensionType=(P=>(P.Renderer="renderer",P.Application="application",P.RendererSystem="renderer-webgl-system",P.RendererPlugin="renderer-webgl-plugin",P.CanvasRendererSystem="renderer-canvas-system",P.CanvasRendererPlugin="renderer-canvas-plugin",P.Asset="asset",P.LoadParser="load-parser",P.ResolveParser="resolve-parser",P.CacheParser="cache-parser",P.DetectionParser="detection-parser",P))(ExtensionType||{});const normalizeExtension=P=>{if(typeof P=="function"||typeof P=="object"&&P.extension){if(!P.extension)throw new Error("Extension class must have an extension object");P={...typeof P.extension!="object"?{type:P.extension}:P.extension,ref:P}}if(typeof P=="object")P={...P};else throw new Error("Invalid extension type");return typeof P.type=="string"&&(P.type=[P.type]),P},normalizePriority=(P,T)=>normalizeExtension(P).priority??T,extensions={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...P){return P.map(normalizeExtension).forEach(T=>{T.type.forEach(L=>this._removeHandlers[L]?.(T))}),this},add(...P){return P.map(normalizeExtension).forEach(T=>{T.type.forEach(L=>{const R=this._addHandlers,I=this._queue;R[L]?R[L]?.(T):(I[L]=I[L]||[],I[L]?.push(T))})}),this},handle(P,T,L){const R=this._addHandlers,I=this._removeHandlers;if(R[P]||I[P])throw new Error(`Extension type ${P} already has a handler`);R[P]=T,I[P]=L;const F=this._queue;return F[P]&&(F[P]?.forEach(D=>T(D)),delete F[P]),this},handleByMap(P,T){return this.handle(P,L=>{L.name&&(T[L.name]=L.ref)},L=>{L.name&&delete T[L.name]})},handleByList(P,T,L=-1){return this.handle(P,R=>{T.includes(R.ref)||(T.push(R.ref),T.sort((I,F)=>normalizePriority(F,L)-normalizePriority(I,L)))},R=>{const I=T.indexOf(R.ref);I!==-1&&T.splice(I,1)})}};class ViewableBuffer{constructor(T){typeof T=="number"?this.rawBinaryData=new ArrayBuffer(T):T instanceof Uint8Array?this.rawBinaryData=T.buffer:this.rawBinaryData=T,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(T){return this[`${T}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(T){switch(T){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${T} isn't a valid view type`)}}}const fragTemplate=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function generateIfTestSrc(P){let T="";for(let L=0;L<P;++L)L>0&&(T+=`
else `),L<P-1&&(T+=`if(test == ${L}.0){}`);return T}function checkMaxIfStatementsInShader(P,T){if(P===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const L=T.createShader(T.FRAGMENT_SHADER);for(;;){const R=fragTemplate.replace(/%forloop%/gi,generateIfTestSrc(P));if(T.shaderSource(L,R),T.compileShader(L),!T.getShaderParameter(L,T.COMPILE_STATUS))P=P/2|0;else break}return P}const BLEND$1=0,OFFSET$1=1,CULLING$1=2,DEPTH_TEST$1=3,WINDING$1=4,DEPTH_MASK$1=5;class State{constructor(){this.data=0,this.blendMode=BLEND_MODES.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<BLEND$1)}set blend(T){!!(this.data&1<<BLEND$1)!==T&&(this.data^=1<<BLEND$1)}get offsets(){return!!(this.data&1<<OFFSET$1)}set offsets(T){!!(this.data&1<<OFFSET$1)!==T&&(this.data^=1<<OFFSET$1)}get culling(){return!!(this.data&1<<CULLING$1)}set culling(T){!!(this.data&1<<CULLING$1)!==T&&(this.data^=1<<CULLING$1)}get depthTest(){return!!(this.data&1<<DEPTH_TEST$1)}set depthTest(T){!!(this.data&1<<DEPTH_TEST$1)!==T&&(this.data^=1<<DEPTH_TEST$1)}get depthMask(){return!!(this.data&1<<DEPTH_MASK$1)}set depthMask(T){!!(this.data&1<<DEPTH_MASK$1)!==T&&(this.data^=1<<DEPTH_MASK$1)}get clockwiseFrontFace(){return!!(this.data&1<<WINDING$1)}set clockwiseFrontFace(T){!!(this.data&1<<WINDING$1)!==T&&(this.data^=1<<WINDING$1)}get blendMode(){return this._blendMode}set blendMode(T){this.blend=T!==BLEND_MODES.NONE,this._blendMode=T}get polygonOffset(){return this._polygonOffset}set polygonOffset(T){this.offsets=!!T,this._polygonOffset=T}static for2d(){const T=new State;return T.depthTest=!1,T.blend=!0,T}}State.prototype.toString=function(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`};const INSTALLED=[];function autoDetectResource(P,T){if(!P)return null;let L="";if(typeof P=="string"){const R=/\.(\w{3,4})(?:$|\?|#)/i.exec(P);R&&(L=R[1].toLowerCase())}for(let R=INSTALLED.length-1;R>=0;--R){const I=INSTALLED[R];if(I.test&&I.test(P,L))return new I(P,T)}throw new Error("Unrecognized source type to auto-detect Resource")}class Runner{constructor(T){this.items=[],this._name=T,this._aliasCount=0}emit(T,L,R,I,F,D,V,q){if(arguments.length>8)throw new Error("max arguments reached");const{name:G,items:z}=this;this._aliasCount++;for(let Q=0,tt=z.length;Q<tt;Q++)z[Q][G](T,L,R,I,F,D,V,q);return z===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(T){return T[this._name]&&(this.ensureNonAliasedItems(),this.remove(T),this.items.push(T)),this}remove(T){const L=this.items.indexOf(T);return L!==-1&&(this.ensureNonAliasedItems(),this.items.splice(L,1)),this}contains(T){return this.items.includes(T)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items.length=0,this._name=""}get empty(){return this.items.length===0}get name(){return this._name}}Object.defineProperties(Runner.prototype,{dispatch:{value:Runner.prototype.emit},run:{value:Runner.prototype.emit}});class Resource{constructor(T=0,L=0){this._width=T,this._height=L,this.destroyed=!1,this.internal=!1,this.onResize=new Runner("setRealSize"),this.onUpdate=new Runner("update"),this.onError=new Runner("onError")}bind(T){this.onResize.add(T),this.onUpdate.add(T),this.onError.add(T),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(T){this.onResize.remove(T),this.onUpdate.remove(T),this.onError.remove(T)}resize(T,L){(T!==this._width||L!==this._height)&&(this._width=T,this._height=L,this.onResize.emit(T,L))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(T,L,R){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(T,L){return!1}}class BufferResource extends Resource{constructor(T,L){const{width:R,height:I}=L||{};if(!R||!I)throw new Error("BufferResource width or height invalid");super(R,I),this.data=T,this.unpackAlignment=L.unpackAlignment??4}upload(T,L,R){const I=T.gl;I.pixelStorei(I.UNPACK_ALIGNMENT,this.unpackAlignment),I.pixelStorei(I.UNPACK_PREMULTIPLY_ALPHA_WEBGL,L.alphaMode===ALPHA_MODES.UNPACK);const F=L.realWidth,D=L.realHeight;return R.width===F&&R.height===D?I.texSubImage2D(L.target,0,0,0,F,D,L.format,R.type,this.data):(R.width=F,R.height=D,I.texImage2D(L.target,0,R.internalFormat,F,D,0,L.format,R.type,this.data)),!0}dispose(){this.data=null}static test(T){return T===null||T instanceof Int8Array||T instanceof Uint8Array||T instanceof Uint8ClampedArray||T instanceof Int16Array||T instanceof Uint16Array||T instanceof Int32Array||T instanceof Uint32Array||T instanceof Float32Array}}const defaultBufferOptions={scaleMode:SCALE_MODES.NEAREST,alphaMode:ALPHA_MODES.NPM},_BaseTexture=class As extends EventEmitter{constructor(T=null,L=null){super(),L=Object.assign({},As.defaultOptions,L);const{alphaMode:R,mipmap:I,anisotropicLevel:F,scaleMode:D,width:V,height:q,wrapMode:G,format:z,type:Q,target:tt,resolution:gt,resourceOptions:yt}=L;T&&!(T instanceof Resource)&&(T=autoDetectResource(T,yt),T.internal=!0),this.resolution=gt||settings.RESOLUTION,this.width=Math.round((V||0)*this.resolution)/this.resolution,this.height=Math.round((q||0)*this.resolution)/this.resolution,this._mipmap=I,this.anisotropicLevel=F,this._wrapMode=G,this._scaleMode=D,this.format=z,this.type=Q,this.target=tt,this.alphaMode=R,this.uid=uid(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=V>0&&q>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(T)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(T){this._mipmap!==T&&(this._mipmap=T,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(T){this._scaleMode!==T&&(this._scaleMode=T,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(T){this._wrapMode!==T&&(this._wrapMode=T,this.dirtyStyleId++)}setStyle(T,L){let R;return T!==void 0&&T!==this.scaleMode&&(this.scaleMode=T,R=!0),L!==void 0&&L!==this.mipmap&&(this.mipmap=L,R=!0),R&&this.dirtyStyleId++,this}setSize(T,L,R){return R=R||this.resolution,this.setRealSize(T*R,L*R,R)}setRealSize(T,L,R){return this.resolution=R||this.resolution,this.width=Math.round(T)/this.resolution,this.height=Math.round(L)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=isPow2(this.realWidth)&&isPow2(this.realHeight)}setResolution(T){const L=this.resolution;return L===T?this:(this.resolution=T,this.valid&&(this.width=Math.round(this.width*L)/T,this.height=Math.round(this.height*L)/T,this.emit("update",this)),this._refreshPOT(),this)}setResource(T){if(this.resource===T)return this;if(this.resource)throw new Error("Resource can be set only once");return T.bind(this),this.resource=T,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(T){this.emit("error",this,T)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete BaseTextureCache[this.cacheId],delete TextureCache[this.cacheId],this.cacheId=null),this.valid=!1,this.dispose(),As.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(T,L,R=settings.STRICT_TEXTURE_CACHE){const I=typeof T=="string";let F=null;if(I)F=T;else{if(!T._pixiId){const V=L?.pixiIdPrefix||"pixiid";T._pixiId=`${V}_${uid()}`}F=T._pixiId}let D=BaseTextureCache[F];if(I&&R&&!D)throw new Error(`The cacheId "${F}" does not exist in BaseTextureCache.`);return D||(D=new As(T,L),D.cacheId=F,As.addToCache(D,F)),D}static fromBuffer(T,L,R,I){T=T||new Float32Array(L*R*4);const F=new BufferResource(T,{width:L,height:R,...I?.resourceOptions});let D,V;return T instanceof Float32Array?(D=FORMATS.RGBA,V=TYPES.FLOAT):T instanceof Int32Array?(D=FORMATS.RGBA_INTEGER,V=TYPES.INT):T instanceof Uint32Array?(D=FORMATS.RGBA_INTEGER,V=TYPES.UNSIGNED_INT):T instanceof Int16Array?(D=FORMATS.RGBA_INTEGER,V=TYPES.SHORT):T instanceof Uint16Array?(D=FORMATS.RGBA_INTEGER,V=TYPES.UNSIGNED_SHORT):T instanceof Int8Array?(D=FORMATS.RGBA,V=TYPES.BYTE):(D=FORMATS.RGBA,V=TYPES.UNSIGNED_BYTE),F.internal=!0,new As(F,Object.assign({},defaultBufferOptions,{type:V,format:D},I))}static addToCache(T,L){L&&(T.textureCacheIds.includes(L)||T.textureCacheIds.push(L),BaseTextureCache[L]&&BaseTextureCache[L]!==T&&console.warn(`BaseTexture added to the cache with an id [${L}] that already had an entry`),BaseTextureCache[L]=T)}static removeFromCache(T){if(typeof T=="string"){const L=BaseTextureCache[T];if(L){const R=L.textureCacheIds.indexOf(T);return R>-1&&L.textureCacheIds.splice(R,1),delete BaseTextureCache[T],L}}else if(T?.textureCacheIds){for(let L=0;L<T.textureCacheIds.length;++L)delete BaseTextureCache[T.textureCacheIds[L]];return T.textureCacheIds.length=0,T}return null}};_BaseTexture.defaultOptions={mipmap:MIPMAP_MODES.POW2,anisotropicLevel:0,scaleMode:SCALE_MODES.LINEAR,wrapMode:WRAP_MODES.CLAMP,alphaMode:ALPHA_MODES.UNPACK,target:TARGETS.TEXTURE_2D,format:FORMATS.RGBA,type:TYPES.UNSIGNED_BYTE},_BaseTexture._globalBatch=0;let BaseTexture=_BaseTexture;class BatchDrawCall{constructor(){this.texArray=null,this.blend=0,this.type=DRAW_MODES.TRIANGLES,this.start=0,this.size=0,this.data=null}}let UID$4=0,Buffer$1=class yr{constructor(T,L=!0,R=!1){this.data=T||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=R,this.static=L,this.id=UID$4++,this.disposeRunner=new Runner("disposeBuffer")}update(T){T instanceof Array&&(T=new Float32Array(T)),this.data=T||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(T){this.type=T?BUFFER_TYPE.ELEMENT_ARRAY_BUFFER:BUFFER_TYPE.ARRAY_BUFFER}get index(){return this.type===BUFFER_TYPE.ELEMENT_ARRAY_BUFFER}static from(T){return T instanceof Array&&(T=new Float32Array(T)),new yr(T)}};class Attribute{constructor(T,L=0,R=!1,I=TYPES.FLOAT,F,D,V,q=1){this.buffer=T,this.size=L,this.normalized=R,this.type=I,this.stride=F,this.start=D,this.instance=V,this.divisor=q}destroy(){this.buffer=null}static from(T,L,R,I,F){return new Attribute(T,L,R,I,F)}}const map$1={Float32Array,Uint32Array,Int32Array,Uint8Array};function interleaveTypedArrays(P,T){let L=0,R=0;const I={};for(let q=0;q<P.length;q++)R+=T[q],L+=P[q].length;const F=new ArrayBuffer(L*4);let D=null,V=0;for(let q=0;q<P.length;q++){const G=T[q],z=P[q],Q=getBufferType(z);I[Q]||(I[Q]=new map$1[Q](F)),D=I[Q];for(let tt=0;tt<z.length;tt++){const gt=(tt/G|0)*R+V,yt=tt%G;D[gt+yt]=z[tt]}V+=G}return new Float32Array(F)}const byteSizeMap$1={5126:4,5123:2,5121:1};let UID$3=0;const map={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class Geometry{constructor(T=[],L={}){this.buffers=T,this.indexBuffer=null,this.attributes=L,this.glVertexArrayObjects={},this.id=UID$3++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new Runner("disposeGeometry"),this.refCount=0}addAttribute(T,L,R=0,I=!1,F,D,V,q=!1){if(!L)throw new Error("You must pass a buffer when creating an attribute");L instanceof Buffer$1||(L instanceof Array&&(L=new Float32Array(L)),L=new Buffer$1(L));const G=T.split("|");if(G.length>1){for(let Q=0;Q<G.length;Q++)this.addAttribute(G[Q],L,R,I,F);return this}let z=this.buffers.indexOf(L);return z===-1&&(this.buffers.push(L),z=this.buffers.length-1),this.attributes[T]=new Attribute(z,R,I,F,D,V,q),this.instanced=this.instanced||q,this}getAttribute(T){return this.attributes[T]}getBuffer(T){return this.buffers[this.getAttribute(T).buffer]}addIndex(T){return T instanceof Buffer$1||(T instanceof Array&&(T=new Uint16Array(T)),T=new Buffer$1(T)),T.type=BUFFER_TYPE.ELEMENT_ARRAY_BUFFER,this.indexBuffer=T,this.buffers.includes(T)||this.buffers.push(T),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;const T=[],L=[],R=new Buffer$1;let I;for(I in this.attributes){const F=this.attributes[I],D=this.buffers[F.buffer];T.push(D.data),L.push(F.size*byteSizeMap$1[F.type]/4),F.buffer=0}for(R.data=interleaveTypedArrays(T,L),I=0;I<this.buffers.length;I++)this.buffers[I]!==this.indexBuffer&&this.buffers[I].destroy();return this.buffers=[R],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const T in this.attributes){const L=this.attributes[T];return this.buffers[L.buffer].data.length/(L.stride/4||L.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const T=new Geometry;for(let L=0;L<this.buffers.length;L++)T.buffers[L]=new Buffer$1(this.buffers[L].data.slice(0));for(const L in this.attributes){const R=this.attributes[L];T.attributes[L]=new Attribute(R.buffer,R.size,R.normalized,R.type,R.stride,R.start,R.instance)}return this.indexBuffer&&(T.indexBuffer=T.buffers[this.buffers.indexOf(this.indexBuffer)],T.indexBuffer.type=BUFFER_TYPE.ELEMENT_ARRAY_BUFFER),T}static merge(T){const L=new Geometry,R=[],I=[],F=[];let D;for(let V=0;V<T.length;V++){D=T[V];for(let q=0;q<D.buffers.length;q++)I[q]=I[q]||0,I[q]+=D.buffers[q].data.length,F[q]=0}for(let V=0;V<D.buffers.length;V++)R[V]=new map[getBufferType(D.buffers[V].data)](I[V]),L.buffers[V]=new Buffer$1(R[V]);for(let V=0;V<T.length;V++){D=T[V];for(let q=0;q<D.buffers.length;q++)R[q].set(D.buffers[q].data,F[q]),F[q]+=D.buffers[q].data.length}if(L.attributes=D.attributes,D.indexBuffer){L.indexBuffer=L.buffers[D.buffers.indexOf(D.indexBuffer)],L.indexBuffer.type=BUFFER_TYPE.ELEMENT_ARRAY_BUFFER;let V=0,q=0,G=0,z=0;for(let Q=0;Q<D.buffers.length;Q++)if(D.buffers[Q]!==D.indexBuffer){z=Q;break}for(const Q in D.attributes){const tt=D.attributes[Q];(tt.buffer|0)===z&&(q+=tt.size*byteSizeMap$1[tt.type]/4)}for(let Q=0;Q<T.length;Q++){const tt=T[Q].indexBuffer.data;for(let gt=0;gt<tt.length;gt++)L.indexBuffer.data[gt+G]+=V;V+=T[Q].buffers[z].data.length/q,G+=tt.length}}return L}}class BatchGeometry extends Geometry{constructor(T=!1){super(),this._buffer=new Buffer$1(null,T,!1),this._indexBuffer=new Buffer$1(null,T,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,TYPES.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,TYPES.FLOAT).addAttribute("aColor",this._buffer,4,!0,TYPES.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,TYPES.FLOAT).addIndex(this._indexBuffer)}}const PI_2=Math.PI*2,RAD_TO_DEG=180/Math.PI,DEG_TO_RAD=Math.PI/180;var SHAPES=(P=>(P[P.POLY=0]="POLY",P[P.RECT=1]="RECT",P[P.CIRC=2]="CIRC",P[P.ELIP=3]="ELIP",P[P.RREC=4]="RREC",P))(SHAPES||{});class Point{constructor(T=0,L=0){this.x=0,this.y=0,this.x=T,this.y=L}clone(){return new Point(this.x,this.y)}copyFrom(T){return this.set(T.x,T.y),this}copyTo(T){return T.set(this.x,this.y),T}equals(T){return T.x===this.x&&T.y===this.y}set(T=0,L=T){return this.x=T,this.y=L,this}}Point.prototype.toString=function(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`};const tempPoints$1=[new Point,new Point,new Point,new Point];class Rectangle{constructor(T=0,L=0,R=0,I=0){this.x=Number(T),this.y=Number(L),this.width=Number(R),this.height=Number(I),this.type=SHAPES.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new Rectangle(0,0,0,0)}clone(){return new Rectangle(this.x,this.y,this.width,this.height)}copyFrom(T){return this.x=T.x,this.y=T.y,this.width=T.width,this.height=T.height,this}copyTo(T){return T.x=this.x,T.y=this.y,T.width=this.width,T.height=this.height,T}contains(T,L){return this.width<=0||this.height<=0?!1:T>=this.x&&T<this.x+this.width&&L>=this.y&&L<this.y+this.height}intersects(T,L){if(!L){const si=this.x<T.x?T.x:this.x;if((this.right>T.right?T.right:this.right)<=si)return!1;const ci=this.y<T.y?T.y:this.y;return(this.bottom>T.bottom?T.bottom:this.bottom)>ci}const R=this.left,I=this.right,F=this.top,D=this.bottom;if(I<=R||D<=F)return!1;const V=tempPoints$1[0].set(T.left,T.top),q=tempPoints$1[1].set(T.left,T.bottom),G=tempPoints$1[2].set(T.right,T.top),z=tempPoints$1[3].set(T.right,T.bottom);if(G.x<=V.x||q.y<=V.y)return!1;const Q=Math.sign(L.a*L.d-L.b*L.c);if(Q===0||(L.apply(V,V),L.apply(q,q),L.apply(G,G),L.apply(z,z),Math.max(V.x,q.x,G.x,z.x)<=R||Math.min(V.x,q.x,G.x,z.x)>=I||Math.max(V.y,q.y,G.y,z.y)<=F||Math.min(V.y,q.y,G.y,z.y)>=D))return!1;const tt=Q*(q.y-V.y),gt=Q*(V.x-q.x),yt=tt*R+gt*F,Et=tt*I+gt*F,J=tt*R+gt*D,At=tt*I+gt*D;if(Math.max(yt,Et,J,At)<=tt*V.x+gt*V.y||Math.min(yt,Et,J,At)>=tt*z.x+gt*z.y)return!1;const kt=Q*(V.y-G.y),ne=Q*(G.x-V.x),Te=kt*R+ne*F,Ht=kt*I+ne*F,Le=kt*R+ne*D,ee=kt*I+ne*D;return!(Math.max(Te,Ht,Le,ee)<=kt*V.x+ne*V.y||Math.min(Te,Ht,Le,ee)>=kt*z.x+ne*z.y)}pad(T=0,L=T){return this.x-=T,this.y-=L,this.width+=T*2,this.height+=L*2,this}fit(T){const L=Math.max(this.x,T.x),R=Math.min(this.x+this.width,T.x+T.width),I=Math.max(this.y,T.y),F=Math.min(this.y+this.height,T.y+T.height);return this.x=L,this.width=Math.max(R-L,0),this.y=I,this.height=Math.max(F-I,0),this}ceil(T=1,L=.001){const R=Math.ceil((this.x+this.width-L)*T)/T,I=Math.ceil((this.y+this.height-L)*T)/T;return this.x=Math.floor((this.x+L)*T)/T,this.y=Math.floor((this.y+L)*T)/T,this.width=R-this.x,this.height=I-this.y,this}enlarge(T){const L=Math.min(this.x,T.x),R=Math.max(this.x+this.width,T.x+T.width),I=Math.min(this.y,T.y),F=Math.max(this.y+this.height,T.y+T.height);return this.x=L,this.width=R-L,this.y=I,this.height=F-I,this}}Rectangle.prototype.toString=function(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class Matrix{constructor(T=1,L=0,R=0,I=1,F=0,D=0){this.array=null,this.a=T,this.b=L,this.c=R,this.d=I,this.tx=F,this.ty=D}fromArray(T){this.a=T[0],this.b=T[1],this.c=T[3],this.d=T[4],this.tx=T[2],this.ty=T[5]}set(T,L,R,I,F,D){return this.a=T,this.b=L,this.c=R,this.d=I,this.tx=F,this.ty=D,this}toArray(T,L){this.array||(this.array=new Float32Array(9));const R=L||this.array;return T?(R[0]=this.a,R[1]=this.b,R[2]=0,R[3]=this.c,R[4]=this.d,R[5]=0,R[6]=this.tx,R[7]=this.ty,R[8]=1):(R[0]=this.a,R[1]=this.c,R[2]=this.tx,R[3]=this.b,R[4]=this.d,R[5]=this.ty,R[6]=0,R[7]=0,R[8]=1),R}apply(T,L){L=L||new Point;const R=T.x,I=T.y;return L.x=this.a*R+this.c*I+this.tx,L.y=this.b*R+this.d*I+this.ty,L}applyInverse(T,L){L=L||new Point;const R=1/(this.a*this.d+this.c*-this.b),I=T.x,F=T.y;return L.x=this.d*R*I+-this.c*R*F+(this.ty*this.c-this.tx*this.d)*R,L.y=this.a*R*F+-this.b*R*I+(-this.ty*this.a+this.tx*this.b)*R,L}translate(T,L){return this.tx+=T,this.ty+=L,this}scale(T,L){return this.a*=T,this.d*=L,this.c*=T,this.b*=L,this.tx*=T,this.ty*=L,this}rotate(T){const L=Math.cos(T),R=Math.sin(T),I=this.a,F=this.c,D=this.tx;return this.a=I*L-this.b*R,this.b=I*R+this.b*L,this.c=F*L-this.d*R,this.d=F*R+this.d*L,this.tx=D*L-this.ty*R,this.ty=D*R+this.ty*L,this}append(T){const L=this.a,R=this.b,I=this.c,F=this.d;return this.a=T.a*L+T.b*I,this.b=T.a*R+T.b*F,this.c=T.c*L+T.d*I,this.d=T.c*R+T.d*F,this.tx=T.tx*L+T.ty*I+this.tx,this.ty=T.tx*R+T.ty*F+this.ty,this}setTransform(T,L,R,I,F,D,V,q,G){return this.a=Math.cos(V+G)*F,this.b=Math.sin(V+G)*F,this.c=-Math.sin(V-q)*D,this.d=Math.cos(V-q)*D,this.tx=T-(R*this.a+I*this.c),this.ty=L-(R*this.b+I*this.d),this}prepend(T){const L=this.tx;if(T.a!==1||T.b!==0||T.c!==0||T.d!==1){const R=this.a,I=this.c;this.a=R*T.a+this.b*T.c,this.b=R*T.b+this.b*T.d,this.c=I*T.a+this.d*T.c,this.d=I*T.b+this.d*T.d}return this.tx=L*T.a+this.ty*T.c+T.tx,this.ty=L*T.b+this.ty*T.d+T.ty,this}decompose(T){const L=this.a,R=this.b,I=this.c,F=this.d,D=T.pivot,V=-Math.atan2(-I,F),q=Math.atan2(R,L),G=Math.abs(V+q);return G<1e-5||Math.abs(PI_2-G)<1e-5?(T.rotation=q,T.skew.x=T.skew.y=0):(T.rotation=0,T.skew.x=V,T.skew.y=q),T.scale.x=Math.sqrt(L*L+R*R),T.scale.y=Math.sqrt(I*I+F*F),T.position.x=this.tx+(D.x*L+D.y*I),T.position.y=this.ty+(D.x*R+D.y*F),T}invert(){const T=this.a,L=this.b,R=this.c,I=this.d,F=this.tx,D=T*I-L*R;return this.a=I/D,this.b=-L/D,this.c=-R/D,this.d=T/D,this.tx=(R*this.ty-I*F)/D,this.ty=-(T*this.ty-L*F)/D,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const T=new Matrix;return T.a=this.a,T.b=this.b,T.c=this.c,T.d=this.d,T.tx=this.tx,T.ty=this.ty,T}copyTo(T){return T.a=this.a,T.b=this.b,T.c=this.c,T.d=this.d,T.tx=this.tx,T.ty=this.ty,T}copyFrom(T){return this.a=T.a,this.b=T.b,this.c=T.c,this.d=T.d,this.tx=T.tx,this.ty=T.ty,this}static get IDENTITY(){return new Matrix}static get TEMP_MATRIX(){return new Matrix}}Matrix.prototype.toString=function(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`};const ux=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],uy=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],vx=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],vy=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],rotationCayley=[],rotationMatrices=[],signum=Math.sign;function init(){for(let P=0;P<16;P++){const T=[];rotationCayley.push(T);for(let L=0;L<16;L++){const R=signum(ux[P]*ux[L]+vx[P]*uy[L]),I=signum(uy[P]*ux[L]+vy[P]*uy[L]),F=signum(ux[P]*vx[L]+vx[P]*vy[L]),D=signum(uy[P]*vx[L]+vy[P]*vy[L]);for(let V=0;V<16;V++)if(ux[V]===R&&uy[V]===I&&vx[V]===F&&vy[V]===D){T.push(V);break}}}for(let P=0;P<16;P++){const T=new Matrix;T.set(ux[P],uy[P],vx[P],vy[P],0,0),rotationMatrices.push(T)}}init();const groupD8={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:P=>ux[P],uY:P=>uy[P],vX:P=>vx[P],vY:P=>vy[P],inv:P=>P&8?P&15:-P&7,add:(P,T)=>rotationCayley[P][T],sub:(P,T)=>rotationCayley[P][groupD8.inv(T)],rotate180:P=>P^4,isVertical:P=>(P&3)===2,byDirection:(P,T)=>Math.abs(P)*2<=Math.abs(T)?T>=0?groupD8.S:groupD8.N:Math.abs(T)*2<=Math.abs(P)?P>0?groupD8.E:groupD8.W:T>0?P>0?groupD8.SE:groupD8.SW:P>0?groupD8.NE:groupD8.NW,matrixAppendRotationInv:(P,T,L=0,R=0)=>{const I=rotationMatrices[groupD8.inv(T)];I.tx=L,I.ty=R,P.append(I)}};class ObservablePoint{constructor(T,L,R=0,I=0){this._x=R,this._y=I,this.cb=T,this.scope=L}clone(T=this.cb,L=this.scope){return new ObservablePoint(T,L,this._x,this._y)}set(T=0,L=T){return(this._x!==T||this._y!==L)&&(this._x=T,this._y=L,this.cb.call(this.scope)),this}copyFrom(T){return(this._x!==T.x||this._y!==T.y)&&(this._x=T.x,this._y=T.y,this.cb.call(this.scope)),this}copyTo(T){return T.set(this._x,this._y),T}equals(T){return T.x===this._x&&T.y===this._y}get x(){return this._x}set x(T){this._x!==T&&(this._x=T,this.cb.call(this.scope))}get y(){return this._y}set y(T){this._y!==T&&(this._y=T,this.cb.call(this.scope))}}ObservablePoint.prototype.toString=function(){return`[@pixi/math:ObservablePoint x=${this.x} y=${this.y} scope=${this.scope}]`};const _Transform=class{constructor(){this.worldTransform=new Matrix,this.localTransform=new Matrix,this.position=new ObservablePoint(this.onChange,this,0,0),this.scale=new ObservablePoint(this.onChange,this,1,1),this.pivot=new ObservablePoint(this.onChange,this,0,0),this.skew=new ObservablePoint(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}updateLocalTransform(){const P=this.localTransform;this._localID!==this._currentLocalID&&(P.a=this._cx*this.scale.x,P.b=this._sx*this.scale.x,P.c=this._cy*this.scale.y,P.d=this._sy*this.scale.y,P.tx=this.position.x-(this.pivot.x*P.a+this.pivot.y*P.c),P.ty=this.position.y-(this.pivot.x*P.b+this.pivot.y*P.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(P){const T=this.localTransform;if(this._localID!==this._currentLocalID&&(T.a=this._cx*this.scale.x,T.b=this._sx*this.scale.x,T.c=this._cy*this.scale.y,T.d=this._sy*this.scale.y,T.tx=this.position.x-(this.pivot.x*T.a+this.pivot.y*T.c),T.ty=this.position.y-(this.pivot.x*T.b+this.pivot.y*T.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==P._worldID){const L=P.worldTransform,R=this.worldTransform;R.a=T.a*L.a+T.b*L.c,R.b=T.a*L.b+T.b*L.d,R.c=T.c*L.a+T.d*L.c,R.d=T.c*L.b+T.d*L.d,R.tx=T.tx*L.a+T.ty*L.c+L.tx,R.ty=T.tx*L.b+T.ty*L.d+L.ty,this._parentID=P._worldID,this._worldID++}}setFromMatrix(P){P.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(P){this._rotation!==P&&(this._rotation=P,this.updateSkew())}};_Transform.IDENTITY=new _Transform;let Transform=_Transform;Transform.prototype.toString=function(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`};var defaultFragment$2=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,defaultVertex$2=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;function compileShader(P,T,L){const R=P.createShader(T);return P.shaderSource(R,L),P.compileShader(R),R}function booleanArray(P){const T=new Array(P);for(let L=0;L<T.length;L++)T[L]=!1;return T}function defaultValue(P,T){switch(P){case"float":return 0;case"vec2":return new Float32Array(2*T);case"vec3":return new Float32Array(3*T);case"vec4":return new Float32Array(4*T);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*T);case"ivec3":return new Int32Array(3*T);case"ivec4":return new Int32Array(4*T);case"uvec2":return new Uint32Array(2*T);case"uvec3":return new Uint32Array(3*T);case"uvec4":return new Uint32Array(4*T);case"bool":return!1;case"bvec2":return booleanArray(2*T);case"bvec3":return booleanArray(3*T);case"bvec4":return booleanArray(4*T);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const uniformParsers=[{test:P=>P.type==="float"&&P.size===1&&!P.isArray,code:P=>`
            if(uv["${P}"] !== ud["${P}"].value)
            {
                ud["${P}"].value = uv["${P}"]
                gl.uniform1f(ud["${P}"].location, uv["${P}"])
            }
            `},{test:(P,T)=>(P.type==="sampler2D"||P.type==="samplerCube"||P.type==="sampler2DArray")&&P.size===1&&!P.isArray&&(T==null||T.castToBaseTexture!==void 0),code:P=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${P}"], t);

            if(ud["${P}"].value !== t)
            {
                ud["${P}"].value = t;
                gl.uniform1i(ud["${P}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(P,T)=>P.type==="mat3"&&P.size===1&&!P.isArray&&T.a!==void 0,code:P=>`
            gl.uniformMatrix3fv(ud["${P}"].location, false, uv["${P}"].toArray(true));
            `,codeUbo:P=>`
                var ${P}_matrix = uv.${P}.toArray(true);

                data[offset] = ${P}_matrix[0];
                data[offset+1] = ${P}_matrix[1];
                data[offset+2] = ${P}_matrix[2];
        
                data[offset + 4] = ${P}_matrix[3];
                data[offset + 5] = ${P}_matrix[4];
                data[offset + 6] = ${P}_matrix[5];
        
                data[offset + 8] = ${P}_matrix[6];
                data[offset + 9] = ${P}_matrix[7];
                data[offset + 10] = ${P}_matrix[8];
            `},{test:(P,T)=>P.type==="vec2"&&P.size===1&&!P.isArray&&T.x!==void 0,code:P=>`
                cv = ud["${P}"].value;
                v = uv["${P}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${P}"].location, v.x, v.y);
                }`,codeUbo:P=>`
                v = uv.${P};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:P=>P.type==="vec2"&&P.size===1&&!P.isArray,code:P=>`
                cv = ud["${P}"].value;
                v = uv["${P}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${P}"].location, v[0], v[1]);
                }
            `},{test:(P,T)=>P.type==="vec4"&&P.size===1&&!P.isArray&&T.width!==void 0,code:P=>`
                cv = ud["${P}"].value;
                v = uv["${P}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${P}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:P=>`
                    v = uv.${P};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:(P,T)=>P.type==="vec4"&&P.size===1&&!P.isArray&&T.red!==void 0,code:P=>`
                cv = ud["${P}"].value;
                v = uv["${P}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
                    cv[3] = v.alpha;
                    gl.uniform4f(ud["${P}"].location, v.red, v.green, v.blue, v.alpha)
                }`,codeUbo:P=>`
                    v = uv.${P};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                    data[offset+3] = v.alpha;
                `},{test:(P,T)=>P.type==="vec3"&&P.size===1&&!P.isArray&&T.red!==void 0,code:P=>`
                cv = ud["${P}"].value;
                v = uv["${P}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
    
                    gl.uniform3f(ud["${P}"].location, v.red, v.green, v.blue)
                }`,codeUbo:P=>`
                    v = uv.${P};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                `},{test:P=>P.type==="vec4"&&P.size===1&&!P.isArray,code:P=>`
                cv = ud["${P}"].value;
                v = uv["${P}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${P}"].location, v[0], v[1], v[2], v[3])
                }`}],GLSL_TO_SINGLE_SETTERS_CACHED={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},GLSL_TO_ARRAY_SETTERS={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function generateUniformsSync(P,T){const L=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(const R in P.uniforms){const I=T[R];if(!I){P.uniforms[R]?.group===!0&&(P.uniforms[R].ubo?L.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${R}, '${R}');
                    `):L.push(`
                        renderer.shader.syncUniformGroup(uv.${R}, syncData);
                    `));continue}const F=P.uniforms[R];let D=!1;for(let V=0;V<uniformParsers.length;V++)if(uniformParsers[V].test(I,F)){L.push(uniformParsers[V].code(R,F)),D=!0;break}if(!D){const V=(I.size===1&&!I.isArray?GLSL_TO_SINGLE_SETTERS_CACHED:GLSL_TO_ARRAY_SETTERS)[I.type].replace("location",`ud["${R}"].location`);L.push(`
            cu = ud["${R}"];
            cv = cu.value;
            v = uv["${R}"];
            ${V};`)}}return new Function("ud","uv","renderer","syncData",L.join(`
`))}const unknownContext={};let context=unknownContext;function getTestContext(){if(context===unknownContext||context?.isContextLost()){const P=settings.ADAPTER.createCanvas();let T;settings.PREFER_ENV>=ENV.WEBGL2&&(T=P.getContext("webgl2",{})),T||(T=P.getContext("webgl",{})||P.getContext("experimental-webgl",{}),T?T.getExtension("WEBGL_draw_buffers"):T=null),context=T}return context}let maxFragmentPrecision;function getMaxFragmentPrecision(){if(!maxFragmentPrecision){maxFragmentPrecision=PRECISION.MEDIUM;const P=getTestContext();if(P&&P.getShaderPrecisionFormat){const T=P.getShaderPrecisionFormat(P.FRAGMENT_SHADER,P.HIGH_FLOAT);T&&(maxFragmentPrecision=T.precision?PRECISION.HIGH:PRECISION.MEDIUM)}}return maxFragmentPrecision}function logPrettyShaderError(P,T){const L=P.getShaderSource(T).split(`
`).map((G,z)=>`${z}: ${G}`),R=P.getShaderInfoLog(T),I=R.split(`
`),F={},D=I.map(G=>parseFloat(G.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(G=>G&&!F[G]?(F[G]=!0,!0):!1),V=[""];D.forEach(G=>{L[G-1]=`%c${L[G-1]}%c`,V.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const q=L.join(`
`);V[0]=q,console.error(R),console.groupCollapsed("click to view full shader code"),console.warn(...V),console.groupEnd()}function logProgramError(P,T,L,R){P.getProgramParameter(T,P.LINK_STATUS)||(P.getShaderParameter(L,P.COMPILE_STATUS)||logPrettyShaderError(P,L),P.getShaderParameter(R,P.COMPILE_STATUS)||logPrettyShaderError(P,R),console.error("PixiJS Error: Could not initialize shader."),P.getProgramInfoLog(T)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",P.getProgramInfoLog(T)))}const GLSL_TO_SIZE={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function mapSize(P){return GLSL_TO_SIZE[P]}let GL_TABLE=null;const GL_TO_GLSL_TYPES={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function mapType(P,T){if(!GL_TABLE){const L=Object.keys(GL_TO_GLSL_TYPES);GL_TABLE={};for(let R=0;R<L.length;++R){const I=L[R];GL_TABLE[P[I]]=GL_TO_GLSL_TYPES[I]}}return GL_TABLE[T]}function setPrecision(P,T,L){if(P.substring(0,9)!=="precision"){let R=T;return T===PRECISION.HIGH&&L!==PRECISION.HIGH&&(R=PRECISION.MEDIUM),`precision ${R} float;
${P}`}else if(L!==PRECISION.HIGH&&P.substring(0,15)==="precision highp")return P.replace("precision highp","precision mediump");return P}let unsafeEval;function unsafeEvalSupported(){if(typeof unsafeEval=="boolean")return unsafeEval;try{unsafeEval=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{unsafeEval=!1}return unsafeEval}let UID$2=0;const nameCache={},_Program=class Cs{constructor(T,L,R="pixi-shader",I={}){this.extra={},this.id=UID$2++,this.vertexSrc=T||Cs.defaultVertexSrc,this.fragmentSrc=L||Cs.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=I,this.vertexSrc.substring(0,8)!=="#version"&&(R=R.replace(/\s+/g,"-"),nameCache[R]?(nameCache[R]++,R+=`-${nameCache[R]}`):nameCache[R]=1,this.vertexSrc=`#define SHADER_NAME ${R}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${R}
${this.fragmentSrc}`,this.vertexSrc=setPrecision(this.vertexSrc,Cs.defaultVertexPrecision,PRECISION.HIGH),this.fragmentSrc=setPrecision(this.fragmentSrc,Cs.defaultFragmentPrecision,getMaxFragmentPrecision())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return defaultVertex$2}static get defaultFragmentSrc(){return defaultFragment$2}static from(T,L,R){const I=T+L;let F=ProgramCache[I];return F||(ProgramCache[I]=F=new Cs(T,L,R)),F}};_Program.defaultVertexPrecision=PRECISION.HIGH,_Program.defaultFragmentPrecision=isMobile.apple.device?PRECISION.HIGH:PRECISION.MEDIUM;let Program=_Program,UID$1=0;class UniformGroup{constructor(T,L,R){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=UID$1++,this.static=!!L,this.ubo=!!R,T instanceof Buffer$1?(this.buffer=T,this.buffer.type=BUFFER_TYPE.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=T,this.ubo&&(this.buffer=new Buffer$1(new Float32Array(1)),this.buffer.type=BUFFER_TYPE.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(T,L,R){if(!this.ubo)this.uniforms[T]=new UniformGroup(L,R);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(T,L,R){return new UniformGroup(T,L,R)}static uboFrom(T,L){return new UniformGroup(T,L??!0,!0)}}class Shader{constructor(T,L){this.uniformBindCount=0,this.program=T,L?L instanceof UniformGroup?this.uniformGroup=L:this.uniformGroup=new UniformGroup(L):this.uniformGroup=new UniformGroup({}),this.disposeRunner=new Runner("disposeShader")}checkUniformExists(T,L){if(L.uniforms[T])return!0;for(const R in L.uniforms){const I=L.uniforms[R];if(I.group===!0&&this.checkUniformExists(T,I))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(T,L,R){const I=Program.from(T,L);return new Shader(I,R)}}class BatchShaderGenerator{constructor(T,L){if(this.vertexSrc=T,this.fragTemplate=L,this.programCache={},this.defaultGroupCache={},!L.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!L.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(T){if(!this.programCache[T]){const R=new Int32Array(T);for(let F=0;F<T;F++)R[F]=F;this.defaultGroupCache[T]=UniformGroup.from({uSamplers:R},!0);let I=this.fragTemplate;I=I.replace(/%count%/gi,`${T}`),I=I.replace(/%forloop%/gi,this.generateSampleSrc(T)),this.programCache[T]=new Program(this.vertexSrc,I)}const L={tint:new Float32Array([1,1,1,1]),translationMatrix:new Matrix,default:this.defaultGroupCache[T]};return new Shader(this.programCache[T],L)}generateSampleSrc(T){let L="";L+=`
`,L+=`
`;for(let R=0;R<T;R++)R>0&&(L+=`
else `),R<T-1&&(L+=`if(vTextureId < ${R}.5)`),L+=`
{`,L+=`
	color = texture2D(uSamplers[${R}], vTextureCoord);`,L+=`
}`;return L+=`
`,L+=`
`,L}}class BatchTextureArray{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let T=0;T<this.count;T++)this.elements[T]=null;this.count=0}}function canUploadSameBuffer(){return!isMobile.apple.device}function maxRecommendedTextures(P){let T=!0;const L=settings.ADAPTER.getNavigator();if(isMobile.tablet||isMobile.phone){if(isMobile.apple.device){const R=L.userAgent.match(/OS (\d+)_(\d+)?/);R&&parseInt(R[1],10)<11&&(T=!1)}if(isMobile.android.device){const R=L.userAgent.match(/Android\s([0-9.]*)/);R&&parseInt(R[1],10)<7&&(T=!1)}}return T?P:4}class ObjectRenderer{constructor(T){this.renderer=T}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(T){}}var defaultFragment$1=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`,defaultVertex$1=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`;const _BatchRenderer=class Vi extends ObjectRenderer{constructor(T){super(T),this.setShaderGenerator(),this.geometryClass=BatchGeometry,this.vertexSize=6,this.state=State.for2d(),this.size=Vi.defaultBatchSize*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),T.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??maxRecommendedTextures(32),this._defaultMaxTextures}static set defaultMaxTextures(T){this._defaultMaxTextures=T}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??canUploadSameBuffer(),this._canUploadSameBuffer}static set canUploadSameBuffer(T){this._canUploadSameBuffer=T}get MAX_TEXTURES(){return deprecation("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return defaultVertex$1}static get defaultFragmentTemplate(){return defaultFragment$1}setShaderGenerator({vertex:T=Vi.defaultVertexSrc,fragment:L=Vi.defaultFragmentTemplate}={}){this.shaderGenerator=new BatchShaderGenerator(T,L)}contextChange(){const T=this.renderer.gl;settings.PREFER_ENV===ENV.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(T.getParameter(T.MAX_TEXTURE_IMAGE_UNITS),Vi.defaultMaxTextures),this.maxTextures=checkMaxIfStatementsInShader(this.maxTextures,T)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let L=0;L<this._packedGeometryPoolSize;L++)this._packedGeometries[L]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:T,_textureArrayPool:L}=Vi,R=this.size/4,I=Math.floor(R/this.maxTextures)+1;for(;T.length<R;)T.push(new BatchDrawCall);for(;L.length<I;)L.push(new BatchTextureArray);for(let F=0;F<this.maxTextures;F++)this._tempBoundTextures[F]=null}onPrerender(){this._flushId=0}render(T){T._texture.valid&&(this._vertexCount+T.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=T.vertexData.length/2,this._indexCount+=T.indices.length,this._bufferedTextures[this._bufferSize]=T._texture.baseTexture,this._bufferedElements[this._bufferSize++]=T)}buildTexturesAndDrawCalls(){const{_bufferedTextures:T,maxTextures:L}=this,R=Vi._textureArrayPool,I=this.renderer.batch,F=this._tempBoundTextures,D=this.renderer.textureGC.count;let V=++BaseTexture._globalBatch,q=0,G=R[0],z=0;I.copyBoundTextures(F,L);for(let Q=0;Q<this._bufferSize;++Q){const tt=T[Q];T[Q]=null,tt._batchEnabled!==V&&(G.count>=L&&(I.boundArray(G,F,V,L),this.buildDrawCalls(G,z,Q),z=Q,G=R[++q],++V),tt._batchEnabled=V,tt.touched=D,G.elements[G.count++]=tt)}G.count>0&&(I.boundArray(G,F,V,L),this.buildDrawCalls(G,z,this._bufferSize),++q,++V);for(let Q=0;Q<F.length;Q++)F[Q]=null;BaseTexture._globalBatch=V}buildDrawCalls(T,L,R){const{_bufferedElements:I,_attributeBuffer:F,_indexBuffer:D,vertexSize:V}=this,q=Vi._drawCallPool;let G=this._dcIndex,z=this._aIndex,Q=this._iIndex,tt=q[G];tt.start=this._iIndex,tt.texArray=T;for(let gt=L;gt<R;++gt){const yt=I[gt],Et=yt._texture.baseTexture,J=premultiplyBlendMode[Et.alphaMode?1:0][yt.blendMode];I[gt]=null,L<gt&&tt.blend!==J&&(tt.size=Q-tt.start,L=gt,tt=q[++G],tt.texArray=T,tt.start=Q),this.packInterleavedGeometry(yt,F,D,z,Q),z+=yt.vertexData.length/2*V,Q+=yt.indices.length,tt.blend=J}L<R&&(tt.size=Q-tt.start,++G),this._dcIndex=G,this._aIndex=z,this._iIndex=Q}bindAndClearTexArray(T){const L=this.renderer.texture;for(let R=0;R<T.count;R++)L.bind(T.elements[R],T.ids[R]),T.elements[R]=null;T.count=0}updateGeometry(){const{_packedGeometries:T,_attributeBuffer:L,_indexBuffer:R}=this;Vi.canUploadSameBuffer?(T[this._flushId]._buffer.update(L.rawBinaryData),T[this._flushId]._indexBuffer.update(R),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,T[this._flushId]=new this.geometryClass),T[this._flushId]._buffer.update(L.rawBinaryData),T[this._flushId]._indexBuffer.update(R),this.renderer.geometry.bind(T[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const T=this._dcIndex,{gl:L,state:R}=this.renderer,I=Vi._drawCallPool;let F=null;for(let D=0;D<T;D++){const{texArray:V,type:q,size:G,start:z,blend:Q}=I[D];F!==V&&(F=V,this.bindAndClearTexArray(V)),this.state.blendMode=Q,R.set(this.state),L.drawElements(q,G,L.UNSIGNED_SHORT,z*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),Vi.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let T=0;T<this._packedGeometryPoolSize;T++)this._packedGeometries[T]&&this._packedGeometries[T].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(T){const L=nextPow2(Math.ceil(T/8)),R=log2(L),I=L*8;this._aBuffers.length<=R&&(this._iBuffers.length=R+1);let F=this._aBuffers[I];return F||(this._aBuffers[I]=F=new ViewableBuffer(I*this.vertexSize*4)),F}getIndexBuffer(T){const L=nextPow2(Math.ceil(T/12)),R=log2(L),I=L*12;this._iBuffers.length<=R&&(this._iBuffers.length=R+1);let F=this._iBuffers[R];return F||(this._iBuffers[R]=F=new Uint16Array(I)),F}packInterleavedGeometry(T,L,R,I,F){const{uint32View:D,float32View:V}=L,q=I/this.vertexSize,G=T.uvs,z=T.indices,Q=T.vertexData,tt=T._texture.baseTexture._batchLocation,gt=Math.min(T.worldAlpha,1),yt=Color.shared.setValue(T._tintRGB).toPremultiplied(gt,T._texture.baseTexture.alphaMode>0);for(let Et=0;Et<Q.length;Et+=2)V[I++]=Q[Et],V[I++]=Q[Et+1],V[I++]=G[Et],V[I++]=G[Et+1],D[I++]=yt,V[I++]=tt;for(let Et=0;Et<z.length;Et++)R[F++]=q+z[Et]}};_BatchRenderer.defaultBatchSize=4096,_BatchRenderer.extension={name:"batch",type:ExtensionType.RendererPlugin},_BatchRenderer._drawCallPool=[],_BatchRenderer._textureArrayPool=[];let BatchRenderer=_BatchRenderer;extensions.add(BatchRenderer);var defaultFragment=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,defaultVertex=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const _Filter=class Os extends Shader{constructor(T,L,R){const I=Program.from(T||Os.defaultVertexSrc,L||Os.defaultFragmentSrc);super(I,R),this.padding=0,this.resolution=Os.defaultResolution,this.multisample=Os.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new State}apply(T,L,R,I,F){T.applyFilter(this,L,R,I)}get blendMode(){return this.state.blendMode}set blendMode(T){this.state.blendMode=T}get resolution(){return this._resolution}set resolution(T){this._resolution=T}static get defaultVertexSrc(){return defaultVertex}static get defaultFragmentSrc(){return defaultFragment}};_Filter.defaultResolution=1,_Filter.defaultMultisample=MSAA_QUALITY.NONE;let Filter=_Filter;class BackgroundSystem{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new Color(0),this.alpha=1}init(T){this.clearBeforeRender=T.clearBeforeRender;const{backgroundColor:L,background:R,backgroundAlpha:I}=T,F=R??L;F!==void 0&&(this.color=F),this.alpha=I}get color(){return this._backgroundColor.value}set color(T){this._backgroundColor.setValue(T)}get alpha(){return this._backgroundColor.alpha}set alpha(T){this._backgroundColor.setAlpha(T)}get backgroundColor(){return this._backgroundColor}destroy(){}}BackgroundSystem.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},BackgroundSystem.extension={type:[ExtensionType.RendererSystem,ExtensionType.CanvasRendererSystem],name:"background"};extensions.add(BackgroundSystem);class BatchSystem{constructor(T){this.renderer=T,this.emptyRenderer=new ObjectRenderer(T),this.currentRenderer=this.emptyRenderer}setObjectRenderer(T){this.currentRenderer!==T&&(this.currentRenderer.stop(),this.currentRenderer=T,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(T,L){const{boundTextures:R}=this.renderer.texture;for(let I=L-1;I>=0;--I)T[I]=R[I]||null,T[I]&&(T[I]._batchLocation=I)}boundArray(T,L,R,I){const{elements:F,ids:D,count:V}=T;let q=0;for(let G=0;G<V;G++){const z=F[G],Q=z._batchLocation;if(Q>=0&&Q<I&&L[Q]===z){D[G]=Q;continue}for(;q<I;){const tt=L[q];if(tt&&tt._batchEnabled===R&&tt._batchLocation===q){q++;continue}D[G]=q,z._batchLocation=q,L[q]=z;break}}}destroy(){this.renderer=null}}BatchSystem.extension={type:ExtensionType.RendererSystem,name:"batch"};extensions.add(BatchSystem);let CONTEXT_UID_COUNTER=0;class ContextSystem{constructor(T){this.renderer=T,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(T){this.gl=T,this.renderer.gl=T,this.renderer.CONTEXT_UID=CONTEXT_UID_COUNTER++}init(T){if(T.context)this.initFromContext(T.context);else{const L=this.renderer.background.alpha<1,R=T.premultipliedAlpha;this.preserveDrawingBuffer=T.preserveDrawingBuffer,this.useContextAlpha=T.useContextAlpha,this.powerPreference=T.powerPreference,this.initFromOptions({alpha:L,premultipliedAlpha:R,antialias:T.antialias,stencil:!0,preserveDrawingBuffer:T.preserveDrawingBuffer,powerPreference:T.powerPreference})}}initFromContext(T){this.gl=T,this.validateContext(T),this.renderer.gl=T,this.renderer.CONTEXT_UID=CONTEXT_UID_COUNTER++,this.renderer.runners.contextChange.emit(T);const L=this.renderer.view;L.addEventListener!==void 0&&(L.addEventListener("webglcontextlost",this.handleContextLost,!1),L.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(T){const L=this.createContext(this.renderer.view,T);this.initFromContext(L)}createContext(T,L){let R;if(settings.PREFER_ENV>=ENV.WEBGL2&&(R=T.getContext("webgl2",L)),R)this.webGLVersion=2;else if(this.webGLVersion=1,R=T.getContext("webgl",L)||T.getContext("experimental-webgl",L),!R)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=R,this.getExtensions(),this.gl}getExtensions(){const{gl:T}=this,L={loseContext:T.getExtension("WEBGL_lose_context"),anisotropicFiltering:T.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:T.getExtension("OES_texture_float_linear"),s3tc:T.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:T.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:T.getExtension("WEBGL_compressed_texture_etc"),etc1:T.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:T.getExtension("WEBGL_compressed_texture_pvrtc")||T.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:T.getExtension("WEBGL_compressed_texture_atc"),astc:T.getExtension("WEBGL_compressed_texture_astc"),bptc:T.getExtension("EXT_texture_compression_bptc")};this.webGLVersion===1?Object.assign(this.extensions,L,{drawBuffers:T.getExtension("WEBGL_draw_buffers"),depthTexture:T.getExtension("WEBGL_depth_texture"),vertexArrayObject:T.getExtension("OES_vertex_array_object")||T.getExtension("MOZ_OES_vertex_array_object")||T.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:T.getExtension("OES_element_index_uint"),floatTexture:T.getExtension("OES_texture_float"),floatTextureLinear:T.getExtension("OES_texture_float_linear"),textureHalfFloat:T.getExtension("OES_texture_half_float"),textureHalfFloatLinear:T.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,L,{colorBufferFloat:T.getExtension("EXT_color_buffer_float")})}handleContextLost(T){T.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const T=this.renderer.view;this.renderer=null,T.removeEventListener!==void 0&&(T.removeEventListener("webglcontextlost",this.handleContextLost),T.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(T){const L=T.getContextAttributes(),R="WebGL2RenderingContext"in globalThis&&T instanceof globalThis.WebGL2RenderingContext;R&&(this.webGLVersion=2),L&&!L.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const I=R||!!T.getExtension("OES_element_index_uint");this.supports.uint32Indices=I,I||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}ContextSystem.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"},ContextSystem.extension={type:ExtensionType.RendererSystem,name:"context"};extensions.add(ContextSystem);class Framebuffer{constructor(T,L){if(this.width=Math.round(T),this.height=Math.round(L),!this.width||!this.height)throw new Error("Framebuffer width or height is zero");this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new Runner("disposeFramebuffer"),this.multisample=MSAA_QUALITY.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(T=0,L){return this.colorTextures[T]=L||new BaseTexture(null,{scaleMode:SCALE_MODES.NEAREST,resolution:1,mipmap:MIPMAP_MODES.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(T){return this.depthTexture=T||new BaseTexture(null,{scaleMode:SCALE_MODES.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:MIPMAP_MODES.OFF,format:FORMATS.DEPTH_COMPONENT,type:TYPES.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(T,L){if(T=Math.round(T),L=Math.round(L),!T||!L)throw new Error("Framebuffer width and height must not be zero");if(!(T===this.width&&L===this.height)){this.width=T,this.height=L,this.dirtyId++,this.dirtySize++;for(let R=0;R<this.colorTextures.length;R++){const I=this.colorTextures[R],F=I.resolution;I.setSize(T/F,L/F)}if(this.depthTexture){const R=this.depthTexture.resolution;this.depthTexture.setSize(T/R,L/R)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class BaseRenderTexture extends BaseTexture{constructor(T={}){if(typeof T=="number"){const L=arguments[0],R=arguments[1],I=arguments[2],F=arguments[3];T={width:L,height:R,scaleMode:I,resolution:F}}T.width=T.width??100,T.height=T.height??100,T.multisample??(T.multisample=MSAA_QUALITY.NONE),super(null,T),this.mipmap=MIPMAP_MODES.OFF,this.valid=!0,this._clear=new Color([0,0,0,0]),this.framebuffer=new Framebuffer(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=T.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(T){this._clear.setValue(T)}get clearColor(){return this._clear.value}get clear(){return this._clear}get multisample(){return this.framebuffer.multisample}set multisample(T){this.framebuffer.multisample=T}resize(T,L){this.framebuffer.resize(T*this.resolution,L*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class BaseImageResource extends Resource{constructor(T){const L=T,R=L.naturalWidth||L.videoWidth||L.displayWidth||L.width,I=L.naturalHeight||L.videoHeight||L.displayHeight||L.height;super(R,I),this.source=T,this.noSubImage=!1}static crossOrigin(T,L,R){R===void 0&&!L.startsWith("data:")?T.crossOrigin=determineCrossOrigin(L):R!==!1&&(T.crossOrigin=typeof R=="string"?R:"anonymous")}upload(T,L,R,I){const F=T.gl,D=L.realWidth,V=L.realHeight;if(I=I||this.source,typeof HTMLImageElement<"u"&&I instanceof HTMLImageElement){if(!I.complete||I.naturalWidth===0)return!1}else if(typeof HTMLVideoElement<"u"&&I instanceof HTMLVideoElement&&I.readyState<=1)return!1;return F.pixelStorei(F.UNPACK_PREMULTIPLY_ALPHA_WEBGL,L.alphaMode===ALPHA_MODES.UNPACK),!this.noSubImage&&L.target===F.TEXTURE_2D&&R.width===D&&R.height===V?F.texSubImage2D(F.TEXTURE_2D,0,0,0,L.format,R.type,I):(R.width=D,R.height=V,F.texImage2D(L.target,0,R.internalFormat,L.format,R.type,I)),!0}update(){if(this.destroyed)return;const T=this.source,L=T.naturalWidth||T.videoWidth||T.width,R=T.naturalHeight||T.videoHeight||T.height;this.resize(L,R),super.update()}dispose(){this.source=null}}class ImageResource extends BaseImageResource{constructor(T,L){if(L=L||{},typeof T=="string"){const R=new Image;BaseImageResource.crossOrigin(R,T,L.crossorigin),R.src=T,T=R}super(T),!T.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=T.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(L.createBitmap??settings.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof L.alphaMode=="number"?L.alphaMode:null,this.bitmap=null,this._load=null,L.autoLoad!==!1&&this.load()}load(T){return this._load?this._load:(T!==void 0&&(this.createBitmap=T),this._load=new Promise((L,R)=>{const I=this.source;this.url=I.src;const F=()=>{this.destroyed||(I.onload=null,I.onerror=null,this.update(),this._load=null,this.createBitmap?L(this.process()):L(this))};I.complete&&I.src?F():(I.onload=F,I.onerror=D=>{R(D),this.onError.emit(D)})}),this._load)}process(){const T=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);const L=globalThis.createImageBitmap,R=!T.crossOrigin||T.crossOrigin==="anonymous";return this._process=fetch(T.src,{mode:R?"cors":"no-cors"}).then(I=>I.blob()).then(I=>L(I,0,0,T.width,T.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===ALPHA_MODES.UNPACK?"premultiply":"none"})).then(I=>this.destroyed?Promise.reject():(this.bitmap=I,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(T,L,R){if(typeof this.alphaMode=="number"&&(L.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(T,L,R);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(T,L,R,this.bitmap),!this.preserveBitmap){let I=!0;const F=L._glTextures;for(const D in F){const V=F[D];if(V!==R&&V.dirtyId!==L.dirtyId){I=!1;break}}I&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(T){return typeof HTMLImageElement<"u"&&(typeof T=="string"||T instanceof HTMLImageElement)}}class TextureUvs{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(T,L,R){const I=L.width,F=L.height;if(R){const D=T.width/2/I,V=T.height/2/F,q=T.x/I+D,G=T.y/F+V;R=groupD8.add(R,groupD8.NW),this.x0=q+D*groupD8.uX(R),this.y0=G+V*groupD8.uY(R),R=groupD8.add(R,2),this.x1=q+D*groupD8.uX(R),this.y1=G+V*groupD8.uY(R),R=groupD8.add(R,2),this.x2=q+D*groupD8.uX(R),this.y2=G+V*groupD8.uY(R),R=groupD8.add(R,2),this.x3=q+D*groupD8.uX(R),this.y3=G+V*groupD8.uY(R)}else this.x0=T.x/I,this.y0=T.y/F,this.x1=(T.x+T.width)/I,this.y1=T.y/F,this.x2=(T.x+T.width)/I,this.y2=(T.y+T.height)/F,this.x3=T.x/I,this.y3=(T.y+T.height)/F;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}}TextureUvs.prototype.toString=function(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`};const DEFAULT_UVS=new TextureUvs;function removeAllHandlers(P){P.destroy=function(){},P.on=function(){},P.once=function(){},P.emit=function(){}}class Texture extends EventEmitter{constructor(T,L,R,I,F,D,V){if(super(),this.noFrame=!1,L||(this.noFrame=!0,L=new Rectangle(0,0,1,1)),T instanceof Texture&&(T=T.baseTexture),this.baseTexture=T,this._frame=L,this.trim=I,this.valid=!1,this.destroyed=!1,this._uvs=DEFAULT_UVS,this.uvMatrix=null,this.orig=R||L,this._rotate=Number(F||0),F===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=D?new Point(D.x,D.y):new Point(0,0),this.defaultBorders=V,this._updateID=0,this.textureCacheIds=[],T.valid?this.noFrame?T.valid&&this.onBaseTextureUpdated(T):this.frame=L:T.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&T.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(T){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=T.width,this._frame.height=T.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(T){if(this.baseTexture){if(T){const{resource:L}=this.baseTexture;L?.url&&TextureCache[L.url]&&Texture.removeFromCache(L.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,Texture.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}clone(){const T=this._frame.clone(),L=this._frame===this.orig?T:this.orig.clone(),R=new Texture(this.baseTexture,!this.noFrame&&T,L,this.trim?.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(R._frame=T),R}updateUvs(){this._uvs===DEFAULT_UVS&&(this._uvs=new TextureUvs),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(T,L={},R=settings.STRICT_TEXTURE_CACHE){const I=typeof T=="string";let F=null;if(I)F=T;else if(T instanceof BaseTexture){if(!T.cacheId){const V=L?.pixiIdPrefix||"pixiid";T.cacheId=`${V}-${uid()}`,BaseTexture.addToCache(T,T.cacheId)}F=T.cacheId}else{if(!T._pixiId){const V=L?.pixiIdPrefix||"pixiid";T._pixiId=`${V}_${uid()}`}F=T._pixiId}let D=TextureCache[F];if(I&&R&&!D)throw new Error(`The cacheId "${F}" does not exist in TextureCache.`);return!D&&!(T instanceof BaseTexture)?(L.resolution||(L.resolution=getResolutionOfUrl(T)),D=new Texture(new BaseTexture(T,L)),D.baseTexture.cacheId=F,BaseTexture.addToCache(D.baseTexture,F),Texture.addToCache(D,F)):!D&&T instanceof BaseTexture&&(D=new Texture(T),Texture.addToCache(D,F)),D}static fromURL(T,L){const R=Object.assign({autoLoad:!1},L?.resourceOptions),I=Texture.from(T,Object.assign({resourceOptions:R},L),!1),F=I.baseTexture.resource;return I.baseTexture.valid?Promise.resolve(I):F.load().then(()=>Promise.resolve(I))}static fromBuffer(T,L,R,I){return new Texture(BaseTexture.fromBuffer(T,L,R,I))}static fromLoader(T,L,R,I){const F=new BaseTexture(T,Object.assign({scaleMode:BaseTexture.defaultOptions.scaleMode,resolution:getResolutionOfUrl(L)},I)),{resource:D}=F;D instanceof ImageResource&&(D.url=L);const V=new Texture(F);return R||(R=L),BaseTexture.addToCache(V.baseTexture,R),Texture.addToCache(V,R),R!==L&&(BaseTexture.addToCache(V.baseTexture,L),Texture.addToCache(V,L)),V.baseTexture.valid?Promise.resolve(V):new Promise(q=>{V.baseTexture.once("loaded",()=>q(V))})}static addToCache(T,L){L&&(T.textureCacheIds.includes(L)||T.textureCacheIds.push(L),TextureCache[L]&&TextureCache[L]!==T&&console.warn(`Texture added to the cache with an id [${L}] that already had an entry`),TextureCache[L]=T)}static removeFromCache(T){if(typeof T=="string"){const L=TextureCache[T];if(L){const R=L.textureCacheIds.indexOf(T);return R>-1&&L.textureCacheIds.splice(R,1),delete TextureCache[T],L}}else if(T?.textureCacheIds){for(let L=0;L<T.textureCacheIds.length;++L)TextureCache[T.textureCacheIds[L]]===T&&delete TextureCache[T.textureCacheIds[L]];return T.textureCacheIds.length=0,T}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(T){this._frame=T,this.noFrame=!1;const{x:L,y:R,width:I,height:F}=T,D=L+I>this.baseTexture.width,V=R+F>this.baseTexture.height;if(D||V){const q=D&&V?"and":"or",G=`X: ${L} + ${I} = ${L+I} > ${this.baseTexture.width}`,z=`Y: ${R} + ${F} = ${R+F} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${G} ${q} ${z}`)}this.valid=I&&F&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=T),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(T){this._rotate=T,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return Texture._EMPTY||(Texture._EMPTY=new Texture(new BaseTexture),removeAllHandlers(Texture._EMPTY),removeAllHandlers(Texture._EMPTY.baseTexture)),Texture._EMPTY}static get WHITE(){if(!Texture._WHITE){const T=settings.ADAPTER.createCanvas(16,16),L=T.getContext("2d");T.width=16,T.height=16,L.fillStyle="white",L.fillRect(0,0,16,16),Texture._WHITE=new Texture(BaseTexture.from(T)),removeAllHandlers(Texture._WHITE),removeAllHandlers(Texture._WHITE.baseTexture)}return Texture._WHITE}}class RenderTexture extends Texture{constructor(T,L){super(T,L),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(T){this.framebuffer.multisample=T}resize(T,L,R=!0){const I=this.baseTexture.resolution,F=Math.round(T*I)/I,D=Math.round(L*I)/I;this.valid=F>0&&D>0,this._frame.width=this.orig.width=F,this._frame.height=this.orig.height=D,R&&this.baseTexture.resize(F,D),this.updateUvs()}setResolution(T){const{baseTexture:L}=this;L.resolution!==T&&(L.setResolution(T),this.resize(L.width,L.height,!1))}static create(T){return new RenderTexture(new BaseRenderTexture(T))}}class RenderTexturePool{constructor(T){this.texturePool={},this.textureOptions=T||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(T,L,R=MSAA_QUALITY.NONE){const I=new BaseRenderTexture(Object.assign({width:T,height:L,resolution:1,multisample:R},this.textureOptions));return new RenderTexture(I)}getOptimalTexture(T,L,R=1,I=MSAA_QUALITY.NONE){let F;T=Math.max(Math.ceil(T*R-1e-6),1),L=Math.max(Math.ceil(L*R-1e-6),1),!this.enableFullScreen||T!==this._pixelsWidth||L!==this._pixelsHeight?(T=nextPow2(T),L=nextPow2(L),F=((T&65535)<<16|L&65535)>>>0,I>1&&(F+=I*4294967296)):F=I>1?-I:-1,this.texturePool[F]||(this.texturePool[F]=[]);let D=this.texturePool[F].pop();return D||(D=this.createTexture(T,L,I)),D.filterPoolKey=F,D.setResolution(R),D}getFilterTexture(T,L,R){const I=this.getOptimalTexture(T.width,T.height,L||T.resolution,R||MSAA_QUALITY.NONE);return I.filterFrame=T.filterFrame,I}returnTexture(T){const L=T.filterPoolKey;T.filterFrame=null,this.texturePool[L].push(T)}returnFilterTexture(T){this.returnTexture(T)}clear(T){if(T=T!==!1,T)for(const L in this.texturePool){const R=this.texturePool[L];if(R)for(let I=0;I<R.length;I++)R[I].destroy(!0)}this.texturePool={}}setScreenSize(T){if(!(T.width===this._pixelsWidth&&T.height===this._pixelsHeight)){this.enableFullScreen=T.width>0&&T.height>0;for(const L in this.texturePool){if(!(Number(L)<0))continue;const R=this.texturePool[L];if(R)for(let I=0;I<R.length;I++)R[I].destroy(!0);this.texturePool[L]=[]}this._pixelsWidth=T.width,this._pixelsHeight=T.height}}}RenderTexturePool.SCREEN_KEY=-1;class Quad extends Geometry{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class QuadUv extends Geometry{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new Buffer$1(this.vertices),this.uvBuffer=new Buffer$1(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(T,L){let R=0,I=0;return this.uvs[0]=R,this.uvs[1]=I,this.uvs[2]=R+L.width/T.width,this.uvs[3]=I,this.uvs[4]=R+L.width/T.width,this.uvs[5]=I+L.height/T.height,this.uvs[6]=R,this.uvs[7]=I+L.height/T.height,R=L.x,I=L.y,this.vertices[0]=R,this.vertices[1]=I,this.vertices[2]=R+L.width,this.vertices[3]=I,this.vertices[4]=R+L.width,this.vertices[5]=I+L.height,this.vertices[6]=R,this.vertices[7]=I+L.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class FilterState{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=MSAA_QUALITY.NONE,this.sourceFrame=new Rectangle,this.destinationFrame=new Rectangle,this.bindingSourceFrame=new Rectangle,this.bindingDestinationFrame=new Rectangle,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const tempPoints=[new Point,new Point,new Point,new Point],tempMatrix$2=new Matrix;class FilterSystem{constructor(T){this.renderer=T,this.defaultFilterStack=[{}],this.texturePool=new RenderTexturePool,this.statePool=[],this.quad=new Quad,this.quadUv=new QuadUv,this.tempRect=new Rectangle,this.activeState={},this.globalUniforms=new UniformGroup({outputFrame:new Rectangle,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(T,L){const R=this.renderer,I=this.defaultFilterStack,F=this.statePool.pop()||new FilterState,D=R.renderTexture;let V,q;if(D.current){const J=D.current;V=J.resolution,q=J.multisample}else V=R.resolution,q=R.multisample;let G=L[0].resolution||V,z=L[0].multisample??q,Q=L[0].padding,tt=L[0].autoFit,gt=L[0].legacy??!0;for(let J=1;J<L.length;J++){const At=L[J];G=Math.min(G,At.resolution||V),z=Math.min(z,At.multisample??q),Q=this.useMaxPadding?Math.max(Q,At.padding):Q+At.padding,tt=tt&&At.autoFit,gt=gt||(At.legacy??!0)}I.length===1&&(this.defaultFilterStack[0].renderTexture=D.current),I.push(F),F.resolution=G,F.multisample=z,F.legacy=gt,F.target=T,F.sourceFrame.copyFrom(T.filterArea||T.getBounds(!0)),F.sourceFrame.pad(Q);const yt=this.tempRect.copyFrom(D.sourceFrame);R.projection.transform&&this.transformAABB(tempMatrix$2.copyFrom(R.projection.transform).invert(),yt),tt?(F.sourceFrame.fit(yt),(F.sourceFrame.width<=0||F.sourceFrame.height<=0)&&(F.sourceFrame.width=0,F.sourceFrame.height=0)):F.sourceFrame.intersects(yt)||(F.sourceFrame.width=0,F.sourceFrame.height=0),this.roundFrame(F.sourceFrame,D.current?D.current.resolution:R.resolution,D.sourceFrame,D.destinationFrame,R.projection.transform),F.renderTexture=this.getOptimalFilterTexture(F.sourceFrame.width,F.sourceFrame.height,G,z),F.filters=L,F.destinationFrame.width=F.renderTexture.width,F.destinationFrame.height=F.renderTexture.height;const Et=this.tempRect;Et.x=0,Et.y=0,Et.width=F.sourceFrame.width,Et.height=F.sourceFrame.height,F.renderTexture.filterFrame=F.sourceFrame,F.bindingSourceFrame.copyFrom(D.sourceFrame),F.bindingDestinationFrame.copyFrom(D.destinationFrame),F.transform=R.projection.transform,R.projection.transform=null,D.bind(F.renderTexture,F.sourceFrame,Et),R.framebuffer.clear(0,0,0,0)}pop(){const T=this.defaultFilterStack,L=T.pop(),R=L.filters;this.activeState=L;const I=this.globalUniforms.uniforms;I.outputFrame=L.sourceFrame,I.resolution=L.resolution;const F=I.inputSize,D=I.inputPixel,V=I.inputClamp;if(F[0]=L.destinationFrame.width,F[1]=L.destinationFrame.height,F[2]=1/F[0],F[3]=1/F[1],D[0]=Math.round(F[0]*L.resolution),D[1]=Math.round(F[1]*L.resolution),D[2]=1/D[0],D[3]=1/D[1],V[0]=.5*D[2],V[1]=.5*D[3],V[2]=L.sourceFrame.width*F[2]-.5*D[2],V[3]=L.sourceFrame.height*F[3]-.5*D[3],L.legacy){const G=I.filterArea;G[0]=L.destinationFrame.width,G[1]=L.destinationFrame.height,G[2]=L.sourceFrame.x,G[3]=L.sourceFrame.y,I.filterClamp=I.inputClamp}this.globalUniforms.update();const q=T[T.length-1];if(this.renderer.framebuffer.blit(),R.length===1)R[0].apply(this,L.renderTexture,q.renderTexture,CLEAR_MODES.BLEND,L),this.returnFilterTexture(L.renderTexture);else{let G=L.renderTexture,z=this.getOptimalFilterTexture(G.width,G.height,L.resolution);z.filterFrame=G.filterFrame;let Q=0;for(Q=0;Q<R.length-1;++Q){Q===1&&L.multisample>1&&(z=this.getOptimalFilterTexture(G.width,G.height,L.resolution),z.filterFrame=G.filterFrame),R[Q].apply(this,G,z,CLEAR_MODES.CLEAR,L);const tt=G;G=z,z=tt}R[Q].apply(this,G,q.renderTexture,CLEAR_MODES.BLEND,L),Q>1&&L.multisample>1&&this.returnFilterTexture(L.renderTexture),this.returnFilterTexture(G),this.returnFilterTexture(z)}L.clear(),this.statePool.push(L)}bindAndClear(T,L=CLEAR_MODES.CLEAR){const{renderTexture:R,state:I}=this.renderer;if(T===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,T?.filterFrame){const D=this.tempRect;D.x=0,D.y=0,D.width=T.filterFrame.width,D.height=T.filterFrame.height,R.bind(T,T.filterFrame,D)}else T!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?R.bind(T):this.renderer.renderTexture.bind(T,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const F=I.stateId&1||this.forceClear;(L===CLEAR_MODES.CLEAR||L===CLEAR_MODES.BLIT&&F)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(T,L,R,I){const F=this.renderer;F.state.set(T.state),this.bindAndClear(R,I),T.uniforms.uSampler=L,T.uniforms.filterGlobals=this.globalUniforms,F.shader.bind(T),T.legacy=!!T.program.attributeData.aTextureCoord,T.legacy?(this.quadUv.map(L._frame,L.filterFrame),F.geometry.bind(this.quadUv),F.geometry.draw(DRAW_MODES.TRIANGLES)):(F.geometry.bind(this.quad),F.geometry.draw(DRAW_MODES.TRIANGLE_STRIP))}calculateSpriteMatrix(T,L){const{sourceFrame:R,destinationFrame:I}=this.activeState,{orig:F}=L._texture,D=T.set(I.width,0,0,I.height,R.x,R.y),V=L.worldTransform.copyTo(Matrix.TEMP_MATRIX);return V.invert(),D.prepend(V),D.scale(1/F.width,1/F.height),D.translate(L.anchor.x,L.anchor.y),D}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(T,L,R=1,I=MSAA_QUALITY.NONE){return this.texturePool.getOptimalTexture(T,L,R,I)}getFilterTexture(T,L,R){if(typeof T=="number"){const F=T;T=L,L=F}T=T||this.activeState.renderTexture;const I=this.texturePool.getOptimalTexture(T.width,T.height,L||T.resolution,R||MSAA_QUALITY.NONE);return I.filterFrame=T.filterFrame,I}returnFilterTexture(T){this.texturePool.returnTexture(T)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(T,L){const R=tempPoints[0],I=tempPoints[1],F=tempPoints[2],D=tempPoints[3];R.set(L.left,L.top),I.set(L.left,L.bottom),F.set(L.right,L.top),D.set(L.right,L.bottom),T.apply(R,R),T.apply(I,I),T.apply(F,F),T.apply(D,D);const V=Math.min(R.x,I.x,F.x,D.x),q=Math.min(R.y,I.y,F.y,D.y),G=Math.max(R.x,I.x,F.x,D.x),z=Math.max(R.y,I.y,F.y,D.y);L.x=V,L.y=q,L.width=G-V,L.height=z-q}roundFrame(T,L,R,I,F){if(!(T.width<=0||T.height<=0||R.width<=0||R.height<=0)){if(F){const{a:D,b:V,c:q,d:G}=F;if((Math.abs(V)>1e-4||Math.abs(q)>1e-4)&&(Math.abs(D)>1e-4||Math.abs(G)>1e-4))return}F=F?tempMatrix$2.copyFrom(F):tempMatrix$2.identity(),F.translate(-R.x,-R.y).scale(I.width/R.width,I.height/R.height).translate(I.x,I.y),this.transformAABB(F,T),T.ceil(L),this.transformAABB(F.invert(),T)}}}FilterSystem.extension={type:ExtensionType.RendererSystem,name:"filter"};extensions.add(FilterSystem);class GLFramebuffer{constructor(T){this.framebuffer=T,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=MSAA_QUALITY.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const tempRectangle=new Rectangle;class FramebufferSystem{constructor(T){this.renderer=T,this.managedFramebuffers=[],this.unknownFramebuffer=new Framebuffer(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const T=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Rectangle,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){let L=this.renderer.context.extensions.drawBuffers,R=this.renderer.context.extensions.depthTexture;settings.PREFER_ENV===ENV.WEBGL_LEGACY&&(L=null,R=null),L?T.drawBuffers=I=>L.drawBuffersWEBGL(I):(this.hasMRT=!1,T.drawBuffers=()=>{}),R||(this.writeDepthTexture=!1)}else this.msaaSamples=T.getInternalformatParameter(T.RENDERBUFFER,T.RGBA8,T.SAMPLES)}bind(T,L,R=0){const{gl:I}=this;if(T){const F=T.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(T);this.current!==T&&(this.current=T,I.bindFramebuffer(I.FRAMEBUFFER,F.framebuffer)),F.mipLevel!==R&&(T.dirtyId++,T.dirtyFormat++,F.mipLevel=R),F.dirtyId!==T.dirtyId&&(F.dirtyId=T.dirtyId,F.dirtyFormat!==T.dirtyFormat?(F.dirtyFormat=T.dirtyFormat,F.dirtySize=T.dirtySize,this.updateFramebuffer(T,R)):F.dirtySize!==T.dirtySize&&(F.dirtySize=T.dirtySize,this.resizeFramebuffer(T)));for(let D=0;D<T.colorTextures.length;D++){const V=T.colorTextures[D];this.renderer.texture.unbind(V.parentTextureArray||V)}if(T.depthTexture&&this.renderer.texture.unbind(T.depthTexture),L){const D=L.width>>R,V=L.height>>R,q=D/L.width;this.setViewport(L.x*q,L.y*q,D,V)}else{const D=T.width>>R,V=T.height>>R;this.setViewport(0,0,D,V)}}else this.current&&(this.current=null,I.bindFramebuffer(I.FRAMEBUFFER,null)),L?this.setViewport(L.x,L.y,L.width,L.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(T,L,R,I){const F=this.viewport;T=Math.round(T),L=Math.round(L),R=Math.round(R),I=Math.round(I),(F.width!==R||F.height!==I||F.x!==T||F.y!==L)&&(F.x=T,F.y=L,F.width=R,F.height=I,this.gl.viewport(T,L,R,I))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(T,L,R,I,F=BUFFER_BITS.COLOR|BUFFER_BITS.DEPTH){const{gl:D}=this;D.clearColor(T,L,R,I),D.clear(F)}initFramebuffer(T){const{gl:L}=this,R=new GLFramebuffer(L.createFramebuffer());return R.multisample=this.detectSamples(T.multisample),T.glFramebuffers[this.CONTEXT_UID]=R,this.managedFramebuffers.push(T),T.disposeRunner.add(this),R}resizeFramebuffer(T){const{gl:L}=this,R=T.glFramebuffers[this.CONTEXT_UID];if(R.stencil){L.bindRenderbuffer(L.RENDERBUFFER,R.stencil);let D;this.renderer.context.webGLVersion===1?D=L.DEPTH_STENCIL:T.depth&&T.stencil?D=L.DEPTH24_STENCIL8:T.depth?D=L.DEPTH_COMPONENT24:D=L.STENCIL_INDEX8,R.msaaBuffer?L.renderbufferStorageMultisample(L.RENDERBUFFER,R.multisample,D,T.width,T.height):L.renderbufferStorage(L.RENDERBUFFER,D,T.width,T.height)}const I=T.colorTextures;let F=I.length;L.drawBuffers||(F=Math.min(F,1));for(let D=0;D<F;D++){const V=I[D],q=V.parentTextureArray||V;this.renderer.texture.bind(q,0),D===0&&R.msaaBuffer&&(L.bindRenderbuffer(L.RENDERBUFFER,R.msaaBuffer),L.renderbufferStorageMultisample(L.RENDERBUFFER,R.multisample,q._glTextures[this.CONTEXT_UID].internalFormat,T.width,T.height))}T.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(T.depthTexture,0)}updateFramebuffer(T,L){const{gl:R}=this,I=T.glFramebuffers[this.CONTEXT_UID],F=T.colorTextures;let D=F.length;R.drawBuffers||(D=Math.min(D,1)),I.multisample>1&&this.canMultisampleFramebuffer(T)?I.msaaBuffer=I.msaaBuffer||R.createRenderbuffer():I.msaaBuffer&&(R.deleteRenderbuffer(I.msaaBuffer),I.msaaBuffer=null,I.blitFramebuffer&&(I.blitFramebuffer.dispose(),I.blitFramebuffer=null));const V=[];for(let q=0;q<D;q++){const G=F[q],z=G.parentTextureArray||G;this.renderer.texture.bind(z,0),q===0&&I.msaaBuffer?(R.bindRenderbuffer(R.RENDERBUFFER,I.msaaBuffer),R.renderbufferStorageMultisample(R.RENDERBUFFER,I.multisample,z._glTextures[this.CONTEXT_UID].internalFormat,T.width,T.height),R.framebufferRenderbuffer(R.FRAMEBUFFER,R.COLOR_ATTACHMENT0,R.RENDERBUFFER,I.msaaBuffer)):(R.framebufferTexture2D(R.FRAMEBUFFER,R.COLOR_ATTACHMENT0+q,G.target,z._glTextures[this.CONTEXT_UID].texture,L),V.push(R.COLOR_ATTACHMENT0+q))}if(V.length>1&&R.drawBuffers(V),T.depthTexture&&this.writeDepthTexture){const q=T.depthTexture;this.renderer.texture.bind(q,0),R.framebufferTexture2D(R.FRAMEBUFFER,R.DEPTH_ATTACHMENT,R.TEXTURE_2D,q._glTextures[this.CONTEXT_UID].texture,L)}if((T.stencil||T.depth)&&!(T.depthTexture&&this.writeDepthTexture)){I.stencil=I.stencil||R.createRenderbuffer();let q,G;this.renderer.context.webGLVersion===1?(q=R.DEPTH_STENCIL_ATTACHMENT,G=R.DEPTH_STENCIL):T.depth&&T.stencil?(q=R.DEPTH_STENCIL_ATTACHMENT,G=R.DEPTH24_STENCIL8):T.depth?(q=R.DEPTH_ATTACHMENT,G=R.DEPTH_COMPONENT24):(q=R.STENCIL_ATTACHMENT,G=R.STENCIL_INDEX8),R.bindRenderbuffer(R.RENDERBUFFER,I.stencil),I.msaaBuffer?R.renderbufferStorageMultisample(R.RENDERBUFFER,I.multisample,G,T.width,T.height):R.renderbufferStorage(R.RENDERBUFFER,G,T.width,T.height),R.framebufferRenderbuffer(R.FRAMEBUFFER,q,R.RENDERBUFFER,I.stencil)}else I.stencil&&(R.deleteRenderbuffer(I.stencil),I.stencil=null)}canMultisampleFramebuffer(T){return this.renderer.context.webGLVersion!==1&&T.colorTextures.length<=1&&!T.depthTexture}detectSamples(T){const{msaaSamples:L}=this;let R=MSAA_QUALITY.NONE;if(T<=1||L===null)return R;for(let I=0;I<L.length;I++)if(L[I]<=T){R=L[I];break}return R===1&&(R=MSAA_QUALITY.NONE),R}blit(T,L,R){const{current:I,renderer:F,gl:D,CONTEXT_UID:V}=this;if(F.context.webGLVersion!==2||!I)return;const q=I.glFramebuffers[V];if(!q)return;if(!T){if(!q.msaaBuffer)return;const z=I.colorTextures[0];if(!z)return;q.blitFramebuffer||(q.blitFramebuffer=new Framebuffer(I.width,I.height),q.blitFramebuffer.addColorTexture(0,z)),T=q.blitFramebuffer,T.colorTextures[0]!==z&&(T.colorTextures[0]=z,T.dirtyId++,T.dirtyFormat++),(T.width!==I.width||T.height!==I.height)&&(T.width=I.width,T.height=I.height,T.dirtyId++,T.dirtySize++)}L||(L=tempRectangle,L.width=I.width,L.height=I.height),R||(R=L);const G=L.width===R.width&&L.height===R.height;this.bind(T),D.bindFramebuffer(D.READ_FRAMEBUFFER,q.framebuffer),D.blitFramebuffer(L.left,L.top,L.right,L.bottom,R.left,R.top,R.right,R.bottom,D.COLOR_BUFFER_BIT,G?D.NEAREST:D.LINEAR),D.bindFramebuffer(D.READ_FRAMEBUFFER,T.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(T,L){const R=T.glFramebuffers[this.CONTEXT_UID],I=this.gl;if(!R)return;delete T.glFramebuffers[this.CONTEXT_UID];const F=this.managedFramebuffers.indexOf(T);F>=0&&this.managedFramebuffers.splice(F,1),T.disposeRunner.remove(this),L||(I.deleteFramebuffer(R.framebuffer),R.msaaBuffer&&I.deleteRenderbuffer(R.msaaBuffer),R.stencil&&I.deleteRenderbuffer(R.stencil)),R.blitFramebuffer&&this.disposeFramebuffer(R.blitFramebuffer,L)}disposeAll(T){const L=this.managedFramebuffers;this.managedFramebuffers=[];for(let R=0;R<L.length;R++)this.disposeFramebuffer(L[R],T)}forceStencil(){const T=this.current;if(!T)return;const L=T.glFramebuffers[this.CONTEXT_UID];if(!L||L.stencil&&T.stencil)return;T.stencil=!0;const R=T.width,I=T.height,F=this.gl,D=L.stencil=F.createRenderbuffer();F.bindRenderbuffer(F.RENDERBUFFER,D);let V,q;this.renderer.context.webGLVersion===1?(V=F.DEPTH_STENCIL_ATTACHMENT,q=F.DEPTH_STENCIL):T.depth?(V=F.DEPTH_STENCIL_ATTACHMENT,q=F.DEPTH24_STENCIL8):(V=F.STENCIL_ATTACHMENT,q=F.STENCIL_INDEX8),L.msaaBuffer?F.renderbufferStorageMultisample(F.RENDERBUFFER,L.multisample,q,R,I):F.renderbufferStorage(F.RENDERBUFFER,q,R,I),F.framebufferRenderbuffer(F.FRAMEBUFFER,V,F.RENDERBUFFER,D)}reset(){this.current=this.unknownFramebuffer,this.viewport=new Rectangle}destroy(){this.renderer=null}}FramebufferSystem.extension={type:ExtensionType.RendererSystem,name:"framebuffer"};extensions.add(FramebufferSystem);const byteSizeMap={5126:4,5123:2,5121:1};class GeometrySystem{constructor(T){this.renderer=T,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const T=this.gl=this.renderer.gl,L=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,L.webGLVersion!==2){let R=this.renderer.context.extensions.vertexArrayObject;settings.PREFER_ENV===ENV.WEBGL_LEGACY&&(R=null),R?(T.createVertexArray=()=>R.createVertexArrayOES(),T.bindVertexArray=I=>R.bindVertexArrayOES(I),T.deleteVertexArray=I=>R.deleteVertexArrayOES(I)):(this.hasVao=!1,T.createVertexArray=()=>null,T.bindVertexArray=()=>null,T.deleteVertexArray=()=>null)}if(L.webGLVersion!==2){const R=T.getExtension("ANGLE_instanced_arrays");R?(T.vertexAttribDivisor=(I,F)=>R.vertexAttribDivisorANGLE(I,F),T.drawElementsInstanced=(I,F,D,V,q)=>R.drawElementsInstancedANGLE(I,F,D,V,q),T.drawArraysInstanced=(I,F,D,V)=>R.drawArraysInstancedANGLE(I,F,D,V)):this.hasInstance=!1}this.canUseUInt32ElementIndex=L.webGLVersion===2||!!L.extensions.uint32ElementIndex}bind(T,L){L=L||this.renderer.shader.shader;const{gl:R}=this;let I=T.glVertexArrayObjects[this.CONTEXT_UID],F=!1;I||(this.managedGeometries[T.id]=T,T.disposeRunner.add(this),T.glVertexArrayObjects[this.CONTEXT_UID]=I={},F=!0);const D=I[L.program.id]||this.initGeometryVao(T,L,F);this._activeGeometry=T,this._activeVao!==D&&(this._activeVao=D,this.hasVao?R.bindVertexArray(D):this.activateVao(T,L.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const T=this._activeGeometry,L=this.renderer.buffer;for(let R=0;R<T.buffers.length;R++){const I=T.buffers[R];L.update(I)}}checkCompatibility(T,L){const R=T.attributes,I=L.attributeData;for(const F in I)if(!R[F])throw new Error(`shader and geometry incompatible, geometry missing the "${F}" attribute`)}getSignature(T,L){const R=T.attributes,I=L.attributeData,F=["g",T.id];for(const D in R)I[D]&&F.push(D,I[D].location);return F.join("-")}initGeometryVao(T,L,R=!0){const I=this.gl,F=this.CONTEXT_UID,D=this.renderer.buffer,V=L.program;V.glPrograms[F]||this.renderer.shader.generateProgram(L),this.checkCompatibility(T,V);const q=this.getSignature(T,V),G=T.glVertexArrayObjects[this.CONTEXT_UID];let z=G[q];if(z)return G[V.id]=z,z;const Q=T.buffers,tt=T.attributes,gt={},yt={};for(const Et in Q)gt[Et]=0,yt[Et]=0;for(const Et in tt)!tt[Et].size&&V.attributeData[Et]?tt[Et].size=V.attributeData[Et].size:tt[Et].size||console.warn(`PIXI Geometry attribute '${Et}' size cannot be determined (likely the bound shader does not have the attribute)`),gt[tt[Et].buffer]+=tt[Et].size*byteSizeMap[tt[Et].type];for(const Et in tt){const J=tt[Et],At=J.size;J.stride===void 0&&(gt[J.buffer]===At*byteSizeMap[J.type]?J.stride=0:J.stride=gt[J.buffer]),J.start===void 0&&(J.start=yt[J.buffer],yt[J.buffer]+=At*byteSizeMap[J.type])}z=I.createVertexArray(),I.bindVertexArray(z);for(let Et=0;Et<Q.length;Et++){const J=Q[Et];D.bind(J),R&&J._glBuffers[F].refCount++}return this.activateVao(T,V),G[V.id]=z,G[q]=z,I.bindVertexArray(null),D.unbind(BUFFER_TYPE.ARRAY_BUFFER),z}disposeGeometry(T,L){if(!this.managedGeometries[T.id])return;delete this.managedGeometries[T.id];const R=T.glVertexArrayObjects[this.CONTEXT_UID],I=this.gl,F=T.buffers,D=this.renderer?.buffer;if(T.disposeRunner.remove(this),!!R){if(D)for(let V=0;V<F.length;V++){const q=F[V]._glBuffers[this.CONTEXT_UID];q&&(q.refCount--,q.refCount===0&&!L&&D.dispose(F[V],L))}if(!L){for(const V in R)if(V[0]==="g"){const q=R[V];this._activeVao===q&&this.unbind(),I.deleteVertexArray(q)}}delete T.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(T){const L=Object.keys(this.managedGeometries);for(let R=0;R<L.length;R++)this.disposeGeometry(this.managedGeometries[L[R]],T)}activateVao(T,L){const R=this.gl,I=this.CONTEXT_UID,F=this.renderer.buffer,D=T.buffers,V=T.attributes;T.indexBuffer&&F.bind(T.indexBuffer);let q=null;for(const G in V){const z=V[G],Q=D[z.buffer],tt=Q._glBuffers[I];if(L.attributeData[G]){q!==tt&&(F.bind(Q),q=tt);const gt=L.attributeData[G].location;if(R.enableVertexAttribArray(gt),R.vertexAttribPointer(gt,z.size,z.type||R.FLOAT,z.normalized,z.stride,z.start),z.instance)if(this.hasInstance)R.vertexAttribDivisor(gt,z.divisor);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(T,L,R,I){const{gl:F}=this,D=this._activeGeometry;if(D.indexBuffer){const V=D.indexBuffer.data.BYTES_PER_ELEMENT,q=V===2?F.UNSIGNED_SHORT:F.UNSIGNED_INT;V===2||V===4&&this.canUseUInt32ElementIndex?D.instanced?F.drawElementsInstanced(T,L||D.indexBuffer.data.length,q,(R||0)*V,I||1):F.drawElements(T,L||D.indexBuffer.data.length,q,(R||0)*V):console.warn("unsupported index buffer type: uint32")}else D.instanced?F.drawArraysInstanced(T,R,L||D.getSize(),I||1):F.drawArrays(T,R,L||D.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}GeometrySystem.extension={type:ExtensionType.RendererSystem,name:"geometry"};extensions.add(GeometrySystem);const tempMat=new Matrix;class TextureMatrix{constructor(T,L){this._texture=T,this.mapCoord=new Matrix,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof L>"u"?.5:L,this.isSimple=!1}get texture(){return this._texture}set texture(T){this._texture=T,this._textureID=-1}multiplyUvs(T,L){L===void 0&&(L=T);const R=this.mapCoord;for(let I=0;I<T.length;I+=2){const F=T[I],D=T[I+1];L[I]=F*R.a+D*R.c+R.tx,L[I+1]=F*R.b+D*R.d+R.ty}return L}update(T){const L=this._texture;if(!L||!L.valid||!T&&this._textureID===L._updateID)return!1;this._textureID=L._updateID,this._updateID++;const R=L._uvs;this.mapCoord.set(R.x1-R.x0,R.y1-R.y0,R.x3-R.x0,R.y3-R.y0,R.x0,R.y0);const I=L.orig,F=L.trim;F&&(tempMat.set(I.width/F.width,0,0,I.height/F.height,-F.x/F.width,-F.y/F.height),this.mapCoord.append(tempMat));const D=L.baseTexture,V=this.uClampFrame,q=this.clampMargin/D.resolution,G=this.clampOffset;return V[0]=(L._frame.x+q+G)/D.width,V[1]=(L._frame.y+q+G)/D.height,V[2]=(L._frame.x+L._frame.width-q+G)/D.width,V[3]=(L._frame.y+L._frame.height-q+G)/D.height,this.uClampOffset[0]=G/D.realWidth,this.uClampOffset[1]=G/D.realHeight,this.isSimple=L._frame.width===D.width&&L._frame.height===D.height&&L.rotate===0,!0}}var fragment$1=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`,vertex=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`;class SpriteMaskFilter extends Filter{constructor(T,L,R){let I=null;typeof T!="string"&&L===void 0&&R===void 0&&(I=T,T=void 0,L=void 0,R=void 0),super(T||vertex,L||fragment$1,R),this.maskSprite=I,this.maskMatrix=new Matrix}get maskSprite(){return this._maskSprite}set maskSprite(T){this._maskSprite=T,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(T,L,R,I){const F=this._maskSprite,D=F._texture;D.valid&&(D.uvMatrix||(D.uvMatrix=new TextureMatrix(D,0)),D.uvMatrix.update(),this.uniforms.npmAlpha=D.baseTexture.alphaMode?0:1,this.uniforms.mask=D,this.uniforms.otherMatrix=T.calculateSpriteMatrix(this.maskMatrix,F).prepend(D.uvMatrix.mapCoord),this.uniforms.alpha=F.worldAlpha,this.uniforms.maskClamp=D.uvMatrix.uClampFrame,T.applyFilter(this,L,R,I))}}class MaskData{constructor(T=null){this.type=MASK_TYPES.NONE,this.autoDetect=!0,this.maskObject=T||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=Filter.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(T){T?this._filters?this._filters[0]=T:this._filters=[T]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=MASK_TYPES.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(T){T?(this._stencilCounter=T._stencilCounter,this._scissorCounter=T._scissorCounter,this._scissorRect=T._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class MaskSystem{constructor(T){this.renderer=T,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(T){this.maskStack=T,this.renderer.scissor.setMaskStack(T),this.renderer.stencil.setMaskStack(T)}push(T,L){let R=L;if(!R.isMaskData){const F=this.maskDataPool.pop()||new MaskData;F.pooled=!0,F.maskObject=L,R=F}const I=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(R.copyCountersOrReset(I),R._colorMask=I?I._colorMask:15,R.autoDetect&&this.detect(R),R._target=T,R.type!==MASK_TYPES.SPRITE&&this.maskStack.push(R),R.enabled)switch(R.type){case MASK_TYPES.SCISSOR:this.renderer.scissor.push(R);break;case MASK_TYPES.STENCIL:this.renderer.stencil.push(R);break;case MASK_TYPES.SPRITE:R.copyCountersOrReset(null),this.pushSpriteMask(R);break;case MASK_TYPES.COLOR:this.pushColorMask(R);break}R.type===MASK_TYPES.SPRITE&&this.maskStack.push(R)}pop(T){const L=this.maskStack.pop();if(!(!L||L._target!==T)){if(L.enabled)switch(L.type){case MASK_TYPES.SCISSOR:this.renderer.scissor.pop(L);break;case MASK_TYPES.STENCIL:this.renderer.stencil.pop(L.maskObject);break;case MASK_TYPES.SPRITE:this.popSpriteMask(L);break;case MASK_TYPES.COLOR:this.popColorMask(L);break}if(L.reset(),L.pooled&&this.maskDataPool.push(L),this.maskStack.length!==0){const R=this.maskStack[this.maskStack.length-1];R.type===MASK_TYPES.SPRITE&&R._filters&&(R._filters[0].maskSprite=R.maskObject)}}}detect(T){const L=T.maskObject;L?L.isSprite?T.type=MASK_TYPES.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(T)?T.type=MASK_TYPES.SCISSOR:T.type=MASK_TYPES.STENCIL:T.type=MASK_TYPES.COLOR}pushSpriteMask(T){const{maskObject:L}=T,R=T._target;let I=T._filters;I||(I=this.alphaMaskPool[this.alphaMaskIndex],I||(I=this.alphaMaskPool[this.alphaMaskIndex]=[new SpriteMaskFilter])),I[0].resolution=T.resolution,I[0].multisample=T.multisample,I[0].maskSprite=L;const F=R.filterArea;R.filterArea=L.getBounds(!0),this.renderer.filter.push(R,I),R.filterArea=F,T._filters||this.alphaMaskIndex++}popSpriteMask(T){this.renderer.filter.pop(),T._filters?T._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(T){const L=T._colorMask,R=T._colorMask=L&T.colorMask;R!==L&&this.renderer.gl.colorMask((R&1)!==0,(R&2)!==0,(R&4)!==0,(R&8)!==0)}popColorMask(T){const L=T._colorMask,R=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;R!==L&&this.renderer.gl.colorMask((R&1)!==0,(R&2)!==0,(R&4)!==0,(R&8)!==0)}destroy(){this.renderer=null}}MaskSystem.extension={type:ExtensionType.RendererSystem,name:"mask"};extensions.add(MaskSystem);class AbstractMaskSystem{constructor(T){this.renderer=T,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(T){const{gl:L}=this.renderer,R=this.getStackLength();this.maskStack=T;const I=this.getStackLength();I!==R&&(I===0?L.disable(this.glConst):(L.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const tempMatrix$1=new Matrix,rectPool=[],_ScissorSystem=class Gs extends AbstractMaskSystem{constructor(T){super(T),this.glConst=settings.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const T=this.maskStack[this.maskStack.length-1];return T?T._scissorCounter:0}calcScissorRect(T){if(T._scissorRectLocal)return;const L=T._scissorRect,{maskObject:R}=T,{renderer:I}=this,F=I.renderTexture,D=R.getBounds(!0,rectPool.pop()??new Rectangle);this.roundFrameToPixels(D,F.current?F.current.resolution:I.resolution,F.sourceFrame,F.destinationFrame,I.projection.transform),L&&D.fit(L),T._scissorRectLocal=D}static isMatrixRotated(T){if(!T)return!1;const{a:L,b:R,c:I,d:F}=T;return(Math.abs(R)>1e-4||Math.abs(I)>1e-4)&&(Math.abs(L)>1e-4||Math.abs(F)>1e-4)}testScissor(T){const{maskObject:L}=T;if(!L.isFastRect||!L.isFastRect()||Gs.isMatrixRotated(L.worldTransform)||Gs.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(T);const R=T._scissorRectLocal;return R.width>0&&R.height>0}roundFrameToPixels(T,L,R,I,F){Gs.isMatrixRotated(F)||(F=F?tempMatrix$1.copyFrom(F):tempMatrix$1.identity(),F.translate(-R.x,-R.y).scale(I.width/R.width,I.height/R.height).translate(I.x,I.y),this.renderer.filter.transformAABB(F,T),T.fit(I),T.x=Math.round(T.x*L),T.y=Math.round(T.y*L),T.width=Math.round(T.width*L),T.height=Math.round(T.height*L))}push(T){T._scissorRectLocal||this.calcScissorRect(T);const{gl:L}=this.renderer;T._scissorRect||L.enable(L.SCISSOR_TEST),T._scissorCounter++,T._scissorRect=T._scissorRectLocal,this._useCurrent()}pop(T){const{gl:L}=this.renderer;T&&rectPool.push(T._scissorRectLocal),this.getStackLength()>0?this._useCurrent():L.disable(L.SCISSOR_TEST)}_useCurrent(){const T=this.maskStack[this.maskStack.length-1]._scissorRect;let L;this.renderer.renderTexture.current?L=T.y:L=this.renderer.height-T.height-T.y,this.renderer.gl.scissor(T.x,L,T.width,T.height)}};_ScissorSystem.extension={type:ExtensionType.RendererSystem,name:"scissor"};let ScissorSystem=_ScissorSystem;extensions.add(ScissorSystem);class StencilSystem extends AbstractMaskSystem{constructor(T){super(T),this.glConst=settings.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const T=this.maskStack[this.maskStack.length-1];return T?T._stencilCounter:0}push(T){const L=T.maskObject,{gl:R}=this.renderer,I=T._stencilCounter;I===0&&(this.renderer.framebuffer.forceStencil(),R.clearStencil(0),R.clear(R.STENCIL_BUFFER_BIT),R.enable(R.STENCIL_TEST)),T._stencilCounter++;const F=T._colorMask;F!==0&&(T._colorMask=0,R.colorMask(!1,!1,!1,!1)),R.stencilFunc(R.EQUAL,I,4294967295),R.stencilOp(R.KEEP,R.KEEP,R.INCR),L.renderable=!0,L.render(this.renderer),this.renderer.batch.flush(),L.renderable=!1,F!==0&&(T._colorMask=F,R.colorMask((F&1)!==0,(F&2)!==0,(F&4)!==0,(F&8)!==0)),this._useCurrent()}pop(T){const L=this.renderer.gl;if(this.getStackLength()===0)L.disable(L.STENCIL_TEST);else{const R=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,I=R?R._colorMask:15;I!==0&&(R._colorMask=0,L.colorMask(!1,!1,!1,!1)),L.stencilOp(L.KEEP,L.KEEP,L.DECR),T.renderable=!0,T.render(this.renderer),this.renderer.batch.flush(),T.renderable=!1,I!==0&&(R._colorMask=I,L.colorMask((I&1)!==0,(I&2)!==0,(I&4)!==0,(I&8)!==0)),this._useCurrent()}}_useCurrent(){const T=this.renderer.gl;T.stencilFunc(T.EQUAL,this.getStackLength(),4294967295),T.stencilOp(T.KEEP,T.KEEP,T.KEEP)}}StencilSystem.extension={type:ExtensionType.RendererSystem,name:"stencil"};extensions.add(StencilSystem);class PluginSystem{constructor(T){this.renderer=T,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get(){return deprecation("7.0.0","renderer.plugins.extract has moved to renderer.extract"),T.extract}},prepare:{enumerable:!1,get(){return deprecation("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),T.prepare}},interaction:{enumerable:!1,get(){return deprecation("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),T.events}}})}init(){const T=this.rendererPlugins;for(const L in T)this.plugins[L]=new T[L](this.renderer)}destroy(){for(const T in this.plugins)this.plugins[T].destroy(),this.plugins[T]=null}}PluginSystem.extension={type:[ExtensionType.RendererSystem,ExtensionType.CanvasRendererSystem],name:"_plugin"};extensions.add(PluginSystem);class ProjectionSystem{constructor(T){this.renderer=T,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new Matrix,this.transform=null}update(T,L,R,I){this.destinationFrame=T||this.destinationFrame||this.defaultFrame,this.sourceFrame=L||this.sourceFrame||T,this.calculateProjection(this.destinationFrame,this.sourceFrame,R,I),this.transform&&this.projectionMatrix.append(this.transform);const F=this.renderer;F.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,F.globalUniforms.update(),F.shader.shader&&F.shader.syncUniformGroup(F.shader.shader.uniforms.globals)}calculateProjection(T,L,R,I){const F=this.projectionMatrix,D=I?-1:1;F.identity(),F.a=1/L.width*2,F.d=D*(1/L.height*2),F.tx=-1-L.x*F.a,F.ty=-D-L.y*F.d}setTransform(T){}destroy(){this.renderer=null}}ProjectionSystem.extension={type:ExtensionType.RendererSystem,name:"projection"};extensions.add(ProjectionSystem);const tempTransform=new Transform,tempRect$1=new Rectangle;class GenerateTextureSystem{constructor(T){this.renderer=T,this._tempMatrix=new Matrix}generateTexture(T,L){const{region:R,...I}=L||{},F=R?.copyTo(tempRect$1)||T.getLocalBounds(tempRect$1,!0),D=I.resolution||this.renderer.resolution;F.width=Math.max(F.width,1/D),F.height=Math.max(F.height,1/D),I.width=F.width,I.height=F.height,I.resolution=D,I.multisample??(I.multisample=this.renderer.multisample);const V=RenderTexture.create(I);this._tempMatrix.tx=-F.x,this._tempMatrix.ty=-F.y;const q=T.transform;return T.transform=tempTransform,this.renderer.render(T,{renderTexture:V,transform:this._tempMatrix,skipUpdateTransform:!!T.parent,blit:!0}),T.transform=q,V}destroy(){}}GenerateTextureSystem.extension={type:[ExtensionType.RendererSystem,ExtensionType.CanvasRendererSystem],name:"textureGenerator"};extensions.add(GenerateTextureSystem);const tempRect=new Rectangle,tempRect2=new Rectangle;class RenderTextureSystem{constructor(T){this.renderer=T,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new Rectangle,this.destinationFrame=new Rectangle,this.viewportFrame=new Rectangle}contextChange(){const T=this.renderer?.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(T&&T.alpha&&T.premultipliedAlpha)}bind(T=null,L,R){const I=this.renderer;this.current=T;let F,D,V;T?(F=T.baseTexture,V=F.resolution,L||(tempRect.width=T.frame.width,tempRect.height=T.frame.height,L=tempRect),R||(tempRect2.x=T.frame.x,tempRect2.y=T.frame.y,tempRect2.width=L.width,tempRect2.height=L.height,R=tempRect2),D=F.framebuffer):(V=I.resolution,L||(tempRect.width=I._view.screen.width,tempRect.height=I._view.screen.height,L=tempRect),R||(R=tempRect,R.width=L.width,R.height=L.height));const q=this.viewportFrame;q.x=R.x*V,q.y=R.y*V,q.width=R.width*V,q.height=R.height*V,T||(q.y=I.view.height-(q.y+q.height)),q.ceil(),this.renderer.framebuffer.bind(D,q),this.renderer.projection.update(R,L,V,!D),T?this.renderer.mask.setMaskStack(F.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(L),this.destinationFrame.copyFrom(R)}clear(T,L){const R=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,I=Color.shared.setValue(T||R);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&I.premultiply(I.alpha);const F=this.destinationFrame,D=this.current?this.current.baseTexture:this.renderer._view.screen,V=F.width!==D.width||F.height!==D.height;if(V){let{x:q,y:G,width:z,height:Q}=this.viewportFrame;q=Math.round(q),G=Math.round(G),z=Math.round(z),Q=Math.round(Q),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(q,G,z,Q)}this.renderer.framebuffer.clear(I.red,I.green,I.blue,I.alpha,L),V&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}RenderTextureSystem.extension={type:ExtensionType.RendererSystem,name:"renderTexture"};extensions.add(RenderTextureSystem);class GLProgram{constructor(T,L){this.program=T,this.uniformData=L,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function getAttributeData(P,T){const L={},R=T.getProgramParameter(P,T.ACTIVE_ATTRIBUTES);for(let I=0;I<R;I++){const F=T.getActiveAttrib(P,I);if(F.name.startsWith("gl_"))continue;const D=mapType(T,F.type),V={type:D,name:F.name,size:mapSize(D),location:T.getAttribLocation(P,F.name)};L[F.name]=V}return L}function getUniformData(P,T){const L={},R=T.getProgramParameter(P,T.ACTIVE_UNIFORMS);for(let I=0;I<R;I++){const F=T.getActiveUniform(P,I),D=F.name.replace(/\[.*?\]$/,""),V=!!F.name.match(/\[.*?\]$/),q=mapType(T,F.type);L[D]={name:D,index:I,type:q,size:F.size,isArray:V,value:defaultValue(q,F.size)}}return L}function generateProgram(P,T){const L=compileShader(P,P.VERTEX_SHADER,T.vertexSrc),R=compileShader(P,P.FRAGMENT_SHADER,T.fragmentSrc),I=P.createProgram();P.attachShader(I,L),P.attachShader(I,R);const F=T.extra?.transformFeedbackVaryings;if(F&&(typeof P.transformFeedbackVaryings!="function"?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):P.transformFeedbackVaryings(I,F.names,F.bufferMode==="separate"?P.SEPARATE_ATTRIBS:P.INTERLEAVED_ATTRIBS)),P.linkProgram(I),P.getProgramParameter(I,P.LINK_STATUS)||logProgramError(P,I,L,R),T.attributeData=getAttributeData(I,P),T.uniformData=getUniformData(I,P),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(T.vertexSrc)){const V=Object.keys(T.attributeData);V.sort((q,G)=>q>G?1:-1);for(let q=0;q<V.length;q++)T.attributeData[V[q]].location=q,P.bindAttribLocation(I,q,V[q]);P.linkProgram(I)}P.deleteShader(L),P.deleteShader(R);const D={};for(const V in T.uniformData){const q=T.uniformData[V];D[V]={location:P.getUniformLocation(I,V),value:defaultValue(q.type,q.size)}}return new GLProgram(I,D)}function uboUpdate(P,T,L,R,I){L.buffer.update(I)}const UBO_TO_SINGLE_SETTERS={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},GLSL_TO_STD40_SIZE={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:32,mat3:48,mat4:64};function createUBOElements(P){const T=P.map(F=>({data:F,offset:0,dataLen:0,dirty:0}));let L=0,R=0,I=0;for(let F=0;F<T.length;F++){const D=T[F];if(L=GLSL_TO_STD40_SIZE[D.data.type],D.data.size>1&&(L=Math.max(L,16)*D.data.size),D.dataLen=L,R%L!==0&&R<16){const V=R%L%16;R+=V,I+=V}R+L>16?(I=Math.ceil(I/16)*16,D.offset=I,I+=L,R=L):(D.offset=I,R+=L,I+=L)}return I=Math.ceil(I/16)*16,{uboElements:T,size:I}}function getUBOData(P,T){const L=[];for(const R in P)T[R]&&L.push(T[R]);return L.sort((R,I)=>R.index-I.index),L}function generateUniformBufferSync(P,T){if(!P.autoManage)return{size:0,syncFunc:uboUpdate};const L=getUBOData(P.uniforms,T),{uboElements:R,size:I}=createUBOElements(L),F=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let D=0;D<R.length;D++){const V=R[D],q=P.uniforms[V.data.name],G=V.data.name;let z=!1;for(let Q=0;Q<uniformParsers.length;Q++){const tt=uniformParsers[Q];if(tt.codeUbo&&tt.test(V.data,q)){F.push(`offset = ${V.offset/4};`,uniformParsers[Q].codeUbo(V.data.name,q)),z=!0;break}}if(!z)if(V.data.size>1){const Q=mapSize(V.data.type),tt=Math.max(GLSL_TO_STD40_SIZE[V.data.type]/16,1),gt=Q/tt,yt=(4-gt%4)%4;F.push(`
                cv = ud.${G}.value;
                v = uv.${G};
                offset = ${V.offset/4};

                t = 0;

                for(var i=0; i < ${V.data.size*tt}; i++)
                {
                    for(var j = 0; j < ${gt}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${yt};
                }

                `)}else{const Q=UBO_TO_SINGLE_SETTERS[V.data.type];F.push(`
                cv = ud.${G}.value;
                v = uv.${G};
                offset = ${V.offset/4};
                ${Q};
                `)}}return F.push(`
       renderer.buffer.update(buffer);
    `),{size:I,syncFunc:new Function("ud","uv","renderer","syncData","buffer",F.join(`
`))}}let UID=0;const defaultSyncData={textureCount:0,uboCount:0};class ShaderSystem{constructor(T){this.destroyed=!1,this.renderer=T,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=UID++}systemCheck(){if(!unsafeEvalSupported())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(T){this.gl=T,this.reset()}bind(T,L){T.disposeRunner.add(this),T.uniforms.globals=this.renderer.globalUniforms;const R=T.program,I=R.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(T);return this.shader=T,this.program!==R&&(this.program=R,this.gl.useProgram(I.program)),L||(defaultSyncData.textureCount=0,defaultSyncData.uboCount=0,this.syncUniformGroup(T.uniformGroup,defaultSyncData)),I}setUniforms(T){const L=this.shader.program,R=L.glPrograms[this.renderer.CONTEXT_UID];L.syncUniforms(R.uniformData,T,this.renderer)}syncUniformGroup(T,L){const R=this.getGlProgram();(!T.static||T.dirtyId!==R.uniformDirtyGroups[T.id])&&(R.uniformDirtyGroups[T.id]=T.dirtyId,this.syncUniforms(T,R,L))}syncUniforms(T,L,R){(T.syncUniforms[this.shader.program.id]||this.createSyncGroups(T))(L.uniformData,T.uniforms,this.renderer,R)}createSyncGroups(T){const L=this.getSignature(T,this.shader.program.uniformData,"u");return this.cache[L]||(this.cache[L]=generateUniformsSync(T,this.shader.program.uniformData)),T.syncUniforms[this.shader.program.id]=this.cache[L],T.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(T,L){const R=this.getGlProgram();if(!T.static||T.dirtyId!==0||!R.uniformGroups[T.id]){T.dirtyId=0;const I=R.uniformGroups[T.id]||this.createSyncBufferGroup(T,R,L);T.buffer.update(),I(R.uniformData,T.uniforms,this.renderer,defaultSyncData,T.buffer)}this.renderer.buffer.bindBufferBase(T.buffer,R.uniformBufferBindings[L])}createSyncBufferGroup(T,L,R){const{gl:I}=this.renderer;this.renderer.buffer.bind(T.buffer);const F=this.gl.getUniformBlockIndex(L.program,R);L.uniformBufferBindings[R]=this.shader.uniformBindCount,I.uniformBlockBinding(L.program,F,this.shader.uniformBindCount),this.shader.uniformBindCount++;const D=this.getSignature(T,this.shader.program.uniformData,"ubo");let V=this._uboCache[D];if(V||(V=this._uboCache[D]=generateUniformBufferSync(T,this.shader.program.uniformData)),T.autoManage){const q=new Float32Array(V.size/4);T.buffer.update(q)}return L.uniformGroups[T.id]=V.syncFunc,L.uniformGroups[T.id]}getSignature(T,L,R){const I=T.uniforms,F=[`${R}-`];for(const D in I)F.push(D),L[D]&&F.push(L[D].type);return F.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(T){const L=this.gl,R=T.program,I=generateProgram(L,R);return R.glPrograms[this.renderer.CONTEXT_UID]=I,I}reset(){this.program=null,this.shader=null}disposeShader(T){this.shader===T&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}ShaderSystem.extension={type:ExtensionType.RendererSystem,name:"shader"};extensions.add(ShaderSystem);class StartupSystem{constructor(T){this.renderer=T}run(T){const{renderer:L}=this;L.runners.init.emit(L.options),T.hello&&console.log(`PixiJS 7.4.3 - ${L.rendererLogId} - https://pixijs.com`),L.resize(L.screen.width,L.screen.height)}destroy(){}}StartupSystem.defaultOptions={hello:!1},StartupSystem.extension={type:[ExtensionType.RendererSystem,ExtensionType.CanvasRendererSystem],name:"startup"};extensions.add(StartupSystem);function mapWebGLBlendModesToPixi(P,T=[]){return T[BLEND_MODES.NORMAL]=[P.ONE,P.ONE_MINUS_SRC_ALPHA],T[BLEND_MODES.ADD]=[P.ONE,P.ONE],T[BLEND_MODES.MULTIPLY]=[P.DST_COLOR,P.ONE_MINUS_SRC_ALPHA,P.ONE,P.ONE_MINUS_SRC_ALPHA],T[BLEND_MODES.SCREEN]=[P.ONE,P.ONE_MINUS_SRC_COLOR,P.ONE,P.ONE_MINUS_SRC_ALPHA],T[BLEND_MODES.OVERLAY]=[P.ONE,P.ONE_MINUS_SRC_ALPHA],T[BLEND_MODES.DARKEN]=[P.ONE,P.ONE_MINUS_SRC_ALPHA],T[BLEND_MODES.LIGHTEN]=[P.ONE,P.ONE_MINUS_SRC_ALPHA],T[BLEND_MODES.COLOR_DODGE]=[P.ONE,P.ONE_MINUS_SRC_ALPHA],T[BLEND_MODES.COLOR_BURN]=[P.ONE,P.ONE_MINUS_SRC_ALPHA],T[BLEND_MODES.HARD_LIGHT]=[P.ONE,P.ONE_MINUS_SRC_ALPHA],T[BLEND_MODES.SOFT_LIGHT]=[P.ONE,P.ONE_MINUS_SRC_ALPHA],T[BLEND_MODES.DIFFERENCE]=[P.ONE,P.ONE_MINUS_SRC_ALPHA],T[BLEND_MODES.EXCLUSION]=[P.ONE,P.ONE_MINUS_SRC_ALPHA],T[BLEND_MODES.HUE]=[P.ONE,P.ONE_MINUS_SRC_ALPHA],T[BLEND_MODES.SATURATION]=[P.ONE,P.ONE_MINUS_SRC_ALPHA],T[BLEND_MODES.COLOR]=[P.ONE,P.ONE_MINUS_SRC_ALPHA],T[BLEND_MODES.LUMINOSITY]=[P.ONE,P.ONE_MINUS_SRC_ALPHA],T[BLEND_MODES.NONE]=[0,0],T[BLEND_MODES.NORMAL_NPM]=[P.SRC_ALPHA,P.ONE_MINUS_SRC_ALPHA,P.ONE,P.ONE_MINUS_SRC_ALPHA],T[BLEND_MODES.ADD_NPM]=[P.SRC_ALPHA,P.ONE,P.ONE,P.ONE],T[BLEND_MODES.SCREEN_NPM]=[P.SRC_ALPHA,P.ONE_MINUS_SRC_COLOR,P.ONE,P.ONE_MINUS_SRC_ALPHA],T[BLEND_MODES.SRC_IN]=[P.DST_ALPHA,P.ZERO],T[BLEND_MODES.SRC_OUT]=[P.ONE_MINUS_DST_ALPHA,P.ZERO],T[BLEND_MODES.SRC_ATOP]=[P.DST_ALPHA,P.ONE_MINUS_SRC_ALPHA],T[BLEND_MODES.DST_OVER]=[P.ONE_MINUS_DST_ALPHA,P.ONE],T[BLEND_MODES.DST_IN]=[P.ZERO,P.SRC_ALPHA],T[BLEND_MODES.DST_OUT]=[P.ZERO,P.ONE_MINUS_SRC_ALPHA],T[BLEND_MODES.DST_ATOP]=[P.ONE_MINUS_DST_ALPHA,P.SRC_ALPHA],T[BLEND_MODES.XOR]=[P.ONE_MINUS_DST_ALPHA,P.ONE_MINUS_SRC_ALPHA],T[BLEND_MODES.SUBTRACT]=[P.ONE,P.ONE,P.ONE,P.ONE,P.FUNC_REVERSE_SUBTRACT,P.FUNC_ADD],T}const BLEND=0,OFFSET=1,CULLING=2,DEPTH_TEST=3,WINDING=4,DEPTH_MASK=5,_StateSystem=class ir{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=BLEND_MODES.NONE,this._blendEq=!1,this.map=[],this.map[BLEND]=this.setBlend,this.map[OFFSET]=this.setOffset,this.map[CULLING]=this.setCullFace,this.map[DEPTH_TEST]=this.setDepthTest,this.map[WINDING]=this.setFrontFace,this.map[DEPTH_MASK]=this.setDepthMask,this.checks=[],this.defaultState=new State,this.defaultState.blend=!0}contextChange(T){this.gl=T,this.blendModes=mapWebGLBlendModesToPixi(T),this.set(this.defaultState),this.reset()}set(T){if(T=T||this.defaultState,this.stateId!==T.data){let L=this.stateId^T.data,R=0;for(;L;)L&1&&this.map[R].call(this,!!(T.data&1<<R)),L=L>>1,R++;this.stateId=T.data}for(let L=0;L<this.checks.length;L++)this.checks[L](this,T)}forceState(T){T=T||this.defaultState;for(let L=0;L<this.map.length;L++)this.map[L].call(this,!!(T.data&1<<L));for(let L=0;L<this.checks.length;L++)this.checks[L](this,T);this.stateId=T.data}setBlend(T){this.updateCheck(ir.checkBlendMode,T),this.gl[T?"enable":"disable"](this.gl.BLEND)}setOffset(T){this.updateCheck(ir.checkPolygonOffset,T),this.gl[T?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(T){this.gl[T?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(T){this.gl.depthMask(T)}setCullFace(T){this.gl[T?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(T){this.gl.frontFace(this.gl[T?"CW":"CCW"])}setBlendMode(T){if(T===this.blendMode)return;this.blendMode=T;const L=this.blendModes[T],R=this.gl;L.length===2?R.blendFunc(L[0],L[1]):R.blendFuncSeparate(L[0],L[1],L[2],L[3]),L.length===6?(this._blendEq=!0,R.blendEquationSeparate(L[4],L[5])):this._blendEq&&(this._blendEq=!1,R.blendEquationSeparate(R.FUNC_ADD,R.FUNC_ADD))}setPolygonOffset(T,L){this.gl.polygonOffset(T,L)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(T,L){const R=this.checks.indexOf(T);L&&R===-1?this.checks.push(T):!L&&R!==-1&&this.checks.splice(R,1)}static checkBlendMode(T,L){T.setBlendMode(L.blendMode)}static checkPolygonOffset(T,L){T.setPolygonOffset(1,L.polygonOffset)}destroy(){this.gl=null}};_StateSystem.extension={type:ExtensionType.RendererSystem,name:"state"};let StateSystem=_StateSystem;extensions.add(StateSystem);class SystemManager extends EventEmitter{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(T){this.addRunners(...T.runners);const L=(T.priority??[]).filter(I=>T.systems[I]),R=[...L,...Object.keys(T.systems).filter(I=>!L.includes(I))];for(const I of R)this.addSystem(T.systems[I],I)}addRunners(...T){T.forEach(L=>{this.runners[L]=new Runner(L)})}addSystem(T,L){const R=new T(this);if(this[L])throw new Error(`Whoops! The name "${L}" is already in use`);this[L]=R,this._systemsHash[L]=R;for(const I in this.runners)this.runners[I].add(R);return this}emitWithCustomOptions(T,L){const R=Object.keys(this._systemsHash);T.items.forEach(I=>{const F=R.find(D=>this._systemsHash[D]===I);I[T.name](L[F])})}destroy(){Object.values(this.runners).forEach(T=>{T.destroy()}),this._systemsHash={}}}const _TextureGCSystem=class Ys{constructor(T){this.renderer=T,this.count=0,this.checkCount=0,this.maxIdle=Ys.defaultMaxIdle,this.checkCountMax=Ys.defaultCheckCountMax,this.mode=Ys.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==GC_MODES.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const T=this.renderer.texture,L=T.managedTextures;let R=!1;for(let I=0;I<L.length;I++){const F=L[I];F.resource&&this.count-F.touched>this.maxIdle&&(T.destroyTexture(F,!0),L[I]=null,R=!0)}if(R){let I=0;for(let F=0;F<L.length;F++)L[F]!==null&&(L[I++]=L[F]);L.length=I}}unload(T){const L=this.renderer.texture,R=T._texture;R&&!R.framebuffer&&L.destroyTexture(R);for(let I=T.children.length-1;I>=0;I--)this.unload(T.children[I])}destroy(){this.renderer=null}};_TextureGCSystem.defaultMode=GC_MODES.AUTO,_TextureGCSystem.defaultMaxIdle=3600,_TextureGCSystem.defaultCheckCountMax=600,_TextureGCSystem.extension={type:ExtensionType.RendererSystem,name:"textureGC"};let TextureGCSystem=_TextureGCSystem;extensions.add(TextureGCSystem);class GLTexture{constructor(T){this.texture=T,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=TYPES.UNSIGNED_BYTE,this.internalFormat=FORMATS.RGBA,this.samplerType=0}}function mapInternalFormatToSamplerType(P){let T;return"WebGL2RenderingContext"in globalThis&&P instanceof globalThis.WebGL2RenderingContext?T={[P.RGB]:SAMPLER_TYPES.FLOAT,[P.RGBA]:SAMPLER_TYPES.FLOAT,[P.ALPHA]:SAMPLER_TYPES.FLOAT,[P.LUMINANCE]:SAMPLER_TYPES.FLOAT,[P.LUMINANCE_ALPHA]:SAMPLER_TYPES.FLOAT,[P.R8]:SAMPLER_TYPES.FLOAT,[P.R8_SNORM]:SAMPLER_TYPES.FLOAT,[P.RG8]:SAMPLER_TYPES.FLOAT,[P.RG8_SNORM]:SAMPLER_TYPES.FLOAT,[P.RGB8]:SAMPLER_TYPES.FLOAT,[P.RGB8_SNORM]:SAMPLER_TYPES.FLOAT,[P.RGB565]:SAMPLER_TYPES.FLOAT,[P.RGBA4]:SAMPLER_TYPES.FLOAT,[P.RGB5_A1]:SAMPLER_TYPES.FLOAT,[P.RGBA8]:SAMPLER_TYPES.FLOAT,[P.RGBA8_SNORM]:SAMPLER_TYPES.FLOAT,[P.RGB10_A2]:SAMPLER_TYPES.FLOAT,[P.RGB10_A2UI]:SAMPLER_TYPES.FLOAT,[P.SRGB8]:SAMPLER_TYPES.FLOAT,[P.SRGB8_ALPHA8]:SAMPLER_TYPES.FLOAT,[P.R16F]:SAMPLER_TYPES.FLOAT,[P.RG16F]:SAMPLER_TYPES.FLOAT,[P.RGB16F]:SAMPLER_TYPES.FLOAT,[P.RGBA16F]:SAMPLER_TYPES.FLOAT,[P.R32F]:SAMPLER_TYPES.FLOAT,[P.RG32F]:SAMPLER_TYPES.FLOAT,[P.RGB32F]:SAMPLER_TYPES.FLOAT,[P.RGBA32F]:SAMPLER_TYPES.FLOAT,[P.R11F_G11F_B10F]:SAMPLER_TYPES.FLOAT,[P.RGB9_E5]:SAMPLER_TYPES.FLOAT,[P.R8I]:SAMPLER_TYPES.INT,[P.R8UI]:SAMPLER_TYPES.UINT,[P.R16I]:SAMPLER_TYPES.INT,[P.R16UI]:SAMPLER_TYPES.UINT,[P.R32I]:SAMPLER_TYPES.INT,[P.R32UI]:SAMPLER_TYPES.UINT,[P.RG8I]:SAMPLER_TYPES.INT,[P.RG8UI]:SAMPLER_TYPES.UINT,[P.RG16I]:SAMPLER_TYPES.INT,[P.RG16UI]:SAMPLER_TYPES.UINT,[P.RG32I]:SAMPLER_TYPES.INT,[P.RG32UI]:SAMPLER_TYPES.UINT,[P.RGB8I]:SAMPLER_TYPES.INT,[P.RGB8UI]:SAMPLER_TYPES.UINT,[P.RGB16I]:SAMPLER_TYPES.INT,[P.RGB16UI]:SAMPLER_TYPES.UINT,[P.RGB32I]:SAMPLER_TYPES.INT,[P.RGB32UI]:SAMPLER_TYPES.UINT,[P.RGBA8I]:SAMPLER_TYPES.INT,[P.RGBA8UI]:SAMPLER_TYPES.UINT,[P.RGBA16I]:SAMPLER_TYPES.INT,[P.RGBA16UI]:SAMPLER_TYPES.UINT,[P.RGBA32I]:SAMPLER_TYPES.INT,[P.RGBA32UI]:SAMPLER_TYPES.UINT,[P.DEPTH_COMPONENT16]:SAMPLER_TYPES.FLOAT,[P.DEPTH_COMPONENT24]:SAMPLER_TYPES.FLOAT,[P.DEPTH_COMPONENT32F]:SAMPLER_TYPES.FLOAT,[P.DEPTH_STENCIL]:SAMPLER_TYPES.FLOAT,[P.DEPTH24_STENCIL8]:SAMPLER_TYPES.FLOAT,[P.DEPTH32F_STENCIL8]:SAMPLER_TYPES.FLOAT}:T={[P.RGB]:SAMPLER_TYPES.FLOAT,[P.RGBA]:SAMPLER_TYPES.FLOAT,[P.ALPHA]:SAMPLER_TYPES.FLOAT,[P.LUMINANCE]:SAMPLER_TYPES.FLOAT,[P.LUMINANCE_ALPHA]:SAMPLER_TYPES.FLOAT,[P.DEPTH_STENCIL]:SAMPLER_TYPES.FLOAT},T}function mapTypeAndFormatToInternalFormat(P){let T;return"WebGL2RenderingContext"in globalThis&&P instanceof globalThis.WebGL2RenderingContext?T={[TYPES.UNSIGNED_BYTE]:{[FORMATS.RGBA]:P.RGBA8,[FORMATS.RGB]:P.RGB8,[FORMATS.RG]:P.RG8,[FORMATS.RED]:P.R8,[FORMATS.RGBA_INTEGER]:P.RGBA8UI,[FORMATS.RGB_INTEGER]:P.RGB8UI,[FORMATS.RG_INTEGER]:P.RG8UI,[FORMATS.RED_INTEGER]:P.R8UI,[FORMATS.ALPHA]:P.ALPHA,[FORMATS.LUMINANCE]:P.LUMINANCE,[FORMATS.LUMINANCE_ALPHA]:P.LUMINANCE_ALPHA},[TYPES.BYTE]:{[FORMATS.RGBA]:P.RGBA8_SNORM,[FORMATS.RGB]:P.RGB8_SNORM,[FORMATS.RG]:P.RG8_SNORM,[FORMATS.RED]:P.R8_SNORM,[FORMATS.RGBA_INTEGER]:P.RGBA8I,[FORMATS.RGB_INTEGER]:P.RGB8I,[FORMATS.RG_INTEGER]:P.RG8I,[FORMATS.RED_INTEGER]:P.R8I},[TYPES.UNSIGNED_SHORT]:{[FORMATS.RGBA_INTEGER]:P.RGBA16UI,[FORMATS.RGB_INTEGER]:P.RGB16UI,[FORMATS.RG_INTEGER]:P.RG16UI,[FORMATS.RED_INTEGER]:P.R16UI,[FORMATS.DEPTH_COMPONENT]:P.DEPTH_COMPONENT16},[TYPES.SHORT]:{[FORMATS.RGBA_INTEGER]:P.RGBA16I,[FORMATS.RGB_INTEGER]:P.RGB16I,[FORMATS.RG_INTEGER]:P.RG16I,[FORMATS.RED_INTEGER]:P.R16I},[TYPES.UNSIGNED_INT]:{[FORMATS.RGBA_INTEGER]:P.RGBA32UI,[FORMATS.RGB_INTEGER]:P.RGB32UI,[FORMATS.RG_INTEGER]:P.RG32UI,[FORMATS.RED_INTEGER]:P.R32UI,[FORMATS.DEPTH_COMPONENT]:P.DEPTH_COMPONENT24},[TYPES.INT]:{[FORMATS.RGBA_INTEGER]:P.RGBA32I,[FORMATS.RGB_INTEGER]:P.RGB32I,[FORMATS.RG_INTEGER]:P.RG32I,[FORMATS.RED_INTEGER]:P.R32I},[TYPES.FLOAT]:{[FORMATS.RGBA]:P.RGBA32F,[FORMATS.RGB]:P.RGB32F,[FORMATS.RG]:P.RG32F,[FORMATS.RED]:P.R32F,[FORMATS.DEPTH_COMPONENT]:P.DEPTH_COMPONENT32F},[TYPES.HALF_FLOAT]:{[FORMATS.RGBA]:P.RGBA16F,[FORMATS.RGB]:P.RGB16F,[FORMATS.RG]:P.RG16F,[FORMATS.RED]:P.R16F},[TYPES.UNSIGNED_SHORT_5_6_5]:{[FORMATS.RGB]:P.RGB565},[TYPES.UNSIGNED_SHORT_4_4_4_4]:{[FORMATS.RGBA]:P.RGBA4},[TYPES.UNSIGNED_SHORT_5_5_5_1]:{[FORMATS.RGBA]:P.RGB5_A1},[TYPES.UNSIGNED_INT_2_10_10_10_REV]:{[FORMATS.RGBA]:P.RGB10_A2,[FORMATS.RGBA_INTEGER]:P.RGB10_A2UI},[TYPES.UNSIGNED_INT_10F_11F_11F_REV]:{[FORMATS.RGB]:P.R11F_G11F_B10F},[TYPES.UNSIGNED_INT_5_9_9_9_REV]:{[FORMATS.RGB]:P.RGB9_E5},[TYPES.UNSIGNED_INT_24_8]:{[FORMATS.DEPTH_STENCIL]:P.DEPTH24_STENCIL8},[TYPES.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[FORMATS.DEPTH_STENCIL]:P.DEPTH32F_STENCIL8}}:T={[TYPES.UNSIGNED_BYTE]:{[FORMATS.RGBA]:P.RGBA,[FORMATS.RGB]:P.RGB,[FORMATS.ALPHA]:P.ALPHA,[FORMATS.LUMINANCE]:P.LUMINANCE,[FORMATS.LUMINANCE_ALPHA]:P.LUMINANCE_ALPHA},[TYPES.UNSIGNED_SHORT_5_6_5]:{[FORMATS.RGB]:P.RGB},[TYPES.UNSIGNED_SHORT_4_4_4_4]:{[FORMATS.RGBA]:P.RGBA},[TYPES.UNSIGNED_SHORT_5_5_5_1]:{[FORMATS.RGBA]:P.RGBA}},T}class TextureSystem{constructor(T){this.renderer=T,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new BaseTexture,this.hasIntegerTextures=!1}contextChange(){const T=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=mapTypeAndFormatToInternalFormat(T),this.samplerTypes=mapInternalFormatToSamplerType(T);const L=T.getParameter(T.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=L;for(let I=0;I<L;I++)this.boundTextures[I]=null;this.emptyTextures={};const R=new GLTexture(T.createTexture());T.bindTexture(T.TEXTURE_2D,R.texture),T.texImage2D(T.TEXTURE_2D,0,T.RGBA,1,1,0,T.RGBA,T.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[T.TEXTURE_2D]=R,this.emptyTextures[T.TEXTURE_CUBE_MAP]=new GLTexture(T.createTexture()),T.bindTexture(T.TEXTURE_CUBE_MAP,this.emptyTextures[T.TEXTURE_CUBE_MAP].texture);for(let I=0;I<6;I++)T.texImage2D(T.TEXTURE_CUBE_MAP_POSITIVE_X+I,0,T.RGBA,1,1,0,T.RGBA,T.UNSIGNED_BYTE,null);T.texParameteri(T.TEXTURE_CUBE_MAP,T.TEXTURE_MAG_FILTER,T.LINEAR),T.texParameteri(T.TEXTURE_CUBE_MAP,T.TEXTURE_MIN_FILTER,T.LINEAR);for(let I=0;I<this.boundTextures.length;I++)this.bind(null,I)}bind(T,L=0){const{gl:R}=this;if(T=T?.castToBaseTexture(),T?.valid&&!T.parentTextureArray){T.touched=this.renderer.textureGC.count;const I=T._glTextures[this.CONTEXT_UID]||this.initTexture(T);this.boundTextures[L]!==T&&(this.currentLocation!==L&&(this.currentLocation=L,R.activeTexture(R.TEXTURE0+L)),R.bindTexture(T.target,I.texture)),I.dirtyId!==T.dirtyId?(this.currentLocation!==L&&(this.currentLocation=L,R.activeTexture(R.TEXTURE0+L)),this.updateTexture(T)):I.dirtyStyleId!==T.dirtyStyleId&&this.updateTextureStyle(T),this.boundTextures[L]=T}else this.currentLocation!==L&&(this.currentLocation=L,R.activeTexture(R.TEXTURE0+L)),R.bindTexture(R.TEXTURE_2D,this.emptyTextures[R.TEXTURE_2D].texture),this.boundTextures[L]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let T=0;T<this.boundTextures.length;T++)this.boundTextures[T]=this.unknownTexture}unbind(T){const{gl:L,boundTextures:R}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let I=0;I<R.length;I++)R[I]===this.unknownTexture&&this.bind(null,I)}for(let I=0;I<R.length;I++)R[I]===T&&(this.currentLocation!==I&&(L.activeTexture(L.TEXTURE0+I),this.currentLocation=I),L.bindTexture(T.target,this.emptyTextures[T.target].texture),R[I]=null)}ensureSamplerType(T){const{boundTextures:L,hasIntegerTextures:R,CONTEXT_UID:I}=this;if(R)for(let F=T-1;F>=0;--F){const D=L[F];D&&D._glTextures[I].samplerType!==SAMPLER_TYPES.FLOAT&&this.renderer.texture.unbind(D)}}initTexture(T){const L=new GLTexture(this.gl.createTexture());return L.dirtyId=-1,T._glTextures[this.CONTEXT_UID]=L,this.managedTextures.push(T),T.on("dispose",this.destroyTexture,this),L}initTextureType(T,L){L.internalFormat=this.internalFormats[T.type]?.[T.format]??T.format,L.samplerType=this.samplerTypes[L.internalFormat]??SAMPLER_TYPES.FLOAT,this.webGLVersion===2&&T.type===TYPES.HALF_FLOAT?L.type=this.gl.HALF_FLOAT:L.type=T.type}updateTexture(T){const L=T._glTextures[this.CONTEXT_UID];if(!L)return;const R=this.renderer;if(this.initTextureType(T,L),T.resource?.upload(R,T,L))L.samplerType!==SAMPLER_TYPES.FLOAT&&(this.hasIntegerTextures=!0);else{const I=T.realWidth,F=T.realHeight,D=R.gl;(L.width!==I||L.height!==F||L.dirtyId<0)&&(L.width=I,L.height=F,D.texImage2D(T.target,0,L.internalFormat,I,F,0,T.format,L.type,null))}T.dirtyStyleId!==L.dirtyStyleId&&this.updateTextureStyle(T),L.dirtyId=T.dirtyId}destroyTexture(T,L){const{gl:R}=this;if(T=T.castToBaseTexture(),T._glTextures[this.CONTEXT_UID]&&(this.unbind(T),R.deleteTexture(T._glTextures[this.CONTEXT_UID].texture),T.off("dispose",this.destroyTexture,this),delete T._glTextures[this.CONTEXT_UID],!L)){const I=this.managedTextures.indexOf(T);I!==-1&&removeItems(this.managedTextures,I,1)}}updateTextureStyle(T){const L=T._glTextures[this.CONTEXT_UID];L&&((T.mipmap===MIPMAP_MODES.POW2||this.webGLVersion!==2)&&!T.isPowerOfTwo?L.mipmap=!1:L.mipmap=T.mipmap>=1,this.webGLVersion!==2&&!T.isPowerOfTwo?L.wrapMode=WRAP_MODES.CLAMP:L.wrapMode=T.wrapMode,T.resource?.style(this.renderer,T,L)||this.setStyle(T,L),L.dirtyStyleId=T.dirtyStyleId)}setStyle(T,L){const R=this.gl;if(L.mipmap&&T.mipmap!==MIPMAP_MODES.ON_MANUAL&&R.generateMipmap(T.target),R.texParameteri(T.target,R.TEXTURE_WRAP_S,L.wrapMode),R.texParameteri(T.target,R.TEXTURE_WRAP_T,L.wrapMode),L.mipmap){R.texParameteri(T.target,R.TEXTURE_MIN_FILTER,T.scaleMode===SCALE_MODES.LINEAR?R.LINEAR_MIPMAP_LINEAR:R.NEAREST_MIPMAP_NEAREST);const I=this.renderer.context.extensions.anisotropicFiltering;if(I&&T.anisotropicLevel>0&&T.scaleMode===SCALE_MODES.LINEAR){const F=Math.min(T.anisotropicLevel,R.getParameter(I.MAX_TEXTURE_MAX_ANISOTROPY_EXT));R.texParameterf(T.target,I.TEXTURE_MAX_ANISOTROPY_EXT,F)}}else R.texParameteri(T.target,R.TEXTURE_MIN_FILTER,T.scaleMode===SCALE_MODES.LINEAR?R.LINEAR:R.NEAREST);R.texParameteri(T.target,R.TEXTURE_MAG_FILTER,T.scaleMode===SCALE_MODES.LINEAR?R.LINEAR:R.NEAREST)}destroy(){this.renderer=null}}TextureSystem.extension={type:ExtensionType.RendererSystem,name:"texture"};extensions.add(TextureSystem);class TransformFeedbackSystem{constructor(T){this.renderer=T}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(T){const{gl:L,CONTEXT_UID:R}=this,I=T._glTransformFeedbacks[R]||this.createGLTransformFeedback(T);L.bindTransformFeedback(L.TRANSFORM_FEEDBACK,I)}unbind(){const{gl:T}=this;T.bindTransformFeedback(T.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(T,L){const{gl:R,renderer:I}=this;L&&I.shader.bind(L),R.beginTransformFeedback(T)}endTransformFeedback(){const{gl:T}=this;T.endTransformFeedback()}createGLTransformFeedback(T){const{gl:L,renderer:R,CONTEXT_UID:I}=this,F=L.createTransformFeedback();T._glTransformFeedbacks[I]=F,L.bindTransformFeedback(L.TRANSFORM_FEEDBACK,F);for(let D=0;D<T.buffers.length;D++){const V=T.buffers[D];V&&(R.buffer.update(V),V._glBuffers[I].refCount++,L.bindBufferBase(L.TRANSFORM_FEEDBACK_BUFFER,D,V._glBuffers[I].buffer||null))}return L.bindTransformFeedback(L.TRANSFORM_FEEDBACK,null),T.disposeRunner.add(this),F}disposeTransformFeedback(T,L){const R=T._glTransformFeedbacks[this.CONTEXT_UID],I=this.gl;T.disposeRunner.remove(this);const F=this.renderer.buffer;if(F)for(let D=0;D<T.buffers.length;D++){const V=T.buffers[D];if(!V)continue;const q=V._glBuffers[this.CONTEXT_UID];q&&(q.refCount--,q.refCount===0&&!L&&F.dispose(V,L))}R&&(L||I.deleteTransformFeedback(R),delete T._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}TransformFeedbackSystem.extension={type:ExtensionType.RendererSystem,name:"transformFeedback"};extensions.add(TransformFeedbackSystem);class ViewSystem{constructor(T){this.renderer=T}init(T){this.screen=new Rectangle(0,0,T.width,T.height),this.element=T.view||settings.ADAPTER.createCanvas(),this.resolution=T.resolution||settings.RESOLUTION,this.autoDensity=!!T.autoDensity}resizeView(T,L){this.element.width=Math.round(T*this.resolution),this.element.height=Math.round(L*this.resolution);const R=this.element.width/this.resolution,I=this.element.height/this.resolution;this.screen.width=R,this.screen.height=I,this.autoDensity&&(this.element.style.width=`${R}px`,this.element.style.height=`${I}px`),this.renderer.emit("resize",R,I),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(T){T&&this.element.parentNode?.removeChild(this.element),this.renderer=null,this.element=null,this.screen=null}}ViewSystem.defaultOptions={width:800,height:600,resolution:void 0,autoDensity:!1},ViewSystem.extension={type:[ExtensionType.RendererSystem,ExtensionType.CanvasRendererSystem],name:"_view"};extensions.add(ViewSystem);settings.PREFER_ENV=ENV.WEBGL2;settings.STRICT_TEXTURE_CACHE=!1;settings.RENDER_OPTIONS={...ContextSystem.defaultOptions,...BackgroundSystem.defaultOptions,...ViewSystem.defaultOptions,...StartupSystem.defaultOptions};Object.defineProperties(settings,{WRAP_MODE:{get(){return BaseTexture.defaultOptions.wrapMode},set(P){deprecation("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),BaseTexture.defaultOptions.wrapMode=P}},SCALE_MODE:{get(){return BaseTexture.defaultOptions.scaleMode},set(P){deprecation("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),BaseTexture.defaultOptions.scaleMode=P}},MIPMAP_TEXTURES:{get(){return BaseTexture.defaultOptions.mipmap},set(P){deprecation("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),BaseTexture.defaultOptions.mipmap=P}},ANISOTROPIC_LEVEL:{get(){return BaseTexture.defaultOptions.anisotropicLevel},set(P){deprecation("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),BaseTexture.defaultOptions.anisotropicLevel=P}},FILTER_RESOLUTION:{get(){return deprecation("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),Filter.defaultResolution},set(P){Filter.defaultResolution=P}},FILTER_MULTISAMPLE:{get(){return deprecation("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),Filter.defaultMultisample},set(P){Filter.defaultMultisample=P}},SPRITE_MAX_TEXTURES:{get(){return BatchRenderer.defaultMaxTextures},set(P){deprecation("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),BatchRenderer.defaultMaxTextures=P}},SPRITE_BATCH_SIZE:{get(){return BatchRenderer.defaultBatchSize},set(P){deprecation("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),BatchRenderer.defaultBatchSize=P}},CAN_UPLOAD_SAME_BUFFER:{get(){return BatchRenderer.canUploadSameBuffer},set(P){deprecation("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),BatchRenderer.canUploadSameBuffer=P}},GC_MODE:{get(){return TextureGCSystem.defaultMode},set(P){deprecation("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),TextureGCSystem.defaultMode=P}},GC_MAX_IDLE:{get(){return TextureGCSystem.defaultMaxIdle},set(P){deprecation("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),TextureGCSystem.defaultMaxIdle=P}},GC_MAX_CHECK_COUNT:{get(){return TextureGCSystem.defaultCheckCountMax},set(P){deprecation("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),TextureGCSystem.defaultCheckCountMax=P}},PRECISION_VERTEX:{get(){return Program.defaultVertexPrecision},set(P){deprecation("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),Program.defaultVertexPrecision=P}},PRECISION_FRAGMENT:{get(){return Program.defaultFragmentPrecision},set(P){deprecation("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),Program.defaultFragmentPrecision=P}}});var UPDATE_PRIORITY=(P=>(P[P.INTERACTION=50]="INTERACTION",P[P.HIGH=25]="HIGH",P[P.NORMAL=0]="NORMAL",P[P.LOW=-25]="LOW",P[P.UTILITY=-50]="UTILITY",P))(UPDATE_PRIORITY||{});class TickerListener{constructor(T,L=null,R=0,I=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=T,this.context=L,this.priority=R,this.once=I}match(T,L=null){return this.fn===T&&this.context===L}emit(T){this.fn&&(this.context?this.fn.call(this.context,T):this.fn(T));const L=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),L}connect(T){this.previous=T,T.next&&(T.next.previous=this),this.next=T.next,T.next=this}destroy(T=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const L=this.next;return this.next=T?null:L,this.previous=null,L}}const _Ticker=class Ni{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new TickerListener(null,null,1/0),this.deltaMS=1/Ni.targetFPMS,this.elapsedMS=1/Ni.targetFPMS,this._tick=T=>{this._requestId=null,this.started&&(this.update(T),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(T,L,R=UPDATE_PRIORITY.NORMAL){return this._addListener(new TickerListener(T,L,R))}addOnce(T,L,R=UPDATE_PRIORITY.NORMAL){return this._addListener(new TickerListener(T,L,R,!0))}_addListener(T){let L=this._head.next,R=this._head;if(!L)T.connect(R);else{for(;L;){if(T.priority>L.priority){T.connect(R);break}R=L,L=L.next}T.previous||T.connect(R)}return this._startIfPossible(),this}remove(T,L){let R=this._head.next;for(;R;)R.match(T,L)?R=R.destroy():R=R.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let T=0,L=this._head;for(;L=L.next;)T++;return T}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let T=this._head.next;for(;T;)T=T.destroy(!0);this._head.destroy(),this._head=null}}update(T=performance.now()){let L;if(T>this.lastTime){if(L=this.elapsedMS=T-this.lastTime,L>this._maxElapsedMS&&(L=this._maxElapsedMS),L*=this.speed,this._minElapsedMS){const F=T-this._lastFrame|0;if(F<this._minElapsedMS)return;this._lastFrame=T-F%this._minElapsedMS}this.deltaMS=L,this.deltaTime=this.deltaMS*Ni.targetFPMS;const R=this._head;let I=R.next;for(;I;)I=I.emit(this.deltaTime);R.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=T}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(T){const L=Math.min(this.maxFPS,T),R=Math.min(Math.max(0,L)/1e3,Ni.targetFPMS);this._maxElapsedMS=1/R}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(T){if(T===0)this._minElapsedMS=0;else{const L=Math.max(this.minFPS,T);this._minElapsedMS=1/(L/1e3)}}static get shared(){if(!Ni._shared){const T=Ni._shared=new Ni;T.autoStart=!0,T._protected=!0}return Ni._shared}static get system(){if(!Ni._system){const T=Ni._system=new Ni;T.autoStart=!0,T._protected=!0}return Ni._system}};_Ticker.targetFPMS=.06;let Ticker=_Ticker;Object.defineProperties(settings,{TARGET_FPMS:{get(){return Ticker.targetFPMS},set(P){deprecation("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),Ticker.targetFPMS=P}}});class TickerPlugin{static init(T){T=Object.assign({autoStart:!0,sharedTicker:!1},T),Object.defineProperty(this,"ticker",{set(L){this._ticker&&this._ticker.remove(this.render,this),this._ticker=L,L&&L.add(this.render,this,UPDATE_PRIORITY.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=T.sharedTicker?Ticker.shared:new Ticker,T.autoStart&&this.start()}static destroy(){if(this._ticker){const T=this._ticker;this.ticker=null,T.destroy()}}}TickerPlugin.extension=ExtensionType.Application;extensions.add(TickerPlugin);const renderers=[];extensions.handleByList(ExtensionType.Renderer,renderers);function autoDetectRenderer(P){for(const T of renderers)if(T.test(P))return new T(P);throw new Error("Unable to auto-detect a suitable renderer.")}var $defaultFilterVertex=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const defaultFilterVertex=$defaultFilterVertex;class MultisampleSystem{constructor(T){this.renderer=T}contextChange(T){let L;if(this.renderer.context.webGLVersion===1){const R=T.getParameter(T.FRAMEBUFFER_BINDING);T.bindFramebuffer(T.FRAMEBUFFER,null),L=T.getParameter(T.SAMPLES),T.bindFramebuffer(T.FRAMEBUFFER,R)}else{const R=T.getParameter(T.DRAW_FRAMEBUFFER_BINDING);T.bindFramebuffer(T.DRAW_FRAMEBUFFER,null),L=T.getParameter(T.SAMPLES),T.bindFramebuffer(T.DRAW_FRAMEBUFFER,R)}L>=MSAA_QUALITY.HIGH?this.multisample=MSAA_QUALITY.HIGH:L>=MSAA_QUALITY.MEDIUM?this.multisample=MSAA_QUALITY.MEDIUM:L>=MSAA_QUALITY.LOW?this.multisample=MSAA_QUALITY.LOW:this.multisample=MSAA_QUALITY.NONE}destroy(){}}MultisampleSystem.extension={type:ExtensionType.RendererSystem,name:"_multisample"};extensions.add(MultisampleSystem);class GLBuffer{constructor(T){this.buffer=T||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class BufferSystem{constructor(T){this.renderer=T,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(T){const{gl:L,CONTEXT_UID:R}=this,I=T._glBuffers[R]||this.createGLBuffer(T);L.bindBuffer(T.type,I.buffer)}unbind(T){const{gl:L}=this;L.bindBuffer(T,null)}bindBufferBase(T,L){const{gl:R,CONTEXT_UID:I}=this;if(this.boundBufferBases[L]!==T){const F=T._glBuffers[I]||this.createGLBuffer(T);this.boundBufferBases[L]=T,R.bindBufferBase(R.UNIFORM_BUFFER,L,F.buffer)}}bindBufferRange(T,L,R){const{gl:I,CONTEXT_UID:F}=this;R=R||0;const D=T._glBuffers[F]||this.createGLBuffer(T);I.bindBufferRange(I.UNIFORM_BUFFER,L||0,D.buffer,R*256,256)}update(T){const{gl:L,CONTEXT_UID:R}=this,I=T._glBuffers[R]||this.createGLBuffer(T);if(T._updateID!==I.updateID)if(I.updateID=T._updateID,L.bindBuffer(T.type,I.buffer),I.byteLength>=T.data.byteLength)L.bufferSubData(T.type,0,T.data);else{const F=T.static?L.STATIC_DRAW:L.DYNAMIC_DRAW;I.byteLength=T.data.byteLength,L.bufferData(T.type,T.data,F)}}dispose(T,L){if(!this.managedBuffers[T.id])return;delete this.managedBuffers[T.id];const R=T._glBuffers[this.CONTEXT_UID],I=this.gl;T.disposeRunner.remove(this),R&&(L||I.deleteBuffer(R.buffer),delete T._glBuffers[this.CONTEXT_UID])}disposeAll(T){const L=Object.keys(this.managedBuffers);for(let R=0;R<L.length;R++)this.dispose(this.managedBuffers[L[R]],T)}createGLBuffer(T){const{CONTEXT_UID:L,gl:R}=this;return T._glBuffers[L]=new GLBuffer(R.createBuffer()),this.managedBuffers[T.id]=T,T.disposeRunner.add(this),T._glBuffers[L]}}BufferSystem.extension={type:ExtensionType.RendererSystem,name:"buffer"};extensions.add(BufferSystem);class ObjectRendererSystem{constructor(T){this.renderer=T}render(T,L){const R=this.renderer;let I,F,D,V;if(L&&(I=L.renderTexture,F=L.clear,D=L.transform,V=L.skipUpdateTransform),this.renderingToScreen=!I,R.runners.prerender.emit(),R.emit("prerender"),R.projection.transform=D,!R.context.isLost){if(I||(this.lastObjectRendered=T),!V){const q=T.enableTempParent();T.updateTransform(),T.disableTempParent(q)}R.renderTexture.bind(I),R.batch.currentRenderer.start(),(F??R.background.clearBeforeRender)&&R.renderTexture.clear(),T.render(R),R.batch.currentRenderer.flush(),I&&(L.blit&&R.framebuffer.blit(),I.baseTexture.update()),R.runners.postrender.emit(),R.projection.transform=null,R.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}ObjectRendererSystem.extension={type:ExtensionType.RendererSystem,name:"objectRenderer"};extensions.add(ObjectRendererSystem);const _Renderer=class sr extends SystemManager{constructor(T){super(),this.type=RENDERER_TYPE.WEBGL,T=Object.assign({},settings.RENDER_OPTIONS,T),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new UniformGroup({projectionMatrix:new Matrix},!0);const L={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:sr.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(L),"useContextAlpha"in T&&(deprecation("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),T.premultipliedAlpha=T.useContextAlpha&&T.useContextAlpha!=="notMultiplied",T.backgroundAlpha=T.useContextAlpha===!1?1:T.backgroundAlpha),this._plugin.rendererPlugins=sr.__plugins,this.options=T,this.startup.run(this.options)}static test(T){return T?.forceCanvas?!1:isWebGLSupported()}render(T,L){this.objectRenderer.render(T,L)}resize(T,L){this._view.resizeView(T,L)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(T=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:T}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(T){this._view.resolution=T,this.runners.resolutionChange.emit(T)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return deprecation("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return deprecation("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return deprecation("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return deprecation("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(T){deprecation("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=T}get backgroundAlpha(){return deprecation("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(T){deprecation("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=T}get powerPreference(){return deprecation("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(T,L){return this.textureGenerator.generateTexture(T,L)}};_Renderer.extension={type:ExtensionType.Renderer,priority:1},_Renderer.__plugins={},_Renderer.__systems={};let Renderer=_Renderer;extensions.handleByMap(ExtensionType.RendererPlugin,Renderer.__plugins);extensions.handleByMap(ExtensionType.RendererSystem,Renderer.__systems);extensions.add(Renderer);class AbstractMultiResource extends Resource{constructor(T,L){const{width:R,height:I}=L||{};super(R,I),this.items=[],this.itemDirtyIds=[];for(let F=0;F<T;F++){const D=new BaseTexture;this.items.push(D),this.itemDirtyIds.push(-2)}this.length=T,this._load=null,this.baseTexture=null}initFromArray(T,L){for(let R=0;R<this.length;R++)T[R]&&(T[R].castToBaseTexture?this.addBaseTextureAt(T[R].castToBaseTexture(),R):T[R]instanceof Resource?this.addResourceAt(T[R],R):this.addResourceAt(autoDetectResource(T[R],L),R))}dispose(){for(let T=0,L=this.length;T<L;T++)this.items[T].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(T,L){if(!this.items[L])throw new Error(`Index ${L} is out of bounds`);return T.valid&&!this.valid&&this.resize(T.width,T.height),this.items[L].setResource(T),this}bind(T){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(T);for(let L=0;L<this.length;L++)this.items[L].parentTextureArray=T,this.items[L].on("update",T.update,T)}unbind(T){super.unbind(T);for(let L=0;L<this.length;L++)this.items[L].parentTextureArray=null,this.items[L].off("update",T.update,T)}load(){if(this._load)return this._load;const T=this.items.map(L=>L.resource).filter(L=>L).map(L=>L.load());return this._load=Promise.all(T).then(()=>{const{realWidth:L,realHeight:R}=this.items[0];return this.resize(L,R),this.update(),Promise.resolve(this)}),this._load}}class ArrayResource extends AbstractMultiResource{constructor(T,L){const{width:R,height:I}=L||{};let F,D;Array.isArray(T)?(F=T,D=T.length):D=T,super(D,{width:R,height:I}),F&&this.initFromArray(F,L)}addBaseTextureAt(T,L){if(T.resource)this.addResourceAt(T.resource,L);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(T){super.bind(T),T.target=TARGETS.TEXTURE_2D_ARRAY}upload(T,L,R){const{length:I,itemDirtyIds:F,items:D}=this,{gl:V}=T;R.dirtyId<0&&V.texImage3D(V.TEXTURE_2D_ARRAY,0,R.internalFormat,this._width,this._height,I,0,L.format,R.type,null);for(let q=0;q<I;q++){const G=D[q];F[q]<G.dirtyId&&(F[q]=G.dirtyId,G.valid&&V.texSubImage3D(V.TEXTURE_2D_ARRAY,0,0,0,q,G.resource.width,G.resource.height,1,L.format,R.type,G.resource.source))}return!0}}class CanvasResource extends BaseImageResource{constructor(T){super(T)}static test(T){const{OffscreenCanvas:L}=globalThis;return L&&T instanceof L?!0:globalThis.HTMLCanvasElement&&T instanceof HTMLCanvasElement}}const _CubeResource=class Ns extends AbstractMultiResource{constructor(T,L){const{width:R,height:I,autoLoad:F,linkBaseTexture:D}=L||{};if(T&&T.length!==Ns.SIDES)throw new Error(`Invalid length. Got ${T.length}, expected 6`);super(6,{width:R,height:I});for(let V=0;V<Ns.SIDES;V++)this.items[V].target=TARGETS.TEXTURE_CUBE_MAP_POSITIVE_X+V;this.linkBaseTexture=D!==!1,T&&this.initFromArray(T,L),F!==!1&&this.load()}bind(T){super.bind(T),T.target=TARGETS.TEXTURE_CUBE_MAP}addBaseTextureAt(T,L,R){if(R===void 0&&(R=this.linkBaseTexture),!this.items[L])throw new Error(`Index ${L} is out of bounds`);if(!this.linkBaseTexture||T.parentTextureArray||Object.keys(T._glTextures).length>0)if(T.resource)this.addResourceAt(T.resource,L);else throw new Error("CubeResource does not support copying of renderTexture.");else T.target=TARGETS.TEXTURE_CUBE_MAP_POSITIVE_X+L,T.parentTextureArray=this.baseTexture,this.items[L]=T;return T.valid&&!this.valid&&this.resize(T.realWidth,T.realHeight),this.items[L]=T,this}upload(T,L,R){const I=this.itemDirtyIds;for(let F=0;F<Ns.SIDES;F++){const D=this.items[F];(I[F]<D.dirtyId||R.dirtyId<L.dirtyId)&&(D.valid&&D.resource?(D.resource.upload(T,D,R),I[F]=D.dirtyId):I[F]<-1&&(T.gl.texImage2D(D.target,0,R.internalFormat,L.realWidth,L.realHeight,0,L.format,R.type,null),I[F]=-1))}return!0}static test(T){return Array.isArray(T)&&T.length===Ns.SIDES}};_CubeResource.SIDES=6;let CubeResource=_CubeResource;class ImageBitmapResource extends BaseImageResource{constructor(T,L){L=L||{};let R,I,F;typeof T=="string"?(R=ImageBitmapResource.EMPTY,I=T,F=!0):(R=T,I=null,F=!1),super(R),this.url=I,this.crossOrigin=L.crossOrigin??!0,this.alphaMode=typeof L.alphaMode=="number"?L.alphaMode:null,this.ownsImageBitmap=L.ownsImageBitmap??F,this._load=null,L.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(async(T,L)=>{if(this.url===null){T(this);return}try{const R=await settings.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const I=await R.blob();if(this.destroyed)return;const F=await createImageBitmap(I,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===ALPHA_MODES.UNPACK?"premultiply":"none"});if(this.destroyed){F.close();return}this.source=F,this.update(),T(this)}catch(R){if(this.destroyed)return;L(R),this.onError.emit(R)}}),this._load)}upload(T,L,R){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(L.alphaMode=this.alphaMode),super.upload(T,L,R)):(this.load(),!1)}dispose(){this.ownsImageBitmap&&this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(T){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&(typeof T=="string"||T instanceof ImageBitmap)}static get EMPTY(){return ImageBitmapResource._EMPTY=ImageBitmapResource._EMPTY??settings.ADAPTER.createCanvas(0,0),ImageBitmapResource._EMPTY}}const _SVGResource=class Hs extends BaseImageResource{constructor(T,L){L=L||{},super(settings.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=T,this.scale=L.scale||1,this._overrideWidth=L.width,this._overrideHeight=L.height,this._resolve=null,this._crossorigin=L.crossorigin,this._load=null,L.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(T=>{if(this._resolve=()=>{this.update(),T(this)},Hs.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){const T=new Image;BaseImageResource.crossOrigin(T,this.svg,this._crossorigin),T.src=this.svg,T.onerror=L=>{this._resolve&&(T.onerror=null,this.onError.emit(L))},T.onload=()=>{if(!this._resolve)return;const L=T.width,R=T.height;if(!L||!R)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let I=L*this.scale,F=R*this.scale;(this._overrideWidth||this._overrideHeight)&&(I=this._overrideWidth||this._overrideHeight/R*L,F=this._overrideHeight||this._overrideWidth/L*R),I=Math.round(I),F=Math.round(F);const D=this.source;D.width=I,D.height=F,D._pixiId=`canvas_${uid()}`,D.getContext("2d").drawImage(T,0,0,L,R,0,0,I,F),this._resolve(),this._resolve=null}}static getSize(T){const L=Hs.SVG_SIZE.exec(T),R={};return L&&(R[L[1]]=Math.round(parseFloat(L[3])),R[L[5]]=Math.round(parseFloat(L[7]))),R}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(T,L){return L==="svg"||typeof T=="string"&&T.startsWith("data:image/svg+xml")||typeof T=="string"&&Hs.SVG_XML.test(T)}};_SVGResource.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,_SVGResource.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;let SVGResource=_SVGResource;class VideoFrameResource extends BaseImageResource{constructor(T){super(T)}static test(T){return!!globalThis.VideoFrame&&T instanceof globalThis.VideoFrame}}const _VideoResource=class rr extends BaseImageResource{constructor(T,L){if(L=L||{},!(T instanceof HTMLVideoElement)){const R=document.createElement("video");L.autoLoad!==!1&&R.setAttribute("preload","auto"),L.playsinline!==!1&&(R.setAttribute("webkit-playsinline",""),R.setAttribute("playsinline","")),L.muted===!0&&(R.setAttribute("muted",""),R.muted=!0),L.loop===!0&&R.setAttribute("loop",""),L.autoPlay!==!1&&R.setAttribute("autoplay",""),typeof T=="string"&&(T=[T]);const I=T[0].src||T[0];BaseImageResource.crossOrigin(R,I,L.crossorigin);for(let F=0;F<T.length;++F){const D=document.createElement("source");let{src:V,mime:q}=T[F];if(V=V||T[F],V.startsWith("data:"))q=V.slice(5,V.indexOf(";"));else if(!V.startsWith("blob:")){const G=V.split("?").shift().toLowerCase(),z=G.slice(G.lastIndexOf(".")+1);q=q||rr.MIME_TYPES[z]||`video/${z}`}D.src=V,q&&(D.type=q),R.appendChild(D)}T=R}super(T),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=L.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=L.autoPlay!==!1,this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),L.autoLoad!==!1&&this.load()}update(T=0){if(!this.destroyed){if(this._updateFPS){const L=Ticker.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-L)}(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}_videoFrameRequestCallback(){this.update(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback)}load(){if(this._load)return this._load;const T=this.source;return(T.readyState===T.HAVE_ENOUGH_DATA||T.readyState===T.HAVE_FUTURE_DATA)&&T.width&&T.height&&(T.complete=!0),T.addEventListener("play",this._onPlayStart),T.addEventListener("pause",this._onPlayStop),T.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._onCanPlay():(T.addEventListener("canplay",this._onCanPlay),T.addEventListener("canplaythrough",this._onCanPlay),T.addEventListener("error",this._onError,!0)),this._load=new Promise((L,R)=>{this.valid?L(this):(this._resolve=L,this._reject=R,T.load())}),this._load}_onError(T){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(T),this._reject&&(this._reject(T),this._reject=null,this._resolve=null)}_isSourcePlaying(){const T=this.source;return!T.paused&&!T.ended}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0)}_onCanPlay(){const T=this.source;T.removeEventListener("canplay",this._onCanPlay),T.removeEventListener("canplaythrough",this._onCanPlay);const L=this.valid;this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0,!L&&this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&T.play()}dispose(){this._configureAutoUpdate();const T=this.source;T&&(T.removeEventListener("play",this._onPlayStart),T.removeEventListener("pause",this._onPlayStop),T.removeEventListener("seeked",this._onSeeked),T.removeEventListener("canplay",this._onCanPlay),T.removeEventListener("canplaythrough",this._onCanPlay),T.removeEventListener("error",this._onError,!0),T.pause(),T.src="",T.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(T){T!==this._autoUpdate&&(this._autoUpdate=T,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(T){T!==this._updateFPS&&(this._updateFPS=T,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.source.requestVideoFrameCallback?(this._isConnectedToTicker&&(Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),this._videoFrameRequestCallbackHandle===null&&(this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback))):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(Ticker.shared.add(this.update,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(T,L){return globalThis.HTMLVideoElement&&T instanceof HTMLVideoElement||rr.TYPES.includes(L)}};_VideoResource.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],_VideoResource.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let VideoResource=_VideoResource;INSTALLED.push(ImageBitmapResource,ImageResource,CanvasResource,VideoResource,VideoFrameResource,SVGResource,BufferResource,CubeResource,ArrayResource);class Bounds{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(T){return this.minX>this.maxX||this.minY>this.maxY?Rectangle.EMPTY:(T=T||new Rectangle(0,0,1,1),T.x=this.minX,T.y=this.minY,T.width=this.maxX-this.minX,T.height=this.maxY-this.minY,T)}addPoint(T){this.minX=Math.min(this.minX,T.x),this.maxX=Math.max(this.maxX,T.x),this.minY=Math.min(this.minY,T.y),this.maxY=Math.max(this.maxY,T.y)}addPointMatrix(T,L){const{a:R,b:I,c:F,d:D,tx:V,ty:q}=T,G=R*L.x+F*L.y+V,z=I*L.x+D*L.y+q;this.minX=Math.min(this.minX,G),this.maxX=Math.max(this.maxX,G),this.minY=Math.min(this.minY,z),this.maxY=Math.max(this.maxY,z)}addQuad(T){let L=this.minX,R=this.minY,I=this.maxX,F=this.maxY,D=T[0],V=T[1];L=D<L?D:L,R=V<R?V:R,I=D>I?D:I,F=V>F?V:F,D=T[2],V=T[3],L=D<L?D:L,R=V<R?V:R,I=D>I?D:I,F=V>F?V:F,D=T[4],V=T[5],L=D<L?D:L,R=V<R?V:R,I=D>I?D:I,F=V>F?V:F,D=T[6],V=T[7],L=D<L?D:L,R=V<R?V:R,I=D>I?D:I,F=V>F?V:F,this.minX=L,this.minY=R,this.maxX=I,this.maxY=F}addFrame(T,L,R,I,F){this.addFrameMatrix(T.worldTransform,L,R,I,F)}addFrameMatrix(T,L,R,I,F){const D=T.a,V=T.b,q=T.c,G=T.d,z=T.tx,Q=T.ty;let tt=this.minX,gt=this.minY,yt=this.maxX,Et=this.maxY,J=D*L+q*R+z,At=V*L+G*R+Q;tt=J<tt?J:tt,gt=At<gt?At:gt,yt=J>yt?J:yt,Et=At>Et?At:Et,J=D*I+q*R+z,At=V*I+G*R+Q,tt=J<tt?J:tt,gt=At<gt?At:gt,yt=J>yt?J:yt,Et=At>Et?At:Et,J=D*L+q*F+z,At=V*L+G*F+Q,tt=J<tt?J:tt,gt=At<gt?At:gt,yt=J>yt?J:yt,Et=At>Et?At:Et,J=D*I+q*F+z,At=V*I+G*F+Q,tt=J<tt?J:tt,gt=At<gt?At:gt,yt=J>yt?J:yt,Et=At>Et?At:Et,this.minX=tt,this.minY=gt,this.maxX=yt,this.maxY=Et}addVertexData(T,L,R){let I=this.minX,F=this.minY,D=this.maxX,V=this.maxY;for(let q=L;q<R;q+=2){const G=T[q],z=T[q+1];I=G<I?G:I,F=z<F?z:F,D=G>D?G:D,V=z>V?z:V}this.minX=I,this.minY=F,this.maxX=D,this.maxY=V}addVertices(T,L,R,I){this.addVerticesMatrix(T.worldTransform,L,R,I)}addVerticesMatrix(T,L,R,I,F=0,D=F){const V=T.a,q=T.b,G=T.c,z=T.d,Q=T.tx,tt=T.ty;let gt=this.minX,yt=this.minY,Et=this.maxX,J=this.maxY;for(let At=R;At<I;At+=2){const kt=L[At],ne=L[At+1],Te=V*kt+G*ne+Q,Ht=z*ne+q*kt+tt;gt=Math.min(gt,Te-F),Et=Math.max(Et,Te+F),yt=Math.min(yt,Ht-D),J=Math.max(J,Ht+D)}this.minX=gt,this.minY=yt,this.maxX=Et,this.maxY=J}addBounds(T){const L=this.minX,R=this.minY,I=this.maxX,F=this.maxY;this.minX=T.minX<L?T.minX:L,this.minY=T.minY<R?T.minY:R,this.maxX=T.maxX>I?T.maxX:I,this.maxY=T.maxY>F?T.maxY:F}addBoundsMask(T,L){const R=T.minX>L.minX?T.minX:L.minX,I=T.minY>L.minY?T.minY:L.minY,F=T.maxX<L.maxX?T.maxX:L.maxX,D=T.maxY<L.maxY?T.maxY:L.maxY;if(R<=F&&I<=D){const V=this.minX,q=this.minY,G=this.maxX,z=this.maxY;this.minX=R<V?R:V,this.minY=I<q?I:q,this.maxX=F>G?F:G,this.maxY=D>z?D:z}}addBoundsMatrix(T,L){this.addFrameMatrix(L,T.minX,T.minY,T.maxX,T.maxY)}addBoundsArea(T,L){const R=T.minX>L.x?T.minX:L.x,I=T.minY>L.y?T.minY:L.y,F=T.maxX<L.x+L.width?T.maxX:L.x+L.width,D=T.maxY<L.y+L.height?T.maxY:L.y+L.height;if(R<=F&&I<=D){const V=this.minX,q=this.minY,G=this.maxX,z=this.maxY;this.minX=R<V?R:V,this.minY=I<q?I:q,this.maxX=F>G?F:G,this.maxY=D>z?D:z}}pad(T=0,L=T){this.isEmpty()||(this.minX-=T,this.maxX+=T,this.minY-=L,this.maxY+=L)}addFramePad(T,L,R,I,F,D){T-=F,L-=D,R+=F,I+=D,this.minX=this.minX<T?this.minX:T,this.maxX=this.maxX>R?this.maxX:R,this.minY=this.minY<L?this.minY:L,this.maxY=this.maxY>I?this.maxY:I}}class DisplayObject extends EventEmitter{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new Transform,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new Bounds,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(T){const L=Object.keys(T);for(let R=0;R<L.length;++R){const I=L[R];Object.defineProperty(DisplayObject.prototype,I,Object.getOwnPropertyDescriptor(T,I))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(T,L){return T||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),L||(this._boundsRect||(this._boundsRect=new Rectangle),L=this._boundsRect),this._bounds.getRectangle(L)}getLocalBounds(T){T||(this._localBoundsRect||(this._localBoundsRect=new Rectangle),T=this._localBoundsRect),this._localBounds||(this._localBounds=new Bounds);const L=this.transform,R=this.parent;this.parent=null,this._tempDisplayObjectParent.worldAlpha=R?.worldAlpha??1,this.transform=this._tempDisplayObjectParent.transform;const I=this._bounds,F=this._boundsID;this._bounds=this._localBounds;const D=this.getBounds(!1,T);return this.parent=R,this.transform=L,this._bounds=I,this._bounds.updateID+=this._boundsID-F,D}toGlobal(T,L,R=!1){return R||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(T,L)}toLocal(T,L,R,I){return L&&(T=L.toGlobal(T,R,I)),I||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(T,R)}setParent(T){if(!T||!T.addChild)throw new Error("setParent: Argument must be a Container");return T.addChild(this),T}removeFromParent(){this.parent?.removeChild(this)}setTransform(T=0,L=0,R=1,I=1,F=0,D=0,V=0,q=0,G=0){return this.position.x=T,this.position.y=L,this.scale.x=R||1,this.scale.y=I||1,this.rotation=F,this.skew.x=D,this.skew.y=V,this.pivot.x=q,this.pivot.y=G,this}destroy(T){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new TemporaryDisplayObject),this.tempDisplayObjectParent}enableTempParent(){const T=this.parent;return this.parent=this._tempDisplayObjectParent,T}disableTempParent(T){this.parent=T}get x(){return this.position.x}set x(T){this.transform.position.x=T}get y(){return this.position.y}set y(T){this.transform.position.y=T}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(T){this.transform.position.copyFrom(T)}get scale(){return this.transform.scale}set scale(T){this.transform.scale.copyFrom(T)}get pivot(){return this.transform.pivot}set pivot(T){this.transform.pivot.copyFrom(T)}get skew(){return this.transform.skew}set skew(T){this.transform.skew.copyFrom(T)}get rotation(){return this.transform.rotation}set rotation(T){this.transform.rotation=T}get angle(){return this.transform.rotation*RAD_TO_DEG}set angle(T){this.transform.rotation=T*DEG_TO_RAD}get zIndex(){return this._zIndex}set zIndex(T){this._zIndex!==T&&(this._zIndex=T,this.parent&&(this.parent.sortDirty=!0))}get worldVisible(){let T=this;do{if(!T.visible)return!1;T=T.parent}while(T);return!0}get mask(){return this._mask}set mask(T){if(this._mask!==T){if(this._mask){const L=this._mask.isMaskData?this._mask.maskObject:this._mask;L&&(L._maskRefCount--,L._maskRefCount===0&&(L.renderable=!0,L.isMask=!1))}if(this._mask=T,this._mask){const L=this._mask.isMaskData?this._mask.maskObject:this._mask;L&&(L._maskRefCount===0&&(L.renderable=!1,L.isMask=!0),L._maskRefCount++)}}}}class TemporaryDisplayObject extends DisplayObject{constructor(){super(...arguments),this.sortDirty=null}}DisplayObject.prototype.displayObjectUpdateTransform=DisplayObject.prototype.updateTransform;const tempMatrix=new Matrix;function sortChildren(P,T){return P.zIndex===T.zIndex?P._lastSortedIndex-T._lastSortedIndex:P.zIndex-T.zIndex}const _Container=class nr extends DisplayObject{constructor(){super(),this.children=[],this.sortableChildren=nr.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(T){}addChild(...T){if(T.length>1)for(let L=0;L<T.length;L++)this.addChild(T[L]);else{const L=T[0];L.parent&&L.parent.removeChild(L),L.parent=this,this.sortDirty=!0,L.transform._parentID=-1,this.children.push(L),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",L,this,this.children.length-1),L.emit("added",this)}return T[0]}addChildAt(T,L){if(L<0||L>this.children.length)throw new Error(`${T}addChildAt: The index ${L} supplied is out of bounds ${this.children.length}`);return T.parent&&T.parent.removeChild(T),T.parent=this,this.sortDirty=!0,T.transform._parentID=-1,this.children.splice(L,0,T),this._boundsID++,this.onChildrenChange(L),T.emit("added",this),this.emit("childAdded",T,this,L),T}swapChildren(T,L){if(T===L)return;const R=this.getChildIndex(T),I=this.getChildIndex(L);this.children[R]=L,this.children[I]=T,this.onChildrenChange(R<I?R:I)}getChildIndex(T){const L=this.children.indexOf(T);if(L===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return L}setChildIndex(T,L){if(L<0||L>=this.children.length)throw new Error(`The index ${L} supplied is out of bounds ${this.children.length}`);const R=this.getChildIndex(T);removeItems(this.children,R,1),this.children.splice(L,0,T),this.onChildrenChange(L)}getChildAt(T){if(T<0||T>=this.children.length)throw new Error(`getChildAt: Index (${T}) does not exist.`);return this.children[T]}removeChild(...T){if(T.length>1)for(let L=0;L<T.length;L++)this.removeChild(T[L]);else{const L=T[0],R=this.children.indexOf(L);if(R===-1)return null;L.parent=null,L.transform._parentID=-1,removeItems(this.children,R,1),this._boundsID++,this.onChildrenChange(R),L.emit("removed",this),this.emit("childRemoved",L,this,R)}return T[0]}removeChildAt(T){const L=this.getChildAt(T);return L.parent=null,L.transform._parentID=-1,removeItems(this.children,T,1),this._boundsID++,this.onChildrenChange(T),L.emit("removed",this),this.emit("childRemoved",L,this,T),L}removeChildren(T=0,L=this.children.length){const R=T,I=L,F=I-R;let D;if(F>0&&F<=I){D=this.children.splice(R,F);for(let V=0;V<D.length;++V)D[V].parent=null,D[V].transform&&(D[V].transform._parentID=-1);this._boundsID++,this.onChildrenChange(T);for(let V=0;V<D.length;++V)D[V].emit("removed",this),this.emit("childRemoved",D[V],this,V);return D}else if(F===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let T=!1;for(let L=0,R=this.children.length;L<R;++L){const I=this.children[L];I._lastSortedIndex=L,!T&&I.zIndex!==0&&(T=!0)}T&&this.children.length>1&&this.children.sort(sortChildren),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let T=0,L=this.children.length;T<L;++T){const R=this.children[T];R.visible&&R.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let T=0;T<this.children.length;T++){const L=this.children[T];if(!(!L.visible||!L.renderable))if(L.calculateBounds(),L._mask){const R=L._mask.isMaskData?L._mask.maskObject:L._mask;R?(R.calculateBounds(),this._bounds.addBoundsMask(L._bounds,R._bounds)):this._bounds.addBounds(L._bounds)}else L.filterArea?this._bounds.addBoundsArea(L._bounds,L.filterArea):this._bounds.addBounds(L._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(T,L=!1){const R=super.getLocalBounds(T);if(!L)for(let I=0,F=this.children.length;I<F;++I){const D=this.children[I];D.visible&&D.updateTransform()}return R}_calculateBounds(){}_renderWithCulling(T){const L=T.renderTexture.sourceFrame;if(!(L.width>0&&L.height>0))return;let R,I;this.cullArea?(R=this.cullArea,I=this.worldTransform):this._render!==nr.prototype._render&&(R=this.getBounds(!0));const F=T.projection.transform;if(F&&(I?(I=tempMatrix.copyFrom(I),I.prepend(F)):I=F),R&&L.intersects(R,I))this._render(T);else if(this.cullArea)return;for(let D=0,V=this.children.length;D<V;++D){const q=this.children[D],G=q.cullable;q.cullable=G||!this.cullArea,q.render(T),q.cullable=G}}render(T){if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||this.filters?.length)this.renderAdvanced(T);else if(this.cullable)this._renderWithCulling(T);else{this._render(T);for(let L=0,R=this.children.length;L<R;++L)this.children[L].render(T)}}renderAdvanced(T){const L=this.filters,R=this._mask;if(L){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let F=0;F<L.length;F++)L[F].enabled&&this._enabledFilters.push(L[F])}const I=L&&this._enabledFilters?.length||R&&(!R.isMaskData||R.enabled&&(R.autoDetect||R.type!==MASK_TYPES.NONE));if(I&&T.batch.flush(),L&&this._enabledFilters?.length&&T.filter.push(this,this._enabledFilters),R&&T.mask.push(this,this._mask),this.cullable)this._renderWithCulling(T);else{this._render(T);for(let F=0,D=this.children.length;F<D;++F)this.children[F].render(T)}I&&T.batch.flush(),R&&T.mask.pop(this),L&&this._enabledFilters?.length&&T.filter.pop()}_render(T){}destroy(T){super.destroy(),this.sortDirty=!1;const L=typeof T=="boolean"?T:T?.children,R=this.removeChildren(0,this.children.length);if(L)for(let I=0;I<R.length;++I)R[I].destroy(T)}get width(){return this.scale.x*this.getLocalBounds().width}set width(T){const L=this.getLocalBounds().width;L!==0?this.scale.x=T/L:this.scale.x=1,this._width=T}get height(){return this.scale.y*this.getLocalBounds().height}set height(T){const L=this.getLocalBounds().height;L!==0?this.scale.y=T/L:this.scale.y=1,this._height=T}};_Container.defaultSortableChildren=!1;let Container=_Container;Container.prototype.containerUpdateTransform=Container.prototype.updateTransform;Object.defineProperties(settings,{SORTABLE_CHILDREN:{get(){return Container.defaultSortableChildren},set(P){deprecation("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),Container.defaultSortableChildren=P}}});const _Application=class ar{constructor(T){this.stage=new Container,T=Object.assign({forceCanvas:!1},T),this.renderer=autoDetectRenderer(T),ar._plugins.forEach(L=>{L.init.call(this,T)})}render(){this.renderer.render(this.stage)}get view(){return this.renderer?.view}get screen(){return this.renderer?.screen}destroy(T,L){const R=ar._plugins.slice(0);R.reverse(),R.forEach(I=>{I.destroy.call(this)}),this.stage.destroy(L),this.stage=null,this.renderer.destroy(T),this.renderer=null}};_Application._plugins=[];let Application=_Application;extensions.handleByList(ExtensionType.Application,Application._plugins);class ResizePlugin{static init(T){Object.defineProperty(this,"resizeTo",{set(L){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=L,L&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let L,R;if(this._resizeTo===globalThis.window)L=globalThis.innerWidth,R=globalThis.innerHeight;else{const{clientWidth:I,clientHeight:F}=this._resizeTo;L=I,R=F}this.renderer.resize(L,R),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=T.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}ResizePlugin.extension=ExtensionType.Application;extensions.add(ResizePlugin);var d=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,u=`uniform float radius;
uniform float strength;
uniform vec2 center;
uniform sampler2D uSampler;
varying vec2 vTextureCoord;

uniform vec4 filterArea;
uniform vec4 filterClamp;
uniform vec2 dimensions;

void main()
{
    vec2 coord = vTextureCoord * filterArea.xy;
    coord -= center * dimensions.xy;
    float distance = length(coord);
    if (distance < radius) {
        float percent = distance / radius;
        if (strength > 0.0) {
            coord *= mix(1.0, smoothstep(0.0, radius / distance, percent), strength * 0.75);
        } else {
            coord *= mix(1.0, pow(percent, 1.0 + strength * 0.75) * radius / distance, 1.0 - percent);
        }
    }
    coord += center * dimensions.xy;
    coord /= filterArea.xy;
    vec2 clampedCoord = clamp(coord, filterClamp.xy, filterClamp.zw);
    vec4 color = texture2D(uSampler, clampedCoord);
    if (coord != clampedCoord) {
        color *= max(0.0, 1.0 - length(coord - clampedCoord));
    }

    gl_FragColor = color;
}
`;const n=class extends Filter{constructor(P){super(d,u),this.uniforms.dimensions=new Float32Array(2),Object.assign(this,n.defaults,P)}apply(P,T,L,R){const{width:I,height:F}=T.filterFrame;this.uniforms.dimensions[0]=I,this.uniforms.dimensions[1]=F,P.applyFilter(this,T,L,R)}get radius(){return this.uniforms.radius}set radius(P){this.uniforms.radius=P}get strength(){return this.uniforms.strength}set strength(P){this.uniforms.strength=P}get center(){return this.uniforms.center}set center(P){this.uniforms.center=P}};let t=n;t.defaults={center:[.5,.5],radius:100,strength:1};var fragment=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`;class ColorMatrixFilter extends Filter{constructor(){const T={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(defaultFilterVertex,fragment,T),this.alpha=1}_loadMatrix(T,L=!1){let R=T;L&&(this._multiply(R,this.uniforms.m,T),R=this._colorMatrix(R)),this.uniforms.m=R}_multiply(T,L,R){return T[0]=L[0]*R[0]+L[1]*R[5]+L[2]*R[10]+L[3]*R[15],T[1]=L[0]*R[1]+L[1]*R[6]+L[2]*R[11]+L[3]*R[16],T[2]=L[0]*R[2]+L[1]*R[7]+L[2]*R[12]+L[3]*R[17],T[3]=L[0]*R[3]+L[1]*R[8]+L[2]*R[13]+L[3]*R[18],T[4]=L[0]*R[4]+L[1]*R[9]+L[2]*R[14]+L[3]*R[19]+L[4],T[5]=L[5]*R[0]+L[6]*R[5]+L[7]*R[10]+L[8]*R[15],T[6]=L[5]*R[1]+L[6]*R[6]+L[7]*R[11]+L[8]*R[16],T[7]=L[5]*R[2]+L[6]*R[7]+L[7]*R[12]+L[8]*R[17],T[8]=L[5]*R[3]+L[6]*R[8]+L[7]*R[13]+L[8]*R[18],T[9]=L[5]*R[4]+L[6]*R[9]+L[7]*R[14]+L[8]*R[19]+L[9],T[10]=L[10]*R[0]+L[11]*R[5]+L[12]*R[10]+L[13]*R[15],T[11]=L[10]*R[1]+L[11]*R[6]+L[12]*R[11]+L[13]*R[16],T[12]=L[10]*R[2]+L[11]*R[7]+L[12]*R[12]+L[13]*R[17],T[13]=L[10]*R[3]+L[11]*R[8]+L[12]*R[13]+L[13]*R[18],T[14]=L[10]*R[4]+L[11]*R[9]+L[12]*R[14]+L[13]*R[19]+L[14],T[15]=L[15]*R[0]+L[16]*R[5]+L[17]*R[10]+L[18]*R[15],T[16]=L[15]*R[1]+L[16]*R[6]+L[17]*R[11]+L[18]*R[16],T[17]=L[15]*R[2]+L[16]*R[7]+L[17]*R[12]+L[18]*R[17],T[18]=L[15]*R[3]+L[16]*R[8]+L[17]*R[13]+L[18]*R[18],T[19]=L[15]*R[4]+L[16]*R[9]+L[17]*R[14]+L[18]*R[19]+L[19],T}_colorMatrix(T){const L=new Float32Array(T);return L[4]/=255,L[9]/=255,L[14]/=255,L[19]/=255,L}brightness(T,L){const R=[T,0,0,0,0,0,T,0,0,0,0,0,T,0,0,0,0,0,1,0];this._loadMatrix(R,L)}tint(T,L){const[R,I,F]=Color.shared.setValue(T).toArray(),D=[R,0,0,0,0,0,I,0,0,0,0,0,F,0,0,0,0,0,1,0];this._loadMatrix(D,L)}greyscale(T,L){const R=[T,T,T,0,0,T,T,T,0,0,T,T,T,0,0,0,0,0,1,0];this._loadMatrix(R,L)}blackAndWhite(T){const L=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(L,T)}hue(T,L){T=(T||0)/180*Math.PI;const R=Math.cos(T),I=Math.sin(T),F=Math.sqrt,D=1/3,V=F(D),q=R+(1-R)*D,G=D*(1-R)-V*I,z=D*(1-R)+V*I,Q=D*(1-R)+V*I,tt=R+D*(1-R),gt=D*(1-R)-V*I,yt=D*(1-R)-V*I,Et=D*(1-R)+V*I,J=R+D*(1-R),At=[q,G,z,0,0,Q,tt,gt,0,0,yt,Et,J,0,0,0,0,0,1,0];this._loadMatrix(At,L)}contrast(T,L){const R=(T||0)+1,I=-.5*(R-1),F=[R,0,0,0,I,0,R,0,0,I,0,0,R,0,I,0,0,0,1,0];this._loadMatrix(F,L)}saturate(T=0,L){const R=T*2/3+1,I=(R-1)*-.5,F=[R,I,I,0,0,I,R,I,0,0,I,I,R,0,0,0,0,0,1,0];this._loadMatrix(F,L)}desaturate(){this.saturate(-1)}negative(T){const L=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(L,T)}sepia(T){const L=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(L,T)}technicolor(T){const L=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(L,T)}polaroid(T){const L=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(L,T)}toBGR(T){const L=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(L,T)}kodachrome(T){const L=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(L,T)}browni(T){const L=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(L,T)}vintage(T){const L=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(L,T)}colorTone(T,L,R,I,F){T=T||.2,L=L||.15,R=R||16770432,I=I||3375104;const D=Color.shared,[V,q,G]=D.setValue(R).toArray(),[z,Q,tt]=D.setValue(I).toArray(),gt=[.3,.59,.11,0,0,V,q,G,T,0,z,Q,tt,L,0,V-z,q-Q,G-tt,0,0];this._loadMatrix(gt,F)}night(T,L){T=T||.1;const R=[T*-2,-T,0,0,0,-T,0,T,0,0,0,T,T*2,0,0,0,0,0,1,0];this._loadMatrix(R,L)}predator(T,L){const R=[11.224130630493164*T,-4.794486999511719*T,-2.8746118545532227*T,0*T,.40342438220977783*T,-3.6330697536468506*T,9.193157196044922*T,-2.951810836791992*T,0*T,-1.316135048866272*T,-3.2184197902679443*T,-4.2375030517578125*T,7.476448059082031*T,0*T,.8044459223747253*T,0,0,0,1,0];this._loadMatrix(R,L)}lsd(T){const L=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(L,T)}reset(){const T=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(T,!1)}get matrix(){return this.uniforms.m}set matrix(T){this.uniforms.m=T}get alpha(){return this.uniforms.uAlpha}set alpha(T){this.uniforms.uAlpha=T}}ColorMatrixFilter.prototype.grayscale=ColorMatrixFilter.prototype.greyscale;var be=Object.defineProperty,xe=(P,T,L)=>T in P?be(P,T,{enumerable:!0,configurable:!0,writable:!0,value:L}):P[T]=L,f=(P,T,L)=>xe(P,typeof T!="symbol"?T+"":T,L);class Ee{}class re extends Ee{constructor(T){super(),f(this,"observer"),f(this,"flowSpeed",4),f(this,"currerntRenderScale",.75),this.canvas=T,this.observer=new ResizeObserver(()=>{const L=Math.max(1,T.clientWidth*window.devicePixelRatio*this.currerntRenderScale),R=Math.max(1,T.clientHeight*window.devicePixelRatio*this.currerntRenderScale);this.onResize(L,R)}),this.observer.observe(T)}setRenderScale(T){this.currerntRenderScale=T,this.onResize(this.canvas.clientWidth*window.devicePixelRatio*this.currerntRenderScale,this.canvas.clientHeight*window.devicePixelRatio*this.currerntRenderScale)}onResize(T,L){this.canvas.width=T,this.canvas.height=L}setFlowSpeed(T){this.flowSpeed=T}dispose(){this.observer.disconnect(),this.canvas.remove()}getElement(){return this.canvas}}const N=1e-6,Ut=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),B=class ki extends Float32Array{constructor(...T){switch(T.length){case 16:super(T);break;case 2:super(T[0],T[1],16);break;case 1:const L=T[0];typeof L=="number"?super([L,L,L,L,L,L,L,L,L,L,L,L,L,L,L,L]):super(L,0,16);break;default:super(Ut);break}}get str(){return ki.str(this)}copy(T){return this.set(T),this}identity(){return this.set(Ut),this}multiply(T){return ki.multiply(this,this,T)}mul(T){return this}transpose(){return ki.transpose(this,this)}invert(){return ki.invert(this,this)}translate(T){return ki.translate(this,this,T)}rotate(T,L){return ki.rotate(this,this,T,L)}scale(T){return ki.scale(this,this,T)}rotateX(T){return ki.rotateX(this,this,T)}rotateY(T){return ki.rotateY(this,this,T)}rotateZ(T){return ki.rotateZ(this,this,T)}perspectiveNO(T,L,R,I){return ki.perspectiveNO(this,T,L,R,I)}perspectiveZO(T,L,R,I){return ki.perspectiveZO(this,T,L,R,I)}orthoNO(T,L,R,I,F,D){return ki.orthoNO(this,T,L,R,I,F,D)}orthoZO(T,L,R,I,F,D){return ki.orthoZO(this,T,L,R,I,F,D)}static create(){return new ki}static clone(T){return new ki(T)}static copy(T,L){return T[0]=L[0],T[1]=L[1],T[2]=L[2],T[3]=L[3],T[4]=L[4],T[5]=L[5],T[6]=L[6],T[7]=L[7],T[8]=L[8],T[9]=L[9],T[10]=L[10],T[11]=L[11],T[12]=L[12],T[13]=L[13],T[14]=L[14],T[15]=L[15],T}static fromValues(...T){return new ki(...T)}static set(T,...L){return T[0]=L[0],T[1]=L[1],T[2]=L[2],T[3]=L[3],T[4]=L[4],T[5]=L[5],T[6]=L[6],T[7]=L[7],T[8]=L[8],T[9]=L[9],T[10]=L[10],T[11]=L[11],T[12]=L[12],T[13]=L[13],T[14]=L[14],T[15]=L[15],T}static identity(T){return T[0]=1,T[1]=0,T[2]=0,T[3]=0,T[4]=0,T[5]=1,T[6]=0,T[7]=0,T[8]=0,T[9]=0,T[10]=1,T[11]=0,T[12]=0,T[13]=0,T[14]=0,T[15]=1,T}static transpose(T,L){if(T===L){const R=L[1],I=L[2],F=L[3],D=L[6],V=L[7],q=L[11];T[1]=L[4],T[2]=L[8],T[3]=L[12],T[4]=R,T[6]=L[9],T[7]=L[13],T[8]=I,T[9]=D,T[11]=L[14],T[12]=F,T[13]=V,T[14]=q}else T[0]=L[0],T[1]=L[4],T[2]=L[8],T[3]=L[12],T[4]=L[1],T[5]=L[5],T[6]=L[9],T[7]=L[13],T[8]=L[2],T[9]=L[6],T[10]=L[10],T[11]=L[14],T[12]=L[3],T[13]=L[7],T[14]=L[11],T[15]=L[15];return T}static invert(T,L){const R=L[0],I=L[1],F=L[2],D=L[3],V=L[4],q=L[5],G=L[6],z=L[7],Q=L[8],tt=L[9],gt=L[10],yt=L[11],Et=L[12],J=L[13],At=L[14],kt=L[15],ne=R*q-I*V,Te=R*G-F*V,Ht=R*z-D*V,Le=I*G-F*q,ee=I*z-D*q,si=F*z-D*G,ci=Q*J-tt*Et,ui=Q*At-gt*Et,di=Q*kt-yt*Et,ii=tt*At-gt*J,bi=tt*kt-yt*J,yi=gt*kt-yt*At;let gi=ne*yi-Te*bi+Ht*ii+Le*di-ee*ui+si*ci;return gi?(gi=1/gi,T[0]=(q*yi-G*bi+z*ii)*gi,T[1]=(F*bi-I*yi-D*ii)*gi,T[2]=(J*si-At*ee+kt*Le)*gi,T[3]=(gt*ee-tt*si-yt*Le)*gi,T[4]=(G*di-V*yi-z*ui)*gi,T[5]=(R*yi-F*di+D*ui)*gi,T[6]=(At*Ht-Et*si-kt*Te)*gi,T[7]=(Q*si-gt*Ht+yt*Te)*gi,T[8]=(V*bi-q*di+z*ci)*gi,T[9]=(I*di-R*bi-D*ci)*gi,T[10]=(Et*ee-J*Ht+kt*ne)*gi,T[11]=(tt*Ht-Q*ee-yt*ne)*gi,T[12]=(q*ui-V*ii-G*ci)*gi,T[13]=(R*ii-I*ui+F*ci)*gi,T[14]=(J*Te-Et*Le-At*ne)*gi,T[15]=(Q*Le-tt*Te+gt*ne)*gi,T):null}static adjoint(T,L){const R=L[0],I=L[1],F=L[2],D=L[3],V=L[4],q=L[5],G=L[6],z=L[7],Q=L[8],tt=L[9],gt=L[10],yt=L[11],Et=L[12],J=L[13],At=L[14],kt=L[15],ne=R*q-I*V,Te=R*G-F*V,Ht=R*z-D*V,Le=I*G-F*q,ee=I*z-D*q,si=F*z-D*G,ci=Q*J-tt*Et,ui=Q*At-gt*Et,di=Q*kt-yt*Et,ii=tt*At-gt*J,bi=tt*kt-yt*J,yi=gt*kt-yt*At;return T[0]=q*yi-G*bi+z*ii,T[1]=F*bi-I*yi-D*ii,T[2]=J*si-At*ee+kt*Le,T[3]=gt*ee-tt*si-yt*Le,T[4]=G*di-V*yi-z*ui,T[5]=R*yi-F*di+D*ui,T[6]=At*Ht-Et*si-kt*Te,T[7]=Q*si-gt*Ht+yt*Te,T[8]=V*bi-q*di+z*ci,T[9]=I*di-R*bi-D*ci,T[10]=Et*ee-J*Ht+kt*ne,T[11]=tt*Ht-Q*ee-yt*ne,T[12]=q*ui-V*ii-G*ci,T[13]=R*ii-I*ui+F*ci,T[14]=J*Te-Et*Le-At*ne,T[15]=Q*Le-tt*Te+gt*ne,T}static determinant(T){const L=T[0],R=T[1],I=T[2],F=T[3],D=T[4],V=T[5],q=T[6],G=T[7],z=T[8],Q=T[9],tt=T[10],gt=T[11],yt=T[12],Et=T[13],J=T[14],At=T[15],kt=L*V-R*D,ne=L*q-I*D,Te=R*q-I*V,Ht=z*Et-Q*yt,Le=z*J-tt*yt,ee=Q*J-tt*Et,si=L*ee-R*Le+I*Ht,ci=D*ee-V*Le+q*Ht,ui=z*Te-Q*ne+tt*kt,di=yt*Te-Et*ne+J*kt;return G*si-F*ci+At*ui-gt*di}static multiply(T,L,R){const I=L[0],F=L[1],D=L[2],V=L[3],q=L[4],G=L[5],z=L[6],Q=L[7],tt=L[8],gt=L[9],yt=L[10],Et=L[11],J=L[12],At=L[13],kt=L[14],ne=L[15];let Te=R[0],Ht=R[1],Le=R[2],ee=R[3];return T[0]=Te*I+Ht*q+Le*tt+ee*J,T[1]=Te*F+Ht*G+Le*gt+ee*At,T[2]=Te*D+Ht*z+Le*yt+ee*kt,T[3]=Te*V+Ht*Q+Le*Et+ee*ne,Te=R[4],Ht=R[5],Le=R[6],ee=R[7],T[4]=Te*I+Ht*q+Le*tt+ee*J,T[5]=Te*F+Ht*G+Le*gt+ee*At,T[6]=Te*D+Ht*z+Le*yt+ee*kt,T[7]=Te*V+Ht*Q+Le*Et+ee*ne,Te=R[8],Ht=R[9],Le=R[10],ee=R[11],T[8]=Te*I+Ht*q+Le*tt+ee*J,T[9]=Te*F+Ht*G+Le*gt+ee*At,T[10]=Te*D+Ht*z+Le*yt+ee*kt,T[11]=Te*V+Ht*Q+Le*Et+ee*ne,Te=R[12],Ht=R[13],Le=R[14],ee=R[15],T[12]=Te*I+Ht*q+Le*tt+ee*J,T[13]=Te*F+Ht*G+Le*gt+ee*At,T[14]=Te*D+Ht*z+Le*yt+ee*kt,T[15]=Te*V+Ht*Q+Le*Et+ee*ne,T}static mul(T,L,R){return T}static translate(T,L,R){const I=R[0],F=R[1],D=R[2];if(L===T)T[12]=L[0]*I+L[4]*F+L[8]*D+L[12],T[13]=L[1]*I+L[5]*F+L[9]*D+L[13],T[14]=L[2]*I+L[6]*F+L[10]*D+L[14],T[15]=L[3]*I+L[7]*F+L[11]*D+L[15];else{const V=L[0],q=L[1],G=L[2],z=L[3],Q=L[4],tt=L[5],gt=L[6],yt=L[7],Et=L[8],J=L[9],At=L[10],kt=L[11];T[0]=V,T[1]=q,T[2]=G,T[3]=z,T[4]=Q,T[5]=tt,T[6]=gt,T[7]=yt,T[8]=Et,T[9]=J,T[10]=At,T[11]=kt,T[12]=V*I+Q*F+Et*D+L[12],T[13]=q*I+tt*F+J*D+L[13],T[14]=G*I+gt*F+At*D+L[14],T[15]=z*I+yt*F+kt*D+L[15]}return T}static scale(T,L,R){const I=R[0],F=R[1],D=R[2];return T[0]=L[0]*I,T[1]=L[1]*I,T[2]=L[2]*I,T[3]=L[3]*I,T[4]=L[4]*F,T[5]=L[5]*F,T[6]=L[6]*F,T[7]=L[7]*F,T[8]=L[8]*D,T[9]=L[9]*D,T[10]=L[10]*D,T[11]=L[11]*D,T[12]=L[12],T[13]=L[13],T[14]=L[14],T[15]=L[15],T}static rotate(T,L,R,I){let F=I[0],D=I[1],V=I[2],q=Math.sqrt(F*F+D*D+V*V);if(q<N)return null;q=1/q,F*=q,D*=q,V*=q;const G=Math.sin(R),z=Math.cos(R),Q=1-z,tt=L[0],gt=L[1],yt=L[2],Et=L[3],J=L[4],At=L[5],kt=L[6],ne=L[7],Te=L[8],Ht=L[9],Le=L[10],ee=L[11],si=F*F*Q+z,ci=D*F*Q+V*G,ui=V*F*Q-D*G,di=F*D*Q-V*G,ii=D*D*Q+z,bi=V*D*Q+F*G,yi=F*V*Q+D*G,gi=D*V*Q-F*G,we=V*V*Q+z;return T[0]=tt*si+J*ci+Te*ui,T[1]=gt*si+At*ci+Ht*ui,T[2]=yt*si+kt*ci+Le*ui,T[3]=Et*si+ne*ci+ee*ui,T[4]=tt*di+J*ii+Te*bi,T[5]=gt*di+At*ii+Ht*bi,T[6]=yt*di+kt*ii+Le*bi,T[7]=Et*di+ne*ii+ee*bi,T[8]=tt*yi+J*gi+Te*we,T[9]=gt*yi+At*gi+Ht*we,T[10]=yt*yi+kt*gi+Le*we,T[11]=Et*yi+ne*gi+ee*we,L!==T&&(T[12]=L[12],T[13]=L[13],T[14]=L[14],T[15]=L[15]),T}static rotateX(T,L,R){let I=Math.sin(R),F=Math.cos(R),D=L[4],V=L[5],q=L[6],G=L[7],z=L[8],Q=L[9],tt=L[10],gt=L[11];return L!==T&&(T[0]=L[0],T[1]=L[1],T[2]=L[2],T[3]=L[3],T[12]=L[12],T[13]=L[13],T[14]=L[14],T[15]=L[15]),T[4]=D*F+z*I,T[5]=V*F+Q*I,T[6]=q*F+tt*I,T[7]=G*F+gt*I,T[8]=z*F-D*I,T[9]=Q*F-V*I,T[10]=tt*F-q*I,T[11]=gt*F-G*I,T}static rotateY(T,L,R){let I=Math.sin(R),F=Math.cos(R),D=L[0],V=L[1],q=L[2],G=L[3],z=L[8],Q=L[9],tt=L[10],gt=L[11];return L!==T&&(T[4]=L[4],T[5]=L[5],T[6]=L[6],T[7]=L[7],T[12]=L[12],T[13]=L[13],T[14]=L[14],T[15]=L[15]),T[0]=D*F-z*I,T[1]=V*F-Q*I,T[2]=q*F-tt*I,T[3]=G*F-gt*I,T[8]=D*I+z*F,T[9]=V*I+Q*F,T[10]=q*I+tt*F,T[11]=G*I+gt*F,T}static rotateZ(T,L,R){let I=Math.sin(R),F=Math.cos(R),D=L[0],V=L[1],q=L[2],G=L[3],z=L[4],Q=L[5],tt=L[6],gt=L[7];return L!==T&&(T[8]=L[8],T[9]=L[9],T[10]=L[10],T[11]=L[11],T[12]=L[12],T[13]=L[13],T[14]=L[14],T[15]=L[15]),T[0]=D*F+z*I,T[1]=V*F+Q*I,T[2]=q*F+tt*I,T[3]=G*F+gt*I,T[4]=z*F-D*I,T[5]=Q*F-V*I,T[6]=tt*F-q*I,T[7]=gt*F-G*I,T}static fromTranslation(T,L){return T[0]=1,T[1]=0,T[2]=0,T[3]=0,T[4]=0,T[5]=1,T[6]=0,T[7]=0,T[8]=0,T[9]=0,T[10]=1,T[11]=0,T[12]=L[0],T[13]=L[1],T[14]=L[2],T[15]=1,T}static fromScaling(T,L){return T[0]=L[0],T[1]=0,T[2]=0,T[3]=0,T[4]=0,T[5]=L[1],T[6]=0,T[7]=0,T[8]=0,T[9]=0,T[10]=L[2],T[11]=0,T[12]=0,T[13]=0,T[14]=0,T[15]=1,T}static fromRotation(T,L,R){let I=R[0],F=R[1],D=R[2],V=Math.sqrt(I*I+F*F+D*D);if(V<N)return null;V=1/V,I*=V,F*=V,D*=V;const q=Math.sin(L),G=Math.cos(L),z=1-G;return T[0]=I*I*z+G,T[1]=F*I*z+D*q,T[2]=D*I*z-F*q,T[3]=0,T[4]=I*F*z-D*q,T[5]=F*F*z+G,T[6]=D*F*z+I*q,T[7]=0,T[8]=I*D*z+F*q,T[9]=F*D*z-I*q,T[10]=D*D*z+G,T[11]=0,T[12]=0,T[13]=0,T[14]=0,T[15]=1,T}static fromXRotation(T,L){let R=Math.sin(L),I=Math.cos(L);return T[0]=1,T[1]=0,T[2]=0,T[3]=0,T[4]=0,T[5]=I,T[6]=R,T[7]=0,T[8]=0,T[9]=-R,T[10]=I,T[11]=0,T[12]=0,T[13]=0,T[14]=0,T[15]=1,T}static fromYRotation(T,L){let R=Math.sin(L),I=Math.cos(L);return T[0]=I,T[1]=0,T[2]=-R,T[3]=0,T[4]=0,T[5]=1,T[6]=0,T[7]=0,T[8]=R,T[9]=0,T[10]=I,T[11]=0,T[12]=0,T[13]=0,T[14]=0,T[15]=1,T}static fromZRotation(T,L){const R=Math.sin(L),I=Math.cos(L);return T[0]=I,T[1]=R,T[2]=0,T[3]=0,T[4]=-R,T[5]=I,T[6]=0,T[7]=0,T[8]=0,T[9]=0,T[10]=1,T[11]=0,T[12]=0,T[13]=0,T[14]=0,T[15]=1,T}static fromRotationTranslation(T,L,R){const I=L[0],F=L[1],D=L[2],V=L[3],q=I+I,G=F+F,z=D+D,Q=I*q,tt=I*G,gt=I*z,yt=F*G,Et=F*z,J=D*z,At=V*q,kt=V*G,ne=V*z;return T[0]=1-(yt+J),T[1]=tt+ne,T[2]=gt-kt,T[3]=0,T[4]=tt-ne,T[5]=1-(Q+J),T[6]=Et+At,T[7]=0,T[8]=gt+kt,T[9]=Et-At,T[10]=1-(Q+yt),T[11]=0,T[12]=R[0],T[13]=R[1],T[14]=R[2],T[15]=1,T}static fromQuat2(T,L){const R=-L[0],I=-L[1],F=-L[2],D=L[3],V=L[4],q=L[5],G=L[6],z=L[7];let Q=R*R+I*I+F*F+D*D;return Q>0?(Y[0]=(V*D+z*R+q*F-G*I)*2/Q,Y[1]=(q*D+z*I+G*R-V*F)*2/Q,Y[2]=(G*D+z*F+V*I-q*R)*2/Q):(Y[0]=(V*D+z*R+q*F-G*I)*2,Y[1]=(q*D+z*I+G*R-V*F)*2,Y[2]=(G*D+z*F+V*I-q*R)*2),ki.fromRotationTranslation(T,L,Y),T}static normalFromMat4(T,L){const R=L[0],I=L[1],F=L[2],D=L[3],V=L[4],q=L[5],G=L[6],z=L[7],Q=L[8],tt=L[9],gt=L[10],yt=L[11],Et=L[12],J=L[13],At=L[14],kt=L[15],ne=R*q-I*V,Te=R*G-F*V,Ht=R*z-D*V,Le=I*G-F*q,ee=I*z-D*q,si=F*z-D*G,ci=Q*J-tt*Et,ui=Q*At-gt*Et,di=Q*kt-yt*Et,ii=tt*At-gt*J,bi=tt*kt-yt*J,yi=gt*kt-yt*At;let gi=ne*yi-Te*bi+Ht*ii+Le*di-ee*ui+si*ci;return gi?(gi=1/gi,T[0]=(q*yi-G*bi+z*ii)*gi,T[1]=(G*di-V*yi-z*ui)*gi,T[2]=(V*bi-q*di+z*ci)*gi,T[3]=0,T[4]=(F*bi-I*yi-D*ii)*gi,T[5]=(R*yi-F*di+D*ui)*gi,T[6]=(I*di-R*bi-D*ci)*gi,T[7]=0,T[8]=(J*si-At*ee+kt*Le)*gi,T[9]=(At*Ht-Et*si-kt*Te)*gi,T[10]=(Et*ee-J*Ht+kt*ne)*gi,T[11]=0,T[12]=0,T[13]=0,T[14]=0,T[15]=1,T):null}static normalFromMat4Fast(T,L){const R=L[0],I=L[1],F=L[2],D=L[4],V=L[5],q=L[6],G=L[8],z=L[9],Q=L[10];return T[0]=V*Q-Q*z,T[1]=q*G-G*Q,T[2]=D*z-z*G,T[3]=0,T[4]=z*F-Q*I,T[5]=Q*R-G*F,T[6]=G*I-z*R,T[7]=0,T[8]=I*q-F*V,T[9]=F*D-R*q,T[10]=R*V-I*D,T[11]=0,T[12]=0,T[13]=0,T[14]=0,T[15]=1,T}static getTranslation(T,L){return T[0]=L[12],T[1]=L[13],T[2]=L[14],T}static getScaling(T,L){const R=L[0],I=L[1],F=L[2],D=L[4],V=L[5],q=L[6],G=L[8],z=L[9],Q=L[10];return T[0]=Math.sqrt(R*R+I*I+F*F),T[1]=Math.sqrt(D*D+V*V+q*q),T[2]=Math.sqrt(G*G+z*z+Q*Q),T}static getRotation(T,L){ki.getScaling(Y,L);const R=1/Y[0],I=1/Y[1],F=1/Y[2],D=L[0]*R,V=L[1]*I,q=L[2]*F,G=L[4]*R,z=L[5]*I,Q=L[6]*F,tt=L[8]*R,gt=L[9]*I,yt=L[10]*F,Et=D+z+yt;let J=0;return Et>0?(J=Math.sqrt(Et+1)*2,T[3]=.25*J,T[0]=(Q-gt)/J,T[1]=(tt-q)/J,T[2]=(V-G)/J):D>z&&D>yt?(J=Math.sqrt(1+D-z-yt)*2,T[3]=(Q-gt)/J,T[0]=.25*J,T[1]=(V+G)/J,T[2]=(tt+q)/J):z>yt?(J=Math.sqrt(1+z-D-yt)*2,T[3]=(tt-q)/J,T[0]=(V+G)/J,T[1]=.25*J,T[2]=(Q+gt)/J):(J=Math.sqrt(1+yt-D-z)*2,T[3]=(V-G)/J,T[0]=(tt+q)/J,T[1]=(Q+gt)/J,T[2]=.25*J),T}static decompose(T,L,R,I){L[0]=I[12],L[1]=I[13],L[2]=I[14];const F=I[0],D=I[1],V=I[2],q=I[4],G=I[5],z=I[6],Q=I[8],tt=I[9],gt=I[10];R[0]=Math.sqrt(F*F+D*D+V*V),R[1]=Math.sqrt(q*q+G*G+z*z),R[2]=Math.sqrt(Q*Q+tt*tt+gt*gt);const yt=1/R[0],Et=1/R[1],J=1/R[2],At=F*yt,kt=D*Et,ne=V*J,Te=q*yt,Ht=G*Et,Le=z*J,ee=Q*yt,si=tt*Et,ci=gt*J,ui=At+Ht+ci;let di=0;return ui>0?(di=Math.sqrt(ui+1)*2,T[3]=.25*di,T[0]=(Le-si)/di,T[1]=(ee-ne)/di,T[2]=(kt-Te)/di):At>Ht&&At>ci?(di=Math.sqrt(1+At-Ht-ci)*2,T[3]=(Le-si)/di,T[0]=.25*di,T[1]=(kt+Te)/di,T[2]=(ee+ne)/di):Ht>ci?(di=Math.sqrt(1+Ht-At-ci)*2,T[3]=(ee-ne)/di,T[0]=(kt+Te)/di,T[1]=.25*di,T[2]=(Le+si)/di):(di=Math.sqrt(1+ci-At-Ht)*2,T[3]=(kt-Te)/di,T[0]=(ee+ne)/di,T[1]=(Le+si)/di,T[2]=.25*di),T}static fromRotationTranslationScale(T,L,R,I){const F=L[0],D=L[1],V=L[2],q=L[3],G=F+F,z=D+D,Q=V+V,tt=F*G,gt=F*z,yt=F*Q,Et=D*z,J=D*Q,At=V*Q,kt=q*G,ne=q*z,Te=q*Q,Ht=I[0],Le=I[1],ee=I[2];return T[0]=(1-(Et+At))*Ht,T[1]=(gt+Te)*Ht,T[2]=(yt-ne)*Ht,T[3]=0,T[4]=(gt-Te)*Le,T[5]=(1-(tt+At))*Le,T[6]=(J+kt)*Le,T[7]=0,T[8]=(yt+ne)*ee,T[9]=(J-kt)*ee,T[10]=(1-(tt+Et))*ee,T[11]=0,T[12]=R[0],T[13]=R[1],T[14]=R[2],T[15]=1,T}static fromRotationTranslationScaleOrigin(T,L,R,I,F){const D=L[0],V=L[1],q=L[2],G=L[3],z=D+D,Q=V+V,tt=q+q,gt=D*z,yt=D*Q,Et=D*tt,J=V*Q,At=V*tt,kt=q*tt,ne=G*z,Te=G*Q,Ht=G*tt,Le=I[0],ee=I[1],si=I[2],ci=F[0],ui=F[1],di=F[2],ii=(1-(J+kt))*Le,bi=(yt+Ht)*Le,yi=(Et-Te)*Le,gi=(yt-Ht)*ee,we=(1-(gt+kt))*ee,Ge=(At+ne)*ee,Se=(Et+Te)*si,ni=(At-ne)*si,ti=(1-(gt+J))*si;return T[0]=ii,T[1]=bi,T[2]=yi,T[3]=0,T[4]=gi,T[5]=we,T[6]=Ge,T[7]=0,T[8]=Se,T[9]=ni,T[10]=ti,T[11]=0,T[12]=R[0]+ci-(ii*ci+gi*ui+Se*di),T[13]=R[1]+ui-(bi*ci+we*ui+ni*di),T[14]=R[2]+di-(yi*ci+Ge*ui+ti*di),T[15]=1,T}static fromQuat(T,L){const R=L[0],I=L[1],F=L[2],D=L[3],V=R+R,q=I+I,G=F+F,z=R*V,Q=I*V,tt=I*q,gt=F*V,yt=F*q,Et=F*G,J=D*V,At=D*q,kt=D*G;return T[0]=1-tt-Et,T[1]=Q+kt,T[2]=gt-At,T[3]=0,T[4]=Q-kt,T[5]=1-z-Et,T[6]=yt+J,T[7]=0,T[8]=gt+At,T[9]=yt-J,T[10]=1-z-tt,T[11]=0,T[12]=0,T[13]=0,T[14]=0,T[15]=1,T}static frustumNO(T,L,R,I,F,D,V=1/0){const q=1/(R-L),G=1/(F-I);if(T[0]=D*2*q,T[1]=0,T[2]=0,T[3]=0,T[4]=0,T[5]=D*2*G,T[6]=0,T[7]=0,T[8]=(R+L)*q,T[9]=(F+I)*G,T[11]=-1,T[12]=0,T[13]=0,T[15]=0,V!=null&&V!==1/0){const z=1/(D-V);T[10]=(V+D)*z,T[14]=2*V*D*z}else T[10]=-1,T[14]=-2*D;return T}static frustum(T,L,R,I,F,D,V=1/0){return T}static frustumZO(T,L,R,I,F,D,V=1/0){const q=1/(R-L),G=1/(F-I);if(T[0]=D*2*q,T[1]=0,T[2]=0,T[3]=0,T[4]=0,T[5]=D*2*G,T[6]=0,T[7]=0,T[8]=(R+L)*q,T[9]=(F+I)*G,T[11]=-1,T[12]=0,T[13]=0,T[15]=0,V!=null&&V!==1/0){const z=1/(D-V);T[10]=V*z,T[14]=V*D*z}else T[10]=-1,T[14]=-D;return T}static perspectiveNO(T,L,R,I,F=1/0){const D=1/Math.tan(L/2);if(T[0]=D/R,T[1]=0,T[2]=0,T[3]=0,T[4]=0,T[5]=D,T[6]=0,T[7]=0,T[8]=0,T[9]=0,T[11]=-1,T[12]=0,T[13]=0,T[15]=0,F!=null&&F!==1/0){const V=1/(I-F);T[10]=(F+I)*V,T[14]=2*F*I*V}else T[10]=-1,T[14]=-2*I;return T}static perspective(T,L,R,I,F=1/0){return T}static perspectiveZO(T,L,R,I,F=1/0){const D=1/Math.tan(L/2);if(T[0]=D/R,T[1]=0,T[2]=0,T[3]=0,T[4]=0,T[5]=D,T[6]=0,T[7]=0,T[8]=0,T[9]=0,T[11]=-1,T[12]=0,T[13]=0,T[15]=0,F!=null&&F!==1/0){const V=1/(I-F);T[10]=F*V,T[14]=F*I*V}else T[10]=-1,T[14]=-I;return T}static perspectiveFromFieldOfView(T,L,R,I){const F=Math.tan(L.upDegrees*Math.PI/180),D=Math.tan(L.downDegrees*Math.PI/180),V=Math.tan(L.leftDegrees*Math.PI/180),q=Math.tan(L.rightDegrees*Math.PI/180),G=2/(V+q),z=2/(F+D);return T[0]=G,T[1]=0,T[2]=0,T[3]=0,T[4]=0,T[5]=z,T[6]=0,T[7]=0,T[8]=-((V-q)*G*.5),T[9]=(F-D)*z*.5,T[10]=I/(R-I),T[11]=-1,T[12]=0,T[13]=0,T[14]=I*R/(R-I),T[15]=0,T}static orthoNO(T,L,R,I,F,D,V){const q=1/(L-R),G=1/(I-F),z=1/(D-V);return T[0]=-2*q,T[1]=0,T[2]=0,T[3]=0,T[4]=0,T[5]=-2*G,T[6]=0,T[7]=0,T[8]=0,T[9]=0,T[10]=2*z,T[11]=0,T[12]=(L+R)*q,T[13]=(F+I)*G,T[14]=(V+D)*z,T[15]=1,T}static ortho(T,L,R,I,F,D,V){return T}static orthoZO(T,L,R,I,F,D,V){const q=1/(L-R),G=1/(I-F),z=1/(D-V);return T[0]=-2*q,T[1]=0,T[2]=0,T[3]=0,T[4]=0,T[5]=-2*G,T[6]=0,T[7]=0,T[8]=0,T[9]=0,T[10]=z,T[11]=0,T[12]=(L+R)*q,T[13]=(F+I)*G,T[14]=D*z,T[15]=1,T}static lookAt(T,L,R,I){const F=L[0],D=L[1],V=L[2],q=I[0],G=I[1],z=I[2],Q=R[0],tt=R[1],gt=R[2];if(Math.abs(F-Q)<N&&Math.abs(D-tt)<N&&Math.abs(V-gt)<N)return ki.identity(T);let yt=F-Q,Et=D-tt,J=V-gt,At=1/Math.sqrt(yt*yt+Et*Et+J*J);yt*=At,Et*=At,J*=At;let kt=G*J-z*Et,ne=z*yt-q*J,Te=q*Et-G*yt;At=Math.sqrt(kt*kt+ne*ne+Te*Te),At?(At=1/At,kt*=At,ne*=At,Te*=At):(kt=0,ne=0,Te=0);let Ht=Et*Te-J*ne,Le=J*kt-yt*Te,ee=yt*ne-Et*kt;return At=Math.sqrt(Ht*Ht+Le*Le+ee*ee),At?(At=1/At,Ht*=At,Le*=At,ee*=At):(Ht=0,Le=0,ee=0),T[0]=kt,T[1]=Ht,T[2]=yt,T[3]=0,T[4]=ne,T[5]=Le,T[6]=Et,T[7]=0,T[8]=Te,T[9]=ee,T[10]=J,T[11]=0,T[12]=-(kt*F+ne*D+Te*V),T[13]=-(Ht*F+Le*D+ee*V),T[14]=-(yt*F+Et*D+J*V),T[15]=1,T}static targetTo(T,L,R,I){const F=L[0],D=L[1],V=L[2],q=I[0],G=I[1],z=I[2];let Q=F-R[0],tt=D-R[1],gt=V-R[2],yt=Q*Q+tt*tt+gt*gt;yt>0&&(yt=1/Math.sqrt(yt),Q*=yt,tt*=yt,gt*=yt);let Et=G*gt-z*tt,J=z*Q-q*gt,At=q*tt-G*Q;return yt=Et*Et+J*J+At*At,yt>0&&(yt=1/Math.sqrt(yt),Et*=yt,J*=yt,At*=yt),T[0]=Et,T[1]=J,T[2]=At,T[3]=0,T[4]=tt*At-gt*J,T[5]=gt*Et-Q*At,T[6]=Q*J-tt*Et,T[7]=0,T[8]=Q,T[9]=tt,T[10]=gt,T[11]=0,T[12]=F,T[13]=D,T[14]=V,T[15]=1,T}static frob(T){return Math.sqrt(T[0]*T[0]+T[1]*T[1]+T[2]*T[2]+T[3]*T[3]+T[4]*T[4]+T[5]*T[5]+T[6]*T[6]+T[7]*T[7]+T[8]*T[8]+T[9]*T[9]+T[10]*T[10]+T[11]*T[11]+T[12]*T[12]+T[13]*T[13]+T[14]*T[14]+T[15]*T[15])}static add(T,L,R){return T[0]=L[0]+R[0],T[1]=L[1]+R[1],T[2]=L[2]+R[2],T[3]=L[3]+R[3],T[4]=L[4]+R[4],T[5]=L[5]+R[5],T[6]=L[6]+R[6],T[7]=L[7]+R[7],T[8]=L[8]+R[8],T[9]=L[9]+R[9],T[10]=L[10]+R[10],T[11]=L[11]+R[11],T[12]=L[12]+R[12],T[13]=L[13]+R[13],T[14]=L[14]+R[14],T[15]=L[15]+R[15],T}static subtract(T,L,R){return T[0]=L[0]-R[0],T[1]=L[1]-R[1],T[2]=L[2]-R[2],T[3]=L[3]-R[3],T[4]=L[4]-R[4],T[5]=L[5]-R[5],T[6]=L[6]-R[6],T[7]=L[7]-R[7],T[8]=L[8]-R[8],T[9]=L[9]-R[9],T[10]=L[10]-R[10],T[11]=L[11]-R[11],T[12]=L[12]-R[12],T[13]=L[13]-R[13],T[14]=L[14]-R[14],T[15]=L[15]-R[15],T}static sub(T,L,R){return T}static multiplyScalar(T,L,R){return T[0]=L[0]*R,T[1]=L[1]*R,T[2]=L[2]*R,T[3]=L[3]*R,T[4]=L[4]*R,T[5]=L[5]*R,T[6]=L[6]*R,T[7]=L[7]*R,T[8]=L[8]*R,T[9]=L[9]*R,T[10]=L[10]*R,T[11]=L[11]*R,T[12]=L[12]*R,T[13]=L[13]*R,T[14]=L[14]*R,T[15]=L[15]*R,T}static multiplyScalarAndAdd(T,L,R,I){return T[0]=L[0]+R[0]*I,T[1]=L[1]+R[1]*I,T[2]=L[2]+R[2]*I,T[3]=L[3]+R[3]*I,T[4]=L[4]+R[4]*I,T[5]=L[5]+R[5]*I,T[6]=L[6]+R[6]*I,T[7]=L[7]+R[7]*I,T[8]=L[8]+R[8]*I,T[9]=L[9]+R[9]*I,T[10]=L[10]+R[10]*I,T[11]=L[11]+R[11]*I,T[12]=L[12]+R[12]*I,T[13]=L[13]+R[13]*I,T[14]=L[14]+R[14]*I,T[15]=L[15]+R[15]*I,T}static exactEquals(T,L){return T[0]===L[0]&&T[1]===L[1]&&T[2]===L[2]&&T[3]===L[3]&&T[4]===L[4]&&T[5]===L[5]&&T[6]===L[6]&&T[7]===L[7]&&T[8]===L[8]&&T[9]===L[9]&&T[10]===L[10]&&T[11]===L[11]&&T[12]===L[12]&&T[13]===L[13]&&T[14]===L[14]&&T[15]===L[15]}static equals(T,L){const R=T[0],I=T[1],F=T[2],D=T[3],V=T[4],q=T[5],G=T[6],z=T[7],Q=T[8],tt=T[9],gt=T[10],yt=T[11],Et=T[12],J=T[13],At=T[14],kt=T[15],ne=L[0],Te=L[1],Ht=L[2],Le=L[3],ee=L[4],si=L[5],ci=L[6],ui=L[7],di=L[8],ii=L[9],bi=L[10],yi=L[11],gi=L[12],we=L[13],Ge=L[14],Se=L[15];return Math.abs(R-ne)<=N*Math.max(1,Math.abs(R),Math.abs(ne))&&Math.abs(I-Te)<=N*Math.max(1,Math.abs(I),Math.abs(Te))&&Math.abs(F-Ht)<=N*Math.max(1,Math.abs(F),Math.abs(Ht))&&Math.abs(D-Le)<=N*Math.max(1,Math.abs(D),Math.abs(Le))&&Math.abs(V-ee)<=N*Math.max(1,Math.abs(V),Math.abs(ee))&&Math.abs(q-si)<=N*Math.max(1,Math.abs(q),Math.abs(si))&&Math.abs(G-ci)<=N*Math.max(1,Math.abs(G),Math.abs(ci))&&Math.abs(z-ui)<=N*Math.max(1,Math.abs(z),Math.abs(ui))&&Math.abs(Q-di)<=N*Math.max(1,Math.abs(Q),Math.abs(di))&&Math.abs(tt-ii)<=N*Math.max(1,Math.abs(tt),Math.abs(ii))&&Math.abs(gt-bi)<=N*Math.max(1,Math.abs(gt),Math.abs(bi))&&Math.abs(yt-yi)<=N*Math.max(1,Math.abs(yt),Math.abs(yi))&&Math.abs(Et-gi)<=N*Math.max(1,Math.abs(Et),Math.abs(gi))&&Math.abs(J-we)<=N*Math.max(1,Math.abs(J),Math.abs(we))&&Math.abs(At-Ge)<=N*Math.max(1,Math.abs(At),Math.abs(Ge))&&Math.abs(kt-Se)<=N*Math.max(1,Math.abs(kt),Math.abs(Se))}static str(T){return`Mat4(${T.join(", ")})`}};f(B,"BYTE_LENGTH",16*Float32Array.BYTES_PER_ELEMENT);let _=B;const Y=new Float32Array(3);_.prototype.mul=_.prototype.multiply;_.sub=_.subtract;_.mul=_.multiply;_.frustum=_.frustumNO;_.perspective=_.perspectiveNO;_.ortho=_.orthoNO;const U=class qi extends Float32Array{constructor(...T){switch(T.length){case 3:super(T);break;case 2:super(T[0],T[1],3);break;case 1:{const L=T[0];typeof L=="number"?super([L,L,L]):super(L,0,3);break}default:super(3);break}}get x(){return this[0]}set x(T){this[0]=T}get y(){return this[1]}set y(T){this[1]=T}get z(){return this[2]}set z(T){this[2]=T}get r(){return this[0]}set r(T){this[0]=T}get g(){return this[1]}set g(T){this[1]=T}get b(){return this[2]}set b(T){this[2]=T}get magnitude(){const T=this[0],L=this[1],R=this[2];return Math.sqrt(T*T+L*L+R*R)}get mag(){return this.magnitude}get squaredMagnitude(){const T=this[0],L=this[1],R=this[2];return T*T+L*L+R*R}get sqrMag(){return this.squaredMagnitude}get str(){return qi.str(this)}copy(T){return this.set(T),this}add(T){return this[0]+=T[0],this[1]+=T[1],this[2]+=T[2],this}subtract(T){return this[0]-=T[0],this[1]-=T[1],this[2]-=T[2],this}sub(T){return this}multiply(T){return this[0]*=T[0],this[1]*=T[1],this[2]*=T[2],this}mul(T){return this}divide(T){return this[0]/=T[0],this[1]/=T[1],this[2]/=T[2],this}div(T){return this}scale(T){return this[0]*=T,this[1]*=T,this[2]*=T,this}scaleAndAdd(T,L){return this[0]+=T[0]*L,this[1]+=T[1]*L,this[2]+=T[2]*L,this}distance(T){return qi.distance(this,T)}dist(T){return 0}squaredDistance(T){return qi.squaredDistance(this,T)}sqrDist(T){return 0}negate(){return this[0]*=-1,this[1]*=-1,this[2]*=-1,this}invert(){return this[0]=1/this[0],this[1]=1/this[1],this[2]=1/this[2],this}abs(){return this[0]=Math.abs(this[0]),this[1]=Math.abs(this[1]),this[2]=Math.abs(this[2]),this}dot(T){return this[0]*T[0]+this[1]*T[1]+this[2]*T[2]}normalize(){return qi.normalize(this,this)}static create(){return new qi}static clone(T){return new qi(T)}static magnitude(T){let L=T[0],R=T[1],I=T[2];return Math.sqrt(L*L+R*R+I*I)}static mag(T){return 0}static length(T){return 0}static len(T){return 0}static fromValues(T,L,R){return new qi(T,L,R)}static copy(T,L){return T[0]=L[0],T[1]=L[1],T[2]=L[2],T}static set(T,L,R,I){return T[0]=L,T[1]=R,T[2]=I,T}static add(T,L,R){return T[0]=L[0]+R[0],T[1]=L[1]+R[1],T[2]=L[2]+R[2],T}static subtract(T,L,R){return T[0]=L[0]-R[0],T[1]=L[1]-R[1],T[2]=L[2]-R[2],T}static sub(T,L,R){return[0,0,0]}static multiply(T,L,R){return T[0]=L[0]*R[0],T[1]=L[1]*R[1],T[2]=L[2]*R[2],T}static mul(T,L,R){return[0,0,0]}static divide(T,L,R){return T[0]=L[0]/R[0],T[1]=L[1]/R[1],T[2]=L[2]/R[2],T}static div(T,L,R){return[0,0,0]}static ceil(T,L){return T[0]=Math.ceil(L[0]),T[1]=Math.ceil(L[1]),T[2]=Math.ceil(L[2]),T}static floor(T,L){return T[0]=Math.floor(L[0]),T[1]=Math.floor(L[1]),T[2]=Math.floor(L[2]),T}static min(T,L,R){return T[0]=Math.min(L[0],R[0]),T[1]=Math.min(L[1],R[1]),T[2]=Math.min(L[2],R[2]),T}static max(T,L,R){return T[0]=Math.max(L[0],R[0]),T[1]=Math.max(L[1],R[1]),T[2]=Math.max(L[2],R[2]),T}static scale(T,L,R){return T[0]=L[0]*R,T[1]=L[1]*R,T[2]=L[2]*R,T}static scaleAndAdd(T,L,R,I){return T[0]=L[0]+R[0]*I,T[1]=L[1]+R[1]*I,T[2]=L[2]+R[2]*I,T}static distance(T,L){const R=L[0]-T[0],I=L[1]-T[1],F=L[2]-T[2];return Math.sqrt(R*R+I*I+F*F)}static dist(T,L){return 0}static squaredDistance(T,L){const R=L[0]-T[0],I=L[1]-T[1],F=L[2]-T[2];return R*R+I*I+F*F}static sqrDist(T,L){return 0}static squaredLength(T){const L=T[0],R=T[1],I=T[2];return L*L+R*R+I*I}static sqrLen(T,L){return 0}static negate(T,L){return T[0]=-L[0],T[1]=-L[1],T[2]=-L[2],T}static inverse(T,L){return T[0]=1/L[0],T[1]=1/L[1],T[2]=1/L[2],T}static abs(T,L){return T[0]=Math.abs(L[0]),T[1]=Math.abs(L[1]),T[2]=Math.abs(L[2]),T}static normalize(T,L){const R=L[0],I=L[1],F=L[2];let D=R*R+I*I+F*F;return D>0&&(D=1/Math.sqrt(D)),T[0]=L[0]*D,T[1]=L[1]*D,T[2]=L[2]*D,T}static dot(T,L){return T[0]*L[0]+T[1]*L[1]+T[2]*L[2]}static cross(T,L,R){const I=L[0],F=L[1],D=L[2],V=R[0],q=R[1],G=R[2];return T[0]=F*G-D*q,T[1]=D*V-I*G,T[2]=I*q-F*V,T}static lerp(T,L,R,I){const F=L[0],D=L[1],V=L[2];return T[0]=F+I*(R[0]-F),T[1]=D+I*(R[1]-D),T[2]=V+I*(R[2]-V),T}static slerp(T,L,R,I){const F=Math.acos(Math.min(Math.max(qi.dot(L,R),-1),1)),D=Math.sin(F),V=Math.sin((1-I)*F)/D,q=Math.sin(I*F)/D;return T[0]=V*L[0]+q*R[0],T[1]=V*L[1]+q*R[1],T[2]=V*L[2]+q*R[2],T}static hermite(T,L,R,I,F,D){const V=D*D,q=V*(2*D-3)+1,G=V*(D-2)+D,z=V*(D-1),Q=V*(3-2*D);return T[0]=L[0]*q+R[0]*G+I[0]*z+F[0]*Q,T[1]=L[1]*q+R[1]*G+I[1]*z+F[1]*Q,T[2]=L[2]*q+R[2]*G+I[2]*z+F[2]*Q,T}static bezier(T,L,R,I,F,D){const V=1-D,q=V*V,G=D*D,z=q*V,Q=3*D*q,tt=3*G*V,gt=G*D;return T[0]=L[0]*z+R[0]*Q+I[0]*tt+F[0]*gt,T[1]=L[1]*z+R[1]*Q+I[1]*tt+F[1]*gt,T[2]=L[2]*z+R[2]*Q+I[2]*tt+F[2]*gt,T}static transformMat4(T,L,R){const I=L[0],F=L[1],D=L[2],V=R[3]*I+R[7]*F+R[11]*D+R[15]||1;return T[0]=(R[0]*I+R[4]*F+R[8]*D+R[12])/V,T[1]=(R[1]*I+R[5]*F+R[9]*D+R[13])/V,T[2]=(R[2]*I+R[6]*F+R[10]*D+R[14])/V,T}static transformMat3(T,L,R){let I=L[0],F=L[1],D=L[2];return T[0]=I*R[0]+F*R[3]+D*R[6],T[1]=I*R[1]+F*R[4]+D*R[7],T[2]=I*R[2]+F*R[5]+D*R[8],T}static transformQuat(T,L,R){const I=R[0],F=R[1],D=R[2],V=R[3]*2,q=L[0],G=L[1],z=L[2],Q=F*z-D*G,tt=D*q-I*z,gt=I*G-F*q,yt=(F*gt-D*tt)*2,Et=(D*Q-I*gt)*2,J=(I*tt-F*Q)*2;return T[0]=q+Q*V+yt,T[1]=G+tt*V+Et,T[2]=z+gt*V+J,T}static rotateX(T,L,R,I){const F=R[1],D=R[2],V=L[1]-F,q=L[2]-D;return T[0]=L[0],T[1]=V*Math.cos(I)-q*Math.sin(I)+F,T[2]=V*Math.sin(I)+q*Math.cos(I)+D,T}static rotateY(T,L,R,I){const F=R[0],D=R[2],V=L[0]-F,q=L[2]-D;return T[0]=q*Math.sin(I)+V*Math.cos(I)+F,T[1]=L[1],T[2]=q*Math.cos(I)-V*Math.sin(I)+D,T}static rotateZ(T,L,R,I){const F=R[0],D=R[1],V=L[0]-F,q=L[1]-D;return T[0]=V*Math.cos(I)-q*Math.sin(I)+F,T[1]=V*Math.sin(I)+q*Math.cos(I)+D,T[2]=R[2],T}static angle(T,L){const R=T[0],I=T[1],F=T[2],D=L[0],V=L[1],q=L[2],G=Math.sqrt((R*R+I*I+F*F)*(D*D+V*V+q*q)),z=G&&qi.dot(T,L)/G;return Math.acos(Math.min(Math.max(z,-1),1))}static zero(T){return T[0]=0,T[1]=0,T[2]=0,T}static str(T){return`Vec3(${T.join(", ")})`}static exactEquals(T,L){return T[0]===L[0]&&T[1]===L[1]&&T[2]===L[2]}static equals(T,L){const R=T[0],I=T[1],F=T[2],D=L[0],V=L[1],q=L[2];return Math.abs(R-D)<=N*Math.max(1,Math.abs(R),Math.abs(D))&&Math.abs(I-V)<=N*Math.max(1,Math.abs(I),Math.abs(V))&&Math.abs(F-q)<=N*Math.max(1,Math.abs(F),Math.abs(q))}};f(U,"BYTE_LENGTH",3*Float32Array.BYTES_PER_ELEMENT);let O=U;O.prototype.sub=O.prototype.subtract;O.prototype.mul=O.prototype.multiply;O.prototype.div=O.prototype.divide;O.prototype.dist=O.prototype.distance;O.prototype.sqrDist=O.prototype.squaredDistance;O.sub=O.subtract;O.mul=O.multiply;O.div=O.divide;O.dist=O.distance;O.sqrDist=O.squaredDistance;O.sqrLen=O.squaredLength;O.mag=O.magnitude;O.length=O.magnitude;O.len=O.magnitude;const X=class zi extends Float32Array{constructor(...T){switch(T.length){case 4:super(T);break;case 2:super(T[0],T[1],4);break;case 1:{const L=T[0];typeof L=="number"?super([L,L,L,L]):super(L,0,4);break}default:super(4);break}}get x(){return this[0]}set x(T){this[0]=T}get y(){return this[1]}set y(T){this[1]=T}get z(){return this[2]}set z(T){this[2]=T}get w(){return this[3]}set w(T){this[3]=T}get r(){return this[0]}set r(T){this[0]=T}get g(){return this[1]}set g(T){this[1]=T}get b(){return this[2]}set b(T){this[2]=T}get a(){return this[3]}set a(T){this[3]=T}get magnitude(){const T=this[0],L=this[1],R=this[2],I=this[3];return Math.sqrt(T*T+L*L+R*R+I*I)}get mag(){return this.magnitude}get str(){return zi.str(this)}copy(T){return super.set(T),this}add(T){return this[0]+=T[0],this[1]+=T[1],this[2]+=T[2],this[3]+=T[3],this}subtract(T){return this[0]-=T[0],this[1]-=T[1],this[2]-=T[2],this[3]-=T[3],this}sub(T){return this}multiply(T){return this[0]*=T[0],this[1]*=T[1],this[2]*=T[2],this[3]*=T[3],this}mul(T){return this}divide(T){return this[0]/=T[0],this[1]/=T[1],this[2]/=T[2],this[3]/=T[3],this}div(T){return this}scale(T){return this[0]*=T,this[1]*=T,this[2]*=T,this[3]*=T,this}scaleAndAdd(T,L){return this[0]+=T[0]*L,this[1]+=T[1]*L,this[2]+=T[2]*L,this[3]+=T[3]*L,this}distance(T){return zi.distance(this,T)}dist(T){return 0}squaredDistance(T){return zi.squaredDistance(this,T)}sqrDist(T){return 0}negate(){return this[0]*=-1,this[1]*=-1,this[2]*=-1,this[3]*=-1,this}invert(){return this[0]=1/this[0],this[1]=1/this[1],this[2]=1/this[2],this[3]=1/this[3],this}abs(){return this[0]=Math.abs(this[0]),this[1]=Math.abs(this[1]),this[2]=Math.abs(this[2]),this[3]=Math.abs(this[3]),this}dot(T){return this[0]*T[0]+this[1]*T[1]+this[2]*T[2]+this[3]*T[3]}normalize(){return zi.normalize(this,this)}static create(){return new zi}static clone(T){return new zi(T)}static fromValues(T,L,R,I){return new zi(T,L,R,I)}static copy(T,L){return T[0]=L[0],T[1]=L[1],T[2]=L[2],T[3]=L[3],T}static set(T,L,R,I,F){return T[0]=L,T[1]=R,T[2]=I,T[3]=F,T}static add(T,L,R){return T[0]=L[0]+R[0],T[1]=L[1]+R[1],T[2]=L[2]+R[2],T[3]=L[3]+R[3],T}static subtract(T,L,R){return T[0]=L[0]-R[0],T[1]=L[1]-R[1],T[2]=L[2]-R[2],T[3]=L[3]-R[3],T}static sub(T,L,R){return T}static multiply(T,L,R){return T[0]=L[0]*R[0],T[1]=L[1]*R[1],T[2]=L[2]*R[2],T[3]=L[3]*R[3],T}static mul(T,L,R){return T}static divide(T,L,R){return T[0]=L[0]/R[0],T[1]=L[1]/R[1],T[2]=L[2]/R[2],T[3]=L[3]/R[3],T}static div(T,L,R){return T}static ceil(T,L){return T[0]=Math.ceil(L[0]),T[1]=Math.ceil(L[1]),T[2]=Math.ceil(L[2]),T[3]=Math.ceil(L[3]),T}static floor(T,L){return T[0]=Math.floor(L[0]),T[1]=Math.floor(L[1]),T[2]=Math.floor(L[2]),T[3]=Math.floor(L[3]),T}static min(T,L,R){return T[0]=Math.min(L[0],R[0]),T[1]=Math.min(L[1],R[1]),T[2]=Math.min(L[2],R[2]),T[3]=Math.min(L[3],R[3]),T}static max(T,L,R){return T[0]=Math.max(L[0],R[0]),T[1]=Math.max(L[1],R[1]),T[2]=Math.max(L[2],R[2]),T[3]=Math.max(L[3],R[3]),T}static round(T,L){return T[0]=Math.round(L[0]),T[1]=Math.round(L[1]),T[2]=Math.round(L[2]),T[3]=Math.round(L[3]),T}static scale(T,L,R){return T[0]=L[0]*R,T[1]=L[1]*R,T[2]=L[2]*R,T[3]=L[3]*R,T}static scaleAndAdd(T,L,R,I){return T[0]=L[0]+R[0]*I,T[1]=L[1]+R[1]*I,T[2]=L[2]+R[2]*I,T[3]=L[3]+R[3]*I,T}static distance(T,L){const R=L[0]-T[0],I=L[1]-T[1],F=L[2]-T[2],D=L[3]-T[3];return Math.hypot(R,I,F,D)}static dist(T,L){return 0}static squaredDistance(T,L){const R=L[0]-T[0],I=L[1]-T[1],F=L[2]-T[2],D=L[3]-T[3];return R*R+I*I+F*F+D*D}static sqrDist(T,L){return 0}static magnitude(T){const L=T[0],R=T[1],I=T[2],F=T[3];return Math.sqrt(L*L+R*R+I*I+F*F)}static mag(T){return 0}static length(T){return 0}static len(T){return 0}static squaredLength(T){const L=T[0],R=T[1],I=T[2],F=T[3];return L*L+R*R+I*I+F*F}static sqrLen(T){return 0}static negate(T,L){return T[0]=-L[0],T[1]=-L[1],T[2]=-L[2],T[3]=-L[3],T}static inverse(T,L){return T[0]=1/L[0],T[1]=1/L[1],T[2]=1/L[2],T[3]=1/L[3],T}static abs(T,L){return T[0]=Math.abs(L[0]),T[1]=Math.abs(L[1]),T[2]=Math.abs(L[2]),T[3]=Math.abs(L[3]),T}static normalize(T,L){const R=L[0],I=L[1],F=L[2],D=L[3];let V=R*R+I*I+F*F+D*D;return V>0&&(V=1/Math.sqrt(V)),T[0]=R*V,T[1]=I*V,T[2]=F*V,T[3]=D*V,T}static dot(T,L){return T[0]*L[0]+T[1]*L[1]+T[2]*L[2]+T[3]*L[3]}static cross(T,L,R,I){const F=R[0]*I[1]-R[1]*I[0],D=R[0]*I[2]-R[2]*I[0],V=R[0]*I[3]-R[3]*I[0],q=R[1]*I[2]-R[2]*I[1],G=R[1]*I[3]-R[3]*I[1],z=R[2]*I[3]-R[3]*I[2],Q=L[0],tt=L[1],gt=L[2],yt=L[3];return T[0]=tt*z-gt*G+yt*q,T[1]=-(Q*z)+gt*V-yt*D,T[2]=Q*G-tt*V+yt*F,T[3]=-(Q*q)+tt*D-gt*F,T}static lerp(T,L,R,I){const F=L[0],D=L[1],V=L[2],q=L[3];return T[0]=F+I*(R[0]-F),T[1]=D+I*(R[1]-D),T[2]=V+I*(R[2]-V),T[3]=q+I*(R[3]-q),T}static transformMat4(T,L,R){const I=L[0],F=L[1],D=L[2],V=L[3];return T[0]=R[0]*I+R[4]*F+R[8]*D+R[12]*V,T[1]=R[1]*I+R[5]*F+R[9]*D+R[13]*V,T[2]=R[2]*I+R[6]*F+R[10]*D+R[14]*V,T[3]=R[3]*I+R[7]*F+R[11]*D+R[15]*V,T}static transformQuat(T,L,R){const I=L[0],F=L[1],D=L[2],V=R[0],q=R[1],G=R[2],z=R[3],Q=z*I+q*D-G*F,tt=z*F+G*I-V*D,gt=z*D+V*F-q*I,yt=-V*I-q*F-G*D;return T[0]=Q*z+yt*-V+tt*-G-gt*-q,T[1]=tt*z+yt*-q+gt*-V-Q*-G,T[2]=gt*z+yt*-G+Q*-q-tt*-V,T[3]=L[3],T}static zero(T){return T[0]=0,T[1]=0,T[2]=0,T[3]=0,T}static str(T){return`Vec4(${T.join(", ")})`}static exactEquals(T,L){return T[0]===L[0]&&T[1]===L[1]&&T[2]===L[2]&&T[3]===L[3]}static equals(T,L){const R=T[0],I=T[1],F=T[2],D=T[3],V=L[0],q=L[1],G=L[2],z=L[3];return Math.abs(R-V)<=N*Math.max(1,Math.abs(R),Math.abs(V))&&Math.abs(I-q)<=N*Math.max(1,Math.abs(I),Math.abs(q))&&Math.abs(F-G)<=N*Math.max(1,Math.abs(F),Math.abs(G))&&Math.abs(D-z)<=N*Math.max(1,Math.abs(D),Math.abs(z))}};f(X,"BYTE_LENGTH",4*Float32Array.BYTES_PER_ELEMENT);let A=X;A.prototype.sub=A.prototype.subtract;A.prototype.mul=A.prototype.multiply;A.prototype.div=A.prototype.divide;A.prototype.dist=A.prototype.distance;A.prototype.sqrDist=A.prototype.squaredDistance;A.sub=A.subtract;A.mul=A.multiply;A.div=A.divide;A.dist=A.distance;A.sqrDist=A.squaredDistance;A.sqrLen=A.squaredLength;A.mag=A.magnitude;A.length=A.magnitude;A.len=A.magnitude;const Z=class Wi extends Float32Array{constructor(...T){switch(T.length){case 2:{const L=T[0];typeof L=="number"?super([L,T[1]]):super(L,T[1],2);break}case 1:{const L=T[0];typeof L=="number"?super([L,L]):super(L,0,2);break}default:super(2);break}}get x(){return this[0]}set x(T){this[0]=T}get y(){return this[1]}set y(T){this[1]=T}get r(){return this[0]}set r(T){this[0]=T}get g(){return this[1]}set g(T){this[1]=T}get magnitude(){return Math.hypot(this[0],this[1])}get mag(){return this.magnitude}get squaredMagnitude(){const T=this[0],L=this[1];return T*T+L*L}get sqrMag(){return this.squaredMagnitude}get str(){return Wi.str(this)}copy(T){return this.set(T),this}add(T){return this[0]+=T[0],this[1]+=T[1],this}subtract(T){return this[0]-=T[0],this[1]-=T[1],this}sub(T){return this}multiply(T){return this[0]*=T[0],this[1]*=T[1],this}mul(T){return this}divide(T){return this[0]/=T[0],this[1]/=T[1],this}div(T){return this}scale(T){return this[0]*=T,this[1]*=T,this}scaleAndAdd(T,L){return this[0]+=T[0]*L,this[1]+=T[1]*L,this}distance(T){return Wi.distance(this,T)}dist(T){return 0}squaredDistance(T){return Wi.squaredDistance(this,T)}sqrDist(T){return 0}negate(){return this[0]*=-1,this[1]*=-1,this}invert(){return this[0]=1/this[0],this[1]=1/this[1],this}abs(){return this[0]=Math.abs(this[0]),this[1]=Math.abs(this[1]),this}dot(T){return this[0]*T[0]+this[1]*T[1]}normalize(){return Wi.normalize(this,this)}static create(){return new Wi}static clone(T){return new Wi(T)}static fromValues(T,L){return new Wi(T,L)}static copy(T,L){return T[0]=L[0],T[1]=L[1],T}static set(T,L,R){return T[0]=L,T[1]=R,T}static add(T,L,R){return T[0]=L[0]+R[0],T[1]=L[1]+R[1],T}static subtract(T,L,R){return T[0]=L[0]-R[0],T[1]=L[1]-R[1],T}static sub(T,L,R){return[0,0]}static multiply(T,L,R){return T[0]=L[0]*R[0],T[1]=L[1]*R[1],T}static mul(T,L,R){return[0,0]}static divide(T,L,R){return T[0]=L[0]/R[0],T[1]=L[1]/R[1],T}static div(T,L,R){return[0,0]}static ceil(T,L){return T[0]=Math.ceil(L[0]),T[1]=Math.ceil(L[1]),T}static floor(T,L){return T[0]=Math.floor(L[0]),T[1]=Math.floor(L[1]),T}static min(T,L,R){return T[0]=Math.min(L[0],R[0]),T[1]=Math.min(L[1],R[1]),T}static max(T,L,R){return T[0]=Math.max(L[0],R[0]),T[1]=Math.max(L[1],R[1]),T}static round(T,L){return T[0]=Math.round(L[0]),T[1]=Math.round(L[1]),T}static scale(T,L,R){return T[0]=L[0]*R,T[1]=L[1]*R,T}static scaleAndAdd(T,L,R,I){return T[0]=L[0]+R[0]*I,T[1]=L[1]+R[1]*I,T}static distance(T,L){return Math.hypot(L[0]-T[0],L[1]-T[1])}static dist(T,L){return 0}static squaredDistance(T,L){const R=L[0]-T[0],I=L[1]-T[1];return R*R+I*I}static sqrDist(T,L){return 0}static magnitude(T){let L=T[0],R=T[1];return Math.sqrt(L*L+R*R)}static mag(T){return 0}static length(T){return 0}static len(T){return 0}static squaredLength(T){const L=T[0],R=T[1];return L*L+R*R}static sqrLen(T,L){return 0}static negate(T,L){return T[0]=-L[0],T[1]=-L[1],T}static inverse(T,L){return T[0]=1/L[0],T[1]=1/L[1],T}static abs(T,L){return T[0]=Math.abs(L[0]),T[1]=Math.abs(L[1]),T}static normalize(T,L){const R=L[0],I=L[1];let F=R*R+I*I;return F>0&&(F=1/Math.sqrt(F)),T[0]=L[0]*F,T[1]=L[1]*F,T}static dot(T,L){return T[0]*L[0]+T[1]*L[1]}static cross(T,L,R){const I=L[0]*R[1]-L[1]*R[0];return T[0]=T[1]=0,T[2]=I,T}static lerp(T,L,R,I){const F=L[0],D=L[1];return T[0]=F+I*(R[0]-F),T[1]=D+I*(R[1]-D),T}static transformMat2(T,L,R){const I=L[0],F=L[1];return T[0]=R[0]*I+R[2]*F,T[1]=R[1]*I+R[3]*F,T}static transformMat2d(T,L,R){const I=L[0],F=L[1];return T[0]=R[0]*I+R[2]*F+R[4],T[1]=R[1]*I+R[3]*F+R[5],T}static transformMat3(T,L,R){const I=L[0],F=L[1];return T[0]=R[0]*I+R[3]*F+R[6],T[1]=R[1]*I+R[4]*F+R[7],T}static transformMat4(T,L,R){const I=L[0],F=L[1];return T[0]=R[0]*I+R[4]*F+R[12],T[1]=R[1]*I+R[5]*F+R[13],T}static rotate(T,L,R,I){const F=L[0]-R[0],D=L[1]-R[1],V=Math.sin(I),q=Math.cos(I);return T[0]=F*q-D*V+R[0],T[1]=F*V+D*q+R[1],T}static angle(T,L){const R=T[0],I=T[1],F=L[0],D=L[1],V=Math.sqrt(R*R+I*I)*Math.sqrt(F*F+D*D),q=V&&(R*F+I*D)/V;return Math.acos(Math.min(Math.max(q,-1),1))}static zero(T){return T[0]=0,T[1]=0,T}static exactEquals(T,L){return T[0]===L[0]&&T[1]===L[1]}static equals(T,L){const R=T[0],I=T[1],F=L[0],D=L[1];return Math.abs(R-F)<=N*Math.max(1,Math.abs(R),Math.abs(F))&&Math.abs(I-D)<=N*Math.max(1,Math.abs(I),Math.abs(D))}static str(T){return`Vec2(${T.join(", ")})`}};f(Z,"BYTE_LENGTH",2*Float32Array.BYTES_PER_ELEMENT);let C=Z;C.prototype.sub=C.prototype.subtract;C.prototype.mul=C.prototype.multiply;C.prototype.div=C.prototype.divide;C.prototype.dist=C.prototype.distance;C.prototype.sqrDist=C.prototype.squaredDistance;C.sub=C.subtract;C.mul=C.multiply;C.div=C.divide;C.dist=C.distance;C.sqrDist=C.squaredDistance;C.sqrLen=C.squaredLength;C.mag=C.magnitude;C.length=C.magnitude;C.len=C.magnitude;function ve(P){return new Promise((T,L)=>{const R=document.createElement("img");R.onload=()=>T(R),R.onerror=L,R.src=P,R.crossOrigin="anonymous",R.loading="eager"})}function Pe(P){return new Promise((T,L)=>{const R=document.createElement("video");let I=!1,F=!1,D=!1;R.addEventListener("playing",()=>{I=!0,V()},!0),R.addEventListener("timeupdate",()=>{F=!0,V()},!0),R.addEventListener("error",q=>{D=!0,L(q)},!0);function V(){I&&F&&!D&&T(R)}R.src=P,R.playsInline=!0,R.crossOrigin="anonymous",R.autoplay=!0,R.loop=!0,R.muted=!0,R.play()})}function ae(P,T=!1){return T?Pe(P):ve(P)}function oe(P){return new Promise((T,L)=>{(P instanceof HTMLImageElement?P.complete:P.readyState>=3)?T(P):(P.onload=()=>T(P),P.onerror=L)})}function ze(P,T,L){const R=P.data,I=P.width,F=P.height;let D,V,q,G,z,Q,tt,gt,yt,Et,J,At,kt;const ne=I-1,Te=F-1,Ht=T+1,Le=T+Ht,ee=T+1,si=T+ee,ci=1/(Le*si),ui=[],di=[],ii=[],bi=[],yi=[],gi=[];for(;L-- >0;){for(kt=At=0,Q=0;Q<F;Q++){for(D=R[kt]*Ht,V=R[kt+1]*Ht,q=R[kt+2]*Ht,G=R[kt+3]*Ht,tt=1;tt<=T;tt++)gt=kt+((tt>ne?ne:tt)<<2),D+=R[gt++],V+=R[gt++],q+=R[gt++],G+=R[gt];for(z=0;z<I;z++)ui[At]=D,di[At]=V,ii[At]=q,bi[At]=G,Q===0&&(yi[z]=Math.min(z+Ht,ne)<<2,gi[z]=Math.max(z-T,0)<<2),yt=kt+yi[z],Et=kt+gi[z],D+=R[yt++]-R[Et++],V+=R[yt++]-R[Et++],q+=R[yt++]-R[Et++],G+=R[yt]-R[Et],At++;kt+=I<<2}for(z=0;z<I;z++){for(J=z,D=ui[J]*ee,V=di[J]*ee,q=ii[J]*ee,G=bi[J]*ee,tt=1;tt<=T;tt++)J+=tt>Te?0:I,D+=ui[J],V+=di[J],q+=ii[J],G+=bi[J];for(At=z<<2,Q=0;Q<F;Q++)R[At]=D*ci+.5|0,R[At+1]=V*ci+.5|0,R[At+2]=q*ci+.5|0,R[At+3]=G*ci+.5|0,z===0&&(yi[Q]=Math.min(Q+ee,Te)*I,gi[Q]=Math.max(Q-T,0)*I),yt=z+yi[Q],Et=z+gi[Q],D+=ui[yt]-ui[Et],V+=di[yt]-di[Et],q+=ii[yt]-ii[Et],G+=bi[yt]-bi[Et],At+=I<<2}}}function Ie(P,T){const L=P.data;for(let R=0;R<L.length;R+=4){const I=L[R],F=L[R+1],D=L[R+2],V=L[R+3],q=I*.3+F*.59+D*.11;L[R]=q*(1-T)+I*T,L[R+1]=q*(1-T)+F*T,L[R+2]=q*(1-T)+D*T,L[R+3]=V}}function ke(P,T){const L=P.data;for(let R=0;R<L.length;R+=4){const I=L[R],F=L[R+1],D=L[R+2],V=L[R+3];L[R]=I*T,L[R+1]=F*T,L[R+2]=D*T,L[R+3]=V}}function Yt(P,T){const L=P.data;for(let R=0;R<L.length;R+=4){const I=L[R],F=L[R+1],D=L[R+2],V=L[R+3];L[R]=(I-128)*T+128,L[R+1]=(F-128)*T+128,L[R+2]=(D-128)*T+128,L[R+3]=V}}const E=(P,T,L,R,I=0,F=0,D=1,V=1)=>Object.freeze({cx:P,cy:T,x:L,y:R,ur:I,vr:F,up:D,vp:V}),pt=(P,T,L)=>Object.freeze({width:P,height:T,conf:L}),jt=[pt(5,5,[E(0,0,-1,-1,0,0,1,1),E(1,0,-.5,-1,0,0,1,1),E(2,0,0,-1,0,0,1,1),E(3,0,.5,-1,0,0,1,1),E(4,0,1,-1,0,0,1,1),E(0,1,-1,-.5,0,0,1,1),E(1,1,-.5,-.5,0,0,1,1),E(2,1,-.0052029684413368305,-.6131420587090777,0,0,1,1),E(3,1,.5884227308309977,-.3990805107556692,0,0,1,1),E(4,1,1,-.5,0,0,1,1),E(0,2,-1,0,0,0,1,1),E(1,2,-.4210024670505933,-.11895058380429502,0,0,1,1),E(2,2,-.1019613423315412,-.023812118047224606,0,-47,.629,.849),E(3,2,.40275125660925437,-.06345314544600389,0,0,1,1),E(4,2,1,0,0,0,1,1),E(0,3,-1,.5,0,0,1,1),E(1,3,.06801958477287173,.5205913248960121,-31,-45,1,1),E(2,3,.21446469120128908,.29331610114301043,6,-56,.566,1.321),E(3,3,.5,.5,0,0,1,1),E(4,3,1,.5,0,0,1,1),E(0,4,-1,1,0,0,1,1),E(1,4,-.31378372841550195,1,0,0,1,1),E(2,4,.26153633255328046,1,0,0,1,1),E(3,4,.5,1,0,0,1,1),E(4,4,1,1,0,0,1,1)]),pt(4,4,[E(0,0,-1,-1,0,0,1,1),E(1,0,-.33333333333333337,-1,0,0,1,1),E(2,0,.33333333333333326,-1,0,0,1,1),E(3,0,1,-1,0,0,1,1),E(0,1,-1,-.04495399932657351,0,0,1,1),E(1,1,-.24056117520129328,-.22465999020104,0,0,1,1),E(2,1,.334758885767489,-.00531297192779423,0,0,1,1),E(3,1,.9989920470678106,-.3382976020775408,8,0,.566,1.792),E(0,2,-1,.33333333333333326,0,0,1,1),E(1,2,-.3425497314639411,-27501607956947893e-21,0,0,1,1),E(2,2,.3321437945812673,.1981776353859399,0,0,1,1),E(3,2,1,.0766118180296832,0,0,1,1),E(0,3,-1,1,0,0,1,1),E(1,3,-.33333333333333337,1,0,0,1,1),E(2,3,.33333333333333326,1,0,0,1,1),E(3,3,1,1,0,0,1,1)]),pt(4,4,[E(0,0,-1,-1,0,0,1,2.075),E(1,0,-.33333333333333337,-1,0,0,1,1),E(2,0,.33333333333333326,-1,0,0,1,1),E(3,0,1,-1,0,0,1,1),E(0,1,-1,-.4545779491139603,0,0,1,1),E(1,1,-.33333333333333337,-.33333333333333337,0,0,1,1),E(2,1,.0889403142626457,-.6025711180694033,-32,45,1,1),E(3,1,1,-.33333333333333337,0,0,1,1),E(0,2,-1,-.07402408608567845,1,0,1,.094),E(1,2,-.2719422694359541,.09775369930903222,25,-18,1.321,0),E(2,2,.19877414408395877,.4307383294587789,48,-40,.755,.975),E(3,2,1,.33333333333333326,-37,0,1,1),E(0,3,-1,1,0,0,1,1),E(1,3,-.33333333333333337,1,0,0,1,1),E(2,3,.5125850864305672,1,-20,-18,0,1.604),E(3,3,1,1,0,0,1,1)]),pt(5,5,[E(0,0,-1,-1,0,0,1,1),E(1,0,-.4501953125,-1,0,55,1,2.075),E(2,0,.1953125,-1,0,0,1,1),E(3,0,.4580078125,-1,0,-25,1,1),E(4,0,1,-1,0,0,1,1),E(0,1,-1,-.2514475377525607,-16,0,2.327,.943),E(1,1,-.55859375,-.6609325945787148,47,0,2.358,.377),E(2,1,.232421875,-.5244375756366635,-66,-25,1.855,1.164),E(3,1,.685546875,-.3753706470552125,0,0,1,1),E(4,1,1,-.6699125300354287,0,0,1,1),E(0,2,-1,.035910396862284255,0,0,1,1),E(1,2,-.4921875,.005378616309457018,90,23,1,1.981),E(2,2,.021484375,-.1365043639066228,0,42,1,1),E(3,2,.4765625,.05925822904974043,-30,0,1.95,.44),E(4,2,1,.251428847823418,0,0,1,1),E(0,3,-1,.6968336464764276,-68,0,1,.786),E(1,3,-.6904296875,.5890744209958608,-68,0,1,1),E(2,3,.1845703125,.3879238667654693,61,0,1,1),E(3,3,.60546875,.4633553246018661,-47,-59,.849,1.73),E(4,3,1,.6214021886400309,-33,0,.377,1.604),E(0,4,-1,1,0,0,1,1),E(1,4,-.5,1,0,-73,1,1),E(2,4,-.3271484375,1,0,-24,.314,2.704),E(3,4,.5,1,0,0,1,1),E(4,4,1,1,0,0,1,1)])],j=(P,T)=>Math.random()*(T-P)+P;function De(P,T,L){return Math.min(Math.max(P,T),L)}function Fe(P,T,L){const R=De((L-P)/(T-P),0,1);return R*R*(3-2*R)}function Ae(P,T,L,R=2,I=.5,F=.1){let D=[],V=I;for(let z=0;z<L;z++){D[z]=[];for(let Q=0;Q<T;Q++)D[z][Q]=P[z*T+Q]}const q=[[1,2,1],[2,4,2],[1,2,1]],G=16;for(let z=0;z<R;z++){const Q=[];for(let tt=0;tt<L;tt++){Q[tt]=[];for(let gt=0;gt<T;gt++){if(gt===0||gt===T-1||tt===0||tt===L-1){Q[tt][gt]=D[tt][gt];continue}let yt=0,Et=0,J=0,At=0,kt=0,ne=0;for(let Ge=-1;Ge<=1;Ge++)for(let Se=-1;Se<=1;Se++){const ni=q[Ge+1][Se+1],ti=D[tt+Ge][gt+Se];yt+=ti.x*ni,Et+=ti.y*ni,J+=ti.ur*ni,At+=ti.vr*ni,kt+=ti.up*ni,ne+=ti.vp*ni}const Te=yt/G,Ht=Et/G,Le=J/G,ee=At/G,si=kt/G,ci=ne/G,ui=D[tt][gt],di=ui.x*(1-V)+Te*V,ii=ui.y*(1-V)+Ht*V,bi=ui.ur*(1-V)+Le*V,yi=ui.vr*(1-V)+ee*V,gi=ui.up*(1-V)+si*V,we=ui.vp*(1-V)+ci*V;Q[tt][gt]=E(gt,tt,di,ii,bi,yi,gi,we)}}D=Q,V=Math.min(1,Math.max(V+F,0))}for(let z=0;z<L;z++)for(let Q=0;Q<T;Q++)P[z*T+Q]=D[z][Q]}function Mt(P,T){return _e(Math.sin(P*12.9898+T*78.233)*43758.5453)}function _e(P){return P-Math.floor(P)}function Re(P,T){const L=Math.floor(P),R=Math.floor(T),I=L+1,F=R+1,D=P-L,V=T-R,q=D*D*(3-2*D),G=V*V*(3-2*V),z=Mt(L,R),Q=Mt(I,R),tt=Mt(L,F),gt=Mt(I,F),yt=z*(1-q)+Q*q,Et=tt*(1-q)+gt*q;return yt*(1-G)+Et*G}function Ce(P,T,L,R=.001){const I=P(T+R,L),F=P(T-R,L),D=P(T,L+R),V=P(T,L-R),q=(I-F)/(2*R),G=(D-V)/(2*R),z=Math.sqrt(q*q+G*G)||1;return[q/z,G/z]}function Oe(P,T,L=j(.4,.6),R=j(.3,.6),I=.8,F=Math.floor(j(3,5)),D=j(.2,.3),V=j(-.1,-.05)){const q=P,G=T,z=[],Q=2/(q-1),tt=2/(G-1);for(let gt=0;gt<G;gt++)for(let yt=0;yt<q;yt++){const Et=yt/(q-1)*2-1,J=gt/(G-1)*2-1,At=yt===0||yt===q-1||gt===0||gt===G-1,kt=At?0:j(-L*Q,L*Q),ne=At?0:j(-L*tt,L*tt);let Te=Et+kt,Ht=J+ne;const Le=At?0:j(-60,60),ee=At?0:j(-60,60),si=At?1:j(.8,1.2),ci=At?1:j(.8,1.2);if(!At){const ui=(Et+1)/2,di=(J+1)/2,[ii,bi]=Ce(Re,ui,di,.001);let yi=ii*R,gi=bi*R;const we=Math.min(ui,1-ui,di,1-di),Ge=Fe(0,1,we);yi*=Ge,gi*=Ge,Te=Te*(1-I)+(Te+yi)*I,Ht=Ht*(1-I)+(Ht+gi)*I}z.push(E(yt,gt,Te,Ht,Le,ee,si,ci))}return Ae(z,q,G,F,D,V),pt(q,G,z)}const Ne=`precision highp float;\r
\r
varying vec3 v_color;\r
varying vec2 v_uv;\r
uniform sampler2D u_texture;\r
uniform float u_time;\r
uniform float u_volume;\r
uniform float u_alpha;\r
\r
/* Gradient noise from Jorge Jimenez's presentation: */\r
/* http://www.iryoku.com/next-generation-post-processing-in-call-of-duty-advanced-warfare */\r
float gradientNoise(in vec2 uv) {\r
    return fract(52.9829189 * fract(dot(uv, vec2(0.06711056, 0.00583715))));\r
}\r
\r
vec2 rot(vec2 v, float a) {\r
    float s = sin(a);\r
    float c = cos(a);\r
    mat2 m = mat2(c, s, -s, c);\r
    return m * v;\r
}\r
\r
void main() {\r
    float dither = (1.0 / 255.0) * gradientNoise(gl_FragCoord.xy) - (0.5 / 255.0);\r
    vec2 centeredUV = v_uv - vec2(0.2);\r
    vec2 rotatedUV = rot(centeredUV, (u_time + u_volume) * 2.0);\r
    vec2 finalUV = rotatedUV * max(0.001, 1.0 - u_volume * 2.0) + vec2(0.5);\r
    vec4 result = texture2D(u_texture, finalUV);\r
    result *= vec4(v_color, u_alpha);\r
    result *= vec4(max(0.5, 1.0 - u_volume / 2.0));\r
    result += vec4(dither);\r
    gl_FragColor = result;\r
}`,We=`precision highp float;\r
\r
attribute vec2 a_pos;\r
attribute vec3 a_color;\r
attribute vec2 a_uv;\r
varying vec3 v_color;\r
varying vec2 v_uv;\r
\r
uniform float u_aspect;\r
\r
void main() {\r
    v_color = a_color;\r
    v_uv = a_uv;\r
    vec2 pos = a_pos;\r
    if (u_aspect > 1.0) {\r
        pos.y *= u_aspect;\r
    } else {\r
        pos.x /= u_aspect;\r
    }\r
    gl_Position = vec4(pos, 0.0, 1.0);\r
}\r
`;class Be{constructor(T,L,R,I="unknown"){f(this,"gl"),f(this,"program"),f(this,"vertexShader"),f(this,"fragmentShader"),f(this,"attrs"),f(this,"notFoundUniforms",new Set),this.label=I,this.gl=T,this.vertexShader=this.createShader(T.VERTEX_SHADER,L),this.fragmentShader=this.createShader(T.FRAGMENT_SHADER,R),this.program=this.createProgram();const F=T.getProgramParameter(this.program,T.ACTIVE_ATTRIBUTES),D={};for(let V=0;V<F;V++){const q=T.getActiveAttrib(this.program,V);if(!q)continue;const G=T.getAttribLocation(this.program,q.name);G!==-1&&(D[q.name]=G)}this.attrs=D}createShader(T,L){const R=this.gl,I=R.createShader(T);if(!I)throw new Error("Failed to create shader");if(R.shaderSource(I,L),R.compileShader(I),!R.getShaderParameter(I,R.COMPILE_STATUS))throw new Error(`Failed to compile shader for type ${T} "${this.label}": ${R.getShaderInfoLog(I)}`);return I}createProgram(){const T=this.gl,L=T.createProgram();if(!L)throw new Error("Failed to create program");if(T.attachShader(L,this.vertexShader),T.attachShader(L,this.fragmentShader),T.linkProgram(L),T.validateProgram(L),!T.getProgramParameter(L,T.LINK_STATUS)){const R=T.getProgramInfoLog(L);throw T.deleteProgram(L),new Error(`Failed to link program "${this.label}": ${R}`)}return L}use(){this.gl.useProgram(this.program)}warnUniformNotFound(T){this.notFoundUniforms.has(T)||(this.notFoundUniforms.add(T),console.warn(`Failed to get uniform location for program "${this.label}": ${T}`))}setUniform1f(T,L){const R=this.gl,I=R.getUniformLocation(this.program,T);I?R.uniform1f(I,L):this.warnUniformNotFound(T)}setUniform2f(T,L,R){const I=this.gl,F=I.getUniformLocation(this.program,T);F?I.uniform2f(F,L,R):this.warnUniformNotFound(T)}setUniform1i(T,L){const R=this.gl,I=R.getUniformLocation(this.program,T);I?R.uniform1i(I,L):this.warnUniformNotFound(T)}dispose(){const T=this.gl;T.deleteShader(this.vertexShader),T.deleteShader(this.fragmentShader),T.deleteProgram(this.program)}}class qe{constructor(T,L,R,I){f(this,"vertexWidth",0),f(this,"vertexHeight",0),f(this,"vertexBuffer"),f(this,"indexBuffer"),f(this,"vertexData"),f(this,"indexData"),f(this,"vertexIndexLength",0),f(this,"wireFrame",!1),this.gl=T,this.attrPos=L,this.attrColor=R,this.attrUV=I;const F=T.createBuffer();if(!F)throw new Error("Failed to create vertex buffer");this.vertexBuffer=F;const D=T.createBuffer();if(!D)throw new Error("Failed to create index buffer");this.indexBuffer=D,this.bind(),this.vertexData=new Float32Array(0),this.indexData=new Uint16Array(0),this.resize(2,2),this.update()}setWireFrame(T){this.wireFrame=T,this.resize(this.vertexWidth,this.vertexHeight)}setVertexPos(T,L,R,I){const F=(T+L*this.vertexWidth)*7;if(F>=this.vertexData.length-1){console.warn("Vertex position out of range",F,this.vertexData.length);return}this.vertexData[F]=R,this.vertexData[F+1]=I}setVertexColor(T,L,R,I,F){const D=(T+L*this.vertexWidth)*7+2;if(D>=this.vertexData.length-1){console.warn("Vertex position out of range",D,this.vertexData.length);return}this.vertexData[D]=R,this.vertexData[D+1]=I,this.vertexData[D+2]=F}setVertexUV(T,L,R,I){const F=(T+L*this.vertexWidth)*7+2+3;if(F>=this.vertexData.length-1){console.warn("Vertex position out of range",F,this.vertexData.length);return}this.vertexData[F]=R,this.vertexData[F+1]=I}getVertexIndexLength(){return this.vertexIndexLength}draw(){const T=this.gl;this.wireFrame?T.drawElements(T.LINES,this.vertexIndexLength,T.UNSIGNED_SHORT,0):T.drawElements(T.TRIANGLES,this.vertexIndexLength,T.UNSIGNED_SHORT,0)}resize(T,L){this.vertexWidth=T,this.vertexHeight=L,this.vertexIndexLength=T*L*6,this.wireFrame&&(this.vertexIndexLength=T*L*10);const R=new Float32Array(T*L*7),I=new Uint16Array(this.vertexIndexLength);this.vertexData=R,this.indexData=I;for(let D=0;D<L;D++)for(let V=0;V<T;V++){const q=V/(T-1)*2-1,G=D/(L-1)*2-1;this.setVertexPos(V,D,q||0,G||0),this.setVertexColor(V,D,1,1,1),this.setVertexUV(V,D,V/(T-1),D/(L-1))}for(let D=0;D<L-1;D++)for(let V=0;V<T-1;V++)if(this.wireFrame){const q=(D*T+V)*10;I[q]=D*T+V,I[q+1]=D*T+V+1,I[q+2]=D*T+V+1,I[q+3]=(D+1)*T+V,I[q+4]=(D+1)*T+V,I[q+5]=(D+1)*T+V+1,I[q+6]=(D+1)*T+V+1,I[q+7]=D*T+V+1,I[q+8]=D*T+V,I[q+9]=(D+1)*T+V}else{const q=(D*T+V)*6;I[q]=D*T+V,I[q+1]=D*T+V+1,I[q+2]=(D+1)*T+V,I[q+3]=D*T+V+1,I[q+4]=(D+1)*T+V+1,I[q+5]=(D+1)*T+V}const F=this.gl;F.bindBuffer(F.ELEMENT_ARRAY_BUFFER,this.indexBuffer),F.bufferData(F.ELEMENT_ARRAY_BUFFER,this.indexData,F.STATIC_DRAW)}bind(){const T=this.gl;T.bindBuffer(T.ARRAY_BUFFER,this.vertexBuffer),T.bindBuffer(T.ELEMENT_ARRAY_BUFFER,this.indexBuffer),this.attrPos!==void 0&&(T.vertexAttribPointer(this.attrPos,2,T.FLOAT,!1,28,0),T.enableVertexAttribArray(this.attrPos)),this.attrColor!==void 0&&(T.vertexAttribPointer(this.attrColor,3,T.FLOAT,!1,28,8),T.enableVertexAttribArray(this.attrColor)),this.attrUV!==void 0&&(T.vertexAttribPointer(this.attrUV,2,T.FLOAT,!1,28,20),T.enableVertexAttribArray(this.attrUV))}update(){const T=this.gl;T.bindBuffer(T.ARRAY_BUFFER,this.vertexBuffer),T.bufferData(T.ARRAY_BUFFER,this.vertexData,T.DYNAMIC_DRAW)}dispose(){this.gl.deleteBuffer(this.vertexBuffer),this.gl.deleteBuffer(this.indexBuffer)}}class $e{constructor(){f(this,"color",O.fromValues(1,1,1)),f(this,"location",C.fromValues(0,0)),f(this,"uTangent",C.fromValues(0,0)),f(this,"vTangent",C.fromValues(0,0)),f(this,"_uRot",0),f(this,"_vRot",0),f(this,"_uScale",1),f(this,"_vScale",1),Object.seal(this)}get uRot(){return this._uRot}get vRot(){return this._vRot}set uRot(T){this._uRot=T,this.updateUTangent()}set vRot(T){this._vRot=T,this.updateVTangent()}get uScale(){return this._uScale}get vScale(){return this._vScale}set uScale(T){this._uScale=T,this.updateUTangent()}set vScale(T){this._vScale=T,this.updateVTangent()}updateUTangent(){this.uTangent[0]=Math.cos(this._uRot)*this._uScale,this.uTangent[1]=Math.sin(this._uRot)*this._uScale}updateVTangent(){this.vTangent[0]=-Math.sin(this._vRot)*this._vScale,this.vTangent[1]=Math.cos(this._vRot)*this._vScale}}const dt=_.fromValues(2,-2,1,1,-3,3,-2,-1,0,0,1,0,1,0,0,0),ft=_.clone(dt).transpose(),et=A.create(),Lt=A.create(),nt=A.create(),rt=_.create(),at=_.create();function Ve(P,T,L,R,I=C.create()){et[0]=P**3,et[1]=P**2,et[2]=P,et[3]=1,Lt.copy(et),nt[0]=T**3,nt[1]=T**2,nt[2]=T,nt[3]=1,rt.copy(L).transpose(),_.mul(rt,rt,dt),_.mul(rt,ft,rt),A.transformMat4(et,et,rt);const F=nt.dot(et);at.copy(R).transpose(),_.mul(at,at,dt),_.mul(at,ft,at),A.transformMat4(Lt,Lt,at);const D=nt.dot(Lt);return I.x=F,I.y=D,I}function Gt(P,T,L,R,I,F=_.create()){const D=G=>G.location[I],V=G=>G.uTangent[I],q=G=>G.vTangent[I];return F[0]=D(P),F[1]=D(T),F[2]=q(P),F[3]=q(T),F[4]=D(L),F[5]=D(R),F[6]=q(L),F[7]=q(R),F[8]=V(P),F[9]=V(T),F[10]=0,F[11]=0,F[12]=V(L),F[13]=V(R),F[14]=0,F[15]=0,F}function Dt(P,T,L,R,I,F=_.create()){const D=V=>V.color[I];return F.fill(0),F[0]=D(P),F[1]=D(T),F[4]=D(L),F[5]=D(R),F}const K=A.create(),bt=A.create(),xt=A.create(),st=A.create(),ot=_.create(),ct=_.create(),ht=_.create(),Tt=O.create();function He(P,T,L,R,I){return K[0]=P**3,K[1]=P**2,K[2]=P,K[3]=1,bt.copy(K),xt.copy(K),st[0]=T**3,st[1]=T**2,st[2]=T,st[3]=1,ot.copy(L).transpose(),_.mul(ot,ot,dt),_.mul(ot,ft,ot),A.transformMat4(K,K,ot),Tt.r=st.dot(K),ct.copy(R).transpose(),_.mul(ct,ct,dt),_.mul(ct,ft,ct),A.transformMat4(bt,bt,ct),Tt.g=st.dot(bt),ht.copy(I).transpose(),_.mul(ht,ht,dt),_.mul(ht,ft,ht),A.transformMat4(xt,xt,ht),Tt.b=st.dot(xt),Tt}class Ue{constructor(T,L){f(this,"_width",0),f(this,"_height",0),f(this,"_data",[]),this.resize(T,L),Object.seal(this)}resize(T,L){this._width=T,this._height=L,this._data=new Array(T*L).fill(0)}set(T,L,R){this._data[T+L*this._width]=R}get(T,L){return this._data[T+L*this._width]}get width(){return this._width}get height(){return this._height}}class Ye extends qe{constructor(T,L,R,I){super(T,L,R,I),f(this,"_subDivisions",10),f(this,"_controlPoints",new Ue(3,3)),f(this,"uMX",_.create()),f(this,"uMY",_.create()),f(this,"uMR",_.create()),f(this,"uMG",_.create()),f(this,"uMB",_.create()),f(this,"tmpV2",C.create()),this.resizeControlPoints(3,3),Object.seal(this)}setWireFrame(T){super.setWireFrame(T),this.updateMesh()}resetSubdivition(T){this._subDivisions=T,super.resize((this._controlPoints.width-1)*T,(this._controlPoints.height-1)*T)}resizeControlPoints(T,L){if(!(T>=2&&L>=2))throw new Error("Control points must be larger than 3x3 or equal");this._controlPoints.resize(T,L);for(let R=0;R<L;R++)for(let I=0;I<T;I++){const F=new $e;F.location.x=I/(T-1)*2-1,F.location.y=R/(L-1)*2-1,F.uTangent.x=2/(T-1),F.vTangent.y=2/(L-1),this._controlPoints.set(I,R,F)}this.resetSubdivition(this._subDivisions)}getControlPoint(T,L){return this._controlPoints.get(T,L)}updateMesh(){const T=this._subDivisions-1,L=T*(this._controlPoints.height-1),R=T*(this._controlPoints.width-1);for(let I=0;I<this._controlPoints.width-1;I++)for(let F=0;F<this._controlPoints.height-1;F++){const D=this._controlPoints.get(I,F),V=this._controlPoints.get(I,F+1),q=this._controlPoints.get(I+1,F),G=this._controlPoints.get(I+1,F+1),z=Gt(D,V,q,G,"x",this.uMX),Q=Gt(D,V,q,G,"y",this.uMY),tt=Dt(D,V,q,G,"r",this.uMR),gt=Dt(D,V,q,G,"g",this.uMG),yt=Dt(D,V,q,G,"b",this.uMB),Et=I/(this._controlPoints.width-1),J=F/(this._controlPoints.height-1);for(let At=0;At<this._subDivisions;At++)for(let kt=0;kt<this._subDivisions;kt++){const ne=F*this._subDivisions+At,Te=I*this._subDivisions+kt,[Ht,Le]=Ve(At/T,kt/T,z,Q,this.tmpV2);this.setVertexPos(ne,Te,Ht,Le),this.setVertexUV(ne,Te,Et+kt/R,1-J-At/L);const[ee,si,ci]=He(At/T,kt/T,tt,gt,yt);this.setVertexColor(ne,Te,ee,si,ci)}}this.update()}}class Xt{constructor(T,L){f(this,"tex"),this.gl=T;const R=T.createTexture();if(!R)throw new Error("Failed to create texture");this.tex=R,T.activeTexture(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,R),T.texImage2D(T.TEXTURE_2D,0,T.RGBA,T.RGBA,T.UNSIGNED_BYTE,L),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MIN_FILTER,T.LINEAR),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MAG_FILTER,T.LINEAR),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_S,T.MIRRORED_REPEAT),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_T,T.MIRRORED_REPEAT)}bind(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.tex)}dispose(){this.gl.deleteTexture(this.tex)}}function je(P,T){if("OffscreenCanvas"in window)return new OffscreenCanvas(P,T);const L=document.createElement("canvas");return L.width=P,L.height=T,L}class hi extends re{constructor(T){super(T),f(this,"gl"),f(this,"lastFrameTime",0),f(this,"frameTime",0),f(this,"currentImageData"),f(this,"lastTickTime",0),f(this,"volume",0),f(this,"tickHandle",0),f(this,"maxFPS",60),f(this,"paused",!1),f(this,"staticMode",!1),f(this,"mainProgram"),f(this,"manualControl",!1),f(this,"reduceImageSizeCanvas",je(32,32)),f(this,"targetSize",C.fromValues(0,0)),f(this,"currentSize",C.fromValues(0,0)),f(this,"isNoCover",!0),f(this,"meshStates",[]),f(this,"_disposed",!1),f(this,"onTickBinded",this.onTick.bind(this)),f(this,"supportTextureFloat",!0);const L=T.getContext("webgl");if(!L)throw new Error("WebGL not supported");L.getExtension("EXT_color_buffer_float")||console.warn("EXT_color_buffer_float not supported"),L.getExtension("EXT_float_blend")||(console.warn("EXT_float_blend not supported"),this.supportTextureFloat=!1),L.getExtension("OES_texture_float_linear")||console.warn("OES_texture_float_linear not supported"),L.getExtension("OES_texture_float")||(this.supportTextureFloat=!1,console.warn("OES_texture_float not supported")),this.gl=L,L.enable(L.BLEND),L.enable(L.DEPTH_TEST),L.depthFunc(L.ALWAYS),this.mainProgram=new Be(L,We,Ne,"main-program-mg"),this.requestTick()}setManualControl(T){this.manualControl=T}setWireFrame(T){for(const L of this.meshStates)L.mesh.setWireFrame(T)}getControlPoint(T,L){var R,I;return(I=(R=this.meshStates[this.meshStates.length-1])==null?void 0:R.mesh)==null?void 0:I.getControlPoint(T,L)}resizeControlPoints(T,L){var R,I;return(I=(R=this.meshStates[this.meshStates.length-1])==null?void 0:R.mesh)==null?void 0:I.resizeControlPoints(T,L)}resetSubdivition(T){var L,R;return(R=(L=this.meshStates[this.meshStates.length-1])==null?void 0:L.mesh)==null?void 0:R.resetSubdivition(T)}onTick(T){if(this.tickHandle=0,this.paused||this._disposed)return;Number.isNaN(this.lastFrameTime)&&(this.lastFrameTime=T);const L=T-this.lastTickTime,R=T-this.lastFrameTime;if(this.lastFrameTime=T,L<1e3/this.maxFPS){this.requestTick();return}this.frameTime+=R*this.flowSpeed,this.onRedraw(this.frameTime,R)&&this.staticMode?this.staticMode&&(this.lastFrameTime=Number.NaN):this.requestTick(),this.lastTickTime=T}checkIfResize(){const[T,L]=[this.targetSize.x,this.targetSize.y],[R,I]=[this.currentSize.x,this.currentSize.y];if(T!==R||L!==I){super.onResize(T,L);const F=this.gl;F.bindFramebuffer(F.FRAMEBUFFER,null),F.viewport(0,0,T,L),this.currentSize.x=T,this.currentSize.y=L}}onRedraw(T,L){const R=this.meshStates[this.meshStates.length-1];let I=!1;if(R)if(R.mesh.bind(),this.manualControl&&R.mesh.updateMesh(),this.isNoCover){for(const V of this.meshStates)V.alpha=Math.max(0,V.alpha-L/500);const D=this.meshStates.filter(V=>V.alpha===0);this.meshStates=this.meshStates.filter(V=>V.alpha>0);for(const V of D)V.mesh.dispose(),V.texture.dispose();this.meshStates.length===0&&(I=!0)}else{if(R.alpha=Math.min(1,R.alpha+L/500),R.alpha>=1){const D=this.meshStates.splice(0,this.meshStates.length-1);for(const V of D)V.mesh.dispose(),V.texture.dispose()}this.meshStates.length===1&&R.alpha>=1&&(I=!0)}const F=this.gl;F.bindFramebuffer(F.FRAMEBUFFER,null),F.blendFunc(F.SRC_ALPHA,F.ONE_MINUS_SRC_ALPHA),F.clear(F.COLOR_BUFFER_BIT),this.checkIfResize(),this.mainProgram.use(),F.activeTexture(F.TEXTURE0),this.mainProgram.setUniform1f("u_time",T/1e4),this.mainProgram.setUniform1f("u_aspect",this.manualControl?1:this.canvas.width/this.canvas.height),this.mainProgram.setUniform1i("u_texture",0),this.mainProgram.setUniform1f("u_volume",this.volume);for(const D of this.meshStates)this.mainProgram.setUniform1f("u_alpha",D.alpha),D.texture.bind(),D.mesh.bind(),D.mesh.draw();return F.flush(),I}requestTick(){this._disposed||this.tickHandle===0&&(this.tickHandle=requestAnimationFrame(this.onTickBinded))}onResize(T,L){this.targetSize.x=Math.ceil(T),this.targetSize.y=Math.ceil(L),this.requestTick()}setStaticMode(T){this.staticMode=T,this.lastFrameTime=performance.now(),this.requestTick()}setFPS(T){this.maxFPS=T}pause(){this.tickHandle&&(cancelAnimationFrame(this.tickHandle),this.tickHandle=0),this.paused=!0}resume(){this.paused=!1,this.requestTick()}async setAlbum(T,L){if(T===void 0||typeof T=="string"&&T.trim().length===0){this.isNoCover=!0;return}let R=null,I=5;for(;!R&&I>0;)try{typeof T=="string"?R=await ae(T,L):R=await oe(T)}catch(z){console.warn(`failed on loading album resource, retrying (${I})`,{albumSource:T,error:z}),I--}if(!R){console.error("Failed to load album resource",T),this.isNoCover=!0;return}this.isNoCover=!1;const F=this.reduceImageSizeCanvas,D=F.getContext("2d",{willReadFrequently:!0});if(!D)throw new Error("Failed to create canvas context");D.clearRect(0,0,F.width,F.height);const V=R instanceof HTMLVideoElement?R.videoWidth:R.naturalWidth,q=R instanceof HTMLVideoElement?R.videoHeight:R.naturalHeight;if(V*q===0)throw new Error("Invalid image size");D.drawImage(R,0,0,V,q,0,0,F.width,F.height);const G=D.getImageData(0,0,F.width,F.height);if(Yt(G,.4),Ie(G,3),Yt(G,1.7),ke(G,.75),ze(G,2,4),this.manualControl&&this.meshStates.length>0)this.meshStates[0].texture.dispose(),this.meshStates[0].texture=new Xt(this.gl,G);else{const z=new Ye(this.gl,this.mainProgram.attrs.a_pos,this.mainProgram.attrs.a_color,this.mainProgram.attrs.a_uv);z.resetSubdivition(15);const Q=Math.random()>.8?Oe(6,6):jt[Math.floor(Math.random()*jt.length)];z.resizeControlPoints(Q.width,Q.height);const tt=2/(Q.width-1),gt=2/(Q.height-1);for(const J of Q.conf){const At=z.getControlPoint(J.cx,J.cy);At.location.x=J.x,At.location.y=J.y,At.uRot=J.ur*Math.PI/180,At.vRot=J.vr*Math.PI/180,At.uScale=tt*J.up,At.vScale=gt*J.vp}z.updateMesh(),this.currentImageData=G;const yt=new Xt(this.gl,G),Et={mesh:z,texture:yt,alpha:0};this.meshStates.push(Et)}this.requestTick()}setLowFreqVolume(T){this.volume=T/10}setHasLyric(T){}dispose(){super.dispose(),this.tickHandle&&(cancelAnimationFrame(this.tickHandle),this.tickHandle=0),this._disposed=!0,this.mainProgram.dispose();for(const T of this.meshStates)T.mesh.dispose(),T.texture.dispose()}}class ce{constructor(T,L){f(this,"element"),f(this,"renderer"),this.renderer=T,this.element=L,L.style.pointerEvents="none",L.style.zIndex="-1",L.style.contain="strict"}static new(T){const L=document.createElement("canvas");return new ce(new T(L),L)}setRenderScale(T){this.renderer.setRenderScale(T)}setFlowSpeed(T){this.renderer.setFlowSpeed(T)}setStaticMode(T){this.renderer.setStaticMode(T)}setFPS(T){this.renderer.setFPS(T)}pause(){this.renderer.pause()}resume(){this.renderer.resume()}setLowFreqVolume(T){this.renderer.setLowFreqVolume(T)}setHasLyric(T){this.renderer.setHasLyric(T)}setAlbum(T,L){return this.renderer.setAlbum(T,L)}getElement(){return this.element}dispose(){this.renderer.dispose(),this.element.remove()}}const Xe="_lyricLine_1vq69_6",Ze="_lyricBgLine_1vq69_42",Je="_active_1vq69_51",Qe="_hasDuetLine_1vq69_63",Ke="_lyricDuetLine_1vq69_64",ts="_lyricMainLine_1vq69_83",es="_emphasizeWrapper_1vq69_93",ss="_emphasize_1vq69_93",is="_lyricSubLine_1vq69_116",ns="_disableSpring_1vq69_123",rs="_interludeDots_1vq69_128",as="_enabled_1vq69_140",os="_tmpDisableTransition_1vq69_166",W={lyricLine:Xe,lyricBgLine:Ze,active:Je,hasDuetLine:Qe,lyricDuetLine:Ke,lyricMainLine:ts,emphasizeWrapper:es,emphasize:ss,lyricSubLine:is,disableSpring:ns,interludeDots:rs,enabled:as,tmpDisableTransition:os},he=-1,zt=0,ut=1,vt=2,Ot=3,Nt=4,Wt=5,Bt=6,le=7,de=8,Zt=typeof self=="object"?self:globalThis,cs=(P,T)=>{const L=(I,F)=>(P.set(F,I),I),R=I=>{if(P.has(I))return P.get(I);const[F,D]=T[I];switch(F){case zt:case he:return L(D,I);case ut:{const V=L([],I);for(const q of D)V.push(R(q));return V}case vt:{const V=L({},I);for(const[q,G]of D)V[R(q)]=R(G);return V}case Ot:return L(new Date(D),I);case Nt:{const{source:V,flags:q}=D;return L(new RegExp(V,q),I)}case Wt:{const V=L(new Map,I);for(const[q,G]of D)V.set(R(q),R(G));return V}case Bt:{const V=L(new Set,I);for(const q of D)V.add(R(q));return V}case le:{const{name:V,message:q}=D;return L(new Zt[V](q),I)}case de:return L(BigInt(D),I);case"BigInt":return L(Object(BigInt(D)),I);case"ArrayBuffer":return L(new Uint8Array(D).buffer,D);case"DataView":{const{buffer:V}=new Uint8Array(D);return L(new DataView(V),D)}}return L(new Zt[F](D),I)};return R},Jt=P=>cs(new Map,P)(0),lt="",{toString:hs}={},{keys:ls}=Object,mt=P=>{const T=typeof P;if(T!=="object"||!P)return[zt,T];const L=hs.call(P).slice(8,-1);switch(L){case"Array":return[ut,lt];case"Object":return[vt,lt];case"Date":return[Ot,lt];case"RegExp":return[Nt,lt];case"Map":return[Wt,lt];case"Set":return[Bt,lt];case"DataView":return[ut,L]}return L.includes("Array")?[ut,L]:L.includes("Error")?[le,L]:[vt,L]},wt=([P,T])=>P===zt&&(T==="function"||T==="symbol"),ds=(P,T,L,R)=>{const I=(D,V)=>{const q=R.push(D)-1;return L.set(V,q),q},F=D=>{if(L.has(D))return L.get(D);let[V,q]=mt(D);switch(V){case zt:{let z=D;switch(q){case"bigint":V=de,z=D.toString();break;case"function":case"symbol":if(P)throw new TypeError("unable to serialize "+q);z=null;break;case"undefined":return I([he],D)}return I([V,z],D)}case ut:{if(q){let tt=D;return q==="DataView"?tt=new Uint8Array(D.buffer):q==="ArrayBuffer"&&(tt=new Uint8Array(D)),I([q,[...tt]],D)}const z=[],Q=I([V,z],D);for(const tt of D)z.push(F(tt));return Q}case vt:{if(q)switch(q){case"BigInt":return I([q,D.toString()],D);case"Boolean":case"Number":case"String":return I([q,D.valueOf()],D)}if(T&&"toJSON"in D)return F(D.toJSON());const z=[],Q=I([V,z],D);for(const tt of ls(D))(P||!wt(mt(D[tt])))&&z.push([F(tt),F(D[tt])]);return Q}case Ot:return I([V,D.toISOString()],D);case Nt:{const{source:z,flags:Q}=D;return I([V,{source:z,flags:Q}],D)}case Wt:{const z=[],Q=I([V,z],D);for(const[tt,gt]of D)(P||!(wt(mt(tt))||wt(mt(gt))))&&z.push([F(tt),F(gt)]);return Q}case Bt:{const z=[],Q=I([V,z],D);for(const tt of D)(P||!wt(mt(tt)))&&z.push(F(tt));return Q}}const{message:G}=D;return I([V,{name:q,message:G}],D)};return F},Qt=(P,{json:T,lossy:L}={})=>{const R=[];return ds(!(T||L),!!T,new Map,R)(P),R},Kt=typeof structuredClone=="function"?((P,T)=>T&&("json"in T||"lossy"in T)?Jt(Qt(P,T)):structuredClone(P)):(P,T)=>Jt(Qt(P,T)),ms=(P,T)=>P.size===T.size&&[...P].every(L=>T.has(L)),ps=P=>/^[\p{Unified_Ideograph}\u0800-\u9FFC]+$/u.test(P);function fs(P){return T=>(P(T+.001)-P(T-.001))/(2*.001)}function te(P){return fs(P)}class Pt{constructor(T=0){f(this,"currentPosition",0),f(this,"targetPosition",0),f(this,"currentTime",0),f(this,"params",{}),f(this,"currentSolver"),f(this,"getV"),f(this,"getV2"),f(this,"queueParams"),f(this,"queuePosition"),this.targetPosition=T,this.currentPosition=this.targetPosition,this.currentSolver=()=>this.targetPosition,this.getV=()=>0,this.getV2=()=>0}resetSolver(){const T=this.getV(this.currentTime);this.currentTime=0,this.currentSolver=us(this.currentPosition,T,this.targetPosition,0,this.params),this.getV=te(this.currentSolver),this.getV2=te(this.getV)}arrived(){return Math.abs(this.targetPosition-this.currentPosition)<.01&&this.getV(this.currentTime)<.01&&this.getV2(this.currentTime)<.01&&this.queueParams===void 0&&this.queuePosition===void 0}setPosition(T){this.targetPosition=T,this.currentPosition=T,this.currentSolver=()=>this.targetPosition,this.getV=()=>0,this.getV2=()=>0}update(T=0){this.currentTime+=T,this.currentPosition=this.currentSolver(this.currentTime),this.queueParams&&(this.queueParams.time-=T,this.queueParams.time<=0&&this.updateParams({...this.queueParams})),this.queuePosition&&(this.queuePosition.time-=T,this.queuePosition.time<=0&&this.setTargetPosition(this.queuePosition.position)),this.arrived()&&this.setPosition(this.targetPosition)}updateParams(T,L=0){L>0?this.queueParams={...this.queuePosition??{},...T,time:L}:(this.queuePosition=void 0,this.params={...this.params,...T},this.resetSolver())}setTargetPosition(T,L=0){L>0?this.queuePosition={...this.queuePosition??{},position:T,time:L}:(this.queuePosition=void 0,this.targetPosition=T,this.resetSolver())}getCurrentPosition(){return this.currentPosition}}function us(P,T,L,R=0,I){const F=I?.soft??!1,D=I?.stiffness??100,V=I?.damping??10,q=I?.mass??1,G=L-P;if(F||1<=V/(2*Math.sqrt(D*q))){const yt=-Math.sqrt(D/q),Et=-yt*G-T;return J=>(J-=R,J<0?P:L-(G+J*Et)*Math.E**(J*yt))}const z=Math.sqrt(4*q*D-V**2),Q=(V*G-2*q*T)/z,tt=.5*z/q,gt=-(.5*V)/q;return yt=>(yt-=R,yt<0?P:L-(Math.cos(yt*tt)*G+Math.sin(yt*tt)*Q)*Math.E**(yt*gt))}const _t=[],Rt=[];let Ct=!1;function ys(){let P=Rt.shift();for(;P;){try{P.resolve(P.task())}catch(T){P.reject(T)}P=Rt.shift()}for(P=_t.shift();P;){try{P.resolve(P.task())}catch(T){P.reject(T)}P=_t.shift()}Ct=!1}function me(){Ct||(Ct=!0,requestAnimationFrame(ys))}function pe(P){const T={task:P,resolve:()=>{},reject:()=>{}},L=new Promise((R,I)=>{T.resolve=R,T.reject=I});return _t.push(T),me(),L}class gs{constructor(T){f(this,"element",document.createElement("div")),f(this,"left",0),f(this,"top",0),f(this,"delay",0),f(this,"lineSize",[0,0]),f(this,"lineTransforms",{posX:new Pt(0),posY:new Pt(0)}),f(this,"lastStyle",""),this.lyricPlayer=T,this.element.setAttribute("class",W.lyricLine),this.rebuildStyle()}async measureSize(){return await pe(()=>[this.element.clientWidth,this.element.clientHeight])}show(){this.rebuildStyle()}hide(){this.rebuildStyle()}rebuildStyle(){let T=`transform:translate(${this.lineTransforms.posX.getCurrentPosition().toFixed(2)}px,${this.lineTransforms.posY.getCurrentPosition().toFixed(2)}px);`;!this.lyricPlayer.getEnableSpring()&&this.isInSight&&(T+=`transition-delay:${this.delay}ms;`),T!==this.lastStyle&&(this.lastStyle=T,this.element.setAttribute("style",T))}getElement(){return this.element}setTransform(T=this.left,L=this.top,R=!1,I=0){this.left=T,this.top=L,this.delay=I*1e3|0,R||!this.lyricPlayer.getEnableSpring()?(R&&this.element.classList.add(W.tmpDisableTransition),this.lineTransforms.posX.setPosition(T),this.lineTransforms.posY.setPosition(L),this.lyricPlayer.getEnableSpring()?this.rebuildStyle():this.show(),R&&requestAnimationFrame(()=>{this.element.classList.remove(W.tmpDisableTransition)})):(this.lineTransforms.posX.setTargetPosition(T,I),this.lineTransforms.posY.setTargetPosition(L,I))}update(T=0){this.lyricPlayer.getEnableSpring()&&(this.lineTransforms.posX.update(T),this.lineTransforms.posY.update(T),this.isInSight?this.show():this.hide())}get isInSight(){const T=this.lineTransforms.posX.getCurrentPosition(),L=this.lineTransforms.posY.getCurrentPosition(),R=T+this.lineSize[0],I=L+this.lineSize[1],F=this.lyricPlayer.size[0],D=this.lyricPlayer.size[1];return!(T>F||L>D||R<0||I<0)}dispose(){this.element.remove()}}function Ms(P){const T=2.5949095;return P<.5?(2*P)**2*((T+1)*2*P-T)/2:((2*P-2)**2*((T+1)*(P*2-2)+T)+2)/2}function Ls(P){return P===1?1:1-2**(-10*P)}const it=(P,T,L)=>Math.max(P,Math.min(T,L));class bs{constructor(){f(this,"element",document.createElement("div")),f(this,"dot0",document.createElement("span")),f(this,"dot1",document.createElement("span")),f(this,"dot2",document.createElement("span")),f(this,"left",0),f(this,"top",0),f(this,"playing",!0),f(this,"lastStyle",""),f(this,"currentInterlude"),f(this,"currentTime",0),f(this,"targetBreatheDuration",1500),this.element.className=W.interludeDots,this.element.appendChild(this.dot0),this.element.appendChild(this.dot1),this.element.appendChild(this.dot2)}getElement(){return this.element}setTransform(T=this.left,L=this.top){this.left=T,this.top=L,this.update()}setInterlude(T){this.currentInterlude=T,this.currentTime=T?.[0]??0,T?this.element.classList.add(W.enabled):this.element.classList.remove(W.enabled)}pause(){this.playing=!1,this.element.classList.remove(W.playing)}resume(){this.playing=!0,this.element.classList.add(W.playing)}update(T=0){if(!this.playing)return;this.currentTime+=T;let L="";if(L+=`transform:translate(${this.left.toFixed(2)}px, ${this.top.toFixed(2)}px)`,this.currentInterlude){const R=this.currentInterlude[1]-this.currentInterlude[0],I=this.currentTime-this.currentInterlude[0];if(I<=R){const F=R/Math.ceil(R/this.targetBreatheDuration);let D=1,V=1;D*=Math.sin(1.5*Math.PI-I/F*2)/20+1,I<2e3&&(D*=Ls(I/2e3)),I<500?V=0:I<1e3&&(V*=(I-500)/500),R-I<750&&(D*=1-Ms((750-(R-I))/750/2)),R-I<375&&(V*=it(0,(R-I)/375,1));const q=Math.max(0,R-750);D=Math.max(0,D)*.7,L+=` scale(${D})`;const G=it(.25,I*3/q*.75,1),z=it(.25,(I-q/3)*3/q*.75,1),Q=it(.25,(I-q/3*2)*3/q*.75,1);this.dot0.style.opacity=`${it(0,Math.max(0,V*G),1)}`,this.dot1.style.opacity=`${it(0,Math.max(0,V*z),1)}`,this.dot2.style.opacity=`${it(0,Math.max(0,V*Q),1)}`}else L+=" scale(0)",this.dot0.style.opacity="0",this.dot1.style.opacity="0",this.dot2.style.opacity="0";L+=";",this.lastStyle!==L&&(this.element.setAttribute("style",L),this.lastStyle=L)}}dispose(){this.element.remove()}}class qt extends EventTarget{constructor(){super(),f(this,"element",document.createElement("div")),f(this,"currentTime",0),f(this,"lyricLinesSize",new WeakMap),f(this,"lyricLineElementMap",new WeakMap),f(this,"currentLyricLines",[]),f(this,"processedLines",[]),f(this,"lyricLinesIndexes",new WeakMap),f(this,"hotLines",new Set),f(this,"bufferedLines",new Set),f(this,"isNonDynamic",!1),f(this,"hasDuetLine",!1),f(this,"scrollToIndex",0),f(this,"disableSpring",!1),f(this,"interludeDotsSize",[0,0]),f(this,"interludeDots",new bs),f(this,"bottomLine",new gs(this)),f(this,"enableBlur",!0),f(this,"enableScale",!0),f(this,"hidePassedLines",!1),f(this,"scrollBoundary",[0,0]),f(this,"currentLyricLineObjects",[]),f(this,"isSeeking",!1),f(this,"lastCurrentTime",0),f(this,"alignAnchor","center"),f(this,"alignPosition",.35),f(this,"scrollOffset",0),f(this,"size",[0,0]),f(this,"allowScroll",!0),f(this,"isPageVisible",!0),f(this,"initialLayoutFinished",!1),f(this,"posXSpringParams",{mass:1,damping:10,stiffness:100}),f(this,"posYSpringParams",{mass:.9,damping:15,stiffness:90}),f(this,"scaleSpringParams",{mass:2,damping:25,stiffness:100}),f(this,"scaleForBGSpringParams",{mass:1,damping:20,stiffness:50}),f(this,"onPageShow",()=>{this.isPageVisible=!0,this.setCurrentTime(this.currentTime,!0)}),f(this,"onPageHide",()=>{this.isPageVisible=!1}),f(this,"scrolledHandler",0),f(this,"isScrolled",!1),f(this,"resizeObserver",new ResizeObserver(G=>{let z=!1,Q=!1;for(const tt of G)if(tt.target===this.element){const gt=tt.contentRect;this.size[0]=gt.width,this.size[1]=gt.height,Q=!0}else if(tt.target===this.interludeDots.getElement())this.interludeDotsSize[0]=tt.target.clientWidth,this.interludeDotsSize[1]=tt.target.clientHeight,z=!0;else if(tt.target===this.bottomLine.getElement()){const gt=[tt.target.clientWidth,tt.target.clientHeight],yt=this.bottomLine.lineSize;(gt[0]!==yt[0]||gt[1]!==yt[1])&&(this.bottomLine.lineSize=gt,z=!0)}else{const gt=this.lyricLineElementMap.get(tt.target);if(gt){const yt=[tt.target.clientWidth,tt.target.clientHeight],Et=this.lyricLinesSize.get(gt)??[0,0];(yt[0]!==Et[0]||yt[1]!==Et[1])&&(this.lyricLinesSize.set(gt,yt),gt.onLineSizeChange(yt),z=!0)}}z&&this.calcLayout(!0),Q&&this.onResize()})),f(this,"wordFadeWidth",.5),f(this,"targetAlignIndex",0),f(this,"isPlaying",!0),this.resizeObserver.observe(this.element),this.resizeObserver.observe(this.interludeDots.getElement()),this.element.classList.add(W.lyricPlayer),this.element.appendChild(this.interludeDots.getElement()),this.element.appendChild(this.bottomLine.getElement()),this.interludeDots.setTransform(0,200),window.addEventListener("pageshow",this.onPageShow),window.addEventListener("pagehide",this.onPageHide);let T=0,L="none",R=0,I=0,F=0,D=Symbol("amll-scroll"),V=0,q=0;this.element.addEventListener("touchstart",G=>{this.beginScrollHandler()&&(G.preventDefault(),T=this.scrollOffset,R=G.touches[0].screenY,V=R,I=Date.now(),F=0)}),this.element.addEventListener("touchmove",G=>{if(this.beginScrollHandler()){G.preventDefault();const z=G.touches[0].screenY,Q=z-R,tt=z-V,gt=tt>0?"down":tt<0?"up":"none";L!==gt?(L=gt,T=this.scrollOffset,R=z,I=Date.now()):this.scrollOffset=T-Q,V=z,q=Date.now(),this.limitScrollOffset(),this.calcLayout(!0)}}),this.element.addEventListener("touchend",G=>{if(this.beginScrollHandler()){G.preventDefault(),R=0;const z=Date.now();if(z-q>100)return this.endScrollHandler();const Q=z-I;F=(this.scrollOffset-T)/Q*1e3;let tt=0;const gt=Symbol("amll-scroll");D=gt;const yt=Et=>{tt||(tt=Et),D===gt&&this.beginScrollHandler()&&(this.scrollOffset+=F*(Et-tt)/1e3,F*=.99,this.limitScrollOffset(),this.calcLayout(!0),Math.abs(F)>1&&!this.scrollBoundary.includes(this.scrollOffset)&&requestAnimationFrame(yt),this.endScrollHandler(),tt=Et)};requestAnimationFrame(yt),this.endScrollHandler()}}),this.element.addEventListener("wheel",G=>{this.beginScrollHandler()&&(G.deltaMode===G.DOM_DELTA_PIXEL?(this.scrollOffset+=G.deltaY,this.limitScrollOffset(),this.calcLayout(!0)):(this.scrollOffset+=G.deltaY*50,this.limitScrollOffset(),this.calcLayout(!1)),this.endScrollHandler())})}beginScrollHandler(){const T=this.allowScroll;return T&&(this.isScrolled=!0,clearTimeout(this.scrolledHandler),this.scrolledHandler=setTimeout(()=>{this.isScrolled=!1,this.scrollOffset=0},5e3)),T}endScrollHandler(){}limitScrollOffset(){this.scrollOffset=Math.max(Math.min(this.scrollBoundary[1],this.scrollOffset),this.scrollBoundary[0])}setWordFadeWidth(T=.5){this.wordFadeWidth=Math.max(1e-4,T)}setEnableScale(T=!0){this.enableScale=T,this.calcLayout()}getEnableScale(){return this.enableScale}getWordFadeWidth(){return this.wordFadeWidth}setIsSeeking(T){this.isSeeking=T}setHidePassedLines(T){this.hidePassedLines=T,this.calcLayout()}setEnableBlur(T){this.enableBlur!==T&&(this.enableBlur=T,this.calcLayout())}setAlignAnchor(T){this.alignAnchor=T}setAlignPosition(T){this.alignPosition=T}setEnableSpring(T=!0){this.disableSpring=!T,T?this.element.classList.remove(W.disableSpring):this.element.classList.add(W.disableSpring),this.calcLayout(!0)}getEnableSpring(){return!this.disableSpring}getCurrentInterlude(){var T,L,R,I;if(this.bufferedLines.size>0)return;const F=this.currentTime+20,D=this.scrollToIndex;if(D===0){if((T=this.processedLines[0])!=null&&T.startTime){if(this.processedLines[0].startTime>F)return[F,Math.max(F,this.processedLines[0].startTime-250),-2,this.processedLines[0].isDuet];if(this.processedLines[1].startTime>F&&this.processedLines[0].endTime<F)return[Math.max(this.processedLines[0].endTime,F),this.processedLines[1].startTime,0,this.processedLines[1].isDuet]}}else if((L=this.processedLines[D])!=null&&L.endTime&&(R=this.processedLines[D+1])!=null&&R.startTime){if(this.processedLines[D+1].startTime>F&&this.processedLines[D].endTime<F)return[Math.max(this.processedLines[D].endTime,F),this.processedLines[D+1].startTime,D,this.processedLines[D+1].isDuet];if((I=this.processedLines[D+2])!=null&&I.startTime&&this.processedLines[D+2].startTime>F&&this.processedLines[D+1].endTime<F)return[Math.max(this.processedLines[D+1].endTime,F),this.processedLines[D+2].startTime,D+1,this.processedLines[D+2].isDuet]}}setLyricLines(T,L=0){this.initialLayoutFinished=!0;for(const R of T)for(const I of R.words)I.word=I.word.replace(/\s+/g," ");this.lastCurrentTime=L,this.currentTime=L,this.currentLyricLines=Kt(T),this.processedLines=Kt(T),this.isNonDynamic=!0;for(const R of this.processedLines)if(R.words.length>1){this.isNonDynamic=!1;break}this.hasDuetLine=this.processedLines.some(R=>R.isDuet),this.processedLines.forEach((R,I,F)=>{if(R.isBG)return;const D=F[I+1];D!=null&&D.isBG&&(D.startTime=Math.min(D.startTime,R.startTime),D.endTime=Math.max(D.endTime,R.endTime))});for(const R of this.currentLyricLineObjects)R.dispose();this.interludeDots.setInterlude(void 0),this.hotLines.clear(),this.bufferedLines.clear(),this.setCurrentTime(0,!0)}setCurrentTime(T,L=!1){var R,I,F,D,V,q,G,z,Q;if(this.currentTime=T,!this.initialLayoutFinished&&!L)return;const tt=new Set,gt=new Set,yt=new Set;for(const Et of this.hotLines){const J=this.processedLines[Et];if(J){if(J.isBG)continue;const At=this.processedLines[Et+1];if(At!=null&&At.isBG){const kt=this.processedLines[Et+2],ne=Math.min(J.startTime,At?.startTime),Te=Math.min(Math.max(J.endTime,kt?.startTime??Number.MAX_VALUE),Math.max(J.endTime,At?.endTime));(ne>T||Te<=T)&&(this.hotLines.delete(Et),tt.add(Et),this.hotLines.delete(Et+1),tt.add(Et+1),L&&((R=this.currentLyricLineObjects[Et])==null||R.disable(),(I=this.currentLyricLineObjects[Et+1])==null||I.disable()))}else(J.startTime>T||J.endTime<=T)&&(this.hotLines.delete(Et),tt.add(Et),L&&((F=this.currentLyricLineObjects[Et])==null||F.disable()))}else this.hotLines.delete(Et),tt.add(Et),L&&((D=this.currentLyricLineObjects[Et])==null||D.disable())}this.currentLyricLineObjects.forEach((Et,J,At)=>{var kt,ne;const Te=Et.getLine();!Te.isBG&&Te.startTime<=T&&Te.endTime>T&&(this.hotLines.has(J)||(this.hotLines.add(J),yt.add(J),L&&Et.enable(),(ne=(kt=At[J+1])==null?void 0:kt.getLine())!=null&&ne.isBG&&(this.hotLines.add(J+1),yt.add(J+1),L&&At[J+1].enable())))});for(const Et of this.bufferedLines)this.hotLines.has(Et)||(gt.add(Et),L&&((V=this.currentLyricLineObjects[Et])==null||V.disable()));if(L){this.bufferedLines.size>0?this.scrollToIndex=Math.min(...this.bufferedLines):this.scrollToIndex=this.processedLines.findIndex(Et=>Et.startTime>=T),this.bufferedLines.clear();for(const Et of this.hotLines)this.bufferedLines.add(Et);this.calcLayout()}else if(gt.size>0||yt.size>0)if(gt.size===0&&yt.size>0){for(const Et of yt)this.bufferedLines.add(Et),(q=this.currentLyricLineObjects[Et])==null||q.enable();this.scrollToIndex=Math.min(...this.bufferedLines),this.calcLayout()}else if(yt.size===0&&gt.size>0){if(ms(gt,this.bufferedLines)){for(const Et of this.bufferedLines)this.hotLines.has(Et)||(this.bufferedLines.delete(Et),(G=this.currentLyricLineObjects[Et])==null||G.disable());this.calcLayout()}}else{for(const Et of yt)this.bufferedLines.add(Et),(z=this.currentLyricLineObjects[Et])==null||z.enable();for(const Et of gt)this.bufferedLines.delete(Et),(Q=this.currentLyricLineObjects[Et])==null||Q.disable();this.bufferedLines.size>0&&(this.scrollToIndex=Math.min(...this.bufferedLines)),this.calcLayout()}this.lastCurrentTime=T}async calcLayout(T=!1){var L;const R=this.getCurrentInterlude();let I=-this.scrollOffset,F=this.scrollToIndex,D=0;R?(D=R[1]-R[0],D>=4e3&&this.currentLyricLineObjects[R[2]+1]&&(F=R[2]+1)):this.interludeDots.setInterlude(void 0);const V=this.size[1]/5,q=this.currentLyricLineObjects.slice(0,F).reduce((yt,Et)=>{var J;return yt+(Et.getLine().isBG&&this.isPlaying?0:((J=this.lyricLinesSize.get(Et))==null?void 0:J[1])??V)},0);this.scrollBoundary[0]=-q,I-=q,I+=this.size[1]*this.alignPosition;const G=this.currentLyricLineObjects[F];if(this.targetAlignIndex=F,G){const yt=((L=this.lyricLinesSize.get(G))==null?void 0:L[1])??V;switch(this.alignAnchor){case"bottom":I-=yt;break;case"center":I-=yt/2;break}}const z=Math.max(...this.bufferedLines);let Q=0,tt=T?0:.05,gt=!1;this.currentLyricLineObjects.forEach((yt,Et)=>{var J,At;const kt=this.bufferedLines.has(Et),ne=kt||Et>=this.scrollToIndex&&Et<z,Te=yt.getLine();!gt&&D>=4e3&&(Et===this.scrollToIndex&&R?.[2]===-2||Et===this.scrollToIndex+1)&&(gt=!0,this.interludeDots.setTransform(0,I),R&&this.interludeDots.setInterlude([R[0],R[1]]),I+=this.interludeDotsSize[1]);let Ht;this.hidePassedLines?Et<(R?R[2]+1:this.scrollToIndex)&&this.isPlaying?Ht=1e-5:kt?Ht=.85:Ht=this.isNonDynamic?.2:1:kt?Ht=.85:Ht=this.isNonDynamic?.2:1;let Le=0;this.enableBlur&&(ne?Le=0:(Le=1,Et<this.scrollToIndex?Le+=Math.abs(this.scrollToIndex-Et)+1:Le+=Math.abs(Et-Math.max(this.scrollToIndex,z))));const ee=this.enableScale?97:100;let si=100;!ne&&this.isPlaying&&(Te.isBG?si=75:si=ee),yt.setTransform(I,si,Ht,window.innerWidth<=1024?Le*.8:Le,!1,Q),Te.isBG&&(ne||!this.isPlaying)?I+=((J=this.lyricLinesSize.get(yt))==null?void 0:J[1])??V:Te.isBG||(I+=((At=this.lyricLinesSize.get(yt))==null?void 0:At[1])??V),I>=0&&!this.isSeeking&&(Te.isBG||(Q+=tt),Et>=this.scrollToIndex&&(tt/=1.05))}),this.scrollBoundary[1]=I+this.scrollOffset-this.size[1]/2,this.bottomLine.setTransform(0,I,!1,Q)}setLinePosXSpringParams(T={}){}setLinePosYSpringParams(T={}){this.posYSpringParams={...this.posYSpringParams,...T},this.bottomLine.lineTransforms.posY.updateParams(this.posYSpringParams);for(const L of this.currentLyricLineObjects)L.lineTransforms.posY.updateParams(this.posYSpringParams)}setLineScaleSpringParams(T={}){this.scaleSpringParams={...this.scaleSpringParams,...T},this.scaleForBGSpringParams={...this.scaleForBGSpringParams,...T};for(const L of this.currentLyricLineObjects)L.getLine().isBG?L.lineTransforms.scale.updateParams(this.scaleForBGSpringParams):L.lineTransforms.scale.updateParams(this.scaleSpringParams)}pause(){this.interludeDots.pause(),this.isPlaying&&(this.isPlaying=!1,this.calcLayout())}resume(){this.interludeDots.resume(),this.isPlaying||(this.isPlaying=!0,this.calcLayout())}update(T=0){this.bottomLine.update(T/1e3),this.interludeDots.update(T/1e3)}onResize(){}getBottomLineElement(){return this.bottomLine.getElement()}resetScroll(){this.isScrolled=!1,this.scrollOffset=0,clearTimeout(this.scrolledHandler),this.scrolledHandler=0}getLyricLines(){return this.currentLyricLines}getCurrentTime(){return this.currentTime}getElement(){return this.element}dispose(){this.element.remove(),window.removeEventListener("pageshow",this.onPageShow),window.removeEventListener("pagehide",this.onPageHide)}}class H extends EventTarget{constructor(){super(...arguments),f(this,"top",0),f(this,"scale",1),f(this,"blur",0),f(this,"opacity",1),f(this,"delay",0),f(this,"lineTransforms",{posY:new Pt(0),scale:new Pt(100)})}onLineSizeChange(T){}setTransform(T=this.top,L=this.scale,R=this.opacity,I=this.blur,F=!1,D=0){this.top=T,this.scale=L,this.opacity=R,this.blur=I,this.delay=D}static shouldEmphasize(T){return ps(T.word)?T.endTime-T.startTime>=1e3:T.endTime-T.startTime>=1e3&&T.word.trim().length<=7&&T.word.trim().length>1}dispose(){}}function xs(P){return P&&P.__esModule&&Object.prototype.hasOwnProperty.call(P,"default")?P.default:P}var Ft,se;function Ts(){if(se)return Ft;se=1;var P=4,T=.001,L=1e-7,R=10,I=11,F=1/(I-1),D=typeof Float32Array=="function";function V(Et,J){return 1-3*J+3*Et}function q(Et,J){return 3*J-6*Et}function G(Et){return 3*Et}function z(Et,J,At){return((V(J,At)*Et+q(J,At))*Et+G(J))*Et}function Q(Et,J,At){return 3*V(J,At)*Et*Et+2*q(J,At)*Et+G(J)}function tt(Et,J,At,kt,ne){var Te,Ht,Le=0;do Ht=J+(At-J)/2,Te=z(Ht,kt,ne)-Et,Te>0?At=Ht:J=Ht;while(Math.abs(Te)>L&&++Le<R);return Ht}function gt(Et,J,At,kt){for(var ne=0;ne<P;++ne){var Te=Q(J,At,kt);if(Te===0)return J;var Ht=z(J,At,kt)-Et;J-=Ht/Te}return J}function yt(Et){return Et}return Ft=function(Et,J,At,kt){if(!(0<=Et&&Et<=1&&0<=At&&At<=1))throw new Error("bezier x values must be in [0, 1] range");if(Et===J&&At===kt)return yt;for(var ne=D?new Float32Array(I):new Array(I),Te=0;Te<I;++Te)ne[Te]=z(Te*F,Et,At);function Ht(Le){for(var ee=0,si=1,ci=I-1;si!==ci&&ne[si]<=Le;++si)ee+=F;--si;var ui=(Le-ne[si])/(ne[si+1]-ne[si]),di=ee+ui*F,ii=Q(di,Et,At);return ii>=T?gt(Le,di,Et,At):ii===0?di:tt(Le,ee,ee+F,Et,At)}return function(Le){return Le===0?0:Le===1?1:z(Ht(Le),J,kt)}},Ft}var ws=Ts();const It=xs(ws),Ss=/^[\p{Unified_Ideograph}\u0800-\u9FFC]+$/u;function $t(P){const T=[];for(const F of P){const D=F.word.replace(/\s/g,"").length,V=F.word.split(" ").filter(q=>q.trim().length>0);if(V.length>1){F.word.startsWith(" ")&&T.push({word:" ",startTime:0,endTime:0,obscene:!1});let q=0;for(const G of V){const z={word:G,obscene:F.obscene,startTime:F.startTime+q/D*(F.endTime-F.startTime),endTime:F.startTime+(q+G.length)/D*(F.endTime-F.startTime)};T.push(z),T.push({word:" ",startTime:0,endTime:0,obscene:!1}),q+=G.length}F.word.endsWith(" ")||T.pop()}else T.push({...F})}let L=[],R=[];const I=[];for(const F of T){const D=F.word;L.push(D),R.push(F),D.length>0&&D.trim().length===0?(L.pop(),R.pop(),R.length===1?I.push(R[0]):R.length>1&&I.push(R),I.push(F),L=[],R=[]):(!/^\s*[^\s]*\s*$/.test(L.join(""))||Ss.test(D))&&(L.pop(),R.pop(),R.length===1?I.push(R[0]):R.length>1&&I.push(R),L=[D],R=[F])}return R.length===1?I.push(R[0]):I.push(R),I}function fe(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function ue(P,T=1,L={x:0,y:0}){const[R,I]=[L.x,L.y];return[P[0]*T,P[1]*T,P[2]*T,P[3],P[4]*T,P[5]*T,P[6]*T,P[7],P[8]*T,P[9]*T,P[10]*T,P[11],P[12]-R*T+R,P[13]-I*T+I,P[14],P[15]]}function ye(P,T=4){const L=(R,I)=>R.toFixed(T);return`matrix3d(${P.map(L).join(", ")})`}const St=32,ge=(P,T)=>L=>Math.min(1,Math.max(0,(L-P)/(T-P))),Vt=.5,Es=ge(0,Vt),vs=ge(Vt,1),Ps=It(.2,.4,.58,1),zs=It(.3,0,.58,1),Is=P=>T=>T<P?Ps(Es(T)):1-zs(vs(T));function ie(P,T=0,L="rgba(0,0,0,var(--bright-mask-alpha, 1.0))",R="rgba(0,0,0,var(--dark-mask-alpha, 1.0))"){const I=2+P+T,F=P/I,D=(1-F)/2;return[`linear-gradient(to right,${L} ${D*100}%,${R} ${(D+F)*100}%)`,I]}let ks=class extends MouseEvent{constructor(P,T){super(T.type,T),this.line=P}};function Ds(P){const T=P.match(/matrix\(([^)]+)\)/);if(T){const L=T[1].split(", "),R=Number.parseFloat(L[0]),I=Number.parseFloat(L[3]);return(R+I)/2}return 1}let Fs=class extends H{constructor(P,T={words:[],translatedLyric:"",romanLyric:"",startTime:0,endTime:0,isBG:!1,isDuet:!1}){super(),f(this,"element",document.createElement("div")),f(this,"splittedWords",[]),f(this,"lineSize",[0,0]),f(this,"listenersMap",new Map),f(this,"onMouseEvent",F=>{const D=new ks(this,F);for(const V of this.listenersMap.get(F.type)??[])V.call(this,D);if(!this.dispatchEvent(D)||D.defaultPrevented)return F.preventDefault(),F.stopPropagation(),F.stopImmediatePropagation(),!1}),f(this,"isEnabled",!1),f(this,"lastWord"),f(this,"_hide",!0),f(this,"_prevParentEl"),f(this,"lastStyle",""),this.lyricPlayer=P,this.lyricLine=T,this._prevParentEl=P.getElement(),P.resizeObserver.observe(this.element),this.element.setAttribute("class",W.lyricLine),this.lyricLine.isBG&&this.element.classList.add(W.lyricBgLine),this.lyricLine.isDuet&&this.element.classList.add(W.lyricDuetLine),this.lineTransforms.posY.setPosition(window.innerHeight*2),this.element.appendChild(document.createElement("div")),this.element.appendChild(document.createElement("div")),this.element.appendChild(document.createElement("div"));const L=this.element.children[0],R=this.element.children[1],I=this.element.children[2];L.setAttribute("class",W.lyricMainLine),R.setAttribute("class",W.lyricSubLine),I.setAttribute("class",W.lyricSubLine),this.rebuildElement(),this.rebuildStyle()}addMouseEventListener(P,T,L){if(T){const R=this.listenersMap.get(P)??new Set;R.size===0&&this.element.addEventListener(P,this.onMouseEvent,L),R.add(T),this.listenersMap.set(P,R)}}removeMouseEventListener(P,T,L){if(T){const R=this.listenersMap.get(P);R&&(R.delete(T),R.size===0&&this.element.removeEventListener(P,this.onMouseEvent,L))}}areWordsOnSameLine(P,T){if(P!=null&&P.mainElement&&T!=null&&T.mainElement){const L=P.mainElement,R=T.mainElement,I=L.getBoundingClientRect(),F=R.getBoundingClientRect();return Math.abs(I.top-F.top)<10}return!0}async enable(P=this.lyricLine.startTime){this.isEnabled=!0,this.element.classList.add(W.active);const T=this.element.children[0];for(const L of this.splittedWords){for(const R of L.elementAnimations)R.currentTime=0,R.playbackRate=1,R.play();for(const R of L.maskAnimations)R.currentTime=Math.min(this.totalDuration,Math.max(0,P-this.lyricLine.startTime)),R.playbackRate=1,R.play()}T.classList.add(W.active)}disable(){this.isEnabled=!1,this.element.classList.remove(W.active);const P=this.element.children[0];for(const T of this.splittedWords)for(const L of T.elementAnimations)(L.id==="float-word"||L.id.includes("emphasize-word-float-only"))&&(L.playbackRate=-1,L.play());P.classList.remove(W.active)}async resume(){if(this.isEnabled)for(const P of this.splittedWords){for(const T of P.elementAnimations)(!this.lastWord||this.splittedWords.indexOf(this.lastWord)<this.splittedWords.indexOf(P))&&T.play();for(const T of P.maskAnimations)(!this.lastWord||this.splittedWords.indexOf(this.lastWord)<this.splittedWords.indexOf(P))&&T.play()}}async pause(){if(this.isEnabled)for(const P of this.splittedWords){for(const T of P.elementAnimations)T.pause();for(const T of P.maskAnimations)T.pause()}}setMaskAnimationState(P=0){const T=P-this.lyricLine.startTime;for(const L of this.splittedWords)for(const R of L.maskAnimations)R.currentTime=Math.min(this.totalDuration,Math.max(0,T)),R.playbackRate=1,T>=0&&T<this.totalDuration?R.play():R.pause()}getLine(){return this.lyricLine}show(){this._hide=!1,this.element.parentElement||(this._prevParentEl.appendChild(this.element),this.lyricPlayer.resizeObserver.observe(this.element)),this.rebuildStyle()}hide(){this._hide=!0,this.element.parentElement&&(this._prevParentEl.removeChild(this.element),this.lyricPlayer.resizeObserver.unobserve(this.element))}rebuildStyle(){let P="";P+=`transform:translateY(${this.lineTransforms.posY.getCurrentPosition().toFixed(1)}px) scale(${(this.lineTransforms.scale.getCurrentPosition()/100).toFixed(4)});`,!this.lyricPlayer.getEnableSpring()&&this.isInSight&&(P+=`transition-delay:${this.delay}ms;`),P+=`filter:blur(${Math.min(32,this.blur)}px);`,P!==this.lastStyle&&(this.lastStyle=P,this.element.setAttribute("style",P))}rebuildElement(){this.disposeElements();const P=this.element.children[0],T=this.element.children[1],L=this.element.children[2];if(this.lyricPlayer._getIsNonDynamic()){P.innerText=this.lyricLine.words.map(I=>I.word).join(""),T.innerText=this.lyricLine.translatedLyric,L.innerText=this.lyricLine.romanLyric;return}const R=$t(this.lyricLine.words);P.innerHTML="";for(const I of R)if(Array.isArray(I)){if(I.length===0)continue;const F=I.reduce((G,z)=>(G.endTime=Math.max(G.endTime,z.endTime),G.startTime=Math.min(G.startTime,z.startTime),G.word+=z.word,G),{word:"",startTime:Number.POSITIVE_INFINITY,endTime:Number.NEGATIVE_INFINITY,wordType:"normal",obscene:!1}),D=I.map(G=>H.shouldEmphasize(G)).reduce((G,z)=>G||z,H.shouldEmphasize(F)),V=document.createElement("span");V.classList.add(W.emphasizeWrapper);const q=[];for(const G of I){const z=document.createElement("span");if(D){z.classList.add(W.emphasize);const Q=[];for(const gt of G.word.trim().split("")){const yt=document.createElement("span");yt.innerText=gt,Q.push(yt),q.push(yt),z.appendChild(yt)}const tt={...G,mainElement:z,subElements:Q,elementAnimations:[this.initFloatAnimation(G,z)],maskAnimations:[],width:0,height:0,padding:0,shouldEmphasize:D};this.splittedWords.push(tt)}else z.innerText=G.word,this.splittedWords.push({...G,mainElement:z,subElements:[],elementAnimations:[this.initFloatAnimation(G,z)],maskAnimations:[],width:0,height:0,padding:0,shouldEmphasize:D});V.appendChild(z)}D&&this.splittedWords[this.splittedWords.length-1].elementAnimations.push(...this.initEmphasizeAnimation(F,q,F.endTime-F.startTime,F.startTime-this.lyricLine.startTime)),F.word.trimStart()!==F.word&&P.appendChild(document.createTextNode(" ")),P.appendChild(V),F.word.trimEnd()!==F.word&&H.shouldEmphasize(F)&&P.appendChild(document.createTextNode(" "))}else if(I.word.trim().length===0)P.appendChild(document.createTextNode(" "));else{const F=H.shouldEmphasize(I),D=document.createElement("span"),V={...I,mainElement:D,subElements:[],elementAnimations:[this.initFloatAnimation(I,D)],maskAnimations:[],width:0,height:0,padding:0,shouldEmphasize:F};if(H.shouldEmphasize(I)){D.classList.add(W.emphasize);const q=[];for(const z of I.word.trim().split("")){const Q=document.createElement("span");Q.innerText=z,q.push(Q),D.appendChild(Q)}V.subElements=q;const G=Math.abs(V.endTime-V.startTime);V.elementAnimations.push(...this.initEmphasizeAnimation(I,q,G,V.startTime-this.lyricLine.startTime))}else D.innerText=I.word.trim();I.word.trimStart()!==I.word&&P.appendChild(document.createTextNode(" ")),P.appendChild(D),I.word.trimEnd()!==I.word&&P.appendChild(document.createTextNode(" ")),this.splittedWords.push(V)}T.innerText=this.lyricLine.translatedLyric,L.innerText=this.lyricLine.romanLyric}initFloatAnimation(P,T){const L=P.startTime-this.lyricLine.startTime,R=Math.max(1e3,P.endTime-P.startTime);let I=.05;this.lyricLine.isBG&&(I*=2);const F=T.animate([{transform:"translateY(0px)"},{transform:`translateY(${-I}em)`}],{duration:Number.isFinite(R)?R:0,delay:Number.isFinite(L)?L:0,id:"float-word",composite:"add",fill:"both",easing:"ease-out"});return F.pause(),F}initEmphasizeAnimation(P,T,L,R){const I=Math.max(0,R);let F=Math.max(1e3,L),D=[],V=F/2e3;V=V>1?Math.sqrt(V):V**3;let q=F/3e3;q=q>1?Math.sqrt(q):q**3,V*=.6,q*=.5,this.lyricLine.words.length>0&&P.word.includes(this.lyricLine.words[this.lyricLine.words.length-1].word)&&(V*=1.6,q*=1.5,F*=1.2),V=Math.min(1.2,V),q=Math.min(.8,q);const G=Number.isFinite(F)?F:0,z=Is(Vt);return D=T.flatMap((Q,tt,gt)=>{const yt=I+F/2.5/gt.length*tt,Et=[],J=new Array(St).fill(0).map((Te,Ht)=>{const Le=(Ht+1)/St,ee=z(Le),si=z(Le)*q,ci=ue(fe(),1+ee*.1*V),ui=-ee*.03*V*(gt.length/2-tt),di=-ee*.025*V;return{offset:Le,transform:`${ye(ci,4)} translate(${ui}em, ${di}em)`,textShadow:`0 0 ${Math.min(.3,q*.3)}em rgba(255, 255, 255, ${si})`}}),At=Q.animate(J,{duration:G,delay:Number.isFinite(yt)?yt:0,id:`emphasize-word-${Q.innerText}-${tt}`,iterations:1,composite:"replace",fill:"both"});At.onfinish=()=>{At.pause()},At.pause(),Et.push(At);const kt=new Array(St).fill(0).map((Te,Ht)=>{const Le=(Ht+1)/St;let ee=Math.sin(Le*Math.PI);return this.lyricLine.isBG&&(ee*=2),{offset:Le,transform:`translateY(${-ee*.05}em)`}}),ne=Q.animate(kt,{duration:G*1.4,delay:Number.isFinite(yt)?yt-400:0,id:"emphasize-word-float",iterations:1,composite:"add",fill:"both"});return ne.onfinish=()=>{ne.pause()},ne.pause(),Et.push(ne),Et}),D}get totalDuration(){return this.lyricLine.endTime-this.lyricLine.startTime}onLineSizeChange(P){this.updateMaskImageSync()}updateMaskImageSync(){for(const P of this.splittedWords){const T=P.mainElement;T?(P.padding=Number.parseFloat(getComputedStyle(T).paddingLeft),P.width=T.clientWidth-P.padding*2,P.height=T.clientHeight-P.padding*2):(P.width=0,P.height=0,P.padding=0)}this.lyricPlayer.supportMaskImage?this.generateWebAnimationBasedMaskImage():this.generateCalcBasedMaskImage(),this.isEnabled&&this.enable(this.lyricPlayer.getCurrentTime())}generateCalcBasedMaskImage(){for(const P of this.splittedWords){const T=P.mainElement;if(T){P.width=T.clientWidth,P.height=T.clientHeight;const L=P.height*this.lyricPlayer.getWordFadeWidth(),[R,I]=ie(L/P.width),F=`${I*100}% 100%`;this.lyricPlayer.supportMaskImage?(T.style.maskImage=R,T.style.maskRepeat="no-repeat",T.style.maskOrigin="left",T.style.maskSize=F):(T.style.webkitMaskImage=R,T.style.webkitMaskRepeat="no-repeat",T.style.webkitMaskOrigin="left",T.style.webkitMaskSize=F);const D=P.width+L,V=`clamp(${-D}px,calc(${-D}px + (var(--amll-player-time) - ${P.startTime})*${D/Math.abs(P.endTime-P.startTime)}px),0px) 0px, left top`;T.style.maskPosition=V,T.style.webkitMaskPosition=V}}}generateWebAnimationBasedMaskImage(){const P=Math.max(this.splittedWords.reduce((T,L)=>Math.max(L.endTime,T),0),this.lyricLine.endTime)-this.lyricLine.startTime;this.splittedWords.forEach((T,L)=>{const R=T.mainElement;if(R){const I=T.height*this.lyricPlayer.getWordFadeWidth(),[F,D]=ie(I/(T.width+T.padding*2)),V=`${D*100}% 100%`;this.lyricPlayer.supportMaskImage?(R.style.maskImage=F,R.style.maskRepeat="no-repeat",R.style.maskOrigin="left",R.style.maskSize=V):(R.style.webkitMaskImage=F,R.style.webkitMaskRepeat="no-repeat",R.style.webkitMaskOrigin="left",R.style.webkitMaskSize=V);const q=this.splittedWords.slice(0,L).reduce((kt,ne)=>kt+ne.width,0)+(this.splittedWords[0]?I:0),G=-(T.width+T.padding*2+I),z=kt=>Math.max(G,Math.min(0,kt));let Q=-q-T.width-T.padding-I,tt=0;const gt=[];let yt=Q,Et=0;const J=()=>{const kt=Q-yt,ne=Math.max(0,Math.min(1,tt)),Te=ne-Et,Ht=Math.abs(Te/kt);if(Q>G&&yt<G){const si=Math.abs(yt-G)*Ht,ci=`${z(yt)}px 0`,ui={offset:Et+si,maskPosition:ci};gt.push(ui)}if(Q>0&&yt<0){const si=Math.abs(yt)*Ht,ci=`${z(Q)}px 0`,ui={offset:Et+si,maskPosition:ci};gt.push(ui)}const Le=`${z(Q)}px 0`,ee={offset:ne,maskPosition:Le};gt.push(ee),yt=Q,Et=ne};J();let At=0;this.splittedWords.forEach((kt,ne)=>{{const Te=kt.startTime-this.lyricLine.startTime,Ht=Te-At;tt+=Ht/P,Ht>0&&J(),At=Te}{const Te=kt.endTime-kt.startTime;tt+=Te/P,Q+=kt.width,ne===0&&(Q+=I*1.5),ne===this.splittedWords.length-1&&(Q+=I*.5),Te>0&&J(),At+=Te}});for(const kt of T.maskAnimations)kt.cancel();try{const kt=R.animate(gt,{duration:P||1,id:`fade-word-${T.word}-${L}`,fill:"both"});kt.pause(),T.maskAnimations=[kt]}catch(kt){console.warn("应用渐变动画发生错误",gt,P,kt)}}})}getElement(){return this.element}setTransform(P=this.top,T=this.scale,L=1,R=0,I=!1,F=0){super.setTransform(P,T,L,R,I,F);const D=this.isInSight,V=this.lyricPlayer.getEnableSpring();this.top=P,this.scale=T,this.delay=F*1e3|0;const q=this.element.children[0];if(q.style.opacity=`${L}`,I||!V)if(this.blur=Math.min(32,R),this.lineTransforms.posY.setPosition(P),this.lineTransforms.scale.setPosition(T),V)this.rebuildStyle();else{const G=this.isInSight;D||G?this.show():this.hide()}else if(this.lineTransforms.posY.setTargetPosition(P,F),this.lineTransforms.scale.setTargetPosition(T),this.blur!==Math.min(32,R)){this.blur=Math.min(32,R);const G=R.toFixed(3);this.element.style.filter=`blur(${G}px)`}}update(P=0){if(this.lyricPlayer.getEnableSpring())if(this.lineTransforms.posY.update(P),this.lineTransforms.scale.update(P),this.isInSight?this.show():this.hide(),this.lyricPlayer.getEnableSpring())this.element.style.setProperty("--bright-mask-alpha",`${Math.max(0,Math.min(1,this.lineTransforms.scale.getCurrentPosition()/100-.97)/.03)*.8+.2}`),this.element.style.setProperty("--dark-mask-alpha",`${Math.max(0,Math.min(1,this.lineTransforms.scale.getCurrentPosition()/100-.97)/.03)*.2+.2}`);else{const T=window.getComputedStyle(this.element).transform,L=Ds(T);this.element.style.setProperty("--bright-mask-alpha",`${Math.max(0,Math.min(1,(L-.97)/.03))*.8+.2}`),this.element.style.setProperty("--dark-mask-alpha",`${Math.max(0,Math.min(1,(L-.97)/.03))*.2+.2}`)}}_getDebugTargetPos(){return`[位移: ${this.top}; 缩放: ${this.scale}; 延时: ${this.delay}]`}get isInSight(){var P;const T=this.lineTransforms.posY.getCurrentPosition(),L=((P=this.lyricPlayer.lyricLinesSize.get(this))==null?void 0:P[1])??0,R=T+L,I=this.lyricPlayer.size[1];return!(T>I+L||R<-L)}disposeElements(){var P,T;for(const L of this.splittedWords){for(const R of L.elementAnimations)R.cancel();for(const R of L.maskAnimations)R.cancel();for(const R of L.subElements)R.remove(),(P=R.parentNode)==null||P.removeChild(R);L.elementAnimations=[],L.maskAnimations=[],L.subElements=[],L.mainElement.remove(),(T=L.mainElement.parentNode)==null||T.removeChild(L.mainElement)}this.splittedWords=[]}dispose(){this.disposeElements(),this.lyricPlayer.resizeObserver.unobserve(this.element),this.element.remove()}};class Me extends MouseEvent{constructor(T,L,R){super(`line-${R.type}`,R),this.lineIndex=T,this.line=L}}class pi extends qt{constructor(){super(),f(this,"currentLyricLineObjects",[]),f(this,"supportPlusLighter",CSS.supports("mix-blend-mode","plus-lighter")),f(this,"supportMaskImage",CSS.supports("mask-image","none")),f(this,"innerSize",[0,0]),f(this,"onLineClickedHandler",T=>{const L=new Me(this.lyricLinesIndexes.get(T.line)??-1,T.line,T);this.dispatchEvent(L)||(T.preventDefault(),T.stopPropagation(),T.stopImmediatePropagation())}),f(this,"_baseFontSize",Number.parseFloat(getComputedStyle(this.element).fontSize)),this.onResize(),this.element.classList.add("amll-lyric-player","dom"),this.disableSpring&&this.element.classList.add(W.disableSpring)}onResize(){const T=getComputedStyle(this.element);this._baseFontSize=Number.parseFloat(T.fontSize),this.rebuildStyle()}_getIsNonDynamic(){return this.isNonDynamic}get baseFontSize(){return this._baseFontSize}rebuildStyle(){}setWordFadeWidth(T=.5){super.setWordFadeWidth(T);for(const L of this.currentLyricLineObjects)L.updateMaskImageSync()}setLyricLines(T,L=0){super.setLyricLines(T,L),this.hasDuetLine?this.element.classList.add(W.hasDuetLine):this.element.classList.remove(W.hasDuetLine),this.supportMaskImage||this.element.style.setProperty("--amll-player-time",`${L}`);for(const R of this.currentLyricLineObjects)R.removeMouseEventListener("click",this.onLineClickedHandler),R.removeMouseEventListener("contextmenu",this.onLineClickedHandler),R.dispose();this.currentLyricLineObjects=this.processedLines.map((R,I)=>{const F=new Fs(this,R);return F.addMouseEventListener("click",this.onLineClickedHandler),F.addMouseEventListener("contextmenu",this.onLineClickedHandler),this.element.appendChild(F.getElement()),this.lyricLinesIndexes.set(F,I),this.lyricLineElementMap.set(F.getElement(),F),F}),this.setLinePosXSpringParams({}),this.setLinePosYSpringParams({}),this.setLineScaleSpringParams({}),this.calcLayout(!0)}pause(){super.pause(),this.element.classList.remove("playing"),this.interludeDots.pause();for(const T of this.currentLyricLineObjects)T.pause()}resume(){super.resume(),this.element.classList.add("playing"),this.interludeDots.resume();for(const T of this.currentLyricLineObjects)T.resume()}update(T=0){if(!this.initialLayoutFinished||(super.update(T),this.supportMaskImage||this.element.style.setProperty("--amll-player-time",`${this.currentTime}`),!this.isPageVisible))return;const L=T/1e3;this.interludeDots.update(T),this.bottomLine.update(L);for(const R of this.currentLyricLineObjects)R.update(L)}dispose(){super.dispose(),this.element.remove();for(const T of this.currentLyricLineObjects)T.dispose();this.bottomLine.dispose(),this.interludeDots.dispose()}}It(.2,.4,.58,1);It(.3,0,.58,1);window.lyrics=lyrics;const DEFAULT_AMLL_COVER_URL=(()=>{if(typeof window<"u"){const P=window.__AMLL_DEFAULT_ALBUM__;if(typeof P=="string"&&P.trim())return P}return"./icons/icon-512x512.png"})(),originalFetch=typeof window<"u"?window.fetch.bind(window):null;function normalizeBackendUrl(P){if(!P||P[0]!==":")return P;const T=/^:(\d+)(\/.*)?$/.exec(P);if(!T)return P;const[,L,R=""]=T,I=window.location?.protocol||"http:",F=window.location?.hostname||"127.0.0.1";return`${I}//${F}:${L}${R}`}originalFetch&&(window.fetch=((P,T)=>(typeof P=="string"&&(P=normalizeBackendUrl(P)),originalFetch(P,T))));function resolveDefaultCover(P){const T=typeof P=="string"?P.trim():"";return T||DEFAULT_AMLL_COVER_URL}const SETTINGS_STORAGE_KEY="amll_background_settings",DEFAULT_PLAYER_STATE={musicUrl:"",lyricUrl:"",coverUrl:"",songTitle:"",songArtist:"",isPlaying:!1,currentTime:0,duration:0,loopPlay:!0,autoPlay:!0,playbackRate:1,volume:50,lyricDelay:0,backgroundType:"fluid",backgroundDynamic:!0,backgroundFlowSpeed:4,backgroundColorMask:!0,backgroundMaskColor:"#FFFFFF",invertColors:!1,originalInvertColors:!1,coverBlurLevel:100,manualDominantColor:null,manualDominantColorLight:null,manualDominantColorDark:null,backgroundMaskOpacity:70,showFPS:!1,marqueeEnabled:!0,roundedCover:55,coverRotationSpeed:0,backgroundRenderScale:1,backgroundFPS:60,lyricAlignPosition:.4,hidePassedLyrics:!1,enableLyricBlur:!0,enableLyricScale:!0,enableLyricSpring:!0,wordFadeWidth:.5,lyricAlignAnchor:"center",showRemainingTime:!1,showTranslatedLyric:!0,showRomanLyric:!0,swapLyricPositions:!1,showbgLyric:!0,swapDuetsPositions:!1,advanceLyricTiming:!1,singleLyrics:!1,backgroundLowFreqVolume:1,coverStyle:"normal",fftDataRangeMin:1,fftDataRangeMax:22050,posYSpringMass:1,posYSpringDamping:15,posYSpringStiffness:100,posYSpringSoft:!1,scaleSpringMass:1,scaleSpringDamping:20,scaleSpringStiffness:100,scaleSpringSoft:!1,isRangeMode:!1,rangeStartTime:0,rangeEndTime:0},cloneDefaultState=()=>JSON.parse(JSON.stringify(DEFAULT_PLAYER_STATE));class WebLyricsPlayer{audio;lyricPlayer;background;coverBlurBackground;stats;state;rangeStartLine=null;rangeEndLine=null;rangeProgressBar=null;rangeSelectionCount=0;isInitialized=!1;hasLyrics=!1;gui=null;urlOverrides=new Set;colorThief;static debounce(P,T){let L=null;return function(...I){const F=()=>{L&&clearTimeout(L),P(...I)};L&&clearTimeout(L),L=window.setTimeout(F,T)}}dominantColor="#fd9c9b";marqueeObserver=null;handleResizeBound=null;titleMarqueeInterval=null;mediaSessionRefreshTimeout=null;originalTitle="";originalLyricLines=[];processedLyricLines=[];musicFile=null;lyricFile=null;coverFile=null;musicFileBtn=null;lyricFileBtn=null;coverFileBtn=null;songTitleInput=null;songArtistInput=null;albumCoverLarge=null;albumCoverContainer=null;roundedCoverSlider=null;roundedCoverValue=null;coverRotationSlider=null;coverRotationValue=null;coverStyleSelect=null;songTitle=null;songArtist=null;albumInfo=null;timeDisplay=null;progressBar=null;progressFill=null;lyricsPanel=null;player=null;playButton=null;landscapePlayBtn=null;controlPanel=null;fullscreenButton=null;fullscreenEnterIcon=null;fullscreenExitIcon=null;status=null;statusText=null;bgFlowSpeed=null;bgFlowSpeedValue=null;bgColorMask=null;bgMaskColor=null;bgMaskOpacity=null;bgMaskOpacityValue=null;showFPSCheckbox=null;backgroundStyleSelect=null;coverBlurLevel=null;coverBlurLevelValue=null;invertColorsCheckbox=null;dominantColorInput=null;dominantColorLightInput=null;dominantColorDarkInput=null;enableMarqueeCheckbox=null;bgRenderScale=null;fluidDesc=null;coverDesc=null;solidDesc=null;solidOptions=null;recordOptions=null;bgRenderScaleValue=null;bgFPS=null;bgFPSValue=null;lyricAlignPosition=null;lyricAlignPositionValue=null;hidePassedLyricsCheckbox=null;bgLowFreqVolume=null;bgLowFreqVolumeValue=null;fftDataRangeMin=null;fftDataRangeMinValue=null;fftDataRangeMax=null;fftDataRangeMaxValue=null;enableLyricBlur=null;enableLyricScale=null;enableLyricSpring=null;wordFadeWidthInput=null;wordFadeWidthValue=null;showbgLyricCheckbox=null;swapDuetsPositionsCheckbox=null;advanceLyricTimingCheckbox=null;singleLyricsCheckbox=null;playbackRateValue=null;playbackRateControl=null;volumeControl=null;volumeValue=null;speedLowIcon=null;speedMediumIcon=null;speedHighIcon=null;volumeOffIcon=null;volumeLowIcon=null;volumeMediumIcon=null;volumeHighIcon=null;loopPlayCheckbox=null;musicUrl=null;lyricUrl=null;coverUrl=null;albumSidePanel=null;loadFromUrlBtn=null;loadFilesBtn=null;resetPlayerBtn=null;toggleControlsBtn=null;lyricAlignAnchorSelect=null;lyricDelayInput=null;pendingLyricDelay=null;amllLyricPlayer=null;lyricAreaHint=null;coverStyleDynamic=null;songTitleDisplay=null;songArtistDisplay=null;landscapeTimeDisplay=null;landscapeProgressFill=null;landscapeCover=null;playControls=null;showTranslatedLyricCheckbox=null;showRomanLyricCheckbox=null;swapLyricPositionsCheckbox=null;waveformCanvas=null;waveformContext=null;cachedWaveform=null;audioBuffer=null;touchExitTimeout=null;posYSpringMassInput=null;posYSpringDampingInput=null;posYSpringStiffnessInput=null;posYSpringSoftCheckbox=null;scaleSpringMassInput=null;scaleSpringDampingInput=null;scaleSpringStiffnessInput=null;scaleSpringSoftCheckbox=null;springPosYMassValue=null;springPosYDampingValue=null;springPosYStiffnessValue=null;springScaleMassValue=null;springScaleDampingValue=null;springScaleStiffnessValue=null;controlPointCodeInput=null;initI18n(){document.documentElement.lang=getCurrentLanguage(),document.querySelectorAll("[data-i18n]").forEach(L=>{const R=L.getAttribute("data-i18n");R&&(L.textContent=t$3(R))}),document.querySelectorAll("[data-i18n-placeholder]").forEach(L=>{const R=L.getAttribute("data-i18n-placeholder");R&&(L.placeholder=t$3(R))})}initUploadButtons(){this.musicFile&&this.musicFile.addEventListener("change",P=>{const T=P.target.files?.[0];if(!this.musicFileBtn)return;const L=this.musicFileBtn.querySelector(".upload-icon"),R=this.musicFileBtn.querySelector(".uploaded-icon");L&&R&&(L.style.display=T?"none":"block",R.style.display=T?"block":"none")}),this.lyricFile&&this.lyricFile.addEventListener("change",P=>{const T=P.target.files?.[0],L=this.lyricFileBtn?.querySelector(".upload-icon"),R=this.lyricFileBtn?.querySelector(".uploaded-icon");L&&R&&(L.style.display=T?"none":"block",R.style.display=T?"block":"none")}),this.coverFile&&this.coverFile.addEventListener("change",P=>{const T=P.target.files?.[0],L=this.coverFileBtn?.querySelector(".upload-icon"),R=this.coverFileBtn?.querySelector(".uploaded-icon");L&&R&&(L.style.display=T?"none":"block",R.style.display=T?"block":"none")})}updateRoundedCover(){if(this.albumCoverLarge&&this.albumCoverContainer){const P=this.state.roundedCover/100*50;this.albumCoverLarge.style.borderRadius=`${P}%`,this.albumCoverContainer.style.borderRadius=`${P}%`,document.documentElement.style.setProperty("--rounded-cover-percent",P.toString())}this.roundedCoverSlider&&(this.roundedCoverSlider.value=this.state.roundedCover.toString()),this.roundedCoverValue&&(this.roundedCoverValue.textContent=`${this.state.roundedCover}%`),this.setOptionsVisibility(this.recordOptions,this.state.roundedCover===100,["cd","vinyl","colored"]),this.applyCoverStyle()}updateCoverRotation(){this.albumCoverLarge&&this.albumCoverContainer&&(this.albumCoverLarge.style.animation="none",this.state.coverRotationSpeed!==0?this.applyCoverRotation(this.albumCoverLarge,this.albumCoverContainer):this.audio.paused?(this.albumCoverContainer.style.transform="scale(0.96)",this.albumCoverLarge.style.transform="scale(1)"):(this.albumCoverContainer.style.transform="scale(1)",this.albumCoverLarge.style.transform="scale(1)")),this.coverRotationSlider&&(this.coverRotationSlider.value=this.state.coverRotationSpeed.toString()),this.coverRotationValue&&(this.coverRotationValue.textContent=`${this.state.coverRotationSpeed}rpm`)}applyCoverRotation(P,T){const R=60/Math.abs(this.state.coverRotationSpeed),I=this.state.coverRotationSpeed>0?"spin":"spinCounterclockwise";P.style.animation=`${I} ${R}s linear infinite`,this.audio.paused||P.matches(":hover")?(P.style.animationPlayState="paused",T.style.transform="scale(0.96)",P.style.transform="scale(1)"):(P.style.animationPlayState="running",T.style.transform="scale(1)",P.style.transform="scale(1)")}checkAndUpdateMarquee(P){if(P){if(!this.state.marqueeEnabled){P.classList.remove("marquee"),P.style.setProperty("--marquee-play-state","paused");return}requestAnimationFrame(()=>{const T=P.textContent||"",L=Math.min(5,Math.ceil(600/T.length)),R=Array(L).fill(T).join("            ");P.getAttribute("data-text")!==R?(P.setAttribute("data-text",R),requestAnimationFrame(()=>{P.scrollWidth>P.clientWidth?(P.classList.contains("marquee")||(P.classList.remove("marquee"),P.offsetWidth,P.classList.add("marquee")),P.style.setProperty("--marquee-play-state",this.audio.paused?"paused":"running")):P.classList.remove("marquee")})):P.scrollWidth>P.clientWidth?(P.classList.contains("marquee")||(P.classList.remove("marquee"),P.offsetWidth,P.classList.add("marquee")),P.style.setProperty("--marquee-play-state",this.audio.paused?"paused":"running")):P.classList.remove("marquee")})}}updateMarqueeSettings(){const P=this.songTitle,T=this.songArtist,L=()=>{if(this.titleMarqueeInterval&&(clearInterval(this.titleMarqueeInterval),this.titleMarqueeInterval=null),this.originalTitle||(this.originalTitle=document.title),this.state.marqueeEnabled&&(this.state.songTitle||this.state.songArtist)){const F=`${`${this.state.songArtist?this.state.songArtist+" - ":""}${this.state.songTitle}`} | AMLL Web Player`;if(F.length>50){let D=0;const V=()=>{if(!this.state.marqueeEnabled||this.audio.paused){document.title=F;return}const q=50;let G=F;if(F.length>q){const z=D%F.length;G=F.substring(z)+" "+F.substring(0,Math.min(z,q)),G=G.substring(0,q)}document.title=G,D++};V(),this.audio.paused||(this.titleMarqueeInterval=window.setInterval(V,300))}else document.title=F}else if(this.state.songTitle||this.state.songArtist){const I=`${this.state.songArtist?this.state.songArtist+" - ":""}${this.state.songTitle}`;document.title=`${I} | AMLL Web Player`}else document.title=this.originalTitle||"AMLL Web Player"};L(),this.marqueeObserver&&this.marqueeObserver.disconnect(),this.marqueeObserver=new MutationObserver(()=>{P&&(P.classList.remove("marquee"),this.checkAndUpdateMarquee(P)),T&&(T.classList.remove("marquee"),this.checkAndUpdateMarquee(T)),L()}),P&&this.marqueeObserver.observe(P,{childList:!0,subtree:!0,characterData:!0}),T&&this.marqueeObserver.observe(T,{childList:!0,subtree:!0,characterData:!0}),this.checkAndUpdateMarquee(P),this.checkAndUpdateMarquee(T),this.handleResizeBound&&window.removeEventListener("resize",this.handleResizeBound);const R=WebLyricsPlayer.debounce(()=>{P&&(P.classList.remove("marquee"),P.offsetWidth,this.checkAndUpdateMarquee(P)),T&&(T.classList.remove("marquee"),T.offsetWidth,this.checkAndUpdateMarquee(T)),this.updateWaveformCanvasSize(),this.updateLayoutByOrientation()},100);this.handleResizeBound=R.bind(this),window.addEventListener("resize",this.handleResizeBound)}updateFFTDataRange(){this.background&&typeof this.background.setFrequencyRange=="function"&&this.background.setFrequencyRange(this.state.fftDataRangeMin,this.state.fftDataRangeMax)}updateLayoutByOrientation(){const P=window.matchMedia("(orientation: portrait)").matches,T=this.albumSidePanel?.querySelector(".song-info-container");P?this.state.swapDuetsPositions?T&&this.albumInfo&&this.albumCoverContainer&&(T.insertBefore(this.albumInfo,this.albumCoverContainer),this.albumCoverContainer.style.marginRight="0",this.albumCoverContainer.style.marginLeft="15px",this.albumInfo.style.textAlign="right"):T&&this.albumInfo&&this.albumCoverContainer&&(T.insertBefore(this.albumCoverContainer,this.albumInfo),this.albumCoverContainer.style.marginLeft="0",this.albumCoverContainer.style.marginRight="15px",this.albumInfo.style.textAlign="left"):(T&&this.albumInfo&&this.albumCoverContainer&&(T.insertBefore(this.albumCoverContainer,this.albumInfo),this.albumCoverContainer.style.marginLeft="0",this.albumCoverContainer.style.marginRight="15px",this.albumInfo.style.textAlign="center"),this.albumSidePanel&&this.lyricsPanel&&this.player&&(this.state.swapDuetsPositions?this.player.insertBefore(this.lyricsPanel,this.albumSidePanel):this.player.insertBefore(this.albumSidePanel,this.lyricsPanel))),this.updateLyricsDisplay()}resetUploadButtons(){const P=document.querySelectorAll(".upload-icon"),T=document.querySelectorAll(".uploaded-icon");P.forEach(L=>{L.style.display="block"}),T.forEach(L=>{L.style.display="none"})}setOptionsVisibility(P,T,L=[]){P&&(P.forEach(R=>{const I=R;T?(I.disabled=!1,I.classList.remove("option-hidden")):(I.disabled=!0,I.classList.add("option-hidden"))}),L.length>0&&this.coverStyleSelect&&L.includes(this.coverStyleSelect.value)&&(this.coverStyleSelect.value="normal",this.state.coverStyle="normal",this.applyCoverStyle()))}initDOMCache(){this.musicFile=document.getElementById("musicFile"),this.lyricFile=document.getElementById("lyricFile"),this.coverFile=document.getElementById("coverFile"),this.musicFileBtn=document.getElementById("musicFileBtn"),this.lyricFileBtn=document.getElementById("lyricFileBtn"),this.coverFileBtn=document.getElementById("coverFileBtn"),this.songTitleInput=document.getElementById("songTitleInput"),this.songArtistInput=document.getElementById("songArtistInput"),this.albumCoverLarge=document.getElementById("albumCoverLarge"),this.albumCoverContainer=document.getElementById("albumCoverContainer"),this.albumInfo=document.getElementById("albumInfo"),this.roundedCoverSlider=document.getElementById("roundedCover"),this.roundedCoverValue=document.getElementById("roundedCoverValue"),this.coverRotationSlider=document.getElementById("coverRotation"),this.coverRotationValue=document.getElementById("coverRotationValue"),this.coverStyleSelect=document.getElementById("coverStyle"),this.songTitle=document.getElementById("songTitle"),this.songArtist=document.getElementById("songArtist"),this.timeDisplay=document.getElementById("timeDisplay"),this.progressBar=document.getElementById("progressBar"),this.progressFill=document.getElementById("progressFill"),this.waveformCanvas=document.getElementById("waveformCanvas"),this.lyricsPanel=document.getElementById("lyricsPanel"),this.player=document.getElementById("player"),this.playButton=document.getElementById("playPauseBtn"),this.landscapePlayBtn=document.getElementById("landscapePlayBtn"),this.controlPanel=document.getElementById("controlPanel"),this.fullscreenButton=document.getElementById("fullscreenBtn"),this.fullscreenEnterIcon=document.querySelector(".fullscreen-enter"),this.fullscreenExitIcon=document.querySelector(".fullscreen-exit"),this.status=document.getElementById("status"),this.statusText=document.getElementById("statusText"),this.bgFlowSpeed=document.getElementById("bgFlowSpeed"),this.bgFlowSpeedValue=document.getElementById("bgFlowSpeedValue"),this.bgColorMask=document.getElementById("bgColorMask"),this.bgMaskColor=document.getElementById("bgMaskColor"),this.bgMaskOpacity=document.getElementById("bgMaskOpacity"),this.bgMaskOpacityValue=document.getElementById("bgMaskOpacityValue"),this.showFPSCheckbox=document.getElementById("showFPS"),this.bgFPS=document.getElementById("bgFPS"),this.bgFPSValue=document.getElementById("bgFPSValue"),this.backgroundStyleSelect=document.getElementById("backgroundStyle"),this.albumSidePanel=document.getElementById("albumSidePanel"),this.coverBlurLevel=document.getElementById("coverBlurLevel"),this.coverBlurLevelValue=document.getElementById("coverBlurLevelValue"),this.invertColorsCheckbox=document.getElementById("invertColors"),this.dominantColorInput=document.getElementById("dominantColor"),this.dominantColorLightInput=document.getElementById("dominantColorLight"),this.dominantColorDarkInput=document.getElementById("dominantColorDark"),this.enableMarqueeCheckbox=document.getElementById("enableMarquee"),this.bgRenderScale=document.getElementById("bgRenderScale"),this.bgRenderScaleValue=document.getElementById("bgRenderScaleValue"),this.lyricAlignPosition=document.getElementById("lyricAlignPosition"),this.lyricAlignPositionValue=document.getElementById("lyricAlignPositionValue"),this.hidePassedLyricsCheckbox=document.getElementById("hidePassedLyrics"),this.bgLowFreqVolume=document.getElementById("bgLowFreqVolume"),this.bgLowFreqVolumeValue=document.getElementById("bgLowFreqVolumeValue"),this.fftDataRangeMin=document.getElementById("fftDataRangeMin"),this.fftDataRangeMinValue=document.getElementById("fftDataRangeMinValue"),this.fftDataRangeMax=document.getElementById("fftDataRangeMax"),this.fftDataRangeMaxValue=document.getElementById("fftDataRangeMaxValue"),this.enableLyricBlur=document.getElementById("enableLyricBlur"),this.enableLyricScale=document.getElementById("enableLyricScale"),this.enableLyricSpring=document.getElementById("enableLyricSpring"),this.wordFadeWidthInput=document.getElementById("wordFadeWidth"),this.wordFadeWidthValue=document.getElementById("wordFadeWidthValue"),this.showbgLyricCheckbox=document.getElementById("showbgLyric"),this.swapDuetsPositionsCheckbox=document.getElementById("swapDuetsPositions"),this.advanceLyricTimingCheckbox=document.getElementById("advanceLyricTiming"),this.singleLyricsCheckbox=document.getElementById("singleLyrics"),this.playbackRateValue=document.getElementById("playbackRateValue"),this.playbackRateControl=document.getElementById("playbackRate"),this.volumeControl=document.getElementById("volumeControl"),this.volumeValue=document.getElementById("volumeValue"),this.speedLowIcon=document.querySelector(".speed-low"),this.speedMediumIcon=document.querySelector(".speed-medium"),this.speedHighIcon=document.querySelector(".speed-high"),this.volumeOffIcon=document.querySelector(".volume-off"),this.volumeLowIcon=document.querySelector(".volume-low"),this.volumeMediumIcon=document.querySelector(".volume-medium"),this.volumeHighIcon=document.querySelector(".volume-high"),this.loopPlayCheckbox=document.getElementById("loopPlay"),this.showTranslatedLyricCheckbox=document.getElementById("showTranslatedLyric"),this.showRomanLyricCheckbox=document.getElementById("showRomanLyric"),this.swapLyricPositionsCheckbox=document.getElementById("swapLyricPositions"),this.musicUrl=document.getElementById("musicUrl"),this.lyricUrl=document.getElementById("lyricUrl"),this.coverUrl=document.getElementById("coverUrl"),this.loadFromUrlBtn=document.getElementById("loadFromUrl"),this.loadFilesBtn=document.getElementById("loadFiles"),this.resetPlayerBtn=document.getElementById("resetPlayer"),this.toggleControlsBtn=document.getElementById("toggleControls"),this.lyricAlignAnchorSelect=document.getElementById("lyricAlignAnchor"),this.lyricDelayInput=document.getElementById("lyricDelayInput"),this.posYSpringMassInput=document.getElementById("springPosYMass"),this.posYSpringDampingInput=document.getElementById("springPosYDamping"),this.posYSpringStiffnessInput=document.getElementById("springPosYStiffness"),this.scaleSpringMassInput=document.getElementById("springScaleMass"),this.scaleSpringDampingInput=document.getElementById("springScaleDamping"),this.scaleSpringStiffnessInput=document.getElementById("springScaleStiffness"),this.springPosYMassValue=document.getElementById("springPosYMassValue"),this.springPosYDampingValue=document.getElementById("springPosYDampingValue"),this.springPosYStiffnessValue=document.getElementById("springPosYStiffnessValue"),this.springScaleMassValue=document.getElementById("springScaleMassValue"),this.springScaleDampingValue=document.getElementById("springScaleDampingValue"),this.springScaleStiffnessValue=document.getElementById("springScaleStiffnessValue"),this.posYSpringSoftCheckbox=document.getElementById("posYSpringSoft"),this.scaleSpringSoftCheckbox=document.getElementById("scaleSpringSoft"),this.controlPointCodeInput=document.getElementById("controlPointCode"),this.amllLyricPlayer=document.getElementById("amll-lyric-player"),this.lyricAreaHint=document.getElementById("lyricAreaHint"),this.coverStyleDynamic=document.getElementById("coverStyleDynamic"),this.songTitleDisplay=document.getElementById("songTitleDisplay"),this.songArtistDisplay=document.getElementById("songArtistDisplay"),this.fluidDesc=document.getElementById("fluid-desc"),this.coverDesc=document.getElementById("cover-desc"),this.solidDesc=document.getElementById("solid-desc"),this.landscapeTimeDisplay=document.querySelector(".landscape-time"),this.landscapeProgressFill=document.querySelector(".landscape-progress-fill"),this.landscapeCover=document.querySelector(".landscape-cover"),this.playControls=document.getElementById("playControls"),this.solidOptions=document.querySelectorAll(".solid-option"),this.recordOptions=document.querySelectorAll(".record-option")}constructor(){this.initI18n(),this.audio=document.createElement("audio"),this.state=cloneDefaultState(),this.audio.volume=this.state.volume/100,this.audio.playbackRate=this.state.playbackRate,this.audio.preload="auto",this.colorThief=new u$2,this.lyricPlayer=new pi;const P=this.lyricPlayer.getElement();P&&(P.style.width="100%",P.style.height="100%",P.style.zIndex="30",P.style.position="relative"),this.hasLyrics=!1,this.setDefaultColors(),this.initColors(),this.background=ce.new(hi),this.coverBlurBackground=document.createElement("div"),this.stats=new Stats,this.initDOMCache(),this.waveformCanvas&&(this.waveformContext=this.waveformCanvas.getContext("2d")),this.initEventListeners(),this.initBackground(),this.setupAudioEvents(),this.setupLyricEvents(),this.setupWaveformEvents(),this.initStats(),this.initUI(),this.initLyricDisplayControls(),this.updateMarqueeSettings()}setupWheelControl(P,T,L){let R=null,I=null;switch(P){case"coverBlurLevel":R=this.coverBlurLevel,I=this.coverBlurLevelValue;break;case"bgFlowSpeed":R=this.bgFlowSpeed,I=this.bgFlowSpeedValue;break;case"bgMaskOpacity":R=this.bgMaskOpacity,I=this.bgMaskOpacityValue;break;case"volume":R=this.volumeControl,I=this.volumeValue;break;case"playbackRate":R=this.playbackRateControl,I=this.playbackRateValue;break;case"roundedCover":R=this.roundedCoverSlider,I=this.roundedCoverValue;break;case"coverRotation":R=this.coverRotationSlider,I=this.coverRotationValue;break;case"bgRenderScale":R=this.bgRenderScale,I=this.bgRenderScaleValue;break;case"bgFPS":R=this.bgFPS,I=this.bgFPSValue;break;case"lyricAlignPosition":R=this.lyricAlignPosition,I=this.lyricAlignPositionValue;break;case"springPosYMass":R=this.posYSpringMassInput,I=document.getElementById("springPosYMassValue");break;case"springPosYDamping":R=this.posYSpringDampingInput,I=document.getElementById("springPosYDampingValue");break;case"springPosYStiffness":R=this.posYSpringStiffnessInput,I=document.getElementById("springPosYStiffnessValue");break;case"springScaleMass":R=this.scaleSpringMassInput,I=document.getElementById("springScaleMassValue");break;case"springScaleDamping":R=this.scaleSpringDampingInput,I=document.getElementById("springScaleDampingValue");break;case"springScaleStiffness":R=this.scaleSpringStiffnessInput,I=document.getElementById("springScaleStiffnessValue");break;default:return}!R||!I||R.addEventListener("wheel",F=>{F.preventDefault();const D=Math.sign(F.deltaY)*-1,V=parseFloat(R.value),q=parseFloat(R.min),G=parseFloat(R.max),z=Math.min(G,Math.max(q,V+D*L));R.value=z.toString(),P.startsWith("spring")?I.textContent=z.toString():I.textContent=`${z}${P==="bgFlowSpeed"?"":"%"}`,R.dispatchEvent(new Event("input"))},{passive:!1})}initGUI(){this.gui=new GUI,this.gui.hide(),this.gui.close();const P={dynamicBackground:!0,flowSpeed:4,toggleBackground(){this.dynamicBackground=!this.dynamicBackground,window.player.getBackground().setStaticMode(!this.dynamicBackground)}},T=this.gui.addFolder(t$3("backgroundControl"));T.add(P,"flowSpeed",0,10,.1).name(t$3("flowSpeed")).onChange(L=>{L===0?window.player.getBackground().setStaticMode(!0):(window.player.getBackground().setStaticMode(!1),window.player.getBackground().setFlowSpeed(L))}),T.add(P,"toggleBackground").name(t$3("toggleBackgroundMode"))}initEventListeners(){this.setupDragAndDropEvents();const P=window.matchMedia("(orientation: portrait)"),T=WebLyricsPlayer.debounce(()=>{this.updateLayoutByOrientation()},100);P.addEventListener("change",T),this.timeDisplay&&(this.timeDisplay.addEventListener("click",()=>{this.state.showRemainingTime=!this.state.showRemainingTime,this.updateTimeDisplay(),this.saveBackgroundSettings()}),this.timeDisplay.style.cursor="pointer"),this.landscapeTimeDisplay&&(this.landscapeTimeDisplay.addEventListener("click",()=>{this.state.showRemainingTime=!this.state.showRemainingTime,this.updateTimeDisplay(),this.saveBackgroundSettings()}),this.landscapeTimeDisplay.style.cursor="pointer"),this.roundedCoverSlider?.addEventListener("input",V=>{const q=parseInt(V.target.value);this.state.roundedCover=q,q!==100&&this.state.coverRotationSpeed!==0&&(this.state.coverRotationSpeed=0,this.updateCoverRotation(),this.coverRotationValue&&(this.coverRotationValue.textContent="0rpm")),this.updateRoundedCover(),this.saveBackgroundSettings()}),this.coverRotationSlider&&this.coverRotationSlider.addEventListener("input",V=>{if(this.state.roundedCover===100){const q=parseInt(V.target.value);this.state.coverRotationSpeed=q,this.updateCoverRotation(),this.coverRotationValue&&(this.coverRotationValue.textContent=`${q}rpm`),this.saveBackgroundSettings()}else this.state.coverRotationSpeed=0,this.updateCoverRotation(),this.coverRotationValue&&(this.coverRotationValue.textContent="0rpm"),V.target.value="0"}),this.coverBlurLevel?.addEventListener("input",V=>{const q=parseFloat(V.target.value),G=q/100*100;this.coverBlurBackground.style.filter=`blur(${G}px)`,this.coverBlurLevelValue&&(this.coverBlurLevelValue.textContent=`${q}%`),this.state.coverBlurLevel=q,this.saveBackgroundSettings()}),this.coverStyleSelect?.addEventListener("change",V=>{const q=V.target;this.state.coverStyle=q.value,this.applyCoverStyle(),this.saveBackgroundSettings()}),this.coverStyleSelect?.addEventListener("wheel",V=>{V.preventDefault();const q=V.target,G=q.options,z=q.selectedIndex,Q=Math.sign(V.deltaY);let tt=z+(Q>0?1:-1);const gt=["cd","vinyl","colored","neumorphismA","neumorphismB"],yt=this.state.roundedCover===100;let Et=0;const J=G.length;for(;Et<J;){tt<0&&(tt=G.length-1),tt>=G.length&&(tt=0);const At=G[tt].value;if(gt.includes(At)&&!yt){tt+=Q>0?1:-1,Et++;continue}break}tt<0&&(tt=G.length-1),tt>=G.length&&(tt=0),q.selectedIndex=tt,q.dispatchEvent(new Event("change"))},{passive:!1}),this.bgRenderScale?.addEventListener("input",V=>{const q=parseFloat(V.target.value);this.state.backgroundRenderScale=q;const G=window.devicePixelRatio||1;this.background.setRenderScale(q*G),this.bgRenderScaleValue&&(this.bgRenderScaleValue.textContent=q.toFixed(2)),this.saveBackgroundSettings()}),this.bgFPS?.addEventListener("input",V=>{const q=parseInt(V.target.value);this.state.backgroundFPS=q,this.background.setFPS(q),this.bgFPSValue&&(this.bgFPSValue.textContent=`${q}fps`),this.saveBackgroundSettings()}),this.lyricAlignPosition?.addEventListener("input",V=>{const q=parseFloat(V.target.value);this.state.lyricAlignPosition=q,this.lyricPlayer.setAlignPosition(q),this.lyricAlignPositionValue&&(this.lyricAlignPositionValue.textContent=q.toFixed(1)),this.saveBackgroundSettings()}),this.hidePassedLyricsCheckbox?.addEventListener("change",V=>{const q=V.target.checked;this.state.hidePassedLyrics=q,this.updateLyricsDisplay(),this.saveBackgroundSettings()}),this.enableLyricBlur?.addEventListener("change",V=>{const q=V.target.checked;this.state.enableLyricBlur=q,this.lyricPlayer.setEnableBlur(q),this.saveBackgroundSettings()}),this.enableLyricScale?.addEventListener("change",V=>{const q=V.target.checked;this.state.enableLyricScale=q,this.lyricPlayer.setEnableScale(q),this.saveBackgroundSettings()}),this.enableLyricSpring?.addEventListener("change",V=>{const q=V.target.checked;this.state.enableLyricSpring=q,this.lyricPlayer.setEnableSpring(q);const G=document.getElementById("spring-desc");G&&(G.style.display=q?"block":"none"),this.saveBackgroundSettings()}),this.posYSpringMassInput?.addEventListener("input",V=>{const q=parseFloat(V.target.value);this.state.posYSpringMass=q,this.lyricPlayer.setLinePosYSpringParams({mass:q,damping:this.state.posYSpringDamping,stiffness:this.state.posYSpringStiffness,soft:this.state.posYSpringSoft});const G=document.getElementById("springPosYMassValue");G&&(G.textContent=q.toFixed(1)),this.saveBackgroundSettings()}),this.posYSpringDampingInput?.addEventListener("input",V=>{const q=parseFloat(V.target.value);this.state.posYSpringDamping=q,this.lyricPlayer.setLinePosYSpringParams({mass:this.state.posYSpringMass,damping:q,stiffness:this.state.posYSpringStiffness,soft:this.state.posYSpringSoft});const G=document.getElementById("springPosYDampingValue");G&&(G.textContent=q.toFixed(1));const z=document.getElementById("springPosYSoft")?.parentElement;z&&(z.style.display=q<1?"flex":"none"),this.saveBackgroundSettings()}),this.posYSpringStiffnessInput?.addEventListener("input",V=>{const q=parseFloat(V.target.value);this.state.posYSpringStiffness=q,this.lyricPlayer.setLinePosYSpringParams({mass:this.state.posYSpringMass,damping:this.state.posYSpringDamping,stiffness:q,soft:this.state.posYSpringSoft});const G=document.getElementById("springPosYStiffnessValue");G&&(G.textContent=q.toString()),this.saveBackgroundSettings()}),this.posYSpringSoftCheckbox?.addEventListener("change",V=>{const q=V.target.checked;this.state.posYSpringSoft=q,this.lyricPlayer.setLinePosYSpringParams({mass:this.state.posYSpringMass,damping:this.state.posYSpringDamping,stiffness:this.state.posYSpringStiffness,soft:q}),this.saveBackgroundSettings()}),this.scaleSpringMassInput?.addEventListener("input",V=>{const q=parseFloat(V.target.value);this.state.scaleSpringMass=q,this.lyricPlayer.setLineScaleSpringParams({mass:q,damping:this.state.scaleSpringDamping,stiffness:this.state.scaleSpringStiffness,soft:this.state.scaleSpringSoft});const G=document.getElementById("springScaleMassValue");G&&(G.textContent=q.toFixed(1)),this.saveBackgroundSettings()}),this.scaleSpringDampingInput?.addEventListener("input",V=>{const q=parseFloat(V.target.value);this.state.scaleSpringDamping=q,this.lyricPlayer.setLineScaleSpringParams({mass:this.state.scaleSpringMass,damping:q,stiffness:this.state.scaleSpringStiffness,soft:this.state.scaleSpringSoft});const G=document.getElementById("springScaleDampingValue");G&&(G.textContent=q.toFixed(1));const z=document.getElementById("springScaleSoft")?.parentElement;z&&(z.style.display=q<1?"flex":"none"),this.saveBackgroundSettings()}),this.scaleSpringStiffnessInput?.addEventListener("input",V=>{const q=parseFloat(V.target.value);this.state.scaleSpringStiffness=q,this.lyricPlayer.setLineScaleSpringParams({mass:this.state.scaleSpringMass,damping:this.state.scaleSpringDamping,stiffness:q,soft:this.state.scaleSpringSoft});const G=document.getElementById("springScaleStiffnessValue");G&&(G.textContent=q.toString()),this.saveBackgroundSettings()}),this.scaleSpringSoftCheckbox?.addEventListener("change",V=>{const q=V.target.checked;this.state.scaleSpringSoft=q,this.lyricPlayer.setLineScaleSpringParams({mass:this.state.scaleSpringMass,damping:this.state.scaleSpringDamping,stiffness:this.state.scaleSpringStiffness,soft:q}),this.saveBackgroundSettings()}),this.wordFadeWidthInput?.addEventListener("input",V=>{const q=parseFloat(V.target.value);this.state.wordFadeWidth=q,this.lyricPlayer.setWordFadeWidth(q),this.saveBackgroundSettings(),this.wordFadeWidthValue&&(this.wordFadeWidthValue.textContent=q.toFixed(2))}),this.wordFadeWidthInput?.addEventListener("wheel",V=>{V.preventDefault();const q=Math.sign(V.deltaY)*-1,G=parseFloat(this.wordFadeWidthInput.value),z=parseFloat(this.wordFadeWidthInput.min),Q=parseFloat(this.wordFadeWidthInput.max),tt=parseFloat(this.wordFadeWidthInput.step),gt=Math.min(Q,Math.max(z,G+q*tt));this.state.wordFadeWidth=gt,this.wordFadeWidthInput.value=gt.toString(),this.lyricPlayer.setWordFadeWidth(gt),this.saveBackgroundSettings(),this.wordFadeWidthValue&&(this.wordFadeWidthValue.textContent=gt.toFixed(2))},{passive:!1}),this.wordFadeWidthInput?.addEventListener("keydown",V=>{if(V.key==="ArrowUp"||V.key==="ArrowDown"){V.preventDefault();const q=parseFloat(this.wordFadeWidthInput.step)||.01,G=V.key==="ArrowUp"?q:-q,z=parseFloat(this.wordFadeWidthInput.value),Q=parseFloat(this.wordFadeWidthInput.min),tt=parseFloat(this.wordFadeWidthInput.max),gt=Math.min(tt,Math.max(Q,z+G));this.wordFadeWidthInput.value=gt.toString(),this.state.wordFadeWidth=gt,this.lyricPlayer.setWordFadeWidth(gt),this.saveBackgroundSettings(),this.wordFadeWidthValue&&(this.wordFadeWidthValue.textContent=gt.toFixed(2))}}),this.lyricAlignAnchorSelect?.addEventListener("change",V=>{const q=V.target.value;this.state.lyricAlignAnchor=q,this.lyricPlayer.setAlignAnchor(q),this.saveBackgroundSettings()}),this.lyricAlignAnchorSelect?.addEventListener("wheel",V=>{V.preventDefault();const q=V.target,G=q.options,z=q.selectedIndex,Q=Math.sign(V.deltaY);let tt=z+(Q>0?1:-1);tt<0&&(tt=G.length-1),tt>=G.length&&(tt=0),q.selectedIndex=tt,q.dispatchEvent(new Event("change"))},{passive:!1}),this.invertColorsCheckbox?.addEventListener("change",V=>{this.invertColors(V.target.checked)}),this.dominantColorInput?.addEventListener("change",()=>this.onDominantColorChange()),this.dominantColorLightInput?.addEventListener("change",()=>this.onDominantColorLightChange()),this.dominantColorDarkInput?.addEventListener("change",()=>this.onDominantColorDarkChange()),this.enableMarqueeCheckbox?.addEventListener("change",V=>{this.state.marqueeEnabled=V.target.checked,this.updateMarqueeSettings(),this.saveBackgroundSettings()});const L=this.fftDataRangeMin,R=this.fftDataRangeMinValue;if(L&&R){R.textContent=`${L.value}Hz`,L.addEventListener("input",G=>{const z=parseInt(G.target.value),Q=this.fftDataRangeMax,tt=this.fftDataRangeMaxValue;let gt=0;Q&&(gt=parseInt(Q.value)),z>gt?(this.state.fftDataRangeMin=z,L.value=z.toString(),this.state.fftDataRangeMax=z,Q&&(Q.value=z.toString()),tt&&(tt.textContent=`${z}Hz`)):this.state.fftDataRangeMin=z,R.textContent=`${this.state.fftDataRangeMin}Hz`,this.updateFFTDataRange(),this.saveBackgroundSettings()}),L.addEventListener("wheel",G=>{G.preventDefault();const z=Math.sign(G.deltaY)*-1,Q=parseInt(L.value),tt=parseInt(L.min),gt=parseInt(L.max),Et=Math.min(gt,Math.max(tt,Q+z*1)),J=this.fftDataRangeMax,At=this.fftDataRangeMaxValue;let kt=0;J&&(kt=parseInt(J.value)),Et>kt?(L.value=Et.toString(),this.state.fftDataRangeMin=Et,J&&(J.value=Et.toString()),this.state.fftDataRangeMax=Et,At&&(At.textContent=`${Et}Hz`)):(L.value=Et.toString(),this.state.fftDataRangeMin=Et),R.textContent=`${this.state.fftDataRangeMin}Hz`,this.updateFFTDataRange(),this.saveBackgroundSettings()},{passive:!1});const V=this.fftDataRangeMax,q=this.fftDataRangeMaxValue;L&&R&&(R.textContent=`${L.value}Hz`),V&&(V.addEventListener("input",G=>{const z=parseInt(G.target.value),Q=this.fftDataRangeMin;let tt=0;Q&&(tt=parseInt(Q.value)),z<tt?(this.state.fftDataRangeMax=z,V.value=z.toString(),this.state.fftDataRangeMin=z,Q&&(Q.value=z.toString(),R&&(R.textContent=`${z}Hz`))):this.state.fftDataRangeMax=z,q&&(q.textContent=`${this.state.fftDataRangeMax}Hz`),this.updateFFTDataRange(),this.saveBackgroundSettings()}),V.addEventListener("wheel",G=>{G.preventDefault();const z=Math.sign(G.deltaY)*-1,Q=parseInt(V.value),tt=parseInt(V.min),gt=parseInt(V.max),Et=Math.min(gt,Math.max(tt,Q+z*1)),J=this.fftDataRangeMin;let At=0;J&&(At=parseInt(J.value)),Et<At?(V.value=Et.toString(),this.state.fftDataRangeMax=Et,J&&(J.value=Et.toString(),this.state.fftDataRangeMin=Et,R&&(R.textContent=`${Et}Hz`))):(V.value=Et.toString(),this.state.fftDataRangeMax=Et),q&&(q.textContent=`${this.state.fftDataRangeMax}Hz`),this.updateFFTDataRange(),this.saveBackgroundSettings()},{passive:!1}))}this.setupWheelControl("coverBlurLevel","coverBlurLevelValue",5),this.setupWheelControl("bgFlowSpeed","bgFlowSpeedValue",.1),this.setupWheelControl("bgMaskOpacity","bgMaskOpacityValue",5),this.setupWheelControl("volume","volumeValue",.05),this.setupWheelControl("playbackRate","playbackRateValue",.1),this.setupWheelControl("roundedCover","roundedCoverValue",5),this.setupWheelControl("coverRotation","coverRotationValue",5),this.setupWheelControl("bgRenderScale","bgRenderScaleValue",.1),this.setupWheelControl("bgFPS","bgFPSValue",1),this.setupWheelControl("lyricAlignPosition","lyricAlignPositionValue",.1),this.setupWheelControl("springPosYMass","springPosYMassValue",.1),this.setupWheelControl("springPosYDamping","springPosYDampingValue",.1),this.setupWheelControl("springPosYStiffness","springPosYStiffnessValue",1),this.setupWheelControl("springScaleMass","springScaleMassValue",.1),this.setupWheelControl("springScaleDamping","springScaleDampingValue",.1),this.setupWheelControl("springScaleStiffness","springScaleStiffnessValue",1),this.controlPointCodeInput&&(this.controlPointCodeInput.addEventListener("change",()=>{this.applyControlPointCode()}),this.controlPointCodeInput.addEventListener("keydown",V=>{V.key==="Enter"&&this.applyControlPointCode()})),this.bgLowFreqVolume?.addEventListener("wheel",V=>{V.preventDefault();const q=Math.sign(V.deltaY)*-1,G=parseFloat(this.bgLowFreqVolume.value),z=parseFloat(this.bgLowFreqVolume.min),Q=parseFloat(this.bgLowFreqVolume.max),tt=Math.min(Q,Math.max(z,G+q*.1));if(this.bgLowFreqVolume.value=tt.toString(),this.bgLowFreqVolumeValue){const gt=yt=>`${(80+yt*40).toFixed(0)}hz`;this.bgLowFreqVolumeValue.textContent=gt(tt)}this.bgLowFreqVolume.dispatchEvent(new Event("input"))},{passive:!1}),this.albumCoverLarge?.addEventListener("click",()=>{!this.state.coverUrl&&this.coverFile&&this.coverFile.click()}),this.albumCoverLarge&&this.coverFile&&this.addLongPressAndRightClickHandler(this.albumCoverLarge,()=>{this.coverFile&&this.coverFile.click()},3e3);const I=V=>{V.classList.remove("marquee");const q=document.createElement("input");q.type="text",q.value=V.textContent||"";const G=window.matchMedia("(orientation: portrait)").matches,z=G&&this.state.swapDuetsPositions?"right":G?"left":"center";q.style.cssText=`
        width: 100%;
        background: transparent;
        border: none;
        color: var(--dominant-color-light);
        font-size: inherit;
        font-weight: inherit;
        text-align: ${z};
        outline: none;
      `,V.textContent="",V.appendChild(q),q.focus(),q.addEventListener("blur",()=>{this.state.songTitle=q.value,V.textContent=q.value,this.songTitleInput&&(this.songTitleInput.value=q.value),this.updateSongInfo()}),q.addEventListener("keydown",Q=>{Q.key==="Enter"&&(this.state.songTitle=q.value,V.textContent=q.value,this.songTitleInput&&(this.songTitleInput.value=q.value),this.updateSongInfo())})};this.songTitle?.addEventListener("click",V=>{const q=V.target,G=q.textContent||"";(G===""||G===t$3("title"))&&I(q)}),this.songTitle&&this.addLongPressAndRightClickHandler(this.songTitle,()=>{this.songTitle&&I(this.songTitle)},3e3);const F=V=>{V.classList.remove("marquee");const q=document.createElement("input");q.type="text",q.value=V.textContent||"";const G=window.matchMedia("(orientation: portrait)").matches,z=G&&this.state.swapDuetsPositions?"right":G?"left":"center";q.style.cssText=`
        width: 100%;
        background: transparent;
        border: none;
        color: var(--dominant-color-light);
        opacity: 0.8;
        font-size: inherit;
        text-align: ${z};
        outline: none;
      `,V.textContent="",V.appendChild(q),q.focus(),q.addEventListener("blur",()=>{this.state.songArtist=q.value,V.textContent=q.value,this.songArtistInput&&(this.songArtistInput.value=q.value),this.updateSongInfo()}),q.addEventListener("keydown",Q=>{Q.key==="Enter"&&(this.state.songArtist=q.value,V.textContent=q.value,this.songArtistInput&&(this.songArtistInput.value=q.value),this.updateSongInfo())})};if(this.songArtist?.addEventListener("click",V=>{const q=V.target,G=q.textContent||"";(G===""||G===t$3("artist"))&&F(q)}),this.songArtist&&this.addLongPressAndRightClickHandler(this.songArtist,()=>{this.songArtist&&F(this.songArtist)},3e3),this.musicFileBtn?.addEventListener("click",()=>{this.musicFile&&this.musicFile.click()}),this.lyricFileBtn?.addEventListener("click",()=>{this.lyricFile&&this.lyricFile.click()}),this.coverFileBtn?.addEventListener("click",()=>{this.coverFile&&this.coverFile.click()}),this.musicFile?.addEventListener("change",V=>{if(!V.target)return;const q=V.target.files?.[0];q&&this.loadMusicFromFile(q)}),this.lyricFile?.addEventListener("change",V=>{if(!V.target)return;const q=V.target.files?.[0];q&&this.loadLyricFromFile(q)}),this.coverFile?.addEventListener("change",V=>{if(!V.target)return;const q=V.target.files?.[0];q&&this.loadCoverFromFile(q)}),this.songTitleInput?.addEventListener("input",V=>{this.state.songTitle=V.target.value,this.updateSongInfo(),this.saveBackgroundSettings()}),this.songArtistInput?.addEventListener("input",V=>{this.state.songArtist=V.target.value,this.updateSongInfo(),this.saveBackgroundSettings()}),this.songTitleInput?.addEventListener("blur",V=>{this.state.songTitle=V.target.value,this.updateSongInfo(),this.songTitle&&this.checkAndUpdateMarquee(this.songTitle),this.saveBackgroundSettings()}),this.songTitleInput?.addEventListener("keydown",V=>{V.key==="Enter"&&V.target.blur()}),this.songArtistInput?.addEventListener("blur",V=>{this.state.songArtist=V.target.value,this.updateSongInfo(),this.songArtist&&this.checkAndUpdateMarquee(this.songArtist),this.saveBackgroundSettings()}),this.songArtistInput?.addEventListener("keydown",V=>{V.key==="Enter"&&V.target.blur()}),this.loopPlayCheckbox?.addEventListener("change",V=>{this.state.loopPlay=V.target.checked,this.saveBackgroundSettings()}),this.playbackRateControl&&this.playbackRateValue){this.playbackRateControl.addEventListener("input",q=>{const G=parseFloat(q.target.value);isNaN(G)||(this.state.playbackRate=G,this.audio.playbackRate=G,this.playbackRateValue&&(this.playbackRateValue.textContent=G.toFixed(2)+"x"),this.updatePlaybackRateIcon(G),this.saveBackgroundSettings())});const V=parseFloat(this.playbackRateControl.value);isNaN(V)||(this.state.playbackRate=V),this.updatePlaybackRateIcon(V)}if(this.volumeControl&&this.volumeValue&&(this.volumeControl.value=this.state.volume.toString(),this.volumeValue.textContent=Math.round(this.state.volume)+"%",this.updateVolumeIcon(Math.round(this.state.volume)),this.volumeControl.addEventListener("input",V=>{const q=parseInt(V.target.value);!isNaN(q)&&this.volumeValue&&(this.audio.volume=q/100,this.volumeValue.textContent=q+"%",this.updateVolumeIcon(q),this.state.volume=q,this.saveBackgroundSettings())}),this.volumeControl.addEventListener("wheel",V=>{V.preventDefault();const q=5;if(!this.volumeControl)return;const G=parseInt(this.volumeControl.value);let z=G;V.deltaY<0?z=Math.min(100,G+q):z=Math.max(0,G-q),z!==G&&this.volumeControl&&this.volumeValue&&(this.volumeControl.value=z.toString(),this.audio.volume=z/100,this.volumeValue.textContent=z+"%",this.updateVolumeIcon(z))},{passive:!1})),this.lyricDelayInput&&(this.lyricDelayInput.addEventListener("input",V=>{const q=parseInt(V.target.value);isNaN(q)||this.applyLyricDelay(q)}),this.lyricDelayInput)){const V=this.lyricDelayInput;V.addEventListener("wheel",q=>{q.preventDefault();const G=q.deltaY<0?50:-50,z=parseInt(V.value||"0")+G;V.value=z.toString(),this.applyLyricDelay(z)},{passive:!1}),V.addEventListener("keydown",q=>{if(q.key==="ArrowUp"||q.key==="ArrowDown"){q.preventDefault();const G=q.key==="ArrowUp"?50:-50,z=parseInt(V.value||"0")+G;V.value=z.toString(),this.applyLyricDelay(z)}})}if(this.bgFlowSpeed?.addEventListener("input",V=>{const q=parseFloat(V.target.value);this.state.backgroundFlowSpeed=q,this.state.backgroundType==="fluid"&&(q===0?this.background.setStaticMode(!0):(this.background.setStaticMode(!1),this.background.setFlowSpeed(q))),this.bgFlowSpeedValue.textContent=q.toFixed(1),this.saveBackgroundSettings()}),this.bgColorMask?.addEventListener("change",V=>{this.state.backgroundColorMask=V.target.checked,this.updateBackground(),this.updateBackgroundUI(),this.saveBackgroundSettings()}),this.bgMaskColor?.addEventListener("input",V=>{this.state.backgroundMaskColor=V.target.value,this.updateBackground(),this.saveBackgroundSettings()}),this.bgMaskOpacity?.addEventListener("input",V=>{const q=parseInt(V.target.value);this.state.backgroundMaskOpacity=q,this.updateBackground(),this.updateBackgroundUI(),this.bgMaskOpacityValue.textContent=q+"%",this.saveBackgroundSettings()}),this.showFPSCheckbox?.addEventListener("change",V=>{this.state.showFPS=V.target.checked,this.updateFPSDisplay(),this.saveBackgroundSettings()}),this.loadFromUrlBtn?.addEventListener("click",()=>{this.loadFromURLs()}),this.musicUrl?.addEventListener("keydown",V=>{V.key==="Enter"&&this.loadFromURLs()}),this.musicUrl?.addEventListener("input",()=>{this.saveBackgroundSettings()}),this.lyricUrl){const V=()=>{const q=this.lyricUrl,G=q.scrollTop;q.style.height="auto";const z=parseInt(window.getComputedStyle(q).lineHeight,10),Q=parseInt(window.getComputedStyle(q).paddingTop,10)+parseInt(window.getComputedStyle(q).paddingBottom,10),tt=Math.max(1,Math.min(10,Math.ceil((q.scrollHeight-Q)/z)));q.style.height=Math.min(q.scrollHeight,200)+"px",q.rows=tt,q.scrollTop=G};V(),this.lyricUrl.addEventListener("input",V),this.lyricUrl.addEventListener("keyup",V),this.lyricUrl.addEventListener("paste",()=>{setTimeout(V,0)}),this.lyricUrl.addEventListener("input",()=>{this.saveBackgroundSettings()})}if(this.lyricUrl?.addEventListener("keydown",V=>{V.key==="Enter"&&(V.ctrlKey||V.metaKey)?this.lyricUrl&&this.processLyricInput(this.lyricUrl.value):V.key==="Enter"&&!V.shiftKey&&this.loadFromURLs()}),this.coverUrl?.addEventListener("keydown",V=>{V.key==="Enter"&&this.coverUrl&&this.processCoverInput(this.coverUrl.value)}),this.coverUrl?.addEventListener("input",()=>{this.saveBackgroundSettings()}),this.loadFilesBtn?.addEventListener("click",()=>{this.loadFromFiles()}),this.resetPlayerBtn?.addEventListener("click",()=>{this.resetPlayer()}),this.fullscreenButton){let V;this.fullscreenButton.addEventListener("click",()=>{this.toggleFullscreen()}),this.fullscreenButton.addEventListener("mousedown",()=>{V=window.setTimeout(()=>{this.lyricFile&&this.lyricFile.click()},3e3)}),this.fullscreenButton.addEventListener("mouseup",()=>{clearTimeout(V)}),this.fullscreenButton.addEventListener("mouseleave",()=>{clearTimeout(V)}),this.fullscreenButton.addEventListener("contextmenu",q=>(q.preventDefault(),this.lyricFile&&this.lyricFile.click(),!1)),this.fullscreenButton&&(this.fullscreenButton.addEventListener("touchstart",q=>{V=window.setTimeout(()=>{this.lyricFile&&this.lyricFile.click()},3e3)},{passive:!0}),this.fullscreenButton.addEventListener("touchend",()=>{clearTimeout(V)},{passive:!0}),this.fullscreenButton.addEventListener("touchcancel",()=>{clearTimeout(V)},{passive:!0}))}this.toggleControlsBtn?.addEventListener("click",()=>{this.toggleControlPanel()}),this.albumSidePanel&&this.albumSidePanel.addEventListener("click",()=>{this.toggleControlPanel()}),this.progressBar?.addEventListener("click",V=>{this.seekToPosition(V)}),this.progressBar&&this.addLongPressAndRightClickHandler(this.progressBar,V=>{V&&this.handleRangeSelection(V)}),this.timeDisplay&&this.addLongPressAndRightClickHandler(this.timeDisplay,()=>{this.exitRangeMode()}),this.landscapeTimeDisplay&&this.addLongPressAndRightClickHandler(this.landscapeTimeDisplay,()=>{this.exitRangeMode()}),this.progressBar?.addEventListener("wheel",V=>{V.preventDefault();const q=V.deltaY>0?-1:1;if(this.audio&&this.state.duration>0){const G=Math.max(0,Math.min(this.state.duration,this.audio.currentTime+q));this.audio.currentTime=G,this.state.currentTime=G;const z=G*1e3+this.state.lyricDelay;this.lyricPlayer.setCurrentTime(z),this.updateProgress(),this.updateTimeDisplay()}},{passive:!1});const D=this.progressBar;D&&(D.style.position="relative",D.addEventListener("mousemove",V=>{this.showTooltip(D,V.clientX)}),D.addEventListener("mouseleave",()=>{this.tooltipTimer&&clearTimeout(this.tooltipTimer),this.verticalLine&&(this.verticalLine.style.display="none"),this.tooltip&&(this.tooltip.style.transform="translateY(4px)",this.tooltip.style.opacity="0",setTimeout(()=>{this.tooltip&&(this.tooltip.style.display="none")},300))})),document.addEventListener("keydown",V=>{this.handleKeyboard(V)}),this.setupTouchEvents(),window.addEventListener("resize",()=>{this.adjustLyricPosition()}),document.addEventListener("fullscreenchange",()=>{document.fullscreenElement?this.fullscreenEnterIcon&&this.fullscreenExitIcon&&(this.fullscreenEnterIcon.style.display="none",this.fullscreenExitIcon.style.display="inline"):this.fullscreenEnterIcon&&this.fullscreenExitIcon&&(this.fullscreenEnterIcon.style.display="inline",this.fullscreenExitIcon.style.display="none")}),window.matchMedia("(orientation: portrait)").addEventListener("change",()=>{this.adjustLyricPosition(),this.songTitle&&(this.songTitle.classList.remove("marquee"),this.songTitle.offsetWidth,this.checkAndUpdateMarquee(this.songTitle)),this.songArtist&&(this.songArtist.classList.remove("marquee"),this.songArtist.offsetWidth,this.checkAndUpdateMarquee(this.songArtist))})}async detectMaxFPS(){try{const P=window.screen;if(P?.refreshRate)return Math.round(P.refreshRate);if(navigator.mediaCapabilities?.encodingInfo)try{if((await navigator.mediaCapabilities.encodingInfo({type:"record",video:{contentType:"video/mp4",width:1920,height:1080,bitrate:1e6,framerate:60}})).supported){for(let L=120;L>60;L-=10)if((await navigator.mediaCapabilities.encodingInfo({type:"record",video:{contentType:"video/mp4",width:1920,height:1080,bitrate:1e6,framerate:L}})).supported)return L}}catch{try{if((await navigator.mediaCapabilities.encodingInfo({type:"transmission",video:{contentType:"video/mp4",width:1920,height:1080,bitrate:1e6,framerate:60}})).supported){for(let R=120;R>60;R-=10)if((await navigator.mediaCapabilities.encodingInfo({type:"transmission",video:{contentType:"video/mp4",width:1920,height:1080,bitrate:1e6,framerate:R}})).supported)return R}}catch(L){console.warn("MediaCapabilities API failed:",L)}}return await this.measureFpsWithRAF()}catch(P){console.warn("Failed to detect max FPS:",P)}return 60}measureFpsWithRAF(){return new Promise(P=>{if(!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){P(60);return}const L=1e3;let R=0,I=null;function F(D){I||(I=D);const V=D-I;if(R++,V<L)requestAnimationFrame(F);else{const q=Math.ceil(R*1e3/V),G=Math.min(q,120);P(Math.max(G,30))}}requestAnimationFrame(F)})}async generateWaveformData(){if(!(!this.audio.src||!this.waveformCanvas))try{this.cachedWaveform=null,this.audioBuffer=null;const T=await(await fetch(this.audio.src)).arrayBuffer(),L=new(window.AudioContext||window.webkitAudioContext);this.audioBuffer=await L.decodeAudioData(T),this.cachedWaveform=this.createWaveformData(this.audioBuffer),console.log("Waveform data generated successfully"),this.updateWaveformCanvasSize(),this.redrawWaveform()}catch(P){console.error("Failed to generate waveform data:",P),this.cachedWaveform=null}}createWaveformData(P){const T=P.getChannelData(0);let L=0;if(this.waveformCanvas&&this.waveformCanvas.width>0)L=Math.floor(this.waveformCanvas.width*5);else if(this.progressBar){const F=parseFloat(getComputedStyle(this.progressBar).width);F>0&&(L=Math.floor(F*10))}const R=Math.floor(T.length/L),I=new Float32Array(L);for(let F=0;F<L;F++){let D=0;for(let V=0;V<R;V++){const q=F*R+V;D+=Math.abs(T[q]||0)}I[F]=D/R}return I}updateWaveformCanvasSize(){if(!this.waveformCanvas||!this.progressBar)return;this.waveformCanvas.parentNode!==this.progressBar&&(this.waveformCanvas.parentNode&&this.waveformCanvas.parentNode.removeChild(this.waveformCanvas),this.progressBar.appendChild(this.waveformCanvas));const P=0,T=Math.max(P,parseFloat(getComputedStyle(this.progressBar).width)),L=this.waveformCanvas.width,R=window.devicePixelRatio||1,I=this.progressBar.getBoundingClientRect();this.waveformCanvas.width=T*R,this.waveformCanvas.height=I.height*R,this.waveformCanvas.style.position="absolute",this.waveformCanvas.style.top="0",this.waveformCanvas.style.left="0",this.waveformCanvas.style.width="100%",this.waveformCanvas.style.height="100%",this.waveformCanvas.style.minWidth=`${P}px`,this.waveformCanvas.style.pointerEvents="none",this.waveformCanvas.style.opacity="0",this.waveformCanvas.style.transition="opacity 0.3s ease",this.waveformCanvas.style.imageRendering="pixelated",this.cachedWaveform&&this.audioBuffer&&L>0&&Math.abs(T-L)>L*.1&&(this.cachedWaveform=this.createWaveformData(this.audioBuffer)),this.cachedWaveform&&this.redrawWaveform()}redrawWaveform(){if(!this.waveformCanvas||!this.waveformContext||!this.cachedWaveform)return;const P=this.waveformCanvas,T=this.waveformContext,L=this.cachedWaveform,R=window.devicePixelRatio||1;if(T.scale(R,R),T.clearRect(0,0,P.width/R,P.height/R),L.length>0){const G=L[0];let z=!0;for(let Q=1;Q<L.length;Q++)if(L[Q]!==G){z=!1;break}if(z)return}const I=getComputedStyle(document.documentElement).getPropertyValue("--waveform-color").trim();T.strokeStyle=I||this.originalDominant,T.lineWidth=1.8/R,T.lineCap="round",T.lineJoin="round";const F=P.width/R,D=P.height/R,V=D/2,q=F/L.length;T.globalAlpha=.7,T.beginPath();for(let G=0;G<L.length;G++){const z=G*q,Q=L[G]*D*.9;T.moveTo(z,V-Q),T.lineTo(z,V+Q)}T.stroke(),T.scale(1/R,1/R)}tooltip=null;verticalLine=null;tooltipTimer=null;diffUpdateTimer=null;showTooltip(P,T){const L=P.getBoundingClientRect();let R=(T-L.left)/L.width;const I=R*this.state.duration;if(this.progressFill){const z=parseFloat(this.progressFill.style.width||"0%");Math.abs(R*100-z)<.5&&(R=z/100)}const F=`${R*100}%`;this.verticalLine||(this.verticalLine=document.createElement("div"),this.verticalLine.style.position="absolute",this.verticalLine.style.width="1px",this.verticalLine.style.height="100%",this.verticalLine.style.backgroundColor="var(--dominant-color-light)",this.verticalLine.style.top="0",this.verticalLine.style.opacity="0.18",this.verticalLine.style.zIndex="51",P.appendChild(this.verticalLine)),this.verticalLine.style.left=F,this.verticalLine.style.display="block",this.tooltip||(this.tooltip=document.createElement("div"),this.tooltip.style.position="fixed",this.tooltip.style.color="var(--dominant-color-light)",this.tooltip.style.padding="4px 8px",this.tooltip.style.borderRadius="0.75em",this.tooltip.style.fontSize="0.75em",this.tooltip.style.pointerEvents="none",this.tooltip.style.zIndex="49",this.tooltip.style.transform="translateY(4px)",this.tooltip.style.transition="all 0.3s ease-out",this.tooltip.style.opacity="0",document.body.appendChild(this.tooltip));const D=Math.floor(I/60),V=Math.floor(I%60),q=Math.floor(I%1*1e3),G=`${D.toString().padStart(2,"0")}:${V.toString().padStart(2,"0")}.${q.toString().padStart(3,"0")}`;if(G=="00:00.000"||I<0||!isFinite(this.state.duration))this.tooltip&&(this.tooltip.style.transform="translateY(4px)",this.tooltip.style.opacity="0",setTimeout(()=>{this.tooltip&&(this.tooltip.style.display="none")},250)),this.tooltipTimer&&clearTimeout(this.tooltipTimer);else{const z=()=>{const yt=I-this.state.currentTime,Et=Math.floor(Math.abs(yt)/60),J=Math.floor(Math.abs(yt)%60),At=Math.floor(Math.abs(yt)%1*1e3);let kt="";const ne=yt>=0?"+":"-";Et>0?kt=`${ne}${Et}:${J}.${At}`:J>0?kt=`${ne}${J}.${At}`:kt=`${ne}${At}`,this.tooltip&&(Math.abs(yt)<.1?this.tooltip.textContent=G:this.tooltip.textContent=`${G} (${kt})`)};z(),this.diffUpdateTimer&&clearInterval(this.diffUpdateTimer),this.diffUpdateTimer=window.setInterval(z,100);const Q=this.verticalLine.getBoundingClientRect();this.tooltip.style.left=`${Q.right-6}px`;const tt=this.tooltip.getBoundingClientRect(),gt=`${L.top+(L.height-tt.height)/2-L.height/2-14}px`;this.tooltip.style.top=gt,this.tooltip.style.display="block",this.tooltip.offsetWidth,this.tooltip.style.transform="translateY(0)",this.tooltip.style.opacity="0.7",this.tooltipTimer&&clearTimeout(this.tooltipTimer),this.tooltipTimer=window.setTimeout(()=>{this.diffUpdateTimer&&(clearInterval(this.diffUpdateTimer),this.diffUpdateTimer=null),this.tooltip&&(this.tooltip.style.transform="translateY(4px)",this.tooltip.style.opacity="0",setTimeout(()=>{this.tooltip&&(this.tooltip.style.display="none")},250)),this.verticalLine&&(this.verticalLine.style.display="none")},3e3)}}setupWaveformEvents(){!this.progressBar||!this.waveformCanvas||(this.progressBar.addEventListener("mouseenter",()=>{if(this.waveformCanvas&&this.waveformCanvas.width>0&&this.progressBar&&this.cachedWaveform&&this.cachedWaveform.length>0){this.waveformCanvas.style.opacity="1",this.redrawWaveform(),this.progressBar.style.height="24px",this.progressBar.style.borderRadius="12px";const P=this.progressBar.querySelector("#progressFill");P&&(P.style.opacity="0.24")}}),this.progressBar.addEventListener("mouseleave",()=>{if(this.waveformCanvas&&this.waveformCanvas.width>0&&this.progressBar&&this.cachedWaveform&&this.cachedWaveform.length>0){this.waveformCanvas.style.opacity="0",this.progressBar.style.height="",this.progressBar.style.borderRadius="";const P=this.progressBar.querySelector("#progressFill");P&&(P.style.opacity="")}}),this.progressBar.addEventListener("touchstart",P=>{if(P.preventDefault(),this.waveformCanvas&&this.waveformCanvas.width>0&&this.progressBar&&this.cachedWaveform&&this.cachedWaveform.length>0){this.touchExitTimeout!==null&&(clearTimeout(this.touchExitTimeout),this.touchExitTimeout=null),this.progressBar.style.height="24px",this.progressBar.style.borderRadius="12px";const T=this.progressBar.querySelector("#progressFill");T&&(T.style.opacity="0.24"),this.waveformCanvas.style.opacity="1",this.redrawWaveform(),this.seekToPosition(P)}},{passive:!1}),this.progressBar.addEventListener("touchmove",P=>{P.preventDefault(),this.progressBar&&this.state.duration>0&&P.touches.length>0&&this.showTooltip(this.progressBar,P.touches[0].clientX)},{passive:!1}),this.progressBar.addEventListener("touchend",()=>{this.waveformCanvas&&this.progressBar&&(this.touchExitTimeout=window.setTimeout(()=>{if(this.progressBar){this.progressBar.style.height="",this.progressBar.style.borderRadius="";const P=this.progressBar.querySelector("#progressFill");P&&(P.style.opacity="")}this.waveformCanvas&&(this.waveformCanvas.style.opacity="0"),this.touchExitTimeout=null},3e3))}),window.addEventListener("resize",()=>{this.updateWaveformCanvasSize(),this.waveformCanvas&&this.cachedWaveform&&this.redrawWaveform()}))}initBackground(){this.background=ce.new(hi),this.background.setFPS(this.state.backgroundFPS||60);const P=window.devicePixelRatio||1;if(this.background.setRenderScale((this.state.backgroundRenderScale||1)*P),this.background.setStaticMode(!this.state.backgroundDynamic),this.background.setFlowSpeed(this.state.backgroundFlowSpeed),this.background.getElement().style.position="absolute",this.background.getElement().style.top="0",this.background.getElement().style.left="0",this.background.getElement().style.width="100%",this.background.getElement().style.height="100%",this.background.getElement().style.backgroundSize="cover",this.background.getElement().style.backgroundPosition="center",this.background.getElement().style.backgroundRepeat="no-repeat",this.detectMaxFPS().then(T=>{this.bgFPS&&(this.bgFPS.max=T.toString(),(parseInt(this.bgFPS.value)>T||parseInt(this.bgFPS.value)===60)&&(this.bgFPS.value=T.toString(),this.state.backgroundFPS=T,this.bgFPSValue&&(this.bgFPSValue.textContent=`${T}fps`),this.background.setFPS(T),this.saveBackgroundSettings()))}),this.backgroundStyleSelect){this.backgroundStyleSelect.addEventListener("change",L=>{const R=L.target.value;this.switchBackgroundStyle(R)});const T=this.backgroundStyleSelect;if(T.addEventListener("keydown",L=>{if(L.key==="ArrowUp"||L.key==="ArrowDown"){L.preventDefault();const R=L.key==="ArrowUp"?-1:1,I=Math.max(0,Math.min(T.options.length-1,T.selectedIndex+R));T.selectedIndex=I,this.switchBackgroundStyle(T.value)}}),this.backgroundStyleSelect){const L=this.backgroundStyleSelect;L.addEventListener("wheel",R=>{R.preventDefault();const I=R.deltaY>0?1:-1,F=Math.max(0,Math.min(L.options.length-1,L.selectedIndex+I));L.selectedIndex=F,this.switchBackgroundStyle(L.value)},{passive:!1})}}if(this.bgLowFreqVolume&&this.bgLowFreqVolumeValue){const T=L=>`${(80+L*40).toFixed(0)}hz`;this.bgLowFreqVolumeValue.textContent=T(parseFloat(this.bgLowFreqVolume.value)),this.bgLowFreqVolume?.addEventListener("input",L=>{const R=parseFloat(L.target.value);this.state.backgroundLowFreqVolume=R,this.bgLowFreqVolumeValue&&(this.bgLowFreqVolumeValue.textContent=T(R)),this.background&&typeof this.background.setLowFreqVolume=="function"&&this.background.setLowFreqVolume(R),this.saveBackgroundSettings()})}}originalDark="";originalLight="";originalDominant="";isColorsInitialized=!1;initColors(){if(this.isColorsInitialized)return;let P=getComputedStyle(document.documentElement).getPropertyValue("--dominant-color-dark").trim(),T=getComputedStyle(document.documentElement).getPropertyValue("--dominant-color-light").trim(),L=getComputedStyle(document.documentElement).getPropertyValue("--dominant-color").trim(),R=getComputedStyle(document.documentElement).getPropertyValue("--waveform-color").trim();this.originalDark=P||"#640302",this.originalLight=T||"#ffcfce",this.originalDominant=L||"#fd9c9b",R||document.documentElement.style.setProperty("--waveform-color",this.originalDominant),this.isColorsInitialized=!0}setDefaultColors(){document.documentElement.style.setProperty("--dominant-color","#fd9c9b"),document.documentElement.style.setProperty("--dominant-color-light","#ffcfce"),document.documentElement.style.setProperty("--dominant-color-dark","#640302"),document.documentElement.style.setProperty("--waveform-color","#fd9c9b"),this.originalDominant="#fd9c9b",this.originalLight="#ffcfce",this.originalDark="#640302",this.isColorsInitialized=!0,this.invertColorsCheckbox&&this.invertColors(this.invertColorsCheckbox.checked)}onDominantColorChange(){this.dominantColorInput&&(this.state.manualDominantColor=this.dominantColorInput.value,this.applyManualColors(),this.saveBackgroundSettings())}onDominantColorLightChange(){this.dominantColorLightInput&&(this.state.manualDominantColorLight=this.dominantColorLightInput.value,this.applyManualColors(),this.saveBackgroundSettings())}onDominantColorDarkChange(){this.dominantColorDarkInput&&(this.state.manualDominantColorDark=this.dominantColorDarkInput.value,this.applyManualColors(),this.saveBackgroundSettings())}applyManualColors(){const P=this.invertColorsCheckbox?.checked||!1,T=this.state.manualDominantColor||this.originalDominant,L=this.state.manualDominantColorLight||this.originalLight,R=this.state.manualDominantColorDark||this.originalDark;P?(document.documentElement.style.setProperty("--dominant-color",L),document.documentElement.style.setProperty("--dominant-color-light",R),document.documentElement.style.setProperty("--dominant-color-dark",T),document.documentElement.style.setProperty("--waveform-color",R)):(document.documentElement.style.setProperty("--dominant-color",T),document.documentElement.style.setProperty("--dominant-color-light",L),document.documentElement.style.setProperty("--dominant-color-dark",R),document.documentElement.style.setProperty("--waveform-color",T)),this.redrawWaveform()}invertColors(P){this.invertColorsCheckbox&&(this.isColorsInitialized||this.initColors(),this.state.invertColors=P,this.applyManualColors(),this.saveBackgroundSettings())}applyDominantColorAsCSSVariable(){const P=this.invertColorsCheckbox?.checked;this.dominantColor&&(this.originalDominant=this.dominantColor,this.originalLight=this.lightenColor(this.dominantColor,.2),this.originalDark=this.darkenColor(this.dominantColor,.5),this.isColorsInitialized=!0,this.dominantColorInput&&!this.state.manualDominantColor&&(this.dominantColorInput.value=this.dominantColor),this.dominantColorLightInput&&!this.state.manualDominantColorLight&&(this.dominantColorLightInput.value=this.originalLight),this.dominantColorDarkInput&&!this.state.manualDominantColorDark&&(this.dominantColorDarkInput.value=this.originalDark),this.invertColors(P||!1))}switchBackgroundStyle(P){if(!this.background)return;const T=this.state.backgroundType;if(this.fluidDesc&&(this.fluidDesc.style.display=P==="fluid"?"block":"none"),this.coverDesc&&(this.coverDesc.style.display=P==="cover"?"block":"none"),this.solidDesc&&(this.solidDesc.style.display=P==="solid"?"block":"none"),this.solidOptions){const L=P==="cover"&&this.state.backgroundColorMask&&this.state.backgroundMaskOpacity===0;this.setOptionsVisibility(this.solidOptions,L,["neumorphismA","neumorphismB"])}switch(T==="cover"&&P!=="cover"&&this.invertColorsCheckbox&&(this.state.originalInvertColors=this.invertColorsCheckbox.checked),P){case"fluid":this.background.setFlowSpeed(this.state.backgroundFlowSpeed||4),this.player&&(this.player.style.background=""),this.state.backgroundType="fluid",this.updateBackground(),this.updateBackgroundUI(),this.saveBackgroundSettings();break;case"cover":this.background.setAlbum(resolveDefaultCover(this.state.coverUrl)),this.player&&(this.player.style.background=""),this.state.backgroundType="cover",this.updateBackground(),this.updateBackgroundUI(),this.saveBackgroundSettings();break;case"solid":this.background.setAlbum(""),this.player&&(this.player.style.background="transparent"),this.state.backgroundType="solid",this.updateBackground(),this.updateBackgroundUI(),this.saveBackgroundSettings();break}if(P!=="cover"&&this.invertColorsCheckbox&&(this.invertColorsCheckbox.checked=!1,this.invertColors(!1)),P==="cover"&&T!=="cover"&&this.invertColorsCheckbox){const L=this.state.originalInvertColors!==null&&this.state.originalInvertColors!==void 0?this.state.originalInvertColors:this.state.invertColors;this.invertColorsCheckbox.checked=L,this.invertColors(L)}if(this.invertColorsCheckbox){const L=this.invertColorsCheckbox.checked;this.invertColorsCheckbox.onchange=()=>{this.invertColorsCheckbox&&this.invertColors(this.invertColorsCheckbox.checked)},L&&P==="cover"&&this.invertColors(L)}}setupAudioEvents(){const P=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;this.mediaSessionRefreshTimeout=null,document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&this.refreshMediaSession()}),window.addEventListener("pageshow",()=>{this.refreshMediaSession()}),window.addEventListener("focus",()=>{this.refreshMediaSession()}),P&&document.addEventListener("touchstart",()=>{this.mediaSessionRefreshTimeout||(this.mediaSessionRefreshTimeout=setTimeout(()=>{this.refreshMediaSession(),this.mediaSessionRefreshTimeout=null},100))},{passive:!0}),this.audio.addEventListener("loadedmetadata",()=>{this.state.duration=this.audio.duration,this.updateTimeDisplay(),this.updateMediaSessionMetadata(),!isFinite(this.state.duration)&&!this.cachedWaveform&&this.generateWaveformData(),/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream&&setTimeout(()=>{this.updateMediaSessionMetadata()},100)}),this.audio.addEventListener("timeupdate",()=>{this.state.currentTime=this.audio.currentTime,this.state.isRangeMode&&this.state.rangeEndTime>this.state.rangeStartTime&&this.audio.currentTime>=this.state.rangeEndTime&&(this.audio.currentTime=this.state.rangeStartTime,this.state.currentTime=this.state.rangeStartTime),this.updateProgress(),this.updateTimeDisplay();const R=this.audio.currentTime*1e3+this.state.lyricDelay;this.lyricPlayer.setCurrentTime(R)}),this.audio.addEventListener("play",()=>{this.state.isPlaying=!0,this.updatePlayButton(),this.lyricPlayer.resume(),this.updateMarqueeSettings(),this.updateCoverRotation(),"mediaSession"in navigator&&(navigator.mediaSession.playbackState="playing")}),this.audio.addEventListener("pause",()=>{this.state.isPlaying=!1,this.updatePlayButton(),this.lyricPlayer.pause(),this.updateMarqueeSettings(),this.updateCoverRotation(),"mediaSession"in navigator&&(navigator.mediaSession.playbackState="paused")}),this.audio.addEventListener("ended",()=>{if(this.state.isPlaying=!1,this.updatePlayButton(),this.state.loopPlay){this.audio.currentTime=0;const R=this.processedLyricLines.length>0?this.processedLyricLines[0].startTime:0;this.lyricPlayer.setCurrentTime(R),setTimeout(()=>{this.lyricPlayer.setCurrentTime(this.state.lyricDelay)},50),this.audio.play()}"mediaSession"in navigator&&(navigator.mediaSession.playbackState="none")});let T=this.audio.src;new MutationObserver(R=>{R.forEach(I=>{I.type==="attributes"&&I.attributeName==="src"&&this.audio.src!==T&&(T=this.audio.src,this.state.isRangeMode&&this.exitRangeMode(),this.generateWaveformData())})}).observe(this.audio,{attributes:!0}),this.setupMediaSessionHandlers()}setupLyricEvents(){this.lyricPlayer.addEventListener("line-click",T=>{const L=T;T.preventDefault(),T.stopImmediatePropagation(),T.stopPropagation(),console.log(L.line,L.lineIndex),this.audio.currentTime=L.line.getLine().startTime/1e3});const P=this.lyricPlayer.getElement();P&&P.addEventListener("touchend",T=>{if(!this.hasLyrics||T.changedTouches.length>1)return;const L=T.target instanceof HTMLElement?T.target:null,I=(this.lyricPlayer?.currentLyricLineObjects??[]).find(q=>{const G=q?.getElement?.();return G instanceof HTMLElement&&(G===L||G.contains(L))});if(!I)return;const F=I.getLine?.();if(!F||typeof F.startTime!="number")return;const D=F.startTime,V=Math.max(0,D/1e3);T.preventDefault(),T.stopPropagation(),T.stopImmediatePropagation?.(),this.audio.currentTime=V,this.lyricPlayer.setCurrentTime(D,!0),typeof this.lyricPlayer.resetScroll=="function"&&this.lyricPlayer.resetScroll()},{passive:!1}),this.updateLyricAreaHint()}updateLyricAreaHint(){if(this.lyricsPanel&&(this.lyricAreaHint&&this.lyricAreaHint.remove(),!this.hasLyrics)){const P=document.createElement("div");P.id="lyricAreaHint",this.lyricAreaHint=P,P.style.cssText=`
        position: absolute;
        top: 45%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: var(--dominant-color-light);
        font-size: 16px;
        text-align: center;
        pointer-events: auto;
        z-index: 30;
        width: 80%;
        padding: 30px;
        opacity: 0.7;
        transition: opacity 0.3s ease;
        cursor: pointer;
        user-select: none;
      `,P.innerHTML=`
        <div style="margin-bottom: 15px; font-size: var(--amll-lp-font-size, max(max(4vh, 2vw), 12px));">${t$3("clickToAddLyrics")}</div>
        <div style="opacity: 0.6; line-height: 1.5; font-size: var(--amll-lp-font-size, max(max(3vh, 1.5vw), 12px));">*.ass, *.lqe, *.lrc, *.lyl, *.lys, *.qrc, *.spl, *.srt, *.ttml, *.yrc</div>
      `,P.addEventListener("click",T=>{T.stopPropagation(),this.lyricFile&&this.lyricFile.click()}),P.addEventListener("touchend",T=>{T.preventDefault(),T.stopPropagation(),this.lyricFile&&this.lyricFile.click()},{passive:!1}),this.lyricsPanel.appendChild(P)}}setupDragAndDropEvents(){this.albumCoverLarge&&(this.albumCoverLarge.addEventListener("dragover",P=>{P.preventDefault(),this.albumCoverLarge.style.opacity="0.7"}),this.albumCoverLarge.addEventListener("dragleave",()=>{this.albumCoverLarge.style.opacity="1"}),this.albumCoverLarge.addEventListener("drop",P=>{if(P.preventDefault(),this.albumCoverLarge.style.opacity="1",P.dataTransfer?.files.length){const T=P.dataTransfer.files[0];T.type.startsWith("image/")?(this.loadCoverFromFile(T),this.updateFileInputDisplay("coverFile",T)):T.type.startsWith("audio/")||/\.(mp3|wav|ogg|m4a|aac|flac)$/i.test(T.name)?(this.loadMusicFromFile(T),this.updateFileInputDisplay("musicFile",T)):this.showStatus("不支持的文件类型，请拖拽音频或图片文件",!0)}})),this.lyricsPanel&&(this.lyricsPanel.addEventListener("dragover",P=>{P.preventDefault(),this.lyricsPanel.style.border="2px dashed rgba(255, 255, 255, 0.5)"}),this.lyricsPanel.addEventListener("dragleave",()=>{this.lyricsPanel.style.border="none"}),this.lyricsPanel.addEventListener("drop",P=>{if(P.preventDefault(),this.lyricsPanel.style.border="none",P.dataTransfer?.files.length){const T=P.dataTransfer.files[0];(T.name.match(/\.(lrc|ttml|yrc|lys|qrc|txt|ass|lqe|lyl|srt|spl)$/i)||T.type==="text/plain"||T.type==="")&&(this.loadLyricFromFile(T),this.updateFileInputDisplay("lyricFile",T))}}))}updateFileInputDisplay(P,T){let L=null;if(P==="musicFile"?L=this.musicFile:P==="lyricFile"?L=this.lyricFile:P==="coverFile"&&(L=this.coverFile),!L)return;if(!T){const F=document.getElementById(`${P}Display`);F&&F.remove();return}const R=document.createElement("span");if(R.className="control-value",R.style="max-width: 100%; overflow: hidden; text-overflow: ellipsis; margin-bottom: 4px;",T instanceof File)R.textContent=`${T.name}`;else if(T==="Direct Input")R.textContent=T;else try{const V=new URL(T).pathname.split("/").pop()||T;R.textContent=`${V}`}catch{R.textContent=T}R.id=`${P}Display`;const I=document.getElementById(`${P}Display`);I&&I.remove(),L.parentNode?.insertBefore(R,L)}initStats(){this.stats=new Stats,this.stats.showPanel(0),this.stats.dom.style.display="none",document.body.appendChild(this.stats.dom)}initUI(){if(this.initUploadButtons(),this.lyricsPanel&&this.lyricPlayer.getElement()&&this.lyricsPanel.appendChild(this.lyricPlayer.getElement()),this.updateLyricAreaHint(),this.initLyricDisplayControls(),this.playButton){let P,T=!1;this.playButton.addEventListener("click",L=>{if(T){T=!1;return}if(!this.state.musicUrl||!this.audio.src){L.preventDefault(),this.musicFile&&this.musicFile.click();return}this.audio.src&&this.togglePlayPause()}),this.playButton.addEventListener("mousedown",()=>{T=!1,P=window.setTimeout(()=>{T=!0,this.musicFile&&this.musicFile.click()},3e3)}),this.playButton.addEventListener("mouseup",()=>{clearTimeout(P)}),this.playButton.addEventListener("mouseleave",()=>{clearTimeout(P)}),this.playButton.addEventListener("contextmenu",L=>(L.preventDefault(),this.musicFile&&this.musicFile.click(),!1)),this.playButton.addEventListener("touchstart",L=>{P=window.setTimeout(()=>{this.musicFile&&this.musicFile.click()},3e3)},{passive:!0}),this.playButton.addEventListener("touchend",()=>{clearTimeout(P)},{passive:!0}),this.playButton.addEventListener("touchcancel",()=>{clearTimeout(P)},{passive:!0})}this.player&&typeof this.player.appendChild=="function"&&(this.player.appendChild(this.audio),this.player.appendChild(this.background.getElement()),this.player.appendChild(this.coverBlurBackground),this.lyricsPanel?(this.lyricsPanel.appendChild(this.lyricPlayer.getElement()),this.lyricsPanel.addEventListener("click",P=>{this.hasLyrics||this.lyricFile&&this.lyricFile.click()}),this.lyricsPanel.addEventListener("touchend",P=>{this.hasLyrics||(P.preventDefault(),this.lyricFile&&this.lyricFile.click())},{passive:!1})):this.player.appendChild(this.lyricPlayer.getElement())),this.initCoverBlurBackground(),this.updateBackground(),this.background.setAlbum(DEFAULT_AMLL_COVER_URL),this.setDefaultColors(),this.controlPanel&&(this.controlPanel.style.width="0px",this.controlPanel.style.right="-50px",this.controlPanel.style.opacity="0"),this.adjustLyricPosition(),this.updateAlbumSidePanel(),this.updateLayoutByOrientation()}async loadMusicFromFile(P){try{const T=P.type.startsWith("audio/"),L=/\.(mp3|wav|ogg|m4a|aac|flac)$/i.test(P.name);if(!T&&!L){this.showStatus(t$3("musicLoadFailed"),!0);return}const R=URL.createObjectURL(P);this.state.musicUrl=R,this.audio.crossOrigin="anonymous",this.audio.src=R,this.audio.load(),this.playControls&&(this.playControls.style.bottom="",this.playControls.style.opacity=""),this.progressBar&&(this.progressBar.style.width=""),this.state.autoPlay?this.togglePlayPause():(this.state.isPlaying=!1,this.updatePlayButton()),await this.parseAudioMetadata(P),this.updateMediaSessionMetadata(),this.controlPanel&&(this.controlPanel.style.width="0px",this.controlPanel.style.right="-50px",this.controlPanel.style.opacity="0"),this.updateFileInputDisplay("musicFile",P),this.showStatus(t$3("musicLoadSuccess"))}catch{this.showStatus(t$3("musicLoadFailed"),!0)}}async loadLyricFromFile(P){try{const T=/\.(lrc|ttml|yrc|lys|qrc|txt|ass|lqe|lyl|srt|spl)$/i.test(P.name),L=P.type==="text/plain"||P.type==="";if(!T&&!L){this.showStatus(t$3("lyricsLoadFailed"),!0);return}const R=await P.text(),I=URL.createObjectURL(new Blob([R],{type:"text/plain"}));this.state.lyricUrl=I,await this.loadLyricContent(R,P.name),this.updateFileInputDisplay("lyricFile",P),this.showStatus(t$3("lyricsLoadSuccess"))}catch{this.showStatus(t$3("lyricsLoadFailed"),!0)}}async loadCoverFromFile(P){try{const T=URL.createObjectURL(P);this.state.coverUrl=T,this.updateBackground(),this.background.setAlbum(resolveDefaultCover(T)),await this.extractAndProcessCoverColor(T),this.applyDominantColorAsCSSVariable(),this.updateBackground(),this.updateSongInfo(),this.updateFileInputDisplay("coverFile",P),this.showStatus(t$3("coverLoadSuccess"))}catch{this.showStatus(t$3("coverLoadFailed"),!0)}}async loadFromURLs(){let P=this.musicUrl?.value,T=this.lyricUrl?.value,L=this.coverUrl?.value;const R=new URLSearchParams(window.location.search),I=R.get("music");I&&this.musicUrl&&(P=I,this.musicUrl.value=I);const F=R.get("lyric");F&&this.lyricUrl&&(T=F,this.lyricUrl.value=T);const D=R.get("cover");D&&this.coverUrl&&(L=D,this.coverUrl.value=D);const V=R.get("x"),q=R.get("ms"),G=R.get("vol"),z=R.get("loop")==="1"||R.get("loop")==="true",Q=R.get("t");if(V){const J=parseFloat(V);!isNaN(J)&&J>0&&this.playbackRateControl&&(this.playbackRateControl.value=J.toString(),this.audio&&(this.audio.playbackRate=J),this.playbackRateValue&&(this.playbackRateValue.textContent=J.toFixed(2)+"x"),this.updatePlaybackRateIcon(J),this.state.playbackRate=J)}if(q){const J=parseInt(q);isNaN(J)||(this.lyricDelayInput&&(this.lyricDelayInput.value=J.toString()),this.applyLyricDelay(J,{skipSave:!0}))}if(G){const J=parseFloat(G);if(!isNaN(J)){let At;J>1&&J<=100?At=J/100:J>=0&&J<=1?At=J:At=.5,this.volumeControl&&(this.volumeControl.value=Math.round(At*100).toString(),this.audio&&(this.audio.volume=At),this.volumeValue&&(this.volumeValue.textContent=Math.round(At*100)+"%"),this.updateVolumeIcon(Math.round(At*100)),this.state.volume=Math.round(At*100))}}R.has("loop")&&this.loopPlayCheckbox&&(this.loopPlayCheckbox.checked=z,this.state.loopPlay=z);const tt=R.get("title");tt&&this.songTitleInput&&(this.songTitleInput.value=tt,this.state.songTitle=tt);const gt=R.get("artist");if(gt&&this.songArtistInput&&(this.songArtistInput.value=gt,this.state.songArtist=gt),this.state.songTitle&&(this.state.songArtist?document.title=`${this.state.songArtist} - ${this.state.songTitle} | AMLL Web Player`:document.title=`${this.state.songTitle} | AMLL Web Player`),P&&(this.state.musicUrl=P,this.audio.src=P,this.audio.load(),this.playControls&&(this.playControls.style.bottom="",this.playControls.style.opacity=""),this.progressBar&&(this.progressBar.style.width=""),this.state.autoPlay?this.togglePlayPause():(this.state.isPlaying=!1,this.updatePlayButton()),this.updateMediaSessionMetadata(),this.updateFileInputDisplay("musicFile",P)),T)if(this.state.lyricUrl=T,/^https?:\/\/.+/.test(T.trim()))try{const kt=await(await fetch(T)).text(),ne=isESLyRiCFormat(kt),Te=isLyRiCA2Format(kt);T.endsWith(".lrc")?ne||Te?await this.loadLyricContent(kt,T):await this.loadLyricContent(kt,T):await this.loadLyricContent(kt,T),this.updateFileInputDisplay("lyricFile",T)}catch{this.showStatus(t$3("lyricsUrlLoadFailed"),!0)}else await this.processLyricInput(T);if(L)if(/^https?:\/\/.+/.test(L.trim()))this.state.coverUrl=L,this.updateBackground(),this.background.setAlbum(resolveDefaultCover(L)),await this.extractAndProcessCoverColor(L),this.applyDominantColorAsCSSVariable(),this.updateFileInputDisplay("coverFile",L);else{const At=/^data:([^;]+)(;charset=([^;]+))?;base64,([A-Za-z0-9+/=]+)$/,kt=L.trim().match(At);if(kt){const ne=kt[1]||"image/png";kt[3],this.state.coverUrl=L,this.updateBackground(),this.background.setAlbum(resolveDefaultCover(L)),await this.extractAndProcessCoverColor(L),this.applyDominantColorAsCSSVariable(),this.updateFileInputDisplay("coverFile",`Base64 Encoded Input (${ne})`)}else this.state.coverUrl=L,this.updateBackground(),this.background.setAlbum(resolveDefaultCover(L)),await this.extractAndProcessCoverColor(L),this.applyDominantColorAsCSSVariable(),this.updateFileInputDisplay("coverFile",L)}this.updateSongInfo(),this.controlPanel&&(this.controlPanel.style.width="0px",this.controlPanel.style.right="-50px",this.controlPanel.style.opacity="0");const yt=this.state.songTitle,Et=this.state.songArtist;if(yt&&(Et?document.title=`${Et} - ${yt} | AMLL Web Player`:document.title=`${yt} | AMLL Web Player`),Q&&this.audio){const J=parseFloat(Q);!isNaN(J)&&J>=0&&(this.audio.currentTime=J)}this.saveBackgroundSettings(),this.showStatus(t$3("loadFromUrlComplete"))}async loadFromFiles(){const P=this.musicFile?.files?.[0],T=this.lyricFile?.files?.[0],L=this.coverFile?.files?.[0];P&&await this.loadMusicFromFile(P),T&&await this.loadLyricFromFile(T),L&&await this.loadCoverFromFile(L)}async processCoverInput(P){if(!P.trim())return;if(/^https?:\/\/.+/.test(P.trim())){this.state.coverUrl=P,this.updateBackground(),this.background.setAlbum(resolveDefaultCover(P)),await this.extractAndProcessCoverColor(P),this.applyDominantColorAsCSSVariable(),this.updateFileInputDisplay("coverFile",P);return}const L=/^data:([^;]+)(;charset=([^;]+))?;base64,([A-Za-z0-9+/=]+)$/,R=P.trim().match(L);if(R){const I=R[1]||"image/png";R[3],this.state.coverUrl=P,this.updateBackground(),this.background.setAlbum(resolveDefaultCover(P)),await this.extractAndProcessCoverColor(P),this.applyDominantColorAsCSSVariable(),this.updateFileInputDisplay("coverFile",`Base64 Encoded Input (${I})`);return}this.state.coverUrl=P,this.updateBackground(),this.background.setAlbum(resolveDefaultCover(P)),await this.extractAndProcessCoverColor(P),this.applyDominantColorAsCSSVariable(),this.updateFileInputDisplay("coverFile",P)}async processLyricInput(P){if(!P.trim())return;if(/^https?:\/\/.+/.test(P.trim())){await this.loadFromURLs();return}const L=/^data:([^;]+)(;charset=([^;]+))?;base64,([A-Za-z0-9+/=]+)$/,R=P.trim().match(L);if(R){try{const I=R[1]||"text/plain",F=R[3]||"utf-8",D=R[4],V=atob(D),q=new Uint8Array(V.length);for(let z=0;z<V.length;z++)q[z]=V.charCodeAt(z);let G;try{G=new TextDecoder(F).decode(q)}catch{G=new TextDecoder("utf-8").decode(q)}await this.loadLyricContent(G,"direct-input.txt"),this.updateFileInputDisplay("lyricFile",`Base64 Encoded Input (${I})`),this.showStatus(t$3("lyricsParseSuccess"))}catch(I){console.error("Base64 decoding error:",I),this.showStatus(t$3("lyricsParseFailed"),!0)}return}try{await this.loadLyricContent(P,"direct-input.txt"),this.updateFileInputDisplay("lyricFile","Direct Input"),this.showStatus(t$3("lyricsParseSuccess"))}catch(I){console.error("Direct lyric input error:",I),this.showStatus(t$3("lyricsParseFailed"),!0)}}async loadLyricContent(P,T){try{let L=[];const R=isESLyRiCFormat(P),I=isLyRiCA2Format(P);if(T.endsWith(".ttml"))L=parseTTML$1(P).lines.map(this.mapTTMLLyric);else if(T.endsWith(".ass")){const F=assToTTML(P);L=parseTTML$1(F).lines.map(this.mapTTMLLyric)}else if(T.endsWith(".lrc"))if(R){const F=parseESLyRiC(P),D=convertToTTML(F);L=parseTTML$1(D).lines.map(this.mapTTMLLyric)}else if(I){const F=parseLyRiCA2(P),D=convertToTTML(F);L=parseTTML$1(D).lines.map(this.mapTTMLLyric)}else if(isWalaokeFormat(P)){const F=parseWalaoke(P);L=parseTTML$1(F).lines.map(this.mapTTMLLyric)}else if(isSPLFormat(P)){const F=parseSPL(P);L=parseTTML$1(F).lines.map(this.mapTTMLLyric)}else L=parseLrc$1(P).map(this.mapLyric);else if(T.endsWith(".yrc"))L=parseYrc$1(P).map(this.mapLyric);else if(T.endsWith(".lys"))L=parseLys$1(P).map(this.mapLyric);else if(T.endsWith(".qrc"))L=parseQrc$1(P).map(this.mapLyric);else if(T.endsWith(".lqe"))if(P.includes("[lyrics: format@Lyricify Syllable]"))L=parseLys$1(P).map(this.mapLyric);else{const F=lqeToTTML(P);L=parseTTML$1(F).lines.map(this.mapTTMLLyric)}else if(T.endsWith(".srt")){const F=srtToTTML(P);L=parseTTML$1(F).lines.map(this.mapTTMLLyric)}else if(T.endsWith(".lyl")){const F=lylToTTML(P);L=parseTTML$1(F).lines.map(this.mapTTMLLyric)}else if(T.endsWith(".spl")){const F=parseSPL(P);L=parseTTML$1(F).lines.map(this.mapTTMLLyric)}else if(R){const F=parseESLyRiC(P),D=convertToTTML(F);L=parseTTML$1(D).lines.map(this.mapTTMLLyric)}else if(I){const F=parseLyRiCA2(P),D=convertToTTML(F);L=parseTTML$1(D).lines.map(this.mapTTMLLyric)}else if(isWalaokeFormat(P)){const F=parseWalaoke(P);L=parseTTML$1(F).lines.map(this.mapTTMLLyric)}else if(isSPLFormat(P)){const F=parseSPL(P);L=parseTTML$1(F).lines.map(this.mapTTMLLyric)}else if(isSrtFormat(P)){const F=srtToTTML(P);L=parseTTML$1(F).lines.map(this.mapTTMLLyric)}else if(isLqeFormat(P)){const F=lqeToTTML(P);L=parseTTML$1(F).lines.map(this.mapTTMLLyric)}else if(isAssFormat(P)){const F=assToTTML(P);L=parseTTML$1(F).lines.map(this.mapTTMLLyric)}else if(isLylFormat(P)){const F=lylToTTML(P);L=parseTTML$1(F).lines.map(this.mapTTMLLyric)}else L=parseLrc$1(P).map(this.mapLyric);this.originalLyricLines=JSON.parse(JSON.stringify(L)),this.hasLyrics=L.length>0,this.updateLyricsDisplay(),this.lyricsPanel&&this.hasLyrics&&this.lyricAreaHint&&this.lyricAreaHint.remove(),this.updateLyricAreaHint(),this.showStatus(`${t$3("lyricsParseSuccess")}${L.length} 行`)}catch(L){console.error("Lyric parsing error:",L),this.showStatus(t$3("lyricsParseFailed"),!0)}}mapLyric(P){return{words:P.words.map(T=>({obscene:!1,...T})),startTime:P.words[0]?.startTime??0,endTime:P.words[P.words.length-1]?.endTime??Number.POSITIVE_INFINITY,translatedLyric:"",romanLyric:"",isBG:!1,isDuet:!1}}mapTTMLLyric(P){return{...P,words:P.words.map(T=>({obscene:!1,...T}))}}findNextLyricLineStartTime(P){if(!this.processedLyricLines||this.processedLyricLines.length===0)return P;const T=P+this.state.lyricDelay;for(let L=0;L<this.processedLyricLines.length;L++){const R=this.processedLyricLines[L];if(R.startTime>=T)return R.startTime}return this.processedLyricLines[this.processedLyricLines.length-1].startTime}updateLyricsDisplay(){if(!this.hasLyrics)return;const P=this.originalLyricLines.map(D=>({...D})),T=this.audio.currentTime,L=P.map(D=>{const V={...D};if(this.state.showTranslatedLyric||(V.translatedLyric=""),this.state.showRomanLyric||(V.romanLyric=""),this.state.swapLyricPositions){const G=V.translatedLyric;V.translatedLyric=V.romanLyric,V.romanLyric=G}!this.state.showbgLyric&&V.isBG&&(V.lyric="",V.translatedLyric="",V.romanLyric="",V.words&&V.words.length>0&&(V.words=V.words.map(G=>({...G,word:""})))),this.state.swapDuetsPositions&&(V.isDuet=!D.isDuet,V.words&&V.words.length>0&&(V.words=V.words.map(G=>({...G,isDuet:V.isDuet}))));const q=D.endTime<=T;return this.state.hidePassedLyrics&&q&&(V.translatedLyric="",V.romanLyric="",V.lyric="",V.words&&V.words.length>0&&(V.words=V.words.map(G=>({...G,word:"",translated:"",roman:""})))),this.state.advanceLyricTiming&&(V.startTime=Math.max(0,V.startTime-.4),V.endTime=Math.max(0,V.endTime+.4)),V}),R=this.state.showbgLyric?L:L.filter(D=>!D.isBG);this.processedLyricLines=R,this.lyricPlayer.setLyricLines(this.processedLyricLines),this.lyricPlayer.setHidePassedLines(this.state.hidePassedLyrics);const I=this.audio.currentTime*1e3,F=this.findNextLyricLineStartTime(I);this.lyricPlayer.setCurrentTime(F),setTimeout(()=>{const D=this.audio.currentTime*1e3,V=this.pendingLyricDelay??this.state.lyricDelay;this.lyricPlayer.setCurrentTime(D+V),this.pendingLyricDelay=null},50)}initLyricDisplayControls(){this.showTranslatedLyricCheckbox&&(this.showTranslatedLyricCheckbox.checked=this.state.showTranslatedLyric,this.showTranslatedLyricCheckbox.addEventListener("change",P=>{this.state.showTranslatedLyric=P.target.checked,this.updateLyricsDisplay(),this.saveBackgroundSettings()})),this.showRomanLyricCheckbox&&(this.showRomanLyricCheckbox.checked=this.state.showRomanLyric,this.showRomanLyricCheckbox.addEventListener("change",P=>{this.state.showRomanLyric=P.target.checked,this.updateLyricsDisplay(),this.saveBackgroundSettings()})),this.swapLyricPositionsCheckbox&&(this.swapLyricPositionsCheckbox.checked=this.state.swapLyricPositions,this.swapLyricPositionsCheckbox.addEventListener("change",P=>{this.state.swapLyricPositions=P.target.checked,this.updateLyricsDisplay(),this.saveBackgroundSettings()})),this.showbgLyricCheckbox&&(this.showbgLyricCheckbox.checked=this.state.showbgLyric,this.showbgLyricCheckbox.addEventListener("change",P=>{this.state.showbgLyric=P.target.checked,this.updateLyricsDisplay(),this.saveBackgroundSettings()})),this.swapDuetsPositionsCheckbox&&(this.swapDuetsPositionsCheckbox.checked=this.state.swapDuetsPositions,this.swapDuetsPositionsCheckbox.addEventListener("change",P=>{if(this.state.swapDuetsPositions=P.target.checked,window.matchMedia("(orientation: portrait)").matches){const L=this.albumSidePanel?.querySelector(".song-info-container");L&&this.albumInfo&&this.albumCoverContainer&&(this.state.swapDuetsPositions?(L.insertBefore(this.albumInfo,this.albumCoverContainer),this.albumCoverContainer.style.marginRight="0",this.albumCoverContainer.style.marginLeft="15px",this.albumInfo.style.textAlign="right"):(L.insertBefore(this.albumCoverContainer,this.albumInfo),this.albumCoverContainer.style.marginLeft="0",this.albumCoverContainer.style.marginRight="15px",this.albumInfo.style.textAlign="left"))}else this.albumSidePanel&&this.lyricsPanel&&this.player&&(this.state.swapDuetsPositions?this.player.insertBefore(this.lyricsPanel,this.albumSidePanel):this.player.insertBefore(this.albumSidePanel,this.lyricsPanel));this.updateLyricsDisplay(),this.saveBackgroundSettings()})),this.hidePassedLyricsCheckbox&&(this.hidePassedLyricsCheckbox.checked=this.state.hidePassedLyrics,this.hidePassedLyricsCheckbox.addEventListener("change",P=>{this.state.hidePassedLyrics=P.target.checked,this.updateLyricsDisplay(),this.saveBackgroundSettings()})),this.advanceLyricTimingCheckbox&&(this.advanceLyricTimingCheckbox.checked=this.state.advanceLyricTiming,this.advanceLyricTimingCheckbox.addEventListener("change",P=>{this.state.advanceLyricTiming=P.target.checked,this.updateLyricsDisplay(),this.saveBackgroundSettings()})),this.singleLyricsCheckbox&&(this.singleLyricsCheckbox.checked=this.state.singleLyrics,this.singleLyricsCheckbox.addEventListener("change",P=>{this.state.singleLyrics=P.target.checked,this.updateLyricsDisplay(),this.saveBackgroundSettings()}))}togglePlayPause(){this.audio.paused?(this.state.isPlaying=!0,this.updatePlayButton(),this.audio.play().catch(P=>{console.error("Playback failed:",P),this.state.isPlaying=!1,this.updatePlayButton()})):(this.state.isPlaying=!1,this.updatePlayButton(),this.audio.pause())}updatePlayButton(){const P=this.playButton;this.landscapePlayBtn,P&&(P.innerHTML=this.state.isPlaying?'<svg aria-hidden="true" width="1em" height="1em" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M5 2a2 2 0 0 0-2 2v12c0 1.1.9 2 2 2h2a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H5Zm8 0a2 2 0 0 0-2 2v12c0 1.1.9 2 2 2h2a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2h-2Z" fill="currentColor"></path></svg>':'<svg aria-hidden="true" width="1em" height="1em" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17.22 8.68a1.5 1.5 0 0 1 0 2.63l-10 5.5A1.5 1.5 0 0 1 5 15.5v-11A1.5 1.5 0 0 1 7.22 3.2l10 5.5Z" fill="currentColor"></path></svg>')}updateProgress(){if(this.state.duration>0)if(this.state.isRangeMode&&this.state.rangeEndTime>this.state.rangeStartTime){const P=this.state.rangeEndTime-this.state.rangeStartTime,L=Math.max(0,Math.min(P,this.state.currentTime-this.state.rangeStartTime))/P*100,R=this.state.rangeStartTime/this.state.duration*100,F=this.state.rangeEndTime/this.state.duration*100-R;this.rangeProgressBar&&(this.rangeProgressBar.style.left=`${R}%`,this.rangeProgressBar.style.width=`${F}%`),this.progressFill&&(this.progressFill.style.left=`${R}%`,this.progressFill.style.width=`${L*F/100}%`),this.landscapeProgressFill&&(this.landscapeProgressFill.style.left=`${R}%`,this.landscapeProgressFill.style.width=`${L*F/100}%`)}else{const P=this.state.currentTime/this.state.duration*100;this.progressFill&&(this.progressFill.style.left="0%",this.progressFill.style.width=`${P}%`),this.landscapeProgressFill&&(this.landscapeProgressFill.style.left="0%",this.landscapeProgressFill.style.width=`${P}%`)}}updateTimeDisplay(){let P,T,L;if(this.state.isRangeMode&&this.state.rangeEndTime>this.state.rangeStartTime){const R=this.state.rangeEndTime-this.state.rangeStartTime,I=Math.max(0,Math.min(R,this.state.currentTime-this.state.rangeStartTime));if(P=this.formatTime(I),T=this.formatTime(R),this.state.showRemainingTime){const F=this.formatTime(R-I);L=`${P} / -${F}`}else L=`${P} / ${T}`}else if(P=this.formatTime(this.state.currentTime),T=this.formatTime(this.state.duration),!isFinite(this.state.duration)||isNaN(this.state.duration))L=`${P} / --:--`;else if(this.state.showRemainingTime&&this.state.duration>0){const R=this.formatTime(this.state.duration-this.state.currentTime);L=`${P} / -${R}`}else L=`${P} / ${T}`;this.timeDisplay&&(this.timeDisplay.textContent=L),this.landscapeTimeDisplay&&(this.landscapeTimeDisplay.textContent=L),this.timeDisplay&&this.timeDisplay.offsetHeight,this.landscapeTimeDisplay&&this.landscapeTimeDisplay.offsetHeight}formatTime(P){const T=Math.floor(P/60),L=Math.floor(P%60);return`${T.toString().padStart(2,"0")}:${L.toString().padStart(2,"0")}`}updateCoverStyle(){this.coverStyleSelect&&(this.coverStyleSelect.value=this.state.coverStyle),this.applyCoverStyle()}applyCoverStyle(){if(this.albumCoverContainer)switch(this.albumCoverContainer.style.boxShadow="",this.albumCoverContainer.style.transform="",this.albumCoverContainer.style.background="",this.albumCoverContainer.style.border="",this.albumCoverContainer.style.filter="",this.coverStyleDynamic&&this.coverStyleDynamic.parentNode&&(this.coverStyleDynamic.parentNode.removeChild(this.coverStyleDynamic),this.coverStyleDynamic=null),this.state.coverStyle){case"normal":this.albumCoverContainer.style.boxShadow="0 20px 25px rgba(0, 0, 0, 0.18), 0 10px 25px rgba(0, 0, 0, 0.18)";break;case"innerShadow":const P=this.state.roundedCover/100*50,T=document.createElement("style");T.id="coverStyleDynamic",this.coverStyleDynamic=T,T.textContent=`
          #albumCoverContainer {
            position: relative;
          }
          #albumCoverContainer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            box-shadow: inset 0 20px 25px rgba(0, 0, 0, 0.18), 0 10px 25px rgba(0, 0, 0, 0.18);
            pointer-events: none;
            z-index: 10;
            border-radius: ${P}%;
          }
          #albumCoverLarge {
            position: relative;
            z-index: 5;
          }
        `,document.head.appendChild(T);break;case"threeDShadow":this.albumCoverContainer.style.boxShadow="0 20px 25px rgba(0, 0, 0, 0.18), 0 10px 25px rgba(0, 0, 0, 0.18)";break;case"longShadow":const L=this.state.roundedCover/100*50,R=document.createElement("style");R.id="coverStyleDynamic",this.coverStyleDynamic=R,R.textContent=`
          #albumCoverContainer {
            position: relative;
            overflow: visible !important; /* 确保长投影不被裁剪 */
            box-shadow: none !important; /* 移除默认阴影以避免干扰 */
          }
          #albumCoverContainer::before,
          #albumCoverContainer::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: -1;
            border-radius: ${L}%;
          }
          #albumCoverContainer::before {
            transform-origin: 0 50%;
            transform: translate(100%, 0) skewY(45deg) scaleX(.6);
            background: linear-gradient(90deg, rgba(0, 0, 0, .3), transparent);
            animation: shadowMoveY 5s infinite linear alternate;
          }
          #albumCoverContainer::after {
            transform-origin: 0 0;
            transform: translate(0%, 100%) skewX(45deg) scaleY(.6);
            background: linear-gradient(180deg, rgba(0, 0, 0, .3), transparent);
            animation: shadowMoveX 5s infinite linear alternate;
          }
          @keyframes shadowMoveX {
            to {
              transform: translate(0%, 100%) skewX(50deg) scaleY(.6);
            }
          }
          @keyframes shadowMoveY {
            to {
              transform: translate(100%, 0) skewY(40deg) scaleX(.6);
            }
          }
        `,document.head.appendChild(R);break;case"neumorphismA":const I=this.state.roundedCover/100*50;this.albumCoverContainer.style.boxShadow="7px 7px 12px var(--dominant-color-dark), -7px -7px 12px var(--dominant-color-light), inset 0 0 0 var(--dominant-color-light), inset 0 0 0 var(--dominant-color-dark)",this.albumCoverContainer.style.borderRadius=`${I}%`;break;case"neumorphismB":const F=this.state.roundedCover/100*50,D=document.createElement("style");D.id="coverStyleDynamic",this.coverStyleDynamic=D,D.textContent=`
          #albumCoverContainer {
            position: relative;
          }
          #albumCoverContainer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            box-shadow: 0 0 0 var(--dominant-color-dark), 0 0 0 var(--dominant-color-light), inset -7px -7px 12px var(--dominant-color-light), inset 7px 7px 12px var(--dominant-color-dark);
            pointer-events: none;
            z-index: 10;
            border-radius: ${F}%;
          }
          #albumCoverLarge {
            position: relative;
            z-index: 5;
            border-radius: ${F}%;
          }
        `,document.head.appendChild(D);break;case"reflection":this.albumCoverContainer.style.boxShadow="0 20px 25px rgba(0, 0, 0, 0.18), 0 10px 25px rgba(0, 0, 0, 0.18)";break;case"cd":this.albumCoverContainer.style.boxShadow="0 20px 25px rgba(0, 0, 0, 0.18), 0 10px 25px rgba(0, 0, 0, 0.18)";break;case"vinyl":this.albumCoverContainer.style.boxShadow="0 20px 25px rgba(0, 0, 0, 0.18), 0 10px 25px rgba(0, 0, 0, 0.18)";break;case"colored":this.albumCoverContainer.style.boxShadow="0 20px 25px rgba(0, 0, 0, 0.18), 0 10px 25px rgba(0, 0, 0, 0.18)";break}}seekToPosition(P){const T=this.progressBar;if(T&&this.state.duration>0){const L=T.getBoundingClientRect();let R=0,I=0;P instanceof MouseEvent?(I=P.clientX,R=(I-L.left)/L.width):P instanceof TouchEvent&&P.touches.length>0&&(I=P.touches[0].clientX,R=(I-L.left)/L.width),this.showTooltip(T,I);let F=R*this.state.duration;this.state.isRangeMode&&this.state.rangeStartTime!==void 0&&this.state.rangeEndTime!==void 0&&(F=Math.max(this.state.rangeStartTime,Math.min(this.state.rangeEndTime,F))),this.audio.currentTime=F,this.state.currentTime=F;const D=this.findNextLyricLineStartTime(F*1e3);this.lyricPlayer.setCurrentTime(D),setTimeout(()=>{const V=F*1e3+this.state.lyricDelay;this.lyricPlayer.setCurrentTime(V)},50),this.updateProgress(),this.updateTimeDisplay()}}toggleFullscreen(){if(!document.fullscreenElement)/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||"ontouchstart"in window||navigator.maxTouchPoints>0?(async()=>{try{await document.documentElement.requestFullscreen();const L=screen.orientation;if(L&&L.lock)try{await L.lock("landscape")}catch{}this.fullscreenEnterIcon&&this.fullscreenExitIcon&&(this.fullscreenEnterIcon.style.display="none",this.fullscreenExitIcon.style.display="inline")}catch{}})():(document.documentElement.requestFullscreen(),this.fullscreenEnterIcon&&this.fullscreenExitIcon&&(this.fullscreenEnterIcon.style.display="none",this.fullscreenExitIcon.style.display="inline"));else{document.exitFullscreen();const P=screen.orientation;if(P&&P.unlock)try{P.unlock()}catch{}this.fullscreenEnterIcon&&this.fullscreenExitIcon&&(this.fullscreenEnterIcon.style.display="inline",this.fullscreenExitIcon.style.display="none")}}toggleControlPanel(){this.controlPanel&&(this.controlPanel.style.width==="0px"?(this.controlPanel.style.width="320px",this.controlPanel.style.right="20px",this.controlPanel.style.opacity="1"):(this.controlPanel.style.width="0px",this.controlPanel.style.right="-50px",this.controlPanel.style.opacity="0"))}handleKeyboard(P){const T=document.activeElement;if(!(T&&(T.tagName==="INPUT"||T.tagName==="TEXTAREA")))switch(P.key){case" ":P.preventDefault(),this.togglePlayPause();break;case"ArrowLeft":this.audio.currentTime=Math.max(0,this.audio.currentTime-10);const L=this.findNextLyricLineStartTime(this.audio.currentTime*1e3);this.lyricPlayer.setCurrentTime(L),setTimeout(()=>{const I=this.audio.currentTime*1e3+this.state.lyricDelay;this.lyricPlayer.setCurrentTime(I)},50);break;case"ArrowRight":this.audio.currentTime=Math.min(this.audio.duration,this.audio.currentTime+10);const R=this.findNextLyricLineStartTime(this.audio.currentTime*1e3);this.lyricPlayer.setCurrentTime(R),setTimeout(()=>{const I=this.audio.currentTime*1e3+this.state.lyricDelay;this.lyricPlayer.setCurrentTime(I)},50);break;case"f":this.toggleFullscreen();break;case"h":this.toggleControlPanel();break}}setupTouchEvents(){let P=0,T=0;document.addEventListener("touchend",L=>{const R=L.changedTouches[0],I=window.innerWidth,F=window.innerHeight,D=R.clientX,V=R.clientY;if(D>I-200&&V>F-200){const q=Date.now();q-T<800?P++:P=1,T=q,P>=5&&(P=0,this.state.showFPS=!this.state.showFPS,this.updateFPSDisplay(),this.showFPSCheckbox&&(this.showFPSCheckbox.checked=this.state.showFPS),this.saveBackgroundSettings(),this.gui&&(this.gui.domElement.style.display=this.gui.domElement.style.display==="none"?"block":"none"),this.stats.dom.style.display=this.stats.dom.style.display==="none"?"block":"none")}else P=0},{passive:!0})}resetPlayer(){this.resetUploadButtons(),Object.assign(this.state,cloneDefaultState()),this.audio.pause(),this.audio.currentTime=0,this.audio.src="",this.state.musicUrl="",this.state.isPlaying=!1,this.state.manualDominantColor=null,this.state.manualDominantColorLight=null,this.state.manualDominantColorDark=null,this.playControls&&(this.playControls.style.bottom="10px",this.playControls.style.opacity="1"),this.progressBar&&(this.progressBar.style.width="72vw"),this.hasLyrics=!1,this.lyricPlayer.setLyricLines([]),this.updateLyricAreaHint(),this.updateFileInputDisplay("musicFile",""),this.updateFileInputDisplay("coverFile",""),this.updateFileInputDisplay("lyricFile",""),this.background.setAlbum(DEFAULT_AMLL_COVER_URL),this.setDefaultColors(),this.isColorsInitialized=!1,this.initColors(),this.state.roundedCover=DEFAULT_PLAYER_STATE.roundedCover,this.updateRoundedCover(),this.state.backgroundRenderScale=DEFAULT_PLAYER_STATE.backgroundRenderScale;const P=window.devicePixelRatio||1;this.background.setRenderScale(this.state.backgroundRenderScale*P),this.state.lyricAlignPosition=DEFAULT_PLAYER_STATE.lyricAlignPosition,this.lyricPlayer.setAlignPosition(this.state.lyricAlignPosition),this.state.hidePassedLyrics=DEFAULT_PLAYER_STATE.hidePassedLyrics,this.lyricPlayer.setHidePassedLines(this.state.hidePassedLyrics),this.state.enableLyricBlur=DEFAULT_PLAYER_STATE.enableLyricBlur,this.lyricPlayer.setEnableBlur(this.state.enableLyricBlur),this.state.enableLyricScale=DEFAULT_PLAYER_STATE.enableLyricScale,this.lyricPlayer.setEnableScale(this.state.enableLyricScale),this.state.enableLyricSpring=DEFAULT_PLAYER_STATE.enableLyricSpring,this.lyricPlayer.setEnableSpring(this.state.enableLyricSpring),this.state.wordFadeWidth=DEFAULT_PLAYER_STATE.wordFadeWidth,this.lyricPlayer.setWordFadeWidth(this.state.wordFadeWidth),this.state.backgroundFPS=DEFAULT_PLAYER_STATE.backgroundFPS,this.background.setFPS(this.state.backgroundFPS),this.state.showTranslatedLyric=DEFAULT_PLAYER_STATE.showTranslatedLyric,this.state.showRomanLyric=DEFAULT_PLAYER_STATE.showRomanLyric,this.state.swapLyricPositions=DEFAULT_PLAYER_STATE.swapLyricPositions,this.state.showbgLyric=DEFAULT_PLAYER_STATE.showbgLyric,this.state.swapDuetsPositions=DEFAULT_PLAYER_STATE.swapDuetsPositions,this.state.singleLyrics=DEFAULT_PLAYER_STATE.singleLyrics,this.state.backgroundLowFreqVolume=DEFAULT_PLAYER_STATE.backgroundLowFreqVolume,this.background.setLowFreqVolume(this.state.backgroundLowFreqVolume),this.state.coverStyle=DEFAULT_PLAYER_STATE.coverStyle,this.state.lyricUrl="",this.state.songTitle="",this.state.songArtist="",this.state.coverUrl="",document.title="AMLL Web Player",this.controlPointCodeInput&&(this.controlPointCodeInput.value="");const T=this.background.renderer;T&&T instanceof hi&&(T.manualControl=!1),this.albumCoverLarge&&(this.albumCoverLarge.src=DEFAULT_AMLL_COVER_URL),this.songTitle&&(this.songTitle.textContent=t$3("title")),this.songArtist&&(this.songArtist.textContent=t$3("artist")),this.songTitleInput&&(this.songTitleInput.value=""),this.songArtistInput&&(this.songArtistInput.value=""),this.updateMediaSessionMetadata();const L=["musicFile","musicUrl","lyricFile","lyricUrl","coverFile","coverUrl","songTitleInput","songArtistInput","lyricDelayInput"];if(this.loopPlayCheckbox&&(this.state.loopPlay=DEFAULT_PLAYER_STATE.loopPlay,this.loopPlayCheckbox.checked=this.state.loopPlay),this.lyricAlignPositionValue&&(this.lyricAlignPositionValue.textContent="0.5"),this.enableLyricBlur&&(this.enableLyricBlur.checked=this.state.enableLyricBlur),this.enableLyricScale&&(this.enableLyricScale.checked=this.state.enableLyricScale),this.enableLyricSpring&&(this.enableLyricSpring.checked=this.state.enableLyricSpring),this.showbgLyricCheckbox&&(this.showbgLyricCheckbox.checked=this.state.showbgLyric),this.swapDuetsPositionsCheckbox&&(this.swapDuetsPositionsCheckbox.checked=this.state.swapDuetsPositions),this.singleLyricsCheckbox&&(this.singleLyricsCheckbox.checked=this.state.singleLyrics),this.bgLowFreqVolume&&(this.bgLowFreqVolume.value=DEFAULT_PLAYER_STATE.backgroundLowFreqVolume.toString()),this.bgLowFreqVolumeValue){const R=I=>`${(80+I*40).toFixed(0)}hz`;this.bgLowFreqVolumeValue.textContent=R(DEFAULT_PLAYER_STATE.backgroundLowFreqVolume)}if(this.posYSpringMassInput&&(this.posYSpringMassInput.value=DEFAULT_PLAYER_STATE.posYSpringMass.toString()),this.springPosYMassValue&&(this.springPosYMassValue.textContent=DEFAULT_PLAYER_STATE.posYSpringMass.toString()),this.posYSpringDampingInput&&(this.posYSpringDampingInput.value=DEFAULT_PLAYER_STATE.posYSpringDamping.toString()),this.springPosYDampingValue&&(this.springPosYDampingValue.textContent=DEFAULT_PLAYER_STATE.posYSpringDamping.toString()),this.posYSpringStiffnessInput&&(this.posYSpringStiffnessInput.value=DEFAULT_PLAYER_STATE.posYSpringStiffness.toString()),this.springPosYStiffnessValue&&(this.springPosYStiffnessValue.textContent=DEFAULT_PLAYER_STATE.posYSpringStiffness.toString()),this.posYSpringSoftCheckbox&&(this.posYSpringSoftCheckbox.checked=DEFAULT_PLAYER_STATE.posYSpringSoft),this.scaleSpringMassInput&&(this.scaleSpringMassInput.value=DEFAULT_PLAYER_STATE.scaleSpringMass.toString()),this.springScaleMassValue&&(this.springScaleMassValue.textContent=DEFAULT_PLAYER_STATE.scaleSpringMass.toString()),this.scaleSpringDampingInput&&(this.scaleSpringDampingInput.value=DEFAULT_PLAYER_STATE.scaleSpringDamping.toString()),this.springScaleDampingValue&&(this.springScaleDampingValue.textContent=DEFAULT_PLAYER_STATE.scaleSpringDamping.toString()),this.scaleSpringStiffnessInput&&(this.scaleSpringStiffnessInput.value=DEFAULT_PLAYER_STATE.scaleSpringStiffness.toString()),this.springScaleStiffnessValue&&(this.springScaleStiffnessValue.textContent=DEFAULT_PLAYER_STATE.scaleSpringStiffness.toString()),this.scaleSpringSoftCheckbox&&(this.scaleSpringSoftCheckbox.checked=DEFAULT_PLAYER_STATE.scaleSpringSoft),this.controlPointCodeInput&&(this.controlPointCodeInput.value=""),this.background&&this.background.renderer&&typeof this.background.renderer.setControlPoints=="function")try{this.background.renderer.setControlPoints([])}catch(R){console.error("Failed to reset control points:",R)}if(this.playbackRateControl){const R=DEFAULT_PLAYER_STATE.playbackRate;this.playbackRateControl.value=R.toString(),this.audio.playbackRate=R,this.state.playbackRate=R,this.playbackRateValue&&(this.playbackRateValue.textContent=`${R.toFixed(2)}x`),this.updatePlaybackRateIcon(R)}if(this.volumeControl){const R=DEFAULT_PLAYER_STATE.volume;this.volumeControl.value=R.toString(),this.audio.volume=R/100,this.state.volume=R,this.volumeValue&&(this.volumeValue.textContent=`${Math.round(R)}%`),this.updateVolumeIcon(Math.round(R))}this.showFPSCheckbox&&(this.showFPSCheckbox.checked=!1),this.controlPanel&&(this.controlPanel.style.width="320px",this.controlPanel.style.right="20px",this.controlPanel.style.opacity="1"),this.musicUrl&&(this.musicUrl.value=""),this.lyricUrl&&(this.lyricUrl.value=""),this.coverUrl&&(this.coverUrl.value=""),L.forEach(R=>{R==="musicUrl"||R==="lyricUrl"||R==="coverUrl"||(R==="musicFile"&&this.musicFile?this.musicFile.value="":R==="lyricFile"&&this.lyricFile?this.lyricFile.value="":R==="coverFile"&&this.coverFile?this.coverFile.value="":R==="songTitleInput"&&this.songTitleInput?this.songTitleInput.value="":R==="songArtistInput"&&this.songArtistInput?this.songArtistInput.value="":R==="lyricDelayInput"&&this.lyricDelayInput&&(this.lyricDelayInput.value=""))}),this.showTranslatedLyricCheckbox&&(this.showTranslatedLyricCheckbox.checked=this.state.showTranslatedLyric),this.showRomanLyricCheckbox&&(this.showRomanLyricCheckbox.checked=this.state.showRomanLyric),this.swapLyricPositionsCheckbox&&(this.swapLyricPositionsCheckbox.checked=this.state.swapLyricPositions),this.updateLyricsDisplay(),this.adjustLyricPosition(),this.updatePlayButton(),localStorage.removeItem(SETTINGS_STORAGE_KEY),this.updateBackgroundUI(),this.updateBackground(),this.updateFPSDisplay(),this.progressFill&&(this.progressFill.style.width="0%"),this.landscapeProgressFill&&(this.landscapeProgressFill.style.width="0%"),this.updateProgress(),this.updateTimeDisplay(),this.updateCoverRotation(),this.showStatus(t$3("playerReset"))}setupMediaSessionHandlers(){"mediaSession"in navigator&&(navigator.mediaSession.setActionHandler("play",()=>{this.audio.play()}),navigator.mediaSession.setActionHandler("pause",()=>{this.audio.pause()}),navigator.mediaSession.setActionHandler("seekbackward",P=>{const T=P.seekOffset||10;let L=Math.max(this.audio.currentTime-T,0);this.state.isRangeMode&&this.state.rangeStartTime!==void 0&&this.state.rangeEndTime!==void 0&&(L=Math.max(this.state.rangeStartTime,Math.min(this.state.rangeEndTime,L))),this.audio.currentTime=L;const R=this.findNextLyricLineStartTime(L*1e3);this.lyricPlayer.setCurrentTime(R),setTimeout(()=>{const I=L*1e3+this.state.lyricDelay;this.lyricPlayer.setCurrentTime(I)},50)}),navigator.mediaSession.setActionHandler("seekforward",P=>{const T=P.seekOffset||10;let L=Math.min(this.audio.currentTime+T,this.audio.duration);this.state.isRangeMode&&this.state.rangeStartTime!==void 0&&this.state.rangeEndTime!==void 0&&(L=Math.max(this.state.rangeStartTime,Math.min(this.state.rangeEndTime,L))),this.audio.currentTime=L;const R=this.findNextLyricLineStartTime(L*1e3);this.lyricPlayer.setCurrentTime(R),setTimeout(()=>{const I=L*1e3+this.state.lyricDelay;this.lyricPlayer.setCurrentTime(I)},50)}),navigator.mediaSession.setActionHandler("seekto",P=>{if(P.seekTime!==void 0){let T=P.seekTime;this.state.isRangeMode&&this.state.rangeStartTime!==void 0&&this.state.rangeEndTime!==void 0&&(T=Math.max(this.state.rangeStartTime,Math.min(this.state.rangeEndTime,T))),this.audio.currentTime=T;const L=this.findNextLyricLineStartTime(T*1e3);this.lyricPlayer.setCurrentTime(L),setTimeout(()=>{const R=T*1e3+this.state.lyricDelay;this.lyricPlayer.setCurrentTime(R)},50)}}),navigator.mediaSession.setActionHandler("previoustrack",()=>{const P=this.state.isRangeMode&&this.state.rangeStartTime!==void 0?this.state.rangeStartTime:0;if(this.audio.currentTime=P,this.processedLyricLines&&this.processedLyricLines.length>0){const T=this.findNextLyricLineStartTime(P*1e3);this.lyricPlayer.setCurrentTime(T),setTimeout(()=>{const L=P*1e3+this.state.lyricDelay;this.lyricPlayer.setCurrentTime(L)},50)}}),navigator.mediaSession.setActionHandler("nexttrack",null))}updateMediaSessionMetadata(){if("mediaSession"in navigator){const P=resolveDefaultCover(this.state.coverUrl);navigator.mediaSession.metadata=new MediaMetadata({title:this.state.songTitle||t$3("title"),artist:this.state.songArtist||t$3("artist"),album:"",artwork:[{src:P,sizes:"96x96",type:"image/png"},{src:P,sizes:"128x128",type:"image/png"},{src:P,sizes:"192x192",type:"image/png"},{src:P,sizes:"256x256",type:"image/png"},{src:P,sizes:"384x384",type:"image/png"},{src:P,sizes:"512x512",type:"image/png"}]})}}refreshMediaSession(){"mediaSession"in navigator&&(navigator.mediaSession.setActionHandler("play",null),navigator.mediaSession.setActionHandler("pause",null),navigator.mediaSession.setActionHandler("seekbackward",null),navigator.mediaSession.setActionHandler("seekforward",null),navigator.mediaSession.setActionHandler("seekto",null),navigator.mediaSession.setActionHandler("previoustrack",null),navigator.mediaSession.setActionHandler("nexttrack",null),navigator.mediaSession.metadata=null,setTimeout(()=>{this.updateMediaSessionMetadata(),"mediaSession"in navigator&&(navigator.mediaSession.playbackState=this.state.isPlaying?"playing":"paused")},50),setTimeout(()=>{this.setupMediaSessionHandlers()},100))}updateSongInfo(){this.state.coverUrl&&this.landscapeCover?this.landscapeCover.style.backgroundImage=`url(${this.state.coverUrl})`:this.landscapeCover&&(this.landscapeCover.style.backgroundImage="none"),this.updateAlbumSidePanel(),this.adjustLyricPosition(),this.updateMediaSessionMetadata(),this.updateMarqueeSettings(),this.state.songTitle&&(this.state.songArtist?document.title=`${this.state.songArtist} - ${this.state.songTitle} | AMLL Web Player`:document.title=`${this.state.songTitle} | AMLL Web Player`)}adjustLyricPosition(){const P=this.lyricPlayer.getElement();P&&(window.matchMedia("(min-width: 769px), (orientation: landscape)").matches?P.style.paddingTop="20px":P.style.paddingTop="120px",this.updateLyricAreaHint())}updateAlbumSidePanel(){this.albumCoverLarge&&this.songTitle&&this.songArtist&&(this.state.coverUrl?this.albumCoverLarge.src=this.state.coverUrl:this.albumCoverLarge.src=DEFAULT_AMLL_COVER_URL,this.songTitle.textContent=this.state.songTitle||t$3("title"),this.songArtist.textContent=this.state.songArtist||t$3("artist"),this.updateMarqueeSettings())}handleRangeSelection(P){if(!this.progressBar||!this.state.duration)return;let T;if(P instanceof MouseEvent)T=P.clientX;else if(P instanceof TouchEvent&&P.touches.length>0)T=P.touches[0].clientX;else return;const L=this.progressBar.getBoundingClientRect(),I=Math.max(0,Math.min(1,(T-L.left)/L.width))*this.state.duration;if(this.rangeSelectionCount>=2&&this.clearRangeSelection(),this.rangeSelectionCount===0)this.state.rangeStartTime=I,this.createRangeLine(!0,I);else{if(this.state.rangeEndTime=I,this.createRangeLine(!1,I),this.state.rangeStartTime>this.state.rangeEndTime){const F=this.state.rangeStartTime;if(this.state.rangeStartTime=this.state.rangeEndTime,this.state.rangeEndTime=F,this.rangeStartLine&&this.rangeEndLine){const D=this.rangeStartLine.style.left;this.rangeStartLine.style.left=this.rangeEndLine.style.left,this.rangeEndLine.style.left=D}}this.state.isRangeMode=!0,this.createRangeProgressBar(),this.updateTimeDisplay(),this.audio&&(this.audio.currentTime=this.state.rangeStartTime)}this.rangeSelectionCount++}createRangeLine(P,T){if(!this.progressBar||!this.state.duration)return;const L=T/this.state.duration*100,R=document.createElement("div");R.style.cssText=`
      position: absolute;
      top: 0;
      bottom: 0;
      width: 1px;
      background-color: ${P?"#4CAF50":"#FF5252"};
      left: ${L}%;
      cursor: pointer;
    `,R.addEventListener("click",I=>{I.stopPropagation(),this.exitRangeMode()}),this.addLongPressAndRightClickHandler(R,()=>{this.exitRangeMode()}),P?this.rangeStartLine=R:this.rangeEndLine=R,this.progressBar.appendChild(R)}createRangeProgressBar(){if(!this.progressBar||!this.state.duration||this.state.rangeEndTime<=this.state.rangeStartTime)return;const P=this.state.rangeStartTime/this.state.duration*100,L=this.state.rangeEndTime/this.state.duration*100-P,R=document.createElement("div");R.style.cssText=`
      position: absolute;
      top: 0;
      height: 100%;
      left: ${P}%;
      width: ${L}%;
      z-index: 5;
    `,this.rangeProgressBar=R,this.progressBar.appendChild(R)}clearRangeSelection(){this.rangeStartLine&&this.rangeStartLine.parentNode&&(this.rangeStartLine.parentNode.removeChild(this.rangeStartLine),this.rangeStartLine=null),this.rangeEndLine&&this.rangeEndLine.parentNode&&(this.rangeEndLine.parentNode.removeChild(this.rangeEndLine),this.rangeEndLine=null),this.rangeProgressBar&&this.rangeProgressBar.parentNode&&(this.rangeProgressBar.parentNode.removeChild(this.rangeProgressBar),this.rangeProgressBar=null),this.rangeSelectionCount=0}exitRangeMode(){this.state.isRangeMode=!1,this.clearRangeSelection(),this.state.rangeStartTime=0,this.state.rangeEndTime=0,this.updateProgress(),this.updateTimeDisplay()}async parseAudioMetadata(P){try{console.log("Parsing audio metadata, file:",P.name,"size:",P.size);const T=window.jsmediatags;T?T.read(P,{onSuccess:L=>{console.log("Audio metadata parsed successfully, full data:",L),console.log("tags:",L.tags);let R=!1;if(L.tags&&L.tags.title&&(this.state.songTitle=L.tags.title,this.songTitleInput&&(this.songTitleInput.value=L.tags.title),console.log("Extracted song title:",L.tags.title),R=!0),L.tags&&L.tags.artist&&(this.state.songArtist=L.tags.artist,this.songArtistInput&&(this.songArtistInput.value=L.tags.artist),console.log("Extracted song artist:",L.tags.artist),R=!0),L.tags&&L.tags.picture){console.log("Found cover image:",L.tags.picture);const{data:I,format:F}=L.tags.picture;let D="";for(let q=0;q<I.length;q++)D+=String.fromCharCode(I[q]);const V=`data:${F};base64,${window.btoa(D)}`;if(this.state.coverUrl=V,this.coverUrl)if(V.length>65536){const G=`data:${F};base64,`,z=65536-G.length;let Q=G+V.substring(G.length,G.length+z);for(;Q.length%4!==0;)Q=Q.substring(0,Q.length-1);this.coverUrl.value=Q}else this.coverUrl.value=V;this.background.setAlbum(resolveDefaultCover(V)),this.extractAndProcessCoverColor(V),this.applyDominantColorAsCSSVariable(),this.updateBackground(),this.updateFileInputDisplay("coverFile",`Base64 Encoded Input (Embedded ${F})`),console.log("Extracted cover image, format:",F,"size:",I.length),R=!0}this.updateSongInfo(),this.updateMediaSessionMetadata(),R?this.showStatus(t$3("metadataParseSuccess")):this.parseAudioMetadataFallback(P)},onError:L=>{this.showStatus(t$3("metadataParseFailed"),!0),this.parseAudioMetadataFallback(P)}}):(console.log("jsmediatags library not loaded"),this.showStatus(t$3("metadataLibNotLoaded"),!0),this.parseAudioMetadataFallback(P))}catch{this.showStatus(t$3("metadataParseError"),!0),this.parseAudioMetadataFallback(P)}}async parseAudioMetadataFallback(P){try{const L=P.name.replace(/\.[^/.]+$/,""),R=L.split(" - ");if(R.length>=2)this.state.songArtist=R[0].trim(),this.state.songTitle=R[1].trim(),this.songArtistInput&&(this.songArtistInput.value=this.state.songArtist),this.songTitleInput&&(this.songTitleInput.value=this.state.songTitle),console.log("Parsing from filename:",{artist:this.state.songArtist,title:this.state.songTitle}),this.updateSongInfo(),this.updateMediaSessionMetadata(),this.showStatus(t$3("extractedSongInfo"));else{const I=L.split(" – ");I.length>=2?(this.state.songArtist=I[0].trim(),this.state.songTitle=I[1].trim(),this.songArtistInput&&(this.songArtistInput.value=this.state.songArtist),this.songTitleInput&&(this.songTitleInput.value=this.state.songTitle),console.log("Parsing from filename (long dash):",{artist:this.state.songArtist,title:this.state.songTitle}),this.updateSongInfo(),this.updateMediaSessionMetadata(),this.showStatus(t$3("extractedSongInfo"))):(this.state.songTitle=L,this.songTitleInput&&(this.songTitleInput.value=this.state.songTitle),this.updateSongInfo(),this.updateMediaSessionMetadata(),this.showStatus(t$3("usedFilenameAsTitle")))}try{const I=new(window.AudioContext||window.webkitAudioContext),F=await P.arrayBuffer(),D=await I.decodeAudioData(F);console.log("Audio info:",{duration:D.duration,sampleRate:D.sampleRate,numberOfChannels:D.numberOfChannels})}catch(I){console.log("Web Audio API parsing failed:",I)}}catch(T){console.log("Fallback parsing method failed:",T),this.showStatus(t$3("cannotParseAudioInfo"),!0)}}showStatus(P,T=!1){this.status&&this.statusText&&(this.statusText.textContent=P,this.status.style.display="block",T?this.status.style.background="rgba(255, 0, 0, 0.9)":this.status.style.background="var(--dominant-color-dark)",setTimeout(()=>{this.status&&(this.status.style.display="none")},3e3))}addLongPressAndRightClickHandler(P,T,L=3e3){if(!P)return;let R;P.addEventListener("mousedown",I=>{R=window.setTimeout(()=>T(I),L)}),P.addEventListener("mouseup",()=>{clearTimeout(R)}),P.addEventListener("mouseleave",()=>{clearTimeout(R)}),P.addEventListener("contextmenu",I=>(I.preventDefault(),T(I),!1)),P.addEventListener("touchstart",I=>{R=window.setTimeout(()=>{T(I)},L)},{passive:!0}),P.addEventListener("touchend",I=>{clearTimeout(R)}),P.addEventListener("touchcancel",()=>{clearTimeout(R)},{passive:!0})}showAutoPlayHint(){const P=document.createElement("div");P.style.cssText=`
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--dominant-color-dark);
      color: white;
      padding: 20px;
      border-radius: 10px;
      z-index: 100;
      text-align: center;
      max-width: 300px;
      font-size: 14px;
    `,P.innerHTML=`
      <div style="margin-bottom: 15px; font-size: 16px;">[INFO] 自动播放提示</div>
      <div style="margin-bottom: 15px;">由于浏览器安全策略，需要用户交互才能自动播放音频。</div>
      <div style="margin-bottom: 15px;">请点击播放按钮开始播放。</div>
      <button onclick="this.parentElement.remove()" title="Got it" style="
        background: #007bff;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 5px;
        cursor: pointer;
      ">知道了</button>
    `,document.body.appendChild(P),setTimeout(()=>{P.parentElement&&P.remove()},3e3)}loadFromURLParams(){this.urlOverrides.clear();const P=new URLSearchParams(window.location.search),T=P.get("music"),L=P.get("lyric"),R=P.get("cover"),I=P.get("title"),F=P.get("artist"),D=P.has("auto"),V=P.get("auto")==="1"||P.get("auto")==="true",q=P.get("x"),G=P.get("ms"),z=P.get("vol"),Q=P.has("loop"),tt=Q?P.get("loop")==="1"||P.get("loop")==="true":!0,gt=P.get("t"),yt=P.get("te");let Et=!1;if(T||this.controlPanel&&(this.controlPanel.style.width="320px",this.controlPanel.style.right="20px",this.controlPanel.style.opacity="1"),T&&(this.urlOverrides.add("musicUrl"),this.urlOverrides.add("musicUrlInput"),this.state.musicUrl=T,this.musicUrl&&(this.musicUrl.value=T),Et=!0),L&&(this.urlOverrides.add("lyricUrl"),this.urlOverrides.add("lyricUrlInput"),this.state.lyricUrl=L,this.lyricUrl&&(this.lyricUrl.value=L),Et=!0),R&&(this.urlOverrides.add("coverUrl"),this.urlOverrides.add("coverUrlInput"),this.state.coverUrl=R,this.coverUrl&&(this.coverUrl.value=R),Et=!0),I&&(this.urlOverrides.add("songTitle"),this.urlOverrides.add("songTitleInput"),this.songTitleInput&&(this.songTitleInput.value=I),this.state.songTitle=I,F?document.title=`${F} - ${I} | AMLL Web Player`:document.title=`${I} | AMLL Web Player`),F&&(this.urlOverrides.add("songArtist"),this.urlOverrides.add("songArtistInput"),this.songArtistInput&&(this.songArtistInput.value=F),this.state.songArtist=F),q){const J=parseFloat(q);!isNaN(J)&&J>0&&this.playbackRateControl&&(this.playbackRateControl.value=J.toString(),this.audio&&(this.audio.playbackRate=J),this.playbackRateValue&&(this.playbackRateValue.textContent=J.toFixed(2)+"x"),this.updatePlaybackRateIcon(J),this.state.playbackRate=J,Et=!0,this.urlOverrides.add("playbackRate"))}if(G){const J=parseInt(G);isNaN(J)||(this.lyricDelayInput&&(this.lyricDelayInput.value=J.toString()),this.applyLyricDelay(J,{skipSave:!0}),this.urlOverrides.add("lyricDelay"),Et=!0)}if(z){const J=parseFloat(z);if(!isNaN(J)){let At;J>1&&J<=100?At=J/100:J>=0&&J<=1?At=J:At=.5,this.volumeControl&&(this.volumeControl.value=Math.round(At*100).toString(),this.audio&&(this.audio.volume=At),this.volumeValue&&(this.volumeValue.textContent=Math.round(At*100)+"%"),this.updateVolumeIcon(Math.round(At*100)),this.state.volume=Math.round(At*100),Et=!0,this.urlOverrides.add("volume"))}}if(Q&&this.loopPlayCheckbox&&(this.loopPlayCheckbox.checked=tt,this.state.loopPlay=tt,Et=!0,this.urlOverrides.add("loopPlay")),D&&(this.state.autoPlay=V,this.urlOverrides.add("autoPlay"),Et=!0),gt&&(this.urlOverrides.add("rangeStartTime"),Et=!0),yt&&(this.urlOverrides.add("rangeEndTime"),this.urlOverrides.add("isRangeMode"),Et=!0),(T||L||R||I||F)&&this.updateSongInfo(),Et&&this.saveBackgroundSettings(),T||L||R){this.loadFromURLs().then(()=>{if(gt&&this.audio){const J=parseFloat(gt);!isNaN(J)&&J>=0&&(this.audio.currentTime=J,this.state.rangeStartTime=J)}if(yt){const J=parseFloat(yt);!isNaN(J)&&J!==0&&(!gt||parseFloat(gt)<=J)&&(this.state.rangeEndTime=J,this.state.isRangeMode=!0)}(D?V:this.state.autoPlay)&&this.audio&&this.audio.play().catch(()=>{this.showAutoPlayHint()})});return}if(gt&&this.audio){const J=parseFloat(gt);!isNaN(J)&&J>=0&&(this.audio.currentTime=J)}}start(){this.loadFromURLParams(),this.loadBackgroundSettings(),this.startAnimationLoop(),this.background.resume(),new URLSearchParams(window.location.search).has("music")||(this.playControls&&(this.playControls.style.bottom="10px",this.playControls.style.opacity="1"),this.progressBar&&(this.progressBar.style.width="72vw")),this.isInitialized=!0,this.initAlbumCoverEffects()}startAnimationLoop(){let P=-1;const T=L=>{this.stats.end(),P===-1&&(P=L),this.lyricPlayer.update(L-P),P=L,this.stats.begin(),requestAnimationFrame(T)};requestAnimationFrame(T)}getAudio(){return this.audio}getLyricPlayer(){return this.lyricPlayer}getBackground(){return this.background}async extractAndProcessCoverColor(P){try{const T=new Image;!P.startsWith("data:image/")&&!P.startsWith("blob:")&&(T.crossOrigin="Anonymous"),await new Promise((Q,tt)=>{T.onload=()=>Q(),T.onerror=()=>tt(new Error("Failed to load image")),T.src=P});const[L,R,I]=this.colorThief.getColor(T),F=this.rgbToHsl(L,R,I);F[2]=.8;const[D,V,q]=this.hslToRgb(F[0],F[1],F[2]);this.dominantColor=this.rgbToHex(D,V,q);const z=(.299*L+.587*R+.114*I)/255>=.5;this.applyDominantColorAsCSSVariable(),this.invertColorsCheckbox&&this.state.backgroundType==="cover"&&(this.state.originalInvertColors===null&&this.state.originalInvertColors===void 0?(this.invertColorsCheckbox.checked=z,this.invertColors(z)):(this.invertColorsCheckbox.checked=this.state.originalInvertColors,this.invertColors(this.state.originalInvertColors)))}catch{this.setDefaultColors(),this.applyDominantColorAsCSSVariable()}}rgbToHsl(P,T,L){P/=255,T/=255,L/=255;const R=Math.max(P,T,L),I=Math.min(P,T,L);let F=0,D,V=(R+I)/2;if(R===I)F=D=0;else{const q=R-I;switch(D=V>.5?q/(2-R-I):q/(R+I),R){case P:F=(T-L)/q+(T<L?6:0);break;case T:F=(L-P)/q+2;break;case L:F=(P-T)/q+4;break}F/=6}return[F,D,V]}hslToRgb(P,T,L){let R,I,F;if(T===0)R=I=F=L;else{const D=(G,z,Q)=>(Q<0&&(Q+=1),Q>1&&(Q-=1),Q<.16666666666666666?G+(z-G)*6*Q:Q<.5?z:Q<.6666666666666666?G+(z-G)*(.6666666666666666-Q)*6:G),V=L<.5?L*(1+T):L+T-L*T,q=2*L-V;R=D(q,V,P+1/3),I=D(q,V,P),F=D(q,V,P-1/3)}return[Math.round(R*255),Math.round(I*255),Math.round(F*255)]}rgbToHex(P,T,L){return"#"+[P,T,L].map(R=>{const I=R.toString(16);return I.length===1?"0"+I:I}).join("")}hexToRgb(P){const T=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(P);return T?{r:parseInt(T[1],16),g:parseInt(T[2],16),b:parseInt(T[3],16)}:null}lightenColor(P,T){const L=parseInt(P.replace("#",""),16),R=Math.round(2.55*T*100),I=(L>>16)+R,F=(L>>8&255)+R,D=(L&255)+R;return"#"+(16777216+(I<255?I<1?0:I:255)*65536+(F<255?F<1?0:F:255)*256+(D<255?D<1?0:D:255)).toString(16).slice(1)}darkenColor(P,T){const L=parseInt(P.replace("#",""),16),R=Math.round(2.55*T*100),I=(L>>16)-R,F=(L>>8&255)-R,D=(L&255)-R;return"#"+(16777216+(I>255?255:I<0?0:I)*65536+(F>255?255:F<0?0:F)*256+(D>255?255:D<0?0:D)).toString(16).slice(1)}saveBackgroundSettings(){const P={backgroundType:this.state.backgroundType,backgroundDynamic:this.state.backgroundDynamic,backgroundFlowSpeed:this.state.backgroundFlowSpeed,backgroundColorMask:this.state.backgroundColorMask,backgroundMaskColor:this.state.backgroundMaskColor,backgroundMaskOpacity:this.state.backgroundMaskOpacity,showFPS:this.state.showFPS,coverBlurLevel:this.state.coverBlurLevel,invertColors:this.state.invertColors,manualDominantColor:this.state.manualDominantColor,manualDominantColorLight:this.state.manualDominantColorLight,manualDominantColorDark:this.state.manualDominantColorDark,marqueeEnabled:this.state.marqueeEnabled,roundedCover:this.state.roundedCover,coverRotationSpeed:this.state.coverRotationSpeed,backgroundRenderScale:this.state.backgroundRenderScale,lyricAlignPosition:this.state.lyricAlignPosition,lyricDelay:this.state.lyricDelay,hidePassedLyrics:this.state.hidePassedLyrics,enableLyricBlur:this.state.enableLyricBlur,enableLyricScale:this.state.enableLyricScale,enableLyricSpring:this.state.enableLyricSpring,wordFadeWidth:this.state.wordFadeWidth,lyricAlignAnchor:this.state.lyricAlignAnchor,showTranslatedLyric:this.state.showTranslatedLyric,showRomanLyric:this.state.showRomanLyric,swapLyricPositions:this.state.swapLyricPositions,showbgLyric:this.state.showbgLyric,swapDuetsPositions:this.state.swapDuetsPositions,advanceLyricTiming:this.state.advanceLyricTiming,singleLyrics:this.state.singleLyrics,backgroundLowFreqVolume:this.state.backgroundLowFreqVolume,coverStyle:this.state.coverStyle,fftDataRangeMin:this.state.fftDataRangeMin,fftDataRangeMax:this.state.fftDataRangeMax,posYSpringMass:this.state.posYSpringMass,backgroundFPS:this.state.backgroundFPS,posYSpringDamping:this.state.posYSpringDamping,posYSpringStiffness:this.state.posYSpringStiffness,posYSpringSoft:this.state.posYSpringSoft,scaleSpringMass:this.state.scaleSpringMass,scaleSpringDamping:this.state.scaleSpringDamping,scaleSpringStiffness:this.state.scaleSpringStiffness,scaleSpringSoft:this.state.scaleSpringSoft,playbackRate:this.state.playbackRate,volume:this.state.volume,loopPlay:this.state.loopPlay,showRemainingTime:this.state.showRemainingTime,autoPlay:this.state.autoPlay,musicUrl:this.state.musicUrl,lyricUrl:this.state.lyricUrl,coverUrl:this.state.coverUrl,songTitle:this.state.songTitle,songArtist:this.state.songArtist,musicUrlInput:this.musicUrl?.value||"",lyricUrlInput:this.lyricUrl?.value||"",coverUrlInput:this.coverUrl?.value||"",songTitleInput:this.songTitleInput?.value||"",songArtistInput:this.songArtistInput?.value||"",isRangeMode:this.state.isRangeMode,rangeStartTime:this.state.rangeStartTime,rangeEndTime:this.state.rangeEndTime,controlPointCode:this.controlPointCodeInput?.value||""};localStorage.setItem(SETTINGS_STORAGE_KEY,JSON.stringify(P))}loadBackgroundSettings(){try{const P=localStorage.getItem(SETTINGS_STORAGE_KEY);if(P){const T=JSON.parse(P),L=DEFAULT_PLAYER_STATE;this.state.backgroundType=typeof T.backgroundType=="string"?T.backgroundType:L.backgroundType,this.state.backgroundDynamic=typeof T.backgroundDynamic=="boolean"?T.backgroundDynamic:L.backgroundDynamic,this.state.backgroundFlowSpeed=typeof T.backgroundFlowSpeed=="number"?T.backgroundFlowSpeed:L.backgroundFlowSpeed,this.state.backgroundColorMask=typeof T.backgroundColorMask=="boolean"?T.backgroundColorMask:L.backgroundColorMask,this.state.backgroundMaskColor=typeof T.backgroundMaskColor=="string"?T.backgroundMaskColor:L.backgroundMaskColor,this.state.backgroundMaskOpacity=typeof T.backgroundMaskOpacity=="number"?T.backgroundMaskOpacity:L.backgroundMaskOpacity,this.state.showFPS=typeof T.showFPS=="boolean"?T.showFPS:L.showFPS,this.state.coverBlurLevel=typeof T.coverBlurLevel=="number"?T.coverBlurLevel:L.coverBlurLevel,this.state.invertColors=typeof T.invertColors=="boolean"?T.invertColors:L.invertColors,this.state.originalInvertColors=this.state.invertColors,this.state.manualDominantColor=typeof T.manualDominantColor=="string"?T.manualDominantColor:L.manualDominantColor,this.state.manualDominantColorLight=typeof T.manualDominantColorLight=="string"?T.manualDominantColorLight:L.manualDominantColorLight,this.state.manualDominantColorDark=typeof T.manualDominantColorDark=="string"?T.manualDominantColorDark:L.manualDominantColorDark,this.state.roundedCover=typeof T.roundedCover=="number"?T.roundedCover:L.roundedCover,this.state.marqueeEnabled=typeof T.marqueeEnabled=="boolean"?T.marqueeEnabled:L.marqueeEnabled,this.state.coverRotationSpeed=typeof T.coverRotationSpeed=="number"?T.coverRotationSpeed:L.coverRotationSpeed,this.state.backgroundRenderScale=typeof T.backgroundRenderScale=="number"?T.backgroundRenderScale:L.backgroundRenderScale,this.state.lyricAlignPosition=typeof T.lyricAlignPosition=="number"?T.lyricAlignPosition:L.lyricAlignPosition,this.urlOverrides.has("lyricDelay")||(this.state.lyricDelay=typeof T.lyricDelay=="number"?T.lyricDelay:L.lyricDelay),this.state.hidePassedLyrics=typeof T.hidePassedLyrics=="boolean"?T.hidePassedLyrics:L.hidePassedLyrics,this.state.enableLyricBlur=typeof T.enableLyricBlur=="boolean"?T.enableLyricBlur:L.enableLyricBlur,this.state.enableLyricScale=typeof T.enableLyricScale=="boolean"?T.enableLyricScale:L.enableLyricScale,this.state.enableLyricSpring=typeof T.enableLyricSpring=="boolean"?T.enableLyricSpring:L.enableLyricSpring,this.state.wordFadeWidth=typeof T.wordFadeWidth=="number"?T.wordFadeWidth:L.wordFadeWidth,this.state.lyricAlignAnchor=typeof T.lyricAlignAnchor=="string"?T.lyricAlignAnchor:L.lyricAlignAnchor,this.state.showTranslatedLyric=typeof T.showTranslatedLyric=="boolean"?T.showTranslatedLyric:L.showTranslatedLyric,this.state.showRomanLyric=typeof T.showRomanLyric=="boolean"?T.showRomanLyric:L.showRomanLyric,this.state.swapLyricPositions=typeof T.swapLyricPositions=="boolean"?T.swapLyricPositions:L.swapLyricPositions,this.state.showbgLyric=typeof T.showbgLyric=="boolean"?T.showbgLyric:L.showbgLyric,this.state.swapDuetsPositions=typeof T.swapDuetsPositions=="boolean"?T.swapDuetsPositions:L.swapDuetsPositions,this.state.advanceLyricTiming=typeof T.advanceLyricTiming=="boolean"?T.advanceLyricTiming:L.advanceLyricTiming,this.state.singleLyrics=typeof T.singleLyrics=="boolean"?T.singleLyrics:L.singleLyrics,this.state.backgroundLowFreqVolume=typeof T.backgroundLowFreqVolume=="number"?T.backgroundLowFreqVolume:L.backgroundLowFreqVolume,this.state.coverStyle=typeof T.coverStyle=="string"?T.coverStyle:L.coverStyle,this.state.fftDataRangeMin=typeof T.fftDataRangeMin=="number"?T.fftDataRangeMin:L.fftDataRangeMin,this.state.fftDataRangeMax=typeof T.fftDataRangeMax=="number"?T.fftDataRangeMax:L.fftDataRangeMax,this.state.posYSpringMass=typeof T.posYSpringMass=="number"?T.posYSpringMass:L.posYSpringMass,this.state.backgroundFPS=typeof T.backgroundFPS=="number"?T.backgroundFPS:L.backgroundFPS,this.state.posYSpringDamping=typeof T.posYSpringDamping=="number"?T.posYSpringDamping:L.posYSpringDamping,this.state.posYSpringStiffness=typeof T.posYSpringStiffness=="number"?T.posYSpringStiffness:L.posYSpringStiffness,this.state.posYSpringSoft=typeof T.posYSpringSoft=="boolean"?T.posYSpringSoft:L.posYSpringSoft,this.state.scaleSpringMass=typeof T.scaleSpringMass=="number"?T.scaleSpringMass:L.scaleSpringMass,this.state.scaleSpringDamping=typeof T.scaleSpringDamping=="number"?T.scaleSpringDamping:L.scaleSpringDamping,this.state.scaleSpringStiffness=typeof T.scaleSpringStiffness=="number"?T.scaleSpringStiffness:L.scaleSpringStiffness,this.state.scaleSpringSoft=typeof T.scaleSpringSoft=="boolean"?T.scaleSpringSoft:L.scaleSpringSoft,this.urlOverrides.has("playbackRate")||(this.state.playbackRate=typeof T.playbackRate=="number"?T.playbackRate:L.playbackRate),this.urlOverrides.has("volume")||(this.state.volume=typeof T.volume=="number"?T.volume:L.volume),this.urlOverrides.has("loopPlay")||(this.state.loopPlay=typeof T.loopPlay=="boolean"?T.loopPlay:L.loopPlay),this.state.showRemainingTime=typeof T.showRemainingTime=="boolean"?T.showRemainingTime:L.showRemainingTime,this.urlOverrides.has("autoPlay")||(this.state.autoPlay=typeof T.autoPlay=="boolean"?T.autoPlay:L.autoPlay),this.urlOverrides.has("musicUrl")||(this.state.musicUrl=typeof T.musicUrl=="string"?T.musicUrl:L.musicUrl),this.urlOverrides.has("lyricUrl")||(this.state.lyricUrl=typeof T.lyricUrl=="string"?T.lyricUrl:L.lyricUrl),this.urlOverrides.has("coverUrl")||(this.state.coverUrl=typeof T.coverUrl=="string"?T.coverUrl:L.coverUrl),this.urlOverrides.has("songTitle")||(this.state.songTitle=typeof T.songTitle=="string"?T.songTitle:L.songTitle),this.urlOverrides.has("songArtist")||(this.state.songArtist=typeof T.songArtist=="string"?T.songArtist:L.songArtist),this.urlOverrides.has("isRangeMode")||(this.state.isRangeMode=typeof T.isRangeMode=="boolean"?T.isRangeMode:L.isRangeMode),this.urlOverrides.has("rangeStartTime")||(this.state.rangeStartTime=typeof T.rangeStartTime=="number"?T.rangeStartTime:L.rangeStartTime),this.urlOverrides.has("rangeEndTime")||(this.state.rangeEndTime=typeof T.rangeEndTime=="number"?T.rangeEndTime:L.rangeEndTime),this.audio.playbackRate=this.state.playbackRate,this.audio.volume=this.state.volume/100,this.musicUrl&&typeof T.musicUrlInput=="string"&&!this.urlOverrides.has("musicUrlInput")&&(this.musicUrl.value=T.musicUrlInput),this.lyricUrl&&typeof T.lyricUrlInput=="string"&&!this.urlOverrides.has("lyricUrlInput")&&(this.lyricUrl.value=T.lyricUrlInput),this.coverUrl&&typeof T.coverUrlInput=="string"&&!this.urlOverrides.has("coverUrlInput")&&(this.coverUrl.value=T.coverUrlInput),this.songTitleInput&&typeof T.songTitleInput=="string"&&!this.urlOverrides.has("songTitleInput")&&(this.songTitleInput.value=T.songTitleInput),this.songArtistInput&&typeof T.songArtistInput=="string"&&!this.urlOverrides.has("songArtistInput")&&(this.songArtistInput.value=T.songArtistInput),this.updateSongInfo(),this.songTitle&&this.checkAndUpdateMarquee(this.songTitle),this.songArtist&&this.checkAndUpdateMarquee(this.songArtist),T.controlPointCode&&this.controlPointCodeInput&&!this.urlOverrides.has("controlPointCode")&&(this.controlPointCodeInput.value=T.controlPointCode),this.lyricDelayInput&&!this.urlOverrides.has("lyricDelay")&&(this.lyricDelayInput.value=this.state.lyricDelay.toString()),this.applyLyricDelay(this.state.lyricDelay,{skipSave:!0}),this.updateBackgroundUI(),this.updateBackground(),this.updateFPSDisplay(),this.updateRoundedCover(),this.updateCoverStyle(),this.updateLyricsDisplay(),this.updateMarqueeSettings(),this.lyricPlayer.setAlignPosition(this.state.lyricAlignPosition),this.invertColors(this.state.invertColors),this.lyricPlayer.setEnableBlur(this.state.enableLyricBlur),this.lyricPlayer.setEnableScale(this.state.enableLyricScale),this.lyricPlayer.setEnableSpring(this.state.enableLyricSpring),this.lyricPlayer.setWordFadeWidth(this.state.wordFadeWidth),this.lyricPlayer.setLinePosYSpringParams({mass:this.state.posYSpringMass,damping:this.state.posYSpringDamping,stiffness:this.state.posYSpringStiffness,soft:this.state.posYSpringSoft}),this.lyricPlayer.setLineScaleSpringParams({mass:this.state.scaleSpringMass,damping:this.state.scaleSpringDamping,stiffness:this.state.scaleSpringStiffness,soft:this.state.scaleSpringSoft});const R=window.devicePixelRatio||1;this.background.setRenderScale(this.state.backgroundRenderScale*R),this.updateTimeDisplay(),T.controlPointCode&&!this.urlOverrides.has("controlPointCode")&&this.applyControlPointCode()}if(this.lyricAlignPositionValue&&(this.lyricAlignPositionValue.textContent=this.state.lyricAlignPosition.toFixed(1)),this.springPosYMassValue&&(this.springPosYMassValue.textContent=this.state.posYSpringMass.toFixed(1)),this.springPosYDampingValue&&(this.springPosYDampingValue.textContent=this.state.posYSpringDamping.toString()),this.springPosYStiffnessValue&&(this.springPosYStiffnessValue.textContent=this.state.posYSpringStiffness.toString()),this.springScaleMassValue&&(this.springScaleMassValue.textContent=this.state.scaleSpringMass.toFixed(1)),this.springScaleDampingValue&&(this.springScaleDampingValue.textContent=this.state.scaleSpringDamping.toString()),this.springScaleStiffnessValue&&(this.springScaleStiffnessValue.textContent=this.state.scaleSpringStiffness.toString()),this.hidePassedLyricsCheckbox&&(this.hidePassedLyricsCheckbox.checked=this.state.hidePassedLyrics),this.enableLyricBlur&&(this.enableLyricBlur.checked=this.state.enableLyricBlur),this.enableLyricScale&&(this.enableLyricScale.checked=this.state.enableLyricScale),this.enableLyricSpring){this.enableLyricSpring.checked=this.state.enableLyricSpring;const T=document.getElementById("spring-desc");T&&(T.style.display=this.state.enableLyricSpring?"block":"none")}this.wordFadeWidthInput&&(this.wordFadeWidthInput.value=this.state.wordFadeWidth.toString()),this.wordFadeWidthValue&&(this.wordFadeWidthValue.textContent=this.state.wordFadeWidth.toFixed(2)),this.showbgLyricCheckbox&&(this.showbgLyricCheckbox.checked=this.state.showbgLyric),this.swapDuetsPositionsCheckbox&&(this.swapDuetsPositionsCheckbox.checked=this.state.swapDuetsPositions),this.urlOverrides.clear()}catch(P){console.log("加载背景设置失败:",P)}}updateBackgroundUI(){if(this.bgFlowSpeed&&(this.bgFlowSpeed.value=this.state.backgroundFlowSpeed.toString()),this.bgFlowSpeedValue&&(this.bgFlowSpeedValue.textContent=this.state.backgroundFlowSpeed.toFixed(1)),this.bgColorMask&&(this.bgColorMask.checked=this.state.backgroundColorMask),this.bgMaskColor&&(this.bgMaskColor.value=this.state.backgroundMaskColor),this.bgMaskOpacity&&(this.bgMaskOpacity.value=this.state.backgroundMaskOpacity.toString()),this.bgMaskOpacityValue&&(this.bgMaskOpacityValue.textContent=`${this.state.backgroundMaskOpacity}%`),this.showFPSCheckbox&&(this.showFPSCheckbox.checked=this.state.showFPS),this.backgroundStyleSelect&&(this.backgroundStyleSelect.value=this.state.backgroundType),this.coverBlurLevel&&(this.coverBlurLevel.value=this.state.coverBlurLevel.toString()),this.coverBlurLevelValue&&(this.coverBlurLevelValue.textContent=`${this.state.coverBlurLevel}%`),this.invertColorsCheckbox&&(this.invertColorsCheckbox.checked=this.state.invertColors),this.dominantColorInput&&this.isColorsInitialized&&(this.dominantColorInput.value=this.state.manualDominantColor||this.originalDominant),this.dominantColorLightInput&&this.isColorsInitialized&&(this.dominantColorLightInput.value=this.state.manualDominantColorLight||this.originalLight),this.dominantColorDarkInput&&this.isColorsInitialized&&(this.dominantColorDarkInput.value=this.state.manualDominantColorDark||this.originalDark),this.roundedCoverSlider&&(this.roundedCoverSlider.value=this.state.roundedCover.toString()),this.roundedCoverValue&&(this.roundedCoverValue.textContent=`${this.state.roundedCover}%`),this.coverRotationSlider&&(this.coverRotationSlider.value=this.state.coverRotationSpeed.toString()),this.coverRotationValue&&(this.coverRotationValue.textContent=`${this.state.coverRotationSpeed}rpm`),this.enableMarqueeCheckbox&&(this.enableMarqueeCheckbox.checked=this.state.marqueeEnabled),this.bgRenderScale&&(this.bgRenderScale.value=this.state.backgroundRenderScale.toString()),this.bgRenderScaleValue&&(this.bgRenderScaleValue.textContent=this.state.backgroundRenderScale.toFixed(2)),this.bgFPS&&(this.bgFPS.value=this.state.backgroundFPS.toString()),this.bgFPSValue&&(this.bgFPSValue.textContent=`${this.state.backgroundFPS}fps`),this.lyricAlignPosition&&(this.lyricAlignPosition.value=this.state.lyricAlignPosition.toString()),this.lyricAlignPositionValue&&(this.lyricAlignPositionValue.textContent=this.state.lyricAlignPosition.toFixed(1)),this.hidePassedLyricsCheckbox&&(this.hidePassedLyricsCheckbox.checked=this.state.hidePassedLyrics),this.fluidDesc&&(this.fluidDesc.style.display=this.state.backgroundType==="fluid"?"block":"none"),this.coverDesc&&(this.coverDesc.style.display=this.state.backgroundType==="cover"?"block":"none"),this.solidDesc&&(this.solidDesc.style.display=this.state.backgroundType==="solid"?"block":"none"),this.solidOptions){const L=this.state.backgroundType==="cover"&&this.state.backgroundColorMask&&this.state.backgroundMaskOpacity===0;this.setOptionsVisibility(this.solidOptions,L,["neumorphismA","neumorphismB"])}if(this.loopPlayCheckbox&&(this.loopPlayCheckbox.checked=this.state.loopPlay),this.playbackRateControl&&(this.playbackRateControl.value=this.state.playbackRate.toString()),this.playbackRateValue&&(this.playbackRateValue.textContent=`${this.state.playbackRate.toFixed(2)}x`),this.updatePlaybackRateIcon(this.state.playbackRate),this.volumeControl&&(this.volumeControl.value=this.state.volume.toString()),this.volumeValue&&(this.volumeValue.textContent=`${Math.round(this.state.volume)}%`),this.audio.playbackRate=this.state.playbackRate,this.audio.volume=this.state.volume/100,this.updateVolumeIcon(Math.round(this.state.volume)),this.showbgLyricCheckbox&&(this.showbgLyricCheckbox.checked=this.state.showbgLyric),this.swapDuetsPositionsCheckbox&&(this.swapDuetsPositionsCheckbox.checked=this.state.swapDuetsPositions),this.advanceLyricTimingCheckbox&&(this.advanceLyricTimingCheckbox.checked=this.state.advanceLyricTiming),this.fftDataRangeMin&&this.fftDataRangeMinValue&&(this.fftDataRangeMin.value=this.state.fftDataRangeMin.toString(),this.fftDataRangeMinValue.textContent=`${this.state.fftDataRangeMin}Hz`),this.fftDataRangeMax&&this.fftDataRangeMaxValue&&(this.fftDataRangeMax.value=this.state.fftDataRangeMax.toString(),this.fftDataRangeMaxValue.textContent=`${this.state.fftDataRangeMax}Hz`),this.bgLowFreqVolume&&(this.bgLowFreqVolume.value=this.state.backgroundLowFreqVolume.toString()),this.bgLowFreqVolumeValue){const L=R=>`${(80+R*40).toFixed(0)}hz`;this.bgLowFreqVolumeValue.textContent=L(this.state.backgroundLowFreqVolume)}const P=document.getElementById("springPosYSoft")?.parentElement;P&&(P.style.display=this.state.posYSpringDamping<1?"flex":"none");const T=document.getElementById("springScaleSoft")?.parentElement;T&&(T.style.display=this.state.scaleSpringDamping<1?"flex":"none")}initCoverBlurBackground(){this.coverBlurBackground.style.position="absolute",this.coverBlurBackground.style.top="0",this.coverBlurBackground.style.left="0",this.coverBlurBackground.style.width="100%",this.coverBlurBackground.style.height="100%",this.coverBlurBackground.style.backgroundSize="cover",this.coverBlurBackground.style.backgroundPosition="center",this.coverBlurBackground.style.backgroundRepeat="no-repeat",this.coverBlurBackground.style.filter="blur(20px)",this.coverBlurBackground.style.transform="scale(1.1)",this.coverBlurBackground.style.zIndex="0",this.coverBlurBackground.style.display="none"}applyControlPointCode(){if(!this.controlPointCodeInput||!this.background)return;this.saveBackgroundSettings();const code=this.controlPointCodeInput.value.trim();if(!code){try{const P=this.background.renderer;if(!P||!(P instanceof hi))return;P.manualControl=!1,P.setAlbum(resolveDefaultCover(this.state.coverUrl))}catch(P){console.error("Failed to reset to default control points:",P)}return}try{const renderer=this.background.renderer;if(!renderer||!(renderer instanceof hi))return;let presetData;try{presetData=JSON.parse(code)}catch(jsonError){try{presetData=eval(`(${code})`)}catch(P){console.error("Failed to parse control point code:",jsonError,P);return}}if(!presetData)return;let width=4,height=4,controlPointsData=[];if(typeof presetData=="object"&&"width"in presetData&&"height"in presetData&&"conf"in presetData)width=presetData.width,height=presetData.height,controlPointsData=presetData.conf;else if(Array.isArray(presetData))if(typeof presetData[0]=="number"&&typeof presetData[1]=="number")width=presetData[0],height=presetData[1],controlPointsData=presetData.slice(2);else if(Array.isArray(presetData[0])){controlPointsData=presetData;let P=0,T=0;for(const L of controlPointsData)Array.isArray(L)&&L.length>=2&&(P=Math.max(P,L[0]),T=Math.max(T,L[1]));width=P+1,height=T+1}else return;else return;if(renderer.manualControl=!0,(!renderer.meshStates||renderer.meshStates.length===0)&&(renderer.setAlbum(resolveDefaultCover(this.state.coverUrl)),!renderer.meshStates||renderer.meshStates.length===0))return;const latestMeshState=renderer.meshStates[renderer.meshStates.length-1];if(!latestMeshState||!latestMeshState.mesh)return;const mesh=latestMeshState.mesh;if(width=Math.max(2,width),height=Math.max(2,height),mesh.resizeControlPoints){try{mesh.resizeControlPoints(width,height)}catch{return}const P=2/(width-1),T=2/(height-1);let L=0;for(let R=0;R<controlPointsData.length;R++){const I=controlPointsData[R];if(Array.isArray(I)&&I.length>=8){const F=I[0],D=I[1],V=I[2],q=I[3],G=I[4],z=I[5],Q=I[6],tt=I[7];if(F>=0&&F<width&&D>=0&&D<height){const gt=mesh.getControlPoint(F,D);if(gt)try{gt.location.x=V,gt.location.y=q,gt.uRot=G*Math.PI/180,gt.vRot=z*Math.PI/180,gt.uScale=P*Q,gt.vScale=T*tt,L++}catch(yt){console.warn(`Failed to apply control point at (${F}, ${D}):`,yt)}}}}mesh.updateMesh()}}catch(P){console.error("Failed to apply control points:",P)}}updateBackground(){const P=resolveDefaultCover(this.state.coverUrl);if(this.state.backgroundType==="cover"){if(this.background.getElement().style.display="none",this.coverBlurBackground.style.display="block",this.coverBlurBackground.style.backgroundImage=`url(${P})`,this.state.backgroundColorMask){const R=this.state.backgroundMaskOpacity/100,I=this.state.backgroundMaskColor;this.coverBlurBackground.style.backgroundColor=I,this.coverBlurBackground.style.backgroundBlendMode="multiply",this.coverBlurBackground.style.opacity=R.toString()}else this.coverBlurBackground.style.backgroundColor="transparent",this.coverBlurBackground.style.backgroundBlendMode="normal",this.coverBlurBackground.style.opacity="1";const L=this.state.coverBlurLevel/100*100;this.coverBlurBackground.style.filter=`blur(${L}px)`,this.invertColors(this.state.invertColors)}else this.state.backgroundType==="solid"?(this.background.getElement().style.display="none",this.coverBlurBackground.style.display="none"):(this.background.getElement().style.display="block",this.coverBlurBackground.style.display="none",this.background.setAlbum(P),this.background.setStaticMode(!this.state.backgroundDynamic),this.background.setFlowSpeed(this.state.backgroundFlowSpeed));const T=window.devicePixelRatio||1;this.background.setRenderScale(this.state.backgroundRenderScale*T)}updateFPSDisplay(){this.stats&&(this.stats.dom.style.display=this.state.showFPS?"block":"none")}updatePlaybackRateIcon(P){this.speedLowIcon&&(this.speedLowIcon.style.display="none"),this.speedMediumIcon&&(this.speedMediumIcon.style.display="none"),this.speedHighIcon&&(this.speedHighIcon.style.display="none"),P<.75&&this.speedLowIcon?this.speedLowIcon.style.display="block":P>=.76&&P<=1.5&&this.speedMediumIcon?this.speedMediumIcon.style.display="block":this.speedHighIcon&&(this.speedHighIcon.style.display="block")}updateVolumeIcon(P){this.volumeOffIcon&&(this.volumeOffIcon.style.display="none"),this.volumeLowIcon&&(this.volumeLowIcon.style.display="none"),this.volumeMediumIcon&&(this.volumeMediumIcon.style.display="none"),this.volumeHighIcon&&(this.volumeHighIcon.style.display="none"),P===0&&this.volumeOffIcon?this.volumeOffIcon.style.display="block":P>0&&P<=35&&this.volumeLowIcon?this.volumeLowIcon.style.display="block":P>35&&P<=65&&this.volumeMediumIcon?this.volumeMediumIcon.style.display="block":this.volumeHighIcon&&(this.volumeHighIcon.style.display="block")}applyLyricDelay(P,T){if(this.state.lyricDelay=P,this.pendingLyricDelay=P,!this.lyricPlayer)return;if(!this.audio){this.lyricPlayer.setCurrentTime(P),this.pendingLyricDelay=null;return}if(this.processedLyricLines.length===0)return;const L=this.audio.currentTime*1e3+P;this.lyricPlayer.setCurrentTime(L),this.pendingLyricDelay=null,T?.skipSave||this.saveBackgroundSettings()}initAlbumCoverEffects(){this.albumCoverContainer&&(this.albumCoverContainer.addEventListener("mouseenter",this.handleAlbumCoverHover.bind(this)),this.albumCoverContainer.addEventListener("mousemove",this.handleAlbumCoverHover.bind(this)),this.albumCoverContainer.addEventListener("mouseleave",this.resetAlbumCoverEffects.bind(this)),this.albumCoverContainer.addEventListener("touchstart",this.handleAlbumCoverTouch.bind(this),{passive:!0}),this.albumCoverContainer.addEventListener("touchmove",this.handleAlbumCoverTouch.bind(this),{passive:!0}),this.albumCoverContainer.addEventListener("touchend",this.resetAlbumCoverEffects.bind(this)))}handleAlbumCoverHover(P){if(!this.albumCoverContainer)return;const T=this.albumCoverContainer.getBoundingClientRect(),L=P.clientX-T.left,R=P.clientY-T.top,I=T.width/2,F=T.height/2;let D=-((R-F)/F)*20,V=-((I-L)/I)*20;const q=R<F,G=L<I,z=.6;q&&G?D*=z:q&&!G?(D*=z,V*=z):!q&&G||(V*=z),this.applyLiquifyEffect(D,V,.95)}handleAlbumCoverTouch(P){if(!this.albumCoverContainer||P.touches.length===0)return;const T=P.touches[0],L=this.albumCoverContainer.getBoundingClientRect(),R=T.clientX-L.left,I=T.clientY-L.top,F=L.width/2,D=L.height/2;let V=-((I-D)/D)*20,q=-((F-R)/F)*20;const G=I<D,z=R<F,Q=.6;G&&z?V*=Q:G&&!z?(V*=Q,q*=Q):!G&&z||(q*=Q),this.applyLiquifyEffect(V,q,.95)}applyLiquifyEffect(P,T,L){this.albumCoverContainer&&(this.albumCoverContainer.style.transform=`perspective(800px) rotateX(${P}deg) rotateY(${T}deg) scale(${L})`,this.albumCoverContainer.style.boxShadow="0 25px 35px rgba(0, 0, 0, 0.25), 0 15px 20px rgba(0, 0, 0, 0.2)")}resetAlbumCoverEffects(){this.albumCoverContainer&&(this.albumCoverContainer.style.transform="",this.albumCoverContainer.style.boxShadow="0 20px 25px rgba(0, 0, 0, 0.18), 0 10px 25px rgba(0, 0, 0, 0.18)")}}const player=new WebLyricsPlayer;window.player=player;window.globalLyricPlayer=player.getLyricPlayer();window.globalBackground=player.getBackground();player.start();
